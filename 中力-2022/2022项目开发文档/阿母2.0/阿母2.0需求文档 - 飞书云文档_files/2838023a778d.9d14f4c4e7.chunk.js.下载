(window.webpackJsonp=window.webpackJsonp||[]).push([["2838023a778d"],{vb1282:function(e,L,j){"use strict";j.r(L),function(l){j.d(L,"UrlEditor",function(){return T});var e,t,i,o,a,p=j("vb143"),n=j("vb152"),h=j.n(n),c=j("vb162"),s=j("vb195"),r=j("vb103"),f=j.n(r),d=j("vb159"),u=j.n(d),b=(j("vb147"),j("vb148"),j("vb112"),j("vb164"),j("vb167"),j("vb113"),j("vb119"),j("vb116"),j("vb155"),j("vb118"),j("vb120"),j("vb174"),j("vb121"),j("vb117"),j("vb115"),j("vb111")),E=(j("vb126"),j("vb125"),j("vb650")),m=j("vb488"),v=j("vb955"),y=j("vb142"),g=j("vb139"),k=j("vb444"),x=j("vb138"),C=j("vb2158"),w=(j("vb537"),j("vb129"),j("vb223"),j("vb214"),j("vb232"),j("vb187"),j("vb225"),j("vb224"),j("vb128"),j("vb122"),j("vb233"),j("vb234"),j("vb235"),j("vb123"),j("vb236"),j("vb193"),j("vb237"),j("vb238"),j("vb124"),j("vb239"),j("vb104"),j("vb240"),j("vb134"),j("vb131"),j("vb226"),j("vb241"),j("vb114"),j("vb110"),j("vb242"),j("vb127"),j("vb132"),j("vb227"),j("vb135"),j("vb228"),j("vb229"),j("vb133"),j("vb243"),j("vb262"),j("vb244"),j("vb245"),j("vb246"),j("vb247"),j("vb194"),j("vb248"),j("vb249"),j("vb201"),j("vb260"),j("vb267"),j("vb250"),j("vb136"),j("vb251"),j("vb130"),j("vb252"),function(n){function r(){var a;Object(p.ov)(this,r);for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];return(a=n.call.apply(n,[this].concat(t))||this).state=Object.assign({},a.props),a.setRef=function(e){a.ref=e},a.setTextInput=function(e){a.textInput=e},a.handleKeyDown=function(e){var t=e.keyCode;t!==p.sx.Enter&&t!==p.sx.Tab||(e.stopImmediatePropagation(),e.stopPropagation(),t===p.sx.Enter&&a.handleConfirm())},a.handleTextChange=function(e){a.setState({text:e.target.value})},a.handleUrlChange=function(e){a.setState({link:e.target.value})},a.handleConfirm=function(){var e=a.props,t=e.onConfirm,i=e.onCancel,n=e.collectEvent,r=a.state,o=r.text,l=r.link;n&&(o!==e.text&&n("edit_text"),l!==e.link&&n("edit_link"),o!==e.text&&l!==e.link&&n("edit_all")),o!==e.text||l!==e.link?t(o,l):i()},a}return Object(p.bu)(r,n),Object(p.Pw)(r,[{key:"componentDidMount",value:function(){this.textInput&&this.textInput.focus(),this.ref&&this.ref.addEventListener("keydown",this.handleKeyDown,!0),this.props.onShow&&this.props.onShow()}},{key:"componentWillUnmount",value:function(){var e;null===(e=this.ref)||void 0===e||e.removeEventListener("keydown",this.handleKeyDown,!0)}},{key:"render",value:function(){var e=this.props,t=e.style,i=e.onCancel,n=this.state,r=n.text,o=n.link;return f.a.createElement("form",{className:"bitable-hyperlink-editor",style:t,ref:this.setRef},f.a.createElement("div",{className:"b-field-label"},f.a.createElement("div",{className:"b-field-label__text"},l("bitable.field_url.text")),f.a.createElement(b.Input,{ref:this.setTextInput,type:"text",value:r,onChange:this.handleTextChange})),f.a.createElement("div",{className:"b-field-label"},f.a.createElement("div",{className:"b-field-label__text"},l("bitable.field_url")),f.a.createElement(b.Input,{type:"text",value:o,onChange:this.handleUrlChange})),f.a.createElement("div",{className:"bitable-hyperlink-cancel-submit-button-group"},f.a.createElement(p.hX,{onCancel:i,onSubmit:this.handleConfirm})))}}]),r}(r.PureComponent)),I=["type","link"],O="BITABLE_URL_EDITOR_CONTAINER",V=272,S=230,R=!1,T=(e=Object(p.zx)(p.Ax.MentionIconHelper),t=Object(p.zx)(p.Ax.ConvertUrlHelper),i=function(n){function r(){var v;Object(p.ov)(this,r);for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];return(v=n.call.apply(n,[this].concat(t))||this).logger=p.rH.createLog("urlEditor"),v.unmounted=!1,v.defaultEditorValue=null,Object(p.Bx)(v,"mentionIconHelper",o,Object(p.Cx)(v)),Object(p.Bx)(v,"convertUrlHelper",a,Object(p.Cx)(v)),v.state={offsetY:0,textEditorVisible:!1,pluginLoaded:R},v.bindDomEvent=function(){v.props.editable&&v.urlEditorRef.addEventListener("keydown",v.onKeyDown,!0),document.body.addEventListener("mousedown",v.handleClickOutside),document.addEventListener("dragstart",v.onDragStart)},v.unbindDomEvent=function(){v.props.editable&&v.urlEditorRef.removeEventListener("keydown",v.onKeyDown,!0),document.body.removeEventListener("mousedown",v.handleClickOutside),document.removeEventListener("dragstart",v.onDragStart)},v.onDragStart=function(){var e=v.props.renderer.getActiveView();e&&e.type===p.az.Form&&v.setState({textEditorVisible:!1})},v.handleClickOutside=function(e){e.target&&v.urlEditorRef&&!v.urlEditorRef.contains(e.target)&&v.setState({textEditorVisible:!1})},v.onKeyDown=function(e){var t=e.shiftKey,i=e.altKey,n=e.keyCode,r=e.metaKey,o=e.ctrlKey;if(p.rx.mac){var l=[r,o];o=l[0],r=l[1]}if(o||r||t||i||(!v.props.disableEnter||n!==p.sx.Enter||v.isMentionBoxVisible())&&n!==p.sx.Tab||v.state.textEditorVisible)if(n!==p.sx.Esc||o||r||t||i){if(!o&&!r&&(n>=p.sx.Space&&n<=p.sx.F15||n===p.sx.Ime)){var a=v.props.onChange;a&&a()}}else v.isMentionBoxVisible()&&(e.ignoreKeybinding=!0);else{e.stopImmediatePropagation(),e.preventDefault();var c=v.props.renderer;c.keybindingService&&c.keybindingService.dispatch(new p.mH(e))}},v.setUrlEditorRef=function(e){v.urlEditorRef=e},v.setHiddenFocusElement=function(e){v.hiddenFocusElement=e},v.setEditorRef=function(e){e&&((v.editorReact=e).setSelectionToLastCharacter||(e.setSelectionToLastCharacter=function(){Object(k.c)(this.getEditor())}),e.replaceEditorValue||(e.replaceEditorValue=function(e){var t=this.getEditor();Object(k.b)(t,e,E.a)}),e.getSegmentArray||(e.getSegmentArray=function(){var e=this.getEditor();return e.callStack.inCallStackIfNecessary("getSegment",function(){e.fastIncorp()}),Object(m.g)(e)}),e.on("focus",function(e){v.setState({textEditorVisible:!1})}))},v.executeSetRecordAction=function(e,t){var i=v.props,n=i.executeAction,r=i.tableId,o=i.viewId;if(!i.editable)return{result:p.Ey.None};var l=t.recordId,a=t.fieldId,c=t.field;return n(function(){return{cmd:p.Fy.SetRecord,tableId:r,viewId:o,recordId:l,data:Object(p.Ww)({},a,{type:c.type,value:e})}})},v.toggleTextEditor=function(){v.state.textEditorVisible?v.closeTextEditor():v.onClickUrlIcon()},v.onClickUrlIcon=function(){p.cz.collectClickEvent(p.Bc.CcmBitableLinkFieldModifyClick,{click:p.wO.ClickIcon,target:p.Rw.CcmBitableLinkFieldModifyView}),v.showTextEditor()},v.showTextEditor=function(){v.setState({textEditorVisible:!0}),v.collectEvent("open_menu")},v.closeTextEditor=function(){v.setState({textEditorVisible:!1})},v.handleUrlChange=function(e,t){p.cz.collectClickEvent(p.Bc.CcmBitableLinkFieldModifyClick,{click:p.wO.Confirm}),v.closeTextEditor();var i=v.getEditorValue(),n="",r="";if(i&&(n=i.text,r=Object(p.CH)(i.link||i.text)),n!==e&&v.onTextChange(),r!==t&&v.onLinkChange(),e=e.trim(),t=t.trim(),e||t){t=Object(p.CH)(t||e);var o={type:p.Vy.Url,text:e||t,link:t};v.setEditorValue([o])}else v.setEditorValue(null)},v.handleMentionConfirm=function(){v.collectEvent("mention_doc")},v.handleClickHyperlink=function(e){var t,i,n;if(null!==(t=e.target.parentElement)&&void 0!==t&&null!==(i=t.parentElement)&&void 0!==i&&null!==(n=i.parentElement)&&void 0!==n&&n.classList.contains("ace-line")){var r;e.preventDefault(),e.stopPropagation();var o=v.getEditorValue();o&&v.handleSecureLink(Object(p.CH)(o.link||o.text));var l=v.props,a=l.tableId,c=l.viewId,s=l.fieldId,d=l.bitableStore,u=l.renderer.getActiveView(),b=null===(r=d.base.getTableById(a))||void 0===r?void 0:r.getField(s||"");u&&b&&(u&&p.ob.collectBitableEvent(p.On.BitableOpenLink,{table_id:a,view_id:c,bitable_view_type:p.Cz[u.type],bitable_field_type:p.lC[p.ex.Url]},!0),p.cz.collectClickEvent(p.Bc.CcmBitableLinkFieldModifyClick,{click:p.wO.ClickImageLink,target:p.Rw.CcmDocsPageView}))}},v.handleSecureLink=function(e){var t=p.ob.CommonUtil.checkSecureLink&&p.ob.CommonUtil.checkSecureLink(e);Object(p.UQ)(t||e)},v.collectEvent=function(e){var t,i=v.props,n=i.tableId,r=i.viewId,o=i.fieldId,l=i.bitableStore,a=i.renderer,c=i.isCardEdit,s=a.getActiveView(),d=null===(t=l.base.getTableById(n))||void 0===t?void 0:t.getField(o||"");s&&d&&s&&p.ob.collectBitableEvent(p.On.BitableUrlOperation,{table_id:n,view_id:r,bitable_view_type:p.Cz[s.type],bitable_field_type:p.lC[d.fieldUIType],source:c?"card":"cell",action:e},!0)},v.onTextChange=function(){p.cz.collectClickEvent(p.Bc.CcmBitableLinkFieldModifyClick,{click:p.wO.EnterText})},v.onLinkChange=function(){p.cz.collectClickEvent(p.Bc.CcmBitableLinkFieldModifyClick,{click:p.wO.EnterLink})},v.onHyperlinkShow=function(){p.cz.collectBitableEvent(p.Rw.CcmBitableLinkFieldModifyView)},v.onCancel=function(){p.cz.collectClickEvent(p.Bc.CcmBitableLinkFieldModifyClick,{click:p.wO.Cancel}),v.closeTextEditor()},v}return Object(p.bu)(r,n),Object(p.Pw)(r,[{key:"componentDidMount",value:function(){var e=Object(p.uY)(h.a.mark(function e(){var t;return h.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.bindDomEvent(),this.gridContext=this.props.renderer.activeBitableWidget.getGridWidget(),this.unbindContextEvent=this.bindContextEvent(),R||!p.ob.loadAditPlugin){e.next=8;break}return e.next=6,p.ob.loadAditPlugin();case 6:R=!0,this.unmounted||this.setState({pluginLoaded:!0});case 8:null===(t=this.editorReact)||void 0===t||t.setCopyable(this.props.copyable);case 9:case"end":return e.stop()}},e,this)}));function t(){return e.apply(this,arguments)}return t}()},{key:"UNSAFE_componentWillReceiveProps",value:function(e){var t;!e.editable&&this.props.editable&&this.state.textEditorVisible&&this.closeTextEditor(),this.props.copyable!==e.copyable&&(null===(t=this.editorReact)||void 0===t||t.setCopyable(this.props.copyable))}},{key:"componentDidUpdate",value:function(){this.editorReact&&this.defaultEditorValue&&(this.setEditorValue(this.defaultEditorValue),this.defaultEditorValue=null)}},{key:"componentWillUnmount",value:function(){this.unmounted=!0,this.unbindDomEvent(),this.unbindContextEvent&&this.unbindContextEvent(),this.closeTextEditor()}},{key:"bindContextEvent",value:function(){var e=this;if(this.gridContext.addGridEventsBindListener){var t=Object(p.Ww)({},p.pC.ClickUrlTextEditor,this.onClickUrlIcon);return this.gridContext.addGridEventsBindListener(t),function(){e.gridContext.removeGridEventsBindListener(t)}}return c.a}},{key:"isMentionBoxVisible",value:function(){return!(!this.mention||!this.mention.docMention)&&this.mention.docMention.isMentionBoxVisible()}},{key:"focus",value:function(){if(this.props.editable&&this.editorReact){var e=document.querySelector(".etherpad-container-wrapper"),t=e?e.scrollTop:0,i=this.editorReact.getEditor();i&&i.focus(),this.editorReact.setSelectionToLastCharacter(),e&&(e.scrollTop=t),p.rx.safari&&setTimeout(function(){e&&(e.scrollTop=t)})}else this.hiddenFocusElement&&this.hiddenFocusElement.focus()}},{key:"onStartEdit",value:function(e,t){var i=this;!t&&this.props.editable||(this.closeTextEditor(),this.setEditorValue(e),this.editorReact&&(this.editorReact.setSelectionToLastCharacter(),this.editorReact.once("paint",function(){i.forceUpdate()})))}},{key:"setDefaultValue",value:function(){this.setEditorValue(this.props.value)}},{key:"setEditorValue",value:function(e){if(this.editorReact){var t=[];if(e){var i=e.length;if(1<i)for(var n=0;n<i;n++)t.push(e[n]),n!==i-1&&t.push({type:p.Vy.Text,text:","});else t=e.map(function(e){var t=e.type,i=e.link,n=Object(p.nA)(e,I);return t!==p.Vy.Url||i?e:Object.assign({},n,{type:p.Vy.Text})})}try{this.editorReact.replaceEditorValue(Object(E.c)(this.editorReact.getEditor(),this.mentionIconHelper,t))}catch(e){this.logger.error("set editor value error",{error:e}),p.hy.ravenCatch(e)}}else this.defaultEditorValue=e}},{key:"onEndEdit",value:function(){var t=Object(p.uY)(h.a.mark(function e(t){var i,n,r,o,l,a,c,s,d,u,b,v;return h.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.editorReact){e.next=2;break}return e.abrupt("return");case 2:if(t||!this.props.editable){e.next=23;break}if(i=this.props,n=i.tableId,r=i.recordId,o=i.fieldId,l=i.field,a=i.value,c=i.rect,s=i.bitableStore,d=i.viewId,(u=this.getEditorValue())&&!u.text&&(u=null,this.setEditorValue(null)),b=u?[u]:null,Object(p.yH)(this.props.relativeClass,l.fieldUIType,b),this.props.cardSyncMode===p.tx.OnDemand){e.next=12;break}this.tryResetEditor(),e.next=17;break;case 12:if(!b){e.next=17;break}return e.next=15,this.convertUrlHelper.executeConvertUrl(b,n,d,r,o,!1);case 15:(v=e.sent)&&(b=v,Object(p.yH)(this.props.relativeClass,l.fieldUIType,b),this.setEditorValue(b));case 17:return e.next=19,this.executeSetRecordAction(b,{recordId:r,fieldId:o,field:l,value:a,rect:c});case 19:e.sent.result===p.Ey.Success&&(this.collectEvent("edit_in_cell"),this.convertUrlHelper.executeConvertUrl(b,n,d,r,o,!1,s.getCommandManager())),e.next=24;break;case 23:this.tryResetEditor();case 24:case"end":return e.stop()}},e,this)}));function e(e){return t.apply(this,arguments)}return e}()},{key:"getEditorValue",value:function(){if(!this.editorReact)return null;var e=null;try{e=Object(v.a)(this.editorReact)}catch(e){this.logger.error("getSegmentArray error",{error:e}),p.hy.ravenCatch(e)}return this.normalise(e)}},{key:"normalise",value:function(e){if(Object(s.a)(e))return null;var t=e[0];return 1===e.length&&t.type===p.Vy.Mention?t:(e.find(function(e,t){return 0!==t&&e.type===p.Vy.Mention})&&p.ob.Toast.info({key:"url",content:l("bitable.field_url.at_doc_tip"),duration:3e3}),{type:p.Vy.Url,text:e.map(function(e){return e.text.trim()}).join(""),link:t.type!==p.Vy.Text?t.link:void 0})}},{key:"tryResetEditor",value:function(){if(this.editorReact){var e=this.editorReact.getEditor();e&&e.getInnerContainer()&&(this.setEditorValue(null),this.setState({offsetY:0}))}}},{key:"renderEditor",value:function(){var e,o=this;if(!this.state.pluginLoaded)return null;var t=this.props,i=t.bitableStore,n=t.isCardEdit,r=t.placeholder,l=t.editable,a=t.disableLink,c=t.tableId,s=null===(e=p.ob.MentionHelper)||void 0===e?void 0:e.mentionV2Enabled,d=Object(p.wH)(i,c),u=Object(p.Ry)(i),b=null==i?void 0:i.base.isPro(),v=l?r:Object(p.xH)({isFieldEditablePermission:d,placeholder:r,isPro:b});return f.a.createElement(k.a,{className:"b-small-scrollbar bitable-url-editor-content ".concat(this.props.editorContainerId),registerPlugin:function(e){var t=[];if(!a){var i,n;o.mention=new p.ob.AditPlugins.Mention({editor:e,source:u,showable:!0,type:"bitable",hoverArea:o.props.editorContainerId?".".concat(o.props.editorContainerId):"",displayLargePopover:!0,container:"#".concat(o.props.editorContainerId||"mainContainer"),boxWidth:280,mentionTypes:[p.mx.Doc,p.mx.Sheet,p.mx.Bitable,p.mx.Mindnote,p.mx.Wiki]});var r=new p.ob.AditPlugins.HyperLinks({editor:e,type:"bitable"});t.push(o.mention,r),null!==(i=(n=p.ob.MentionHelper).getUDMentionEnable)&&void 0!==i&&i.call(n)&&t.push(new p.ob.AditPlugins.CommonMention(e,"".concat(o.props.editorContainerId||"mainContainer"),{suiteType:p.ob.MentionHelper.suiteTypeNum,source:u,token:p.ob.CommonUtil.getToken(),tabs:["t-docs"],defaultNeedNotification:!s&&void 0,shouldMention:function(){return e.isEmpty()}},{viewPortContainer:".app-main-container"}))}return t.push(new p.ob.AditPlugins.Undo({editor:e}),new p.ob.AditPlugins.Redo({editor:e}),new p.ob.AditPlugins.Indent({editor:e}),new x.TextNodeDeserializer,new x.BlockElementDeserializer,new g.BlockPlugin({editor:e,blockManager:new g.BlockManager([new y.AtUserCreator({ExternalServices:p.ob.BlockExternalServices.AtUserCreator})])})),t},idleWorkTimer:!1,tagsIgnoreToParse:{table:!0},onInit:function(e){o.setEditorRef(e)},placeholder:n?v:r,editable:l})}},{key:"getPosition",value:function(){var e=this.props.isCardEdit,t=this.urlEditorRef,i={left:0,top:0,width:0,transform:"none"};if(e){var n=t.getBoundingClientRect(),r=1;i.top=n.height+r+p.vF,i.width=n.width}else{var o=t.getBoundingClientRect(),l=2;i.top=o.height-l+p.vF,i.left=-l,i.width=Math.max(o.width,V);var a=window.innerWidth,c=window.innerHeight,s=a-(o.left+i.width);s<0&&(i.left=s),c-(o.top+o.height+S+p.vF)<0&&(i.top=-l-p.vF,i.transform="translateY(-100%)")}return i}},{key:"render",value:function(){var e=this.props,t=e.editable,i=e.recordId,n=e.fieldId,r=e.anchorRef,o=this.state.textEditorVisible,l="".concat(O,"_").concat(i,"_").concat(n),a="",c="";if(o){var s=this.getEditorValue();s&&(a=s.text,c=Object(p.CH)(s.link||s.text))}return f.a.createElement("div",{className:u()("bitable-url-editor-container",{"bitable-url-editor-editable":t}),id:l,style:Object.assign({},this.props.style,{transform:r?"translateY(-".concat(this.state.offsetY,"px)"):"none"}),ref:this.setUrlEditorRef},f.a.createElement("input",{readOnly:!0,className:"hidden-input",ref:this.setHiddenFocusElement}),f.a.createElement("div",{className:"bitable-editor-wrapper b-ud-scrollbar",onClick:this.handleClickHyperlink},this.renderEditor(),t&&f.a.createElement(C.a,{className:"bitable-hyperlink-btn",onClick:this.toggleTextEditor})),o&&t&&f.a.createElement(w,{text:a,link:c,style:this.getPosition(),onCancel:this.onCancel,onConfirm:this.handleUrlChange,collectEvent:this.collectEvent,onShow:this.onHyperlinkShow}))}}]),r}(f.a.Component),o=Object(p.lz)(i.prototype,"mentionIconHelper",[e],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),a=Object(p.lz)(i.prototype,"convertUrlHelper",[t],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),i)}.call(this,j("vb163"))},vb955:function(e,t,i){"use strict";i.d(t,"a",function(){return o});var n=i("vb650"),r=i("vb143");i("vb147"),i("vb103"),i("vb148");function o(e){var t=e.getSegmentArray({linkReg:r.GH});return Object(n.b)(t)}}}]);
//# sourceMappingURL=//slardar.bytedance.net/api_v2/browser/jserr/get_sourcemap?bid=docs_pc&js_filename=2838023a778d.9d14f4c4e7.chunk.js