(window.webpackJsonp=window.webpackJsonp||[]).push([["1c383cd30b7c"],{vb1276:function(e,p,v){"use strict";v.r(p),function(f){v.d(p,"UserSelectorEditor",function(){return u});var e=v("vb152"),E=v.n(e),w=v("vb143"),o=v("vb145"),h=v("vb184"),t=v("vb103"),m=v.n(t),n=v("vb114"),r=(v("vb147"),v("vb148"),v("vb112"),v("vb164"),v("vb167"),v("vb113"),v("vb162")),I=(v("vb155"),v("vb116"),v("vb118"),v("vb120"),v("vb174"),v("vb119"),v("vb121"),v("vb117"),v("vb115"),v("vb111")),i=v("vb159"),y=v.n(i),d=(v("vb126"),v("vb125"),v("vb1905")),g=v("vb344"),s=v("vb395"),k=(v("vb129"),v("vb223"),v("vb214"),v("vb232"),v("vb187"),v("vb225"),v("vb224"),v("vb128"),v("vb122"),v("vb233"),v("vb234"),v("vb235"),v("vb123"),v("vb236"),v("vb193"),v("vb237"),v("vb238"),v("vb124"),v("vb239"),v("vb104"),v("vb240"),v("vb134"),v("vb131"),v("vb226"),v("vb241"),v("vb110"),v("vb242"),v("vb127"),v("vb132"),v("vb227"),v("vb135"),v("vb228"),v("vb229"),v("vb133"),v("vb243"),v("vb262"),v("vb244"),v("vb245"),v("vb246"),v("vb247"),v("vb194"),v("vb248"),v("vb249"),v("vb201"),v("vb260"),v("vb267"),v("vb250"),v("vb136"),v("vb251"),v("vb130"),v("vb252"),["prefixCls","className","style","name","type","disabled","tabIndex","onClick","onFocus","onBlur","id"]),l=function(r){function i(e){var n;Object(w.ov)(this,i),(n=r.call(this,e)||this).hanldeChange=function(e){var t=Object(w.Cx)(n).props;t.disabled||("checked"in t||n.setState({checked:e.target.checked}),t.onChange({target:Object.assign({},t,{checked:e.target.checked}),stopPropagation:function(){e.stopPropagation()},preventDefault:function(){e.preventDefault()}}))};var t="checked"in e?e.checked:e.defaultChecked;return n.state={checked:t},n}return Object(w.bu)(i,r),Object(w.Pw)(i,[{key:"UNSAFE_componentWillReceiveProps",value:function(e){"checked"in e&&this.setState({checked:e.checked})}},{key:"render",value:function(){var e,t=this.props,n=t.prefixCls,r=t.className;t.style;var i=t.name,a=t.type,o=t.disabled,s=t.tabIndex,c=t.onClick,u=t.onFocus,d=t.onBlur,l=t.id,b=Object(w.nA)(t,k),p=this.state.checked,v=Object.keys(b).reduce(function(e,t){return"aria-"!==t.substr(0,5)&&"data-"!==t.substr(0,5)&&"role"!==t||(e[t]=b[t]),e},{}),f=y()(n,r,(Object(w.Ww)(e={},"".concat(n,"-checked"),p),Object(w.Ww)(e,"".concat(n,"-disbaled"),o),Object(w.Ww)(e,"".concat(n,"-disabled"),o),e));return m.a.createElement("span",{className:f},m.a.createElement(I.Checkbox,Object(w.Kx)({id:l,name:i,type:a,disabled:o,tabIndex:s,checked:!!p,onClick:c,onFocus:u,onBlur:d,onChange:this.hanldeChange},v)))}}]),i}(t.PureComponent);l.defaultProps={prefixCls:"bitable-checkbox",className:"",style:{},type:"checkbox",defaultChecked:!1,onChange:r.a,onFocus:r.a,onBlur:r.a};var a,c,b=function(e){function t(){return Object(w.ov)(this,t),e.apply(this,arguments)||this}return Object(w.bu)(t,e),Object(w.Pw)(t,[{key:"render",value:function(){var e=this.props.message;return m.a.createElement("div",{className:"m-mention-nodata bitable-layout-row bitable-layout-main-center bitable-layout-cross-center"},m.a.createElement("p",{className:"m-mention-nodata__desc"},e||f("bitable.sp.search.not_found")))}}]),t}(t.Component);function j(){return(0<arguments.length&&void 0!==arguments[0]?arguments[0]:[]).reduce(function(e,t){return Object.assign(Object(w.Ww)({},t.userId,t),e)},{})}var u=Object(n.connect)(function(e){return{shareable:Object(w.jH)(e),shouldNotifyLark:Object(w.iJ)(e)}},{setEditorConfig:w.jJ},null,{forwardRef:!0})(((c=function(i){function a(){var C,t;Object(w.ov)(this,a);for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return(C=i.call.apply(i,[this].concat(n))||this).editorRef=null,C.isSearched=!1,C.hasNotifyIds=[],C.menuHeight=35,C.preventOpen=!1,C.focusAfterSetRef=!1,C.state={noSearchData:!1,options:[],values:[],userIdItemMap:{},position:{x:0,y:0},listLoaded:!1},C.supplementMentionId=function(e,t){var n=C.props.bitableStore,r=t.tableId,i=t.recordId,a=t.fieldId,o=e&&e.data&&e.data.entities&&e.data.entities.users;if(o){var s=n.getCellValue(r,i,a),c=!1;s&&s.users&&s.users.length&&(s.users.forEach(function(e){var t=o[e.userId];t&&(e.mentionId=t,c=!0)}),c&&C.executeSetRecordAction(s.users,t))}},C.setEditorRef=function(e){C.editorRef=e,C.editorRef&&(C.focusAfterSetRef&&C.editorRef.focus(),C.focusAfterSetRef=!1)},C.handleInviteMember=function(){w.ob.EventEmitter&&w.ob.EventEmitter.emit("bitable-invite-member"),C.onEndEdit()},C.renderFooter=function(){var e=C.props,t=e.shareable,n=e.withShareFooter,r=C.state,i=r.options,a=r.listLoaded,o=w.ob.CommonUtil.replaceName,s=Object(w.kJ)(),c=function(){return m.a.createElement("div",{className:"no-data-wrapper"},i.length?m.a.createElement(b,null):m.a.createElement("div",{className:y()("no-result-container",{"no-result-image-ind":s})},m.a.createElement(w.Bh,null),m.a.createElement("p",null,f("bitable.sp.search.not_found"))))},u=function(){return m.a.createElement("div",{className:"mention-checkbox-wrapper"},m.a.createElement(l,{checked:!!C.props.shouldNotifyLark,onChange:C.onToggleCheckbox}),m.a.createElement("span",{className:"mention-checkbox-text",onClick:C.onToggleCheckbox},o?o(f("lark.notification")):f("lark.notification")))};return m.a.createElement("div",null,C.state.noSearchData&&!Object(w.FE)()&&m.a.createElement(c,null),!C.state.noSearchData&&C.mentionAvailable&&m.a.createElement(u,null),s&&t&&n&&!i.length&&a&&m.a.createElement("div",{className:"pinned-entry-invite-member",onClick:C.handleInviteMember},m.a.createElement(d.a,null),f("bitable.sp.invite.member")))},C.onToggleCheckbox=function(){var e=C.props,t=e.shouldNotifyLark,n=e.setEditorConfig;n&&n({shouldNotifyLarkOnUser:!t})},C.onOpenSelectList=function(){C.props.renderer.setGlobalContext(w.aJ.CellSelectOpened,!0)},C.onSearch=function(e){C.searchUsers(e);var t=C.props,n=t.tableId,r=t.viewId,i=t.view;Object(w.cJ)(n,r,i,C.isMultiple)},C.onMultiChange=(t=Object(w.uY)(E.a.mark(function e(t){var n,r,i,a,o,s,c,u,d,l,b,p,v,f,h,m,I,y,g,k,S,O,x;return E.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=Object(w.Cx)(C),i=r.sourceData,a=r.state,o=a.options,s=a.userIdItemMap,c=r.props,u=c.renderer,d=c.shouldNotifyLark,l=c.tableId,b=c.viewId,p=c.recordId,v=c.fieldId,f=c.view,h=c.isCardEdit,m=c.bitableStore,i){e.next=3;break}return e.abrupt("return");case 3:return y=(I=null)===(n=w.ob.MentionHelper)||void 0===n?void 0:n.mentionV2Enabled,t.length&&(k=s,S=Object(w.nJ)(o,"userId"),I=t.map(function(e){var t=S[e],n=k[e]||t||null;if(m.base.setUserItemValid(n.userId),n){if(delete n.block_notify,delete n.not_notify,y&&!n.mentionId){var r,i=null===(r=w.ob.MentionHelper)||void 0===r?void 0:r.genMentionId();n.mentionId=i}var a=Object.assign({notify:d},t||{},{},n);return a.displayName&&delete a.displayName,a}return null}).filter(function(e){return!!e}).slice(0,100),null===(g=u.mentionPermissionManager)||void 0===g||g.addUsers(t)),C.props.cardSyncMode===w.tx.OnDemand&&(C.setState({values:t,userIdItemMap:j(I||[])},function(){return C.updatePosition()}),C.editorRef&&!C.editorRef.isOpened()&&C.focus()),O=C.isSearched,x=u.activeBitableWidget.isFloatLayerOpen,f&&w.ob.collectBitableEvent(w.On.BitableRecordEdit,Object.assign({smartable_token:m.md5Token,row:f.getVisibleRecordIndexById(p),col:f.getFieldIndexById(v),table_id:l,view_id:b,bitable_editor_type:h?"card":"cell",bitable_view_type:w.Cz[f.type],bitable_field_type:w.lC[w.ex.User],bitable_edit_search:O,bitable_notify_status:d,data_source:m.Options.module,is_record_floating:x},u.getRecordEditLogParams()),!0),C.editorRef&&!C.editorRef.isOpened()&&C.focus(),e.abrupt("return",C.executeSetRecordAction(I,{tableId:l,viewId:b,recordId:p,fieldId:v}));case 12:case"end":return e.stop()}},e)})),function(e){return t.apply(this,arguments)}),C.executeSetRecordAction=function(e,t){var n=C.props,r=n.executeAction;if(n.editable){var i=t.tableId,a=t.viewId,o=t.recordId,s=t.fieldId;return r(function(){return{cmd:w.Fy.SetRecord,tableId:i,viewId:a,recordId:o,data:Object(w.Ww)({},s,{value:e&&e.length?{users:e}:null,type:w.og.User})}})}},C.onDropdownVisibleChange=function(e,t){e&&(t&&(C.isDropdownReverse=t.reverse,C.updatePosition()),C.searchUsers(""))},C.onOptionClick=function(e,t){var n=C.props,r=n.tableId,i=n.viewId,a=n.view;!t&&Object(w.bJ)(r,i,a)},C}return Object(w.bu)(a,i),Object(w.Pw)(a,[{key:"componentDidMount",value:function(){this.gridContext=this.props.renderer.activeBitableWidget.getGridWidget(),this.unbindContextEvent=this.bindContextEvent(),this.bindDataSource(this.props)}},{key:"componentDidUpdate",value:function(e){e.tableId===this.props.tableId&&e.fieldId===this.props.fieldId&&e.recordId===this.props.recordId||this.bindDataSource(this.props)}},{key:"componentWillUnmount",value:function(){this.dataSource&&this.dataSource.destroyed(),this.unbindContextEvent&&this.unbindContextEvent()}},{key:"mentionAvailable",get:function(){var e;return(null===(e=this.props.view)||void 0===e?void 0:e.type)!==w.az.Form&&w.ob.config.ui.useNotifyLark}},{key:"focus",value:function(){this.editorRef?this.editorRef.focus():this.focusAfterSetRef=!0,this.updatePosition()}},{key:"onStartEdit",value:function(){this.editorRef&&this.editorRef.onStartEdit(),this.searchUsers("")}},{key:"onEndEdit",value:function(){this.editorRef&&this.editorRef.onEndEdit(),Object(w.yH)(this.props.relativeClass,w.ex.User,this.state.values),this.props.renderer.setGlobalContext(w.aJ.CellSelectOpened,!1),this.props.cardSyncMode!==w.tx.OnDemand&&this.mentionNotify()}},{key:"setDefaultValue",value:function(){this.setEditorValue(this.props.value||null)}},{key:"setEditorValue",value:function(e){var t=[];e&&e.users&&(t=e.users);var n=this.props,r=n.tableId,i=n.fieldId,a=n.recordId,o=n.bitableStore;this.dataSource=new w.lJ(r,i,a,o,t);var s=this.dataSource.getSource();s&&t.forEach(function(e){!s.userIdItemMap[e.userId]&&e.name&&(s.userIdItemMap[e.userId]={userId:e.userId,name:e.name,enName:e.enName||"",avatarUrl:e.avatarUrl||""})}),this.setState({values:t.map(function(e){return e.userId}),userIdItemMap:s?s.userIdItemMap:{}})}},{key:"bindDataSource",value:function(e){var t=this;this.dataSource&&this.dataSource.destroyed();var n,r=e.tableId,i=e.fieldId,a=e.recordId,o=e.bitableStore;this.props.cardSyncMode===w.tx.OnDemand&&(n=e.value&&e.value.users||[]),this.dataSource=new w.lJ(r,i,a,o,n),this.setSourceData(this.dataSource.getSource()),this.isSearched=!1,this.initNotifyIds(),this.dataSource.bindUpdate(function(e){t.setSourceData(e),t.props.cardSyncMode===w.tx.OnDemand&&t.mentionNotify()})}},{key:"bindContextEvent",value:function(){var e,r=this,t=(Object(w.Ww)(e={},w.pC.CoverMouseDown,function(){r.editorRef&&(r.preventOpen=r.editorRef.isOpened())}),Object(w.Ww)(e,w.pC.DeleteUserCell,function(e){var t=e.userId,n=e.userValue;r.onMultiChange((n&&n.users||[]).map(function(e){return e.userId}).filter(function(e){return e!==t})),Object(w.yH)(r.props.relativeClass,w.ex.User,r.state.values)}),Object(w.Ww)(e,w.pC.CoverClick,function(e){r.preventOpen||r.editorRef&&e&&(r.editorRef.isOpened()?r.props.endEdit&&r.props.endEdit(!0):(r.menuHeight=e.height,r.props.startEdit&&r.props.startEdit(!1),r.updatePosition()))}),e);return this.gridContext&&this.gridContext.addGridEventsBindListener(t),function(){r.gridContext&&r.gridContext.removeGridEventsBindListener(t)}}},{key:"setSourceData",value:function(e){var t=this;if((this.sourceData=e)&&this.props.cardSyncMode!==w.tx.OnDemand){var n=e.value.map(function(e){return e.userId});this.setState({userIdItemMap:e.userIdItemMap,values:n},function(){return t.updatePosition()})}}},{key:"searchUsers",value:function(e){var r=this;e&&(this.isSearched=!0),this.setState({noSearchData:!1});var t=this.props.bitableStore,n=Object(w.Ry)(t);Object(w.mJ)({content:e,source:n,token:w.ob.CommonUtil.getToken(),type:String(w.EH.USER)},function(e){var t=Object(o.a)(e,"data.entities.users",{}),n=Object(o.a)(e,"data.result_list",[]).filter(function(e){return e.type===w.EH.USER&&t[e.token]}).map(function(e){return t[e.token]});r.setUsers(n),!r.state.listLoaded&&r.setState({listLoaded:!0})})}},{key:"setUsers",value:function(e){var n=this,r=e.map(function(e){return{userId:e.id,name:e.name,enName:e.en_name,avatarUrl:e.avatar_url,department:e.department,isExternal:e.is_external,not_notify:e.not_notify,block_notify:e.block_notify,displayName:e.display_name}});this.state.values.forEach(function(t){!r.find(function(e){return e.userId===t})&&n.state.userIdItemMap[t]&&r.push(n.state.userIdItemMap[t])}),this.setState({options:r,noSearchData:!e.length},function(){return n.updatePosition()})}},{key:"updatePosition",value:function(){if(!this.props.staticPosition){var e=Object(w.rI)(this.props.renderer);e&&this.setState({position:{y:e,x:0}})}}},{key:"isMultiple",get:function(){var e=this.props,t=e.bitableStore,n=e.tableId,r=e.fieldId,i=t.base.getTableById(n);if(!i)return!0;var a=i.fields[r];return!!(a&&a.property&&a.property.multiple)}},{key:"mentionNotify",value:function(){var e=Object(w.uY)(E.a.mark(function e(){var t,n,r,i,a,o,s,c,u,d,l,b,p,v,f,h,m,I,y,g,k=this;return E.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.sourceData){e.next=2;break}return e.abrupt("return");case 2:if(this.mentionAvailable){e.next=4;break}return e.abrupt("return");case 4:if(n=this.props,r=n.tableId,i=n.viewId,a=n.recordId,o=n.fieldId,s=n.bitableStore,c=n.renderer,u=n.shareable,d=this.state.options,![r,i,a,o].some(function(e){return!e})){e.next=7;break}return e.abrupt("return");case 7:if(l=null===(t=w.ob.MentionHelper)||void 0===t?void 0:t.mentionV2Enabled,b=[],p=[],v=Object(w.nJ)(d,"userId"),h={},m=this.sourceData.value.filter(function(e){return e.notify}).reduce(function(e,t){var n=v[t.userId];return n.not_notify||n.block_notify||k.hasNotifyIds.includes(t.userId)?(n.not_notify&&b.push(t),n.block_notify&&p.push(t)):e.push(t.userId),t.mentionId&&!f&&(f=t.mentionId),h[t.userId]={name:t.name||""},e},[]),(0<b.length||0<p.length)&&Object(w.AH)({notNotifyUsers:b,blockedUsers:p}),0!==m.length){e.next=17;break}return e.abrupt("return");case 17:if(Object(w.WH)(s,I={tableId:r,viewId:i,recordId:a,fieldId:o},w.VH.UserEditor)){e.next=21;break}return e.abrupt("return");case 21:if(!l){e.next=29;break}return y=m.map(function(e){return h[e].name||""}),e.next=25,Object(w.zH)(s,c,m,y,{position:I,from:w.VH.UserEditor,query:{mentionId:f},permission:{shareable:u}});case 25:this.initNotifyIds(),s.base.eventEmitter.emit(w.Yx.AfterMentionNotify,{tableId:r,toUsers:m}),e.next=34;break;case 29:return e.next=31,Object(w.UH)(s,m,I,w.VH.UserEditor);case 31:g=e.sent,this.initNotifyIds(),this.supplementMentionId(g,I);case 34:case"end":return e.stop()}},e,this)}));function t(){return e.apply(this,arguments)}return t}()},{key:"getNotifyIdsFromFieldData",value:function(){return this.sourceData?this.sourceData.value.filter(function(e){return e.notify}).map(function(e){return e.userId}):[]}},{key:"initNotifyIds",value:function(){this.hasNotifyIds=this.getNotifyIdsFromFieldData()}},{key:"footerHeight",get:function(){return this.state.noSearchData?0:53}},{key:"getSelectorCellPosition",value:function(){if(this.props.staticPosition)return{};var e=this.state.position;return{left:0,width:(this.props.width?Math.max(s.b,this.props.width):0)||"100%",top:e.y}}},{key:"render",value:function(){var e=Object(w.nJ)(this.state.options,"userId"),t=Object(h.a)({},this.state.userIdItemMap,e,function(e,t){return null!=t?t:void 0}),n=this.props,r=n.editable,i=n.maxListHeight,a=n.minContentHeight,o=n.relativeClass,s=n.rect,c=n.isAnonymousAccess,u=n.bitableStore,d=n.isCardEdit,l=n.tableId,b=Object(w.wH)(u,l),p=null==u?void 0:u.base.isPro(),v=r?f("Bitable_Form_PleaseSelectMember"):Object(w.xH)({isFieldEditablePermission:b,placeholder:f("Bitable_Form_PleaseSelectMember"),isPro:p});return m.a.createElement(g.c,{className:"selector-cell user-editor",ref:this.setEditorRef,options:this.state.options,style:this.getSelectorCellPosition(),language:w.ob.I18nConfig.language,userIdItemMap:t,onOpenSelectList:this.onOpenSelectList,values:this.state.values,placeholder:v,editable:r&&!c,maxListHeight:i,anchorHeight:s?s.height:0,offY:d?1:0,relativeClass:o,isMultiple:this.isMultiple,minContentHeight:a,customFooter:this.renderFooter(),customFooterHeight:this.footerHeight,onSearch:this.onSearch,onMultiChange:this.onMultiChange,onOptionClick:this.onOptionClick,onDropdownVisibleChange:this.onDropdownVisibleChange,onShowUser:function(e,t){c||w.lx.open({name:"en"===w.ob.I18nConfig.language&&e.enName?e.enName:e.name,token:e.userId,rect:t,mentionType:w.mx.User})},onHideUser:function(){w.lx.close()}})}}]),a}(m.a.PureComponent)).defaultProps={shareable:!1,shouldNotifyLark:!0,maxListHeight:s.c,minContentHeight:s.d},a=c))||a}.call(this,v("vb163"))},vb1905:function(e,t,n){"use strict";var r=n("vb144"),i=n.n(r),a=n("vb103"),o=n("vb151");function s(e){return a.createElement("svg",i()({width:"1em",height:"1em",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},e),a.createElement("path",{d:"M12 23c6.075 0 11-4.925 11-11S18.075 1 12 1 1 5.925 1 12s4.925 11 11 11Zm-1-12V8a1 1 0 1 1 2 0v3h3a1 1 0 1 1 0 2h-3v3a1 1 0 1 1-2 0v-3H8a1 1 0 1 1 0-2h3Z",fill:"currentColor"}))}var c=a.forwardRef(function(e,t){return a.createElement(o.a,i()({icon:s},e,{ref:t,svgProps:{"data-icon":"MoreAddFilled"}}))});t.a=c},vb344:function(e,t,n){"use strict";n.d(t,"a",function(){return s}),n.d(t,"b",function(){return o}),n.d(t,"c",function(){return c});var r=n("vb152"),i=n.n(r),a=n("vb143"),o=Object(a.Uy)(Object(a.uY)(i.a.mark(function e(){return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.e("d645920e395f").then(n.bind(null,"vb485"));case 2:return e.abrupt("return",e.sent.SingleSelectorEditor);case 3:case"end":return e.stop()}},e)}))),s=Object(a.Uy)(Object(a.uY)(i.a.mark(function e(){return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.e("d67d8ab4f4c1").then(n.bind(null,"vb486"));case 2:return e.abrupt("return",e.sent.MultiSelectorEditor);case 3:case"end":return e.stop()}},e)}))),c=Object(a.Uy)(Object(a.uY)(i.a.mark(function e(){return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.e("3416a75f4cea").then(n.bind(null,"vb487"));case 2:return e.abrupt("return",e.sent.UserSelectorEditor);case 3:case"end":return e.stop()}},e)})))},vb395:function(e,t,n){"use strict";n.d(t,"a",function(){return r}),n.d(t,"b",function(){return i}),n.d(t,"c",function(){return o}),n.d(t,"d",function(){return s}),n.d(t,"e",function(){return a});var r=183,i=280,a=35,o=215,s=325}}]);
//# sourceMappingURL=//slardar.bytedance.net/api_v2/browser/jserr/get_sourcemap?bid=docs_pc&js_filename=1c383cd30b7c.1d7056bfe5.chunk.js