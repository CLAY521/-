(window.webpackJsonp=window.webpackJsonp||[]).push([["c16a5320fa47"],{vb1283:function(e,Le,je){"use strict";je.r(Le),function(p){je.d(Le,"FormulaEditorAdaptor",function(){return we});var B=je("vb143"),r=je("vb180"),m=je("vb103"),F=je.n(m),k=(je("vb147"),je("vb148"),je("vb152"),je("vb112"),je("vb164"),je("vb167"),je("vb113"),je("vb651")),d=je("vb773"),o=je("vb2166"),i=je("vb1284"),l=je("vb2190"),c=je("vb2181"),s=je("vb2226"),u=je("vb1906"),a=je("vb1907"),e=je("vb2227"),t=je("vb2228"),n=je("vb2179"),f=je("vb2182"),b=je("vb183"),h=je("vb178"),v=je("vb139"),g=(je("vb537"),je("vb138")),_=je("vb110"),E=je.n(_),y=je("vb957"),I=je("vb195"),D=je("vb488"),C=je("vb444"),x=je("vb159"),T=je.n(x),N=je("vb111");je("vb129"),je("vb223"),je("vb214"),je("vb232"),je("vb187"),je("vb174"),je("vb225"),je("vb224"),je("vb128"),je("vb122"),je("vb115"),je("vb118"),je("vb119"),je("vb233"),je("vb234"),je("vb235"),je("vb123"),je("vb236"),je("vb193"),je("vb237"),je("vb155"),je("vb238"),je("vb124"),je("vb239"),je("vb104"),je("vb116"),je("vb120"),je("vb121"),je("vb117"),je("vb240"),je("vb134"),je("vb131"),je("vb226"),je("vb241"),je("vb114"),je("vb125"),je("vb242"),je("vb127"),je("vb132"),je("vb227"),je("vb135"),je("vb228"),je("vb229"),je("vb133"),je("vb126"),je("vb243"),je("vb262"),je("vb244"),je("vb245"),je("vb246"),je("vb247"),je("vb194"),je("vb248"),je("vb249"),je("vb201"),je("vb260"),je("vb267"),je("vb250"),je("vb136"),je("vb251"),je("vb130"),je("vb252");function R(e){if(null==e||!Object(B.oJ)(e)&&!Object(B.pJ)(e))return!1;var t=e.field;return!(null==t||!Object(B.vy)(t)&&!t.getCustomType(t))}var O,S,w="advanced-editor-details",L=function(n){function a(e){var t;return Object(B.ov)(this,a),(t=n.call(this,e)||this).state={showReference:!1},t}return Object(B.bu)(a,n),Object(B.Pw)(a,[{key:"getDetailsPreComps",value:function(e){var t=e.replace(/\n+/gm,"\n").split("\n");return F.a.createElement(m.Fragment,null,t.map(function(e,t){return e&&F.a.createElement("div",{key:t,className:"".concat(w,"_pre-code")},e)}))}},{key:"getFormulaParametersComps",value:function(e){var t=e.name,n=e.desc;return F.a.createElement(m.Fragment,null,F.a.createElement("div",{className:"".concat(w,"_subtitle")},t),n&&F.a.createElement("div",{className:"".concat(w,"_pre")},this.getDetailsPreComps(null!=n?n:"")))}},{key:"render",value:function(){var n=this,e=this.props,t=e.headline,a=e.descriptions,r=e.example,i=e.paramsInfo,o=e.helpLinkFeishu,l=e.helpLinkLark,c=i&&0<i.length,s=o&&l,u=function(e,t){var n=Object(B.HP)(e,t);B.ob.DomainHelper.protectedOpenLink(n)};return F.a.createElement("div",{className:"".concat(w)},F.a.createElement("div",{className:"".concat(w,"_headline")},t),a&&F.a.createElement("div",{className:"".concat(w,"_descriptions")},a),r&&F.a.createElement(m.Fragment,null,F.a.createElement("div",{className:"".concat(w,"_subtitle_container")},F.a.createElement("div",{className:"".concat(w,"_subtitle")},p("bitable.formula.example")),s?F.a.createElement("div",{className:"".concat(w,"_help_link"),onClick:function(){return u(o,l)}},F.a.createElement(d.a,null),p("Bitable_Formula_LearnMore")):null),F.a.createElement("div",{className:"".concat(w,"_pre")},this.getDetailsPreComps(r))),c&&i.map(function(e,t){return F.a.createElement("span",{key:t},n.getFormulaParametersComps(e))}))}}]),a}(F.a.Component),j=function(r){function i(e,t,n){var a;return Object(B.ov)(this,i),(a=r.call(this,e,t)||this).renderLocally=!0,a}return Object(B.bu)(i,r),Object(B.Pw)(i,[{key:"blockDidMount",value:function(){}},{key:"blockDidUnmount",value:function(){}},{key:"render",value:function(){var t=this,n=this.attributes.selected;return new Promise(function(e){E.a.render([F.a.createElement(F.a.Fragment,{key:t.props.context},F.a.createElement("span",{"data-zero-space":"true"},"​"),F.a.createElement(y.d,{context:t.props.context,content:t.props.content,isActive:n}),F.a.createElement("span",{"data-zero-space":"true"},"​"))],t.mountPoint,function(){return e()})})}},{key:"collectText",value:function(){return this.props.content||" "}},{key:"onCopy",value:function(e){var t=e.props,n="";return this.props&&(n=t.content||this.props.content),{html:n,text:n}}},{key:"resize",value:function(){}}]),i}(v.Block),M="REF_BLOCK",P=function(r){function i(){var e;Object(B.ov)(this,i);for(var t=arguments.length,n=new Array(t),a=0;a<t;a++)n[a]=arguments[a];return(e=r.call.apply(r,[this].concat(n))||this).blockType=M,e.defaultProps={displayMode:v.BlockDisplayMode.INLINE},e}return Object(B.bu)(i,r),Object(B.Pw)(i,[{key:"create",value:function(e,t,n){return new j(e,t,n)}}]),i}(v.Creator),V=function(t){function a(e){var n;return Object(B.ov)(this,a),(n=t.call(this)||this).className="RefBlock",n.aceSelectionChanged=function(e,t){n.options.onSelectionChange()},n.editorWillCopy=function(e){var t=e.deltaSet.reduce(function(e,t){if(t instanceof g.ZoneDelta){var n=t.reduce(function(e,t){var n;if(t.insert&&t.attributes&&t.attributes.dataMetaBlockProps){var a=JSON.parse(t.attributes.dataMetaBlockProps);if(a.blockType===M){var r=a.props.content;r&&(t.insert=r,t.attributes={})}}return e.insert(null!==(n=t.insert)&&void 0!==n?n:" ",t.attributes)},new g.ZoneDelta({zoneId:t.zoneId}));return e.concat(n)}return e.concat(t)},new g.DeltaSet);e.deltaSet=t},n.options=e,n}return Object(B.bu)(a,t),a}(g.Plugin);function J(e){for(var t=e.getSegmentArray(),n=1,a=[],r={},i=0;i<t.length;i++){var o=t[i];if(i===t.length-1){var l=o.text||"";if(!l||"\n"===l){t.pop();continue}l.endsWith("\n")&&(o.text=l.replace(/\u000A/g,""))}if(o.content&&o.context){if(o.context.type===k.c.Property){a.push("".concat(B.qJ.Property).concat(o.text));continue}var c="".concat(B.qJ.Reference).concat(n++);a.push(c),r[c]=o.context}else{var s=a.length;if(0===s||a[s-1][0]===B.qJ.Reference||a[s-1][0]===B.qJ.Property){a.push("".concat(B.qJ.Constant).concat(o.text));continue}a[s-1]+=o.text}}return new y.b(a,Object(I.a)(r)?null:r)}function U(e){for(var t=[],n=0;n<e.length;n++){var a=e[n],r=a.attributes&&Object(D.d)(a.attributes)||{};switch(a.type){case O.REFBLOCK:Object.assign(r,Object(D.d)(a.attributes)),t.push(Object(D.e)({insert:" ",attributes:r}));continue;case O.TEXT:t.push(Object(D.e)({insert:a.text,attributes:r}));continue}}return new g.ZoneDelta({ops:t})}function W(e,t,n){var a=e.plugins.blockPlugin,r=Object(v.generateBlockDataSet)({blockType:M,props:{displayMode:v.BlockDisplayMode.INLINE,viewType:v.ViewTypes.INLINE,content:t,context:n}});return{text:t,type:O.REFBLOCK,attributes:a.getAttrsFromBlockDataSet(r)}}function K(e){return{text:e,type:O.TEXT}}function z(d,t){if(t instanceof y.b){var e=function(){for(var c=t.getTokens(),s=t.getRefs(),u=t.getTokenInfo(),m=[],e=function(a){var e=c[a];if(e[0]===B.qJ.Reference){var t=c[a+2],n=t&&t[0]===B.qJ.Reference,r=u.find(function(e){return e&&e.includes(a)});if(r&&n){var i="",o="";r.forEach(function(e){var t=c[e];if(t)if(t[0]===B.qJ.Reference){var n=s[t];i+=n.name,o+=n.referenceId}else i+=t.substring(1),o+=t.substring(1);else p=a}),a=r[r.length-1];var l=s[c[a]];l&&(l.type===B.rJ.Column?(l.name=i,l.referenceId=o):l.type===B.rJ.Field&&(l.referenceId=o),m.push(W(d,l.name,l)))}else m.push(W(d,s[e].name,s[e]))}else e[0]===B.qJ.Property?m.push(W(d,e.substring(1),{type:k.c.Property,showName:e.substring(1)})):m.push(K(e.substring(1)));p=a},p=0;p<c.length;p++)e(p);return{v:m}}();if("object"===Object(B.uz)(e))return e.v}return t}function H(e){return e.replace(/\[|\]/g,"")}function q(e){return e.replace(/\s/g," ").trim()}function X(e){return"[".concat(e,"]")}function Z(e){return e.type===B.sJ.Name||e.type===B.sJ.EscapeName}function Y(e){return e.type===B.sJ.FunctionName}function Q(e){return e.type===B.sJ.Point}function $(e){return e.type===B.sJ.CloseParen}function ee(e){return e.type===B.sJ.OpenParen}function te(e){return e.type===B.sJ.CurrentValue}(S=O||(O={})).REFBLOCK="refblock",S.TEXT="text";var ne,ae,re={INVALID_REF:p("bitable.formula.invalid_ref"),INVALID_FUNC:p("bitable.formula.invalid_func"),INVALID_FORMULE:p("bitable.formula.invalid"),INVALID_TABLE:p("bitable.formula.invalid_table"),NONE:"",INVALID_FILTER_RESULT:p("Bitable_Formula_FilterTip"),REJECT_TABLE_TIPS:p("Bitable_Formula_ApplyToEntireTableTip")},ie=function(e){var t=e.type;return"INVALID_REF"===t||"INVALID_FUNC"===t||"INVALID_FORMULE"===t};function oe(e){return e.type===B.qJ.Constant}function le(e){return e.type===B.qJ.Reference}function ce(e){return e.type===B.qJ.Property}(ae=ne||(ne={})).ADD="add",ae.SPLIT="split",ae.MERGE="merge",ae.REPAIR="repair";var se=function(a){function r(){var d;Object(B.ov)(this,r);for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return(d=a.call.apply(a,[this].concat(t))||this).isImeInputting=!1,d.fieldInfos=[],d.shouldUpdateSelection=!1,d.decompileAfterDidPaste=function(){var e=d.getEditorBase();if(e){var t=e.getNamesText(),n=d.props.serialize(t);if(null!=n){var a=[];if(e.setTokenInfo(n.combinedTokens),null==n.error)a=n.tokens;else{var r=e.getTokens(),i=e.getRefs(),o=n.tokens,l=n.refMap||{};a=r.reduce(function(e,t,n){return t!==o[n]&&t[0]===B.qJ.Reference&&void 0===l[t]&&(t="".concat(B.qJ.Constant).concat(i[t].name)),e.push(t),e},[])}e.setTokens(a),e.setRefs(n.refMap||{}),d.setEditorValue(e)}}},d.setFormulaInputEditorRef=function(e){e&&(d.editorReact=e,d.addEditorListener(),e.setSelectionToLastCharacter||(e.setSelectionToLastCharacter=function(){Object(C.c)(this.getEditor())}),e.replaceEditorValue||(e.replaceEditorValue=function(e){var t=this.getEditor();Object(C.b)(t,e,U)}),e.getSegmentArray||(e.getSegmentArray=function(){var e=this.getEditor();return e.callStack.inCallStackIfNecessary("getSegment",function(){e.fastIncorp()}),Object(D.g)(e)}))},d.addEditorListener=function(){if(d.editorReact){var e=d.editorReact.getEditor();e.on(g.EditorEventType.DID_PASTE,d.decompileAfterDidPaste),e.on(g.EditorEventType.CONTENT_CHANGE,d.props.onFormulaChange)}},d.removeEditorListener=function(){if(d.editorReact){var e=d.editorReact.getEditor();e.off(g.EditorEventType.DID_PASTE,d.decompileAfterDidPaste),e.off(g.EditorEventType.CONTENT_CHANGE,d.props.onFormulaChange)}},d.onEditorKeyDown=function(e){if(!d.props.isOpen||d.props.isOpen()){var t=e.shiftKey,n=e.altKey,a=e.keyCode,r=e.metaKey,i=e.ctrlKey;if(B.rx.mac){var o=[r,i];i=o[0],r=o[1]}if(!(i||r||t||n)){if(a===B.sx.Enter&&d.props.context.props.mode!==k.b.FULLSCREEN)return e.stopImmediatePropagation(),e.preventDefault(),void d.props.endEdit(!1);if(a===B.sx.Tab||a===B.sx.Enter)return e.stopImmediatePropagation(),e.preventDefault(),void d.completeKeyName()}a===B.sx.Esc&&(e.stopImmediatePropagation(),e.preventDefault(),d.props.endEdit(!0))}},d.startEdit=function(e){var t=d.props.serialize(e);if(t){if(t.error)d.setEditorText(e);else{var n=t.tokens,a=t.refMap,r=t.combinedTokens;d.setEditorValue(new y.b(n,a,r))}d.updateKeyword(),d.editorReact&&d.editorReact.setSelectionToLastCharacter()}},d.focus=function(){if(d.editorReact){var e=document.querySelector(".etherpad-container-wrapper"),t=e?e.scrollTop:0;d.editorReact.focus(),e&&(e.scrollTop=t),B.rx.safari&&setTimeout(function(){e&&(e.scrollTop=t)})}},d.resetSelection=function(){d.editorReact&&d.editorReact.selection.setSelection({start:{line:0,offset:0,zoneId:"0"},end:{line:0,offset:0,zoneId:"0"}},!1)},d.focusAndSetSelectionToLast=function(){d.editorReact&&(d.editorReact.focus(),d.resetSelection(),d.editorReact.setSelectionToLastCharacter())},d.attachHost=function(){if(d.textEditorRef){var e=d.textEditorRef.firstChild;e&&(d.host=e,d.host.addEventListener("keydown",d.handleKeyDownEvent),d.host.addEventListener("compositionstart",d.handleCompositionstart),d.host.addEventListener("compositionend",d.handleCompositionend))}},d.disposeHost=function(){if(d.textEditorRef){var e=d.textEditorRef.firstChild;e&&(d.host=e,d.host.removeEventListener("keydown",d.handleKeyDownEvent),d.host.removeEventListener("compositionstart",d.handleCompositionstart),d.host.removeEventListener("compositionend",d.handleCompositionend))}},d.handleCompositionstart=function(){d.isImeInputting=!0},d.handleCompositionend=function(){d.isImeInputting=!1,d.onInput()},d.handleKeyDownEvent=function(e){if(!d.props.isOpen||d.props.isOpen()){var t=e.ctrlKey,n=e.shiftKey,a=e.altKey,r=e.metaKey,i=t||n||a||r,o=e.keyCode,l=d.props.context;!i&&l&&(o===B.sx.Down?(l.handleNavigate("DOWN"),e.preventDefault(),e.stopPropagation()):o===B.sx.Up?(l.handleNavigate("UP"),e.preventDefault(),e.stopPropagation()):o===B.sx.Dot?d.completeRefBlock():o===B.sx.Plus&&0===d.getCaret()&&(e.preventDefault(),e.stopPropagation())),i&&o===B.sx.Digit9&&d.completeFuncCloseParen()&&(e.preventDefault(),e.stopPropagation()),o!==B.sx.Left&&o!==B.sx.Right&&o!==B.sx.Home&&o!==B.sx.End&&o!==B.sx.BackSpace||d.checkCaret()}},d.checkCaret=function(){requestAnimationFrame(function(){d.onInput()})},d.onInput=function(){d.editorReact&&(d.isImeInputting||(d.setText(d.getEditorText()),d.updateKeyword()))},d.handleDOMSelectionChange=function(){var e,t,n=null===(e=d.editorReact)||void 0===e?void 0:e.isFocus();try{var a;t=!(null===(a=d.editorReact)||void 0===a||!a.isFocusOnBlock({}))}catch(e){t=!1}if((n||t)&&d.shouldUpdateSelection)try{d.updateKeyword()}finally{d.shouldUpdateSelection=!1}},d.getCaret=function(){var e=d.editorReact.getEditor(),t=e.getRep(),n=t.selStart,a=t.selEnd,r=t.selFocusAtStart,i=e.repManager.getActiveRep().attributeManager.getAttributesAndPoints([["dataMetaBlockProps",""]]),o=0;try{var l,c=Object(B.WB)(i);try{for(c.s();!(l=c.n()).done;){var s=l.value,u=JSON.parse(s.attribs[0][1]).props.content;s.selEnd[1]<=a[1]&&(o+=u.length-1)}}catch(e){c.e(e)}finally{c.f()}}catch(e){console.error("cant parse block text")}var m=n[1]+o,p=a[1]+o;return m===p?p:r?m:p},d.caretToSelection=function(t){var e,n=d.editorReact.getEditor().repManager.getActiveRep().attributeManager.getAttributesAndPoints([["dataMetaBlockProps",""]]),a=[],r=0,i=Object(B.WB)(n);try{for(i.s();!(e=i.n()).done;){var o=e.value,l=JSON.parse(o.attribs[0][1]).props.content,c=o.selStart,s=o.selEnd,u=c[1]+r,m=s[1]+r+l.length-1;(u<=t&&t<=m||m<=t)&&(a.push({selStart:c,selEnd:s,start:u,end:m,text:l}),r+=l.length-1)}}catch(e){i.e(e)}finally{i.f()}var p=a.find(function(e){return e.start<=t&&e.end>=t});return p?p.selEnd[1]:t-r},d.setTextEditorRef=function(e){d.textEditorRef=e},d.bindDomEvent=function(){document.addEventListener("selectionchange",d.handleDOMSelectionChange),d.textEditorRef.addEventListener("keydown",d.onEditorKeyDown,!0)},d.unbindDomEvent=function(){document.removeEventListener("selectionchange",d.handleDOMSelectionChange),d.textEditorRef.removeEventListener("keydown",d.onEditorKeyDown,!0)},d}return Object(B.bu)(r,a),Object(B.Pw)(r,[{key:"componentDidMount",value:function(){this.attachHost(),this.bindDomEvent(),window.feditor=this}},{key:"componentWillUnmount",value:function(){this.removeEditorListener(),this.disposeHost(),this.unbindDomEvent()}},{key:"getEditorBase",value:function(){return this.editorReact?J(this.editorReact):null}},{key:"compileEditorBase",value:function(e){var t=e.getIdReferencesText();return this.props.serialize(t)}},{key:"getEditorIDReference",value:function(){return this.editorReact?J(this.editorReact).getIdReferencesText():this.getEditorText()}},{key:"getEditorText",value:function(){if(!this.editorReact){if(!this.textEditorRef)return"";var e=this.textEditorRef.firstChild;return e?e.innerText:""}var t,n="",a=this.editorReact.getContentState().getActiveZone().length()-1,r=this.editorReact.getContentState().getActiveZone().getLine(a),i=r?r.length():0,o=this.editorReact.getTextAndAttrsOnSelection({selStart:[0,0],selEnd:[a,i],selZone:"0"}),l=Object(B.WB)(o);try{for(l.s();!(t=l.n()).done;){var c=t.value;if("[BLOCK]"===c.text&&c.attributes[v.BLOCK_DATA_META_BLOCK_PROPS]){var s=JSON.parse(c.attributes[v.BLOCK_DATA_META_BLOCK_PROPS]);Object(b.a)(s)&&s.props&&s.props.content?n+=s.props.content:n+=c.text}else n+=c.text}}catch(e){l.e(e)}finally{l.f()}return function(e){return e.replace(/\u200B/g,"")}(n=n.slice(0,-1))}},{key:"setEditorText",value:function(e){var t=["C".concat(e)];this.setEditorValue(new y.b(t,{},[]))}},{key:"setEditorValue",value:function(e){if(this.editorReact)try{var t=z(this.editorReact,e);this.editorReact.replaceEditorValue(t);var n="";Object(h.a)(t)?t.forEach(function(e){return n+=e.text}):n=t,this.setText(n||this.getEditorText())}catch(e){console.error(e)}}},{key:"resetKeyword",value:function(){var e=this.props.context;e&&e.updateKeyword("")}},{key:"updateKeyword",value:function(){var e;if(null===(e=this.editorReact)||void 0===e||!e.getCurrentCallStack()||this.editorReact.getCurrentCallStack().domClean){var t=this.props.context,n=this.getCaret(),a=this.getTokens(),r=this.getToken(n);if(0!==a.length&&r){if(!this.isImeInputting){var i,o,l,c,s=a.indexOf(r),u=a[s-1],m=u&&Q(u),p=a[s+1],d=p&&ee(p),f=r.text||"";if(Z(r)&&!d)m&&(i=a[s-2].text||"",o=n-((null===(l=u.text)||void 0===l?void 0:l.length)||0)-((null===(c=r.text)||void 0===c?void 0:c.length)||0)),this.highlightRefBlock(f,i,o);else if(Y(r)){var b=f.substring(0,f.length-1);this.resetKeyword(),$(p)&&n===r.stopIndex+1||t.setActiveItemByName(b)}else if(Q(r)&&u){if(Z(u)){var h;i=u.text;var v=(null===(h=u.text)||void 0===h?void 0:h.length)||0,g=this.getPredictRefInfo(n-v);i=g?g.type===B.rJ.Field?g.referenceId:g.type===B.rJ.Column&&g.parent?g.referenceId.startsWith(B.tJ)?g.referenceId:"".concat(g.parent.referenceId,".").concat(g.referenceId):u.text:u.text}if(te(u)){var _,E=(null===(_=u.text)||void 0===_?void 0:_.length)||0,F=this.getRefInfo(n-E);i=F&&F.type===B.tI.CurrentValue&&F.parent?F.parent.type!==B.rJ.Field&&F.parent.type!==B.rJ.Column||!F.parent.parent?F.parent.referenceId:"".concat(F.parent.parent.referenceId,".").concat(F.parent.referenceId):u.text}if($(u)){var y=this.getPredictContext(s-1);i=y?Object(B.pJ)(y)||Object(B.oJ)(y)||Object(B.uI)(y)?Object(B.vI)(y,!0):y.id():u.text}t.updateKeyword("",i)}else $(r)?this.props.context.clearKeyword():this.resetKeyword()}}else this.resetKeyword()}else this.shouldUpdateSelection=!0}},{key:"getPredictRefInfo",value:function(e){var t=this.getPredictRef(e);if(null==t)return null;if(!Object(B.pJ)(t)&&!Object(B.oJ)(t)&&!Object(B.uI)(t))return this.getRefInfo(e);var n=this.props.serializeReference(t);return null==n?this.getRefInfo(e):n}},{key:"getPredictRef",value:function(e){var t=this.getTokens(),n=this.getToken(e);if(0===t.length||null==n)return null;var a=t.indexOf(n);return this.getPredictContext(a)}},{key:"highlightRefBlock",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"",n=2<arguments.length?arguments[2]:void 0,a=this.props.context,r=n,i=this.getCaret();null==r&&(r=i);var o=this.getPredictRefInfo(r)||this.getRefInfo(r),l=this.getPredictRef(i),c=this.getPredictRefInfo(i)||this.getRefInfo(i),s=this.getPropertyToken(i);o&&o.type===B.rJ.Column&&o.referenceId.startsWith("bitable::")&&(o=o.parent);var u=this.getTokenIndex(i);if(")"===t){var m=this.getPredictContext(u-2);m&&(Object(B.pJ)(m)||Object(B.oJ)(m)||Object(B.uI)(m))&&(t=Object(B.vI)(m,!0))}var p=null!=c||null!=s?"":e;if(null==o&&null==c)return null==t||t.startsWith(B.tJ)||(t=H(t)),a.updateKeyword(p,t),void a.setActiveItemByName(e);var d=R(l);if((null==o||d)&&(o=c),null!=o)switch(o.type){case B.rJ.Table:a.updateKeyword(p,o.referenceId,e);break;case B.rJ.Field:a.updateKeyword(p,n||d?o.referenceId:null,e);break;case B.rJ.Column:a.updateKeyword(p,o.referenceId.startsWith(B.tJ)?o.referenceId:"".concat(o.parent?o.parent.referenceId+".":"").concat(o.referenceId),e);break;case B.tI.CurrentValue:var f=o.parent,b=null==f?t:f.referenceId.startsWith(B.tJ)?f.referenceId:"".concat(f.parent?f.parent.referenceId+".":"").concat(f.referenceId);a.updateKeyword(p,b,e)}}},{key:"completeFuncCloseParen",value:function(){var e=this.getCaret(),t=this.getToken(e);return!!t&&(t.text&&this.props.context.getFunctionByName(t.text)?(this.operateEditorContent(Math.max(0,e),0,{type:B.qJ.Constant,value:"()"}),this.setCaret(this.caretToSelection(e+1)),!0):(Y(t)&&(this.operateEditorContent(Math.max(0,e),0,{type:B.qJ.Constant,value:")"}),this.setCaret(this.caretToSelection(e))),!1))}},{key:"completeRefBlock",value:function(){var e=this.props.context,t=this.getCaret(),n=this.getToken(t);if(n){var a=n.text;if(a&&e.isTableRefKeyWord(a)){var r=Math.max(0,t-a.length),i=e.getRefsByName(a).find(function(e){return e.type===B.rJ.Table});i&&this.operateEditorContent(r,t,{type:B.qJ.Reference,value:i});var o=this.caretToSelection(t);this.setCaret(o)}}}},{key:"completeKeyName",value:function(){var e,t=this.props.context.getActiveItem();if(t){var n="",a=0,r=0,i=this.getCaret(),o=this.getToken(i);n=t instanceof B.wI?t.name+"()":Object(k.i)(t)?t.showName||t.name:X(t.showName||t.name);var l=J(this.editorReact),c=l.getTokenByCaret(i),s=!!c&&c[0]===B.qJ.Reference,u=!!c&&c[0]===B.qJ.Property,m=s||u,p=l.getRefs()[c];o&&!m?(r=o.stopIndex+1,a=Z(o)?o.startIndex:r):a=r=i;var d=a,f=Object(k.i)(t)&&u||Object(k.e)(t)&&s&&p&&!this.props.isLinkRefChaining(p,t)&&(null===(e=t.parent)||void 0===e?void 0:e.id)!==(null==p?void 0:p.id);o&&m&&f&&(d=o.startIndex),t instanceof B.wI?(d+=n.length-1,o&&m&&(d+=1)):t.isChildren&&(d+=n.length);var b=r-a;t instanceof B.wI?this.operateEditorContent(a,b,{type:B.qJ.Constant,value:n}):Object(k.i)(t)?this.operateEditorContent(a,b,{type:B.qJ.Property,value:t}):this.operateEditorContent(a,b,{type:B.qJ.Reference,value:t}),this.setCaret(this.caretToSelection(d)),this.updateKeyword()}}},{key:"createOperations",value:function(e){var t=e.targetToken,n=e.tokenIndex,a=e.start,r=e.size,i=e.opType,o=e.content;if(oe(o)){var l=o.value;switch(i){case ne.ADD:return[new y.a(n,l)];case ne.REPAIR:return[new y.a(n+1,".".concat(l))];default:return new y.e(t,n,a,r,l).ops()}}if(ce(o)){var c=o.value,s=c.showName||c.name;return i===ne.REPAIR?new y.g(t,n,a,r,s).ops():new y.f(t,n,a,r,s).ops()}if(le(o)){var u=o.value;switch(i){case ne.ADD:return[new y.j(n,u)];case ne.MERGE:return new y.c(t,n,a,r,u).ops();case ne.REPAIR:return new y.i(t,n,a,r,u).ops();default:return new y.h(t,n,a,r,u).ops()}}return[]}},{key:"getPredictContext",value:function(r){var e=this.compileEditorBase(this.getEditorBase());if(null==e||-1===r)return null;var t=e.tokenVariants,n=e.chainingParentMap,a=e.combinedTokens,i=e.tokens,o=e.refMap,l=a.filter(function(e,t){if(r<t)return!1;var n=i[e[2]],a=n&&o&&o[n];return a&&a.type===B.rJ.Field}).length;r+=2*l;var c=t.get(r),s=c&&n.get(c);if(s&&(c=s),c&&Object(B.xI)(c))return null;var u=c&&c.isOp()&&!(c.op()instanceof B.yI)&&c.predict(Object.assign({service:this.props.context.getFormulaService(),info:{}},this.props.getCalcCtx()));return u&&u.isRef()?u.getRef():null}},{key:"getOperationType",value:function(e,t){var n=e.getTokens(),a=e.getRefs(),r=n[e.getIndexStartByCaret(this.getCaret()).segIndex]||"",i=0===n.length||!r,o=!1,l=a[r];if(l&&le(t)){var c,s=t.value;if(this.props.isLinkRefChaining(l,s))return ne.REPAIR;o=(null===(c=s.parent)||void 0===c?void 0:c.id)===(null==l?void 0:l.id),s.type===B.rJ.Column&&s.parent&&l.type===s.type&&l.parent&&l.parent.id===s.parent.id&&l.referenceId.includes(l.parent.referenceId)&&(s.name=s.parent.name+"."+s.name,s.referenceId=s.parent.referenceId+"."+s.referenceId)}return ce(t)?l?ne.REPAIR:ne.SPLIT:oe(t)?l||r[0]===B.qJ.Property?ne.REPAIR:ne.SPLIT:i?ne.ADD:o?ne.REPAIR:ne.SPLIT}},{key:"operateEditorContent",value:function(e,t,n){var a=J(this.editorReact),r=a.getIndexStartByCaret(this.getCaret()),i=a.getTokens()[r.segIndex]||"",o=this.getOperationType(a,n),l=this.createOperations({targetToken:i,tokenIndex:r.segIndex,start:e-r.startIndex,size:t,opType:o,content:n});a.updateDataByOps(l);var c=le(n)&&this.compileEditorBase(a);!1!==c&&null!=c&&null==c.error&&(a.setTokenInfo(c.combinedTokens),a.setTokens(c.tokens),a.setRefs(c.refMap||{})),this.setEditorValue(a)}},{key:"_parse",value:function(e){var t=this.props.context;this.tokens=[],this.funcInfos=[],this.fieldInfos=[];var n=this.props.compileTokens(e);if(n&&(this.tokens=n.tokens),0!==this.tokens.length){for(var a=this.tokens,r=[],i=0,o=a.length;i<o;i++){var l=a[i];switch(l.type){case B.sJ.EscapeName:case B.sJ.Name:this.fieldInfos.push(l.text);break;case B.sJ.FunctionName:var c=l.text&&l.text.trim();c&&r.push({type:"func",name:c.slice(0,c.length-1),operandStarts:[l.startIndex+c.length-1],start:l.startIndex});break;case B.sJ.OpenParen:r.push({type:"paren"});break;case B.sJ.CloseParen:for(;;){var s=r.pop();if(!s)break;if("func"===s.type){var u=s.name,m=t.getFunctionByName(u.toUpperCase());m&&this.funcInfos.push({func:m,operandStarts:s.operandStarts,operands:s.operandStarts.length,start:s.start,stop:l.startIndex+l.text.indexOf(")")});break}if("paren"===s.type)break}break;case B.sJ.Comma:var p=r[r.length-1];p&&"func"===p.type&&p.operandStarts.push(l.startIndex+l.text.indexOf(","))}}for(;r.length;){var d=r.pop();if(d&&"func"===d.type){var f=d.name,b=t.getFunctionByName(f.toUpperCase());b&&this.funcInfos.push({func:b,operandStarts:d.operandStarts,operands:d.operandStarts.length,start:d.start,stop:e.length});break}}this.funcInfos.reverse()}}},{key:"setText",value:function(e){this.text!==e&&(this.text=e,this._parse(e.trim()))}},{key:"getTokens",value:function(){return this.tokens}},{key:"getToken",value:function(e){if(e<=0)return null;for(var t=e-1,n=this.tokens,a=0,r=n.length;a<r;a++){var i=n[a];if(i.startIndex<=t&&t<=i.stopIndex)return i}return null}},{key:"getTokenIndex",value:function(e){var t=this.getTokens(),n=this.getToken(e);return n?t.indexOf(n):-1}},{key:"getRefInfo",value:function(e){return J(this.editorReact).getRefByCaret(e)||null}},{key:"getPropertyToken",value:function(e){var t=J(this.editorReact).getTokenByCaret(e);return t[0]===B.qJ.Property?t:null}},{key:"getFuncInfo",value:function(e){var t=this.getFuncInfos(e);return t&&0!==t.length?t[0]:null}},{key:"getFuncInfos",value:function(e){if(e<=0)return null;for(var t=[],n=e-1,a=this.funcInfos,r=a.length-1;0<=r;r--){var i=a[r];(i.operandStarts[0]||i.start)<=n&&n<=i.stop-1&&t.push(i)}return t}},{key:"isInsideMappableFunc",value:function(){var e=this.getFuncInfos(this.getCaret());return!(null==e||!e.some(function(e){return(null==e?void 0:e.func)&&Object(B.zI)(e.func)}))}},{key:"getFuncInfoSupportMappableParam",value:function(){var e=this.getFuncInfo(this.getCaret());return null!=e&&e.func&&Object(B.zI)(e.func)?e.func.paramsDesc.findIndex(function(e){return e.type===B.AI}):null}},{key:"setCaret",value:function(e){this.focus(),this._setCaret(e)}},{key:"_setCaret",value:function(e){if(this.editorReact){var t=this.editorReact.getContentState().getActiveZone().offsetToPoint(e);t.zoneId="0",this.editorReact.getInInternationalComposition()?this.editorReact&&this.editorReact.setSelectionToLastCharacter():this.editorReact.selection.setSelection({start:t,end:t},!0)}}},{key:"getEditorReactComponent",value:function(){var n=this;return m.createElement(C.a,{placeholder:p("bitable.formula.input_formula"),className:"b-small-scrollbar bitable-formula-editor-content",registerPlugin:function(e){var t=[];return t.push(new V({onSelectionChange:n.onInput})),t.push(new g.TextNodeDeserializer,new g.BlockElementDeserializer,new v.BlockPlugin({editor:e,blockManager:new v.BlockManager([new P({})])})),t},onInit:function(e){n.setFormulaInputEditorRef(e)},inEmbed:function(){return!1},editable:!0,idleWorkTimer:!1})}},{key:"render",value:function(){return m.createElement("div",{className:"formula-editor-input",ref:this.setTextEditorRef,spellCheck:!1,autoCorrect:"false"},this.getEditorReactComponent())}}]),r}(m.Component);function ue(){var e=B.CI.CurrentValue;return{name:e,id:B.BI,referenceId:e,type:B.tI.CurrentValue,parent:null}}var me=function(r){function i(){var e;Object(B.ov)(this,i);for(var t=arguments.length,n=new Array(t),a=0;a<t;a++)n[a]=arguments[a];return(e=r.call.apply(r,[this].concat(n))||this).handleClickHelper=function(){B.ob.collectBitableEvent(B.On.BitableFormulaHelpercenterUse)},e}return Object(B.bu)(i,r),Object(B.Pw)(i,[{key:"render",value:function(){var e=this.props,t=e.mode,n=e.onClickCancel,a=e.onClickConfirm;return F.a.createElement("div",{className:"formula-editor-footer"},t===k.b.SIMPLE?F.a.createElement("div",null):F.a.createElement("a",{className:"bitable-formula-guide-icon bitable-formula-guide-tap-icon",target:"_blank",href:p("bitable.formula.helpcenterlink"),rel:"noreferrer",onClick:this.handleClickHelper},F.a.createElement(o.a,null),p("bitable.formula.guide.tooltip")),F.a.createElement("div",{className:"footer-cancel-submit-button-group"},F.a.createElement(B.hX,{onCancel:n,onSubmit:a,submitBtnText:p("common.confirm")})))}}]),i}(F.a.PureComponent),pe="bitable-formula-guide",de=function(e){function t(){return Object(B.ov)(this,t),e.apply(this,arguments)||this}return Object(B.bu)(t,e),Object(B.Pw)(t,[{key:"render",value:function(){var e=this.props,t=e.mode,n=e.toggleFullScreen,a=t===k.b.FULLSCREEN;return F.a.createElement(F.a.Fragment,null,F.a.createElement(N.Tooltip,{title:p(a?"Bitable_Automation_Calendar_Collapse":"Bitable_Formula_ExpandEditor"),placement:"top",adjustOverflow:!0,mouseEnterDelay:200},F.a.createElement("div",{className:"".concat(pe,"-icon ").concat(pe,"-press-icon"),onClick:function(){return null==n?void 0:n(t)}},a?F.a.createElement(i.a,null):F.a.createElement(l.a,null))))}}]),t}(m.PureComponent),fe=function(e){function t(){return Object(B.ov)(this,t),e.apply(this,arguments)||this}return Object(B.bu)(t,e),Object(B.Pw)(t,[{key:"render",value:function(){var e=this.props,t=e.mode,n=e.setEditorMode,a=e.toggleFullScreen,r=e.onlyFullScreen,i=t===k.b.SIMPLE?k.b.ADVANCE:k.b.SIMPLE,o=t===k.b.SIMPLE?p("bitable.formula.enter_advance"):p("bitable.formula.enter_simple");return F.a.createElement("div",{className:"formula-editor-header"},F.a.createElement("div",{className:"title"},p("Bitable_Formula_FormulaEditor_Title")),r?null:t===k.b.FULLSCREEN?F.a.createElement(de,{mode:t,toggleFullScreen:a}):F.a.createElement("div",{className:"switch",onClick:function(){return n(i)}},F.a.createElement(c.a,null),F.a.createElement("span",null,o)))}}]),t}(F.a.PureComponent),be={SUM:{example:p("Bitable_Formula_SumExample"),funcDesc:p("Bitable_Formula_SumDesc"),paramDesc:[p("Bitable_Formula_SumArgument1Desc"),p("Bitable_Formula_SumArgument2Desc")],paramName:[p("Bitable_Formula_SumArgument1Name"),p("Bitable_Formula_SumArgument2Name")],type:B.DI.DIGITAL},AVERAGE:{example:p("Bitable_Formula_AverageExample"),funcDesc:p("Bitable_Formula_AverageDesc"),paramDesc:[p("Bitable_Formula_AverageArgument1Desc"),p("Bitable_Formula_AverageArgument2Desc")],paramName:[p("Bitable_Formula_AverageArgument1Name"),p("Bitable_Formula_AverageArgument2Name")],type:B.DI.DIGITAL},COUNTA:{example:p("Bitable_Formula_CountaExample"),funcDesc:p("Bitable_Formula_CountaDesc"),paramDesc:[p("Bitable_Formula_CountaArgument1Desc"),p("Bitable_Formula_CountaArgument2Desc")],paramName:[p("Bitable_Formula_CountaArgument1Name"),p("Bitable_Formula_CountaArgument2Name")],type:B.DI.DIGITAL},ROUNDDOWN:{example:p("Bitable_Formula_RounddownExample"),funcDesc:p("Bitable_Formula_RounddownDesc"),paramDesc:[p("Bitable_Formula_RounddownArgument1Desc"),p("Bitable_Formula_RounddownArgument2Desc")],paramName:[p("Bitable_Formula_RounddownArgument1Name"),p("Bitable_Formula_RounddownArgument2Name")],type:B.DI.DIGITAL},ROUND:{example:p("Bitable_Formula_RoundExample"),funcDesc:p("Bitable_Formula_RoundDesc"),paramDesc:[p("Bitable_Formula_RoundArgument1Desc"),p("Bitable_Formula_RoundArgument2Desc")],paramName:[p("Bitable_Formula_RoundArgument1Name"),p("Bitable_Formula_RoundArgument2Name")],type:B.DI.DIGITAL},ROUNDUP:{example:p("Bitable_Formula_RoundupExample"),funcDesc:p("Bitable_Formula_RoundupDesc"),paramDesc:[p("Bitable_Formula_RoundupArgument1Desc"),p("Bitable_Formula_RoundupArgument2Desc")],paramName:[p("Bitable_Formula_RoundupArgument1Name"),p("Bitable_Formula_RoundupArgument2Name")],type:B.DI.DIGITAL},MAX:{example:p("Bitable_Formula_MaxExample"),funcDesc:p("Bitable_Formula_MaxDesc"),paramDesc:[p("Bitable_Formula_MaxArgument1Desc"),p("Bitable_Formula_MaxArgument2Desc")],paramName:[p("Bitable_Formula_MaxArgument1Name"),p("Bitable_Formula_MaxArgument2Name")],type:B.DI.DIGITAL},MIN:{example:p("Bitable_Formula_MinExample"),funcDesc:p("Bitable_Formula_MinDesc"),paramDesc:[p("Bitable_Formula_MinArgument1Desc"),p("Bitable_Formula_MinArgument2Desc")],paramName:[p("Bitable_Formula_MinArgument1Name"),p("Bitable_Formula_MinArgument2Name")],type:B.DI.DIGITAL},ABS:{example:p("Bitable_Formula_AbsExample"),funcDesc:p("Bitable_Formula_AbsDesc"),paramDesc:[p("Bitable_Formula_AbsArgument1Desc")],paramName:[p("Bitable_Formula_AbsArgument1Name")],type:B.DI.DIGITAL},IF:{helpLinkFeishu:p("Bitable_Formula_IfAndIfsGuideFeishu"),helpLinkLark:p("Bitable_Formula_IfAndIfsGuideLark"),example:p("Bitable_Formula_IfExample"),funcDesc:p("Bitable_Formula_IfDesc"),paramDesc:[p("Bitable_Formula_IfArgument1Desc"),p("Bitable_Formula_IfArgument2Desc"),p("Bitable_Formula_IfArgument3Desc")],paramName:[p("Bitable_Formula_IfArgument1Name"),p("Bitable_Formula_IfArgument2Name"),p("Bitable_Formula_IfArgument3Name")],type:B.DI.LOGIC},IFS:{helpLinkFeishu:p("Bitable_Formula_IfAndIfsGuideFeishu"),helpLinkLark:p("Bitable_Formula_IfAndIfsGuideLark"),example:p("Bitable_Formula_IfsExample"),funcDesc:p("Bitable_Formula_IfsDesc"),paramDesc:[p("Bitable_Formula_IfsArgument1Desc"),p("Bitable_Formula_IfsArgument2Desc"),p("Bitable_Formula_IfsArgument3Desc"),p("Bitable_Formula_IfsArgument4Desc")],paramName:[p("Bitable_Formula_IfsArgument1Name"),p("Bitable_Formula_IfsArgument2Name"),p("Bitable_Formula_IfsArgument3Name"),p("Bitable_Formula_IfsArgument4Name")],type:B.DI.LOGIC},AND:{example:p("Bitable_Formula_AndExample"),funcDesc:p("Bitable_Formula_AndDesc"),paramDesc:[p("Bitable_Formula_AndArgument1Desc"),p("Bitable_Formula_AndArgument2Desc")],paramName:[p("Bitable_Formula_AndArgument1Name"),p("Bitable_Formula_AndArgument2Name")],type:B.DI.LOGIC},OR:{example:p("Bitable_Formula_OrExample"),funcDesc:p("Bitable_Formula_OrDesc"),paramDesc:[p("Bitable_Formula_OrArgument1Desc"),p("Bitable_Formula_OrArgument2Desc")],paramName:[p("Bitable_Formula_OrArgument1Name"),p("Bitable_Formula_OrArgument2Name")],type:B.DI.LOGIC},NOT:{example:p("Bitable_Formula_NotExample"),funcDesc:p("Bitable_Formula_NotDesc"),paramDesc:[p("Bitable_Formula_NotArgument1Desc")],paramName:[p("Bitable_Formula_NotArgument1Name")],type:B.DI.LOGIC},TRUE:{example:p("Bitable_Formula_TrueExample"),funcDesc:p("Bitable_Formula_TrueDesc"),paramDesc:[""],paramName:[""],type:B.DI.LOGIC},FALSE:{example:p("Bitable_Formula_FalseExample"),funcDesc:p("Bitable_Formula_FalseDesc"),paramDesc:[""],paramName:[""],type:B.DI.LOGIC},COUNTIF:{chainingMode:!0,helpLinkFeishu:p("Bitable_Formula_CountifGuideFeishu"),helpLinkLark:p("Bitable_Formula_CountifGuideLark"),example:p("Bitable_Formula_CountifExample"),funcDesc:p("Bitable_Formula_CountifDesc"),shortExample:p("Bitable_Formula_CountifExampleNew"),paramDesc:[p("Bitable_Formula_CountifArgument1Desc"),p("Bitable_Formula_CountifArgument2Desc")],paramName:[p("Bitable_Formula_CountifArgument1Name"),p("Bitable_Formula_CountifArgument2Name")],type:B.DI.DIGITAL},SUMIF:{helpLinkFeishu:p("Bitable_Formula_SumifGuideFeishu"),helpLinkLark:p("Bitable_Formula_SumifGuideLark"),example:p("Bitable_Formula_SumifExample"),funcDesc:p("Bitable_Formula_SumifDesc"),shortExample:p("Bitable_Formula_SumifExampleNew"),paramDesc:[p("Bitable_Formula_SumifArgument1Desc"),p("Bitable_Formula_SumifArgument2Desc")],paramName:[p("Bitable_Formula_SumifArgument1Name"),p("Bitable_Formula_SumifArgument2Name")],type:B.DI.DIGITAL},FILTER:{example:p("Bitable_Formula_FilterExample"),shortExample:p("Bitable_Formula_FilterExampleNew"),chainingMode:!0,helpLinkFeishu:p("Bitable_Formula_FilterGuideFeishu"),helpLinkLark:p("Bitable_Formula_FilterGuideLark"),funcDesc:p("Bitable_Formula_FilterDesc"),paramDesc:[p("Bitable_Formula_FilterArgument1Desc"),p("Bitable_Formula_FilterArgument2Desc")],paramName:[p("Bitable_Formula_FilterArgument1Name"),p("Bitable_Formula_FilterArgument2Name")],type:B.DI.LOGIC},CONTAINS:{example:p("Bitable_Formula_ContainsExample"),funcDesc:p("Bitable_Formula_ContainsDesc"),paramDesc:[p("Bitable_Formula_ContainsArgument1Desc"),p("Bitable_Formula_ContainsArgument2Desc")],paramName:[p("Bitable_Formula_ContainsArgument1Name"),p("Bitable_Formula_ContainsArgument2Name")],type:B.DI.LOGIC},CONTAIN:{helpLinkFeishu:p("Bitable_Formula_ContainGuideFeishu"),helpLinkLark:p("Bitable_Formula_ContainGuideLark"),example:p("Bitable_Formula_ContainExample"),funcDesc:p("Bitable_Formula_ContainDesc"),paramDesc:[p("Bitable_Formula_ContainArgument1Desc"),p("Bitable_Formula_ContainArgument2Desc")],paramName:[p("Bitable_Formula_ContainArgument1Name"),p("Bitable_Formula_ContainArgument2Name")],type:B.DI.LOGIC},TODATE:{example:p("Bitable_Formula_TodateExample"),funcDesc:p("Bitable_Formula_TodateDesc"),paramDesc:[p("Bitable_Formula_TodateArgument1Desc")],paramName:[p("Bitable_Formula_TodateArgument1Name")],type:B.DI.TEXT},MID:{example:p("Bitable_Formula_MidExample"),funcDesc:p("Bitable_Formula_MidDesc"),paramDesc:[p("Bitable_Formula_MidArgument1Desc"),p("Bitable_Formula_MidArgument2Desc"),p("Bitable_Formula_MidArgument3Desc")],paramName:[p("Bitable_Formula_MidArgument1Name"),p("Bitable_Formula_MidArgument2Name"),p("Bitable_Formula_MidArgument3Name")],type:B.DI.TEXT},LEFT:{example:p("Bitable_Formula_LeftExample"),funcDesc:p("Bitable_Formula_LeftDesc"),paramDesc:[p("Bitable_Formula_LeftArgument1Desc"),p("Bitable_Formula_LeftArgument2Desc")],paramName:[p("Bitable_Formula_LeftArgument1Name"),p("Bitable_Formula_LeftArgument2Name")],type:B.DI.TEXT},RIGHT:{example:p("Bitable_Formula_RightExample"),funcDesc:p("Bitable_Formula_RightDesc"),paramDesc:[p("Bitable_Formula_RightArgument1Desc"),p("Bitable_Formula_RightArgument2Desc")],paramName:[p("Bitable_Formula_RightArgument1Name"),p("Bitable_Formula_RightArgument2Name")],type:B.DI.TEXT},LEN:{example:p("Bitable_Formula_LenExample"),funcDesc:p("Bitable_Formula_LenDesc"),paramDesc:[p("Bitable_Formula_LenArgument1Desc")],paramName:[p("Bitable_Formula_LenArgument1Name")],type:B.DI.TEXT},TRIM:{example:p("Bitable_Formula_TrimExample"),funcDesc:p("Bitable_Formula_TrimDesc"),paramDesc:[p("Bitable_Formula_TrimArgument1Desc")],paramName:[p("Bitable_Formula_TrimArgument1Name")],type:B.DI.TEXT},UPPER:{example:p("Bitable_Formula_UpperExample"),funcDesc:p("Bitable_Formula_UpperDesc"),paramDesc:[p("Bitable_Formula_UpperArgument1Desc")],paramName:[p("Bitable_Formula_UpperArgument1Name")],type:B.DI.TEXT},LOWER:{example:p("Bitable_Formula_LowerExample"),funcDesc:p("Bitable_Formula_LowerDesc"),paramDesc:[p("Bitable_Formula_LowerArgument1Desc")],paramName:[p("Bitable_Formula_LowerArgument1Name")],type:B.DI.TEXT},SUBSTITUTE:{example:p("Bitable_Formula_SubstituteExample"),funcDesc:p("Bitable_Formula_SubstituteDesc"),paramDesc:[p("Bitable_Formula_SubstituteArgument1Desc"),p("Bitable_Formula_SubstituteArgument2Desc"),p("Bitable_Formula_SubstituteArgument3Desc"),p("Bitable_Formula_SubstituteArgument4Desc")],paramName:[p("Bitable_Formula_SubstituteArgument1Name"),p("Bitable_Formula_SubstituteArgument2Name"),p("Bitable_Formula_SubstituteArgument3Name"),p("Bitable_Formula_SubstituteArgument4Name")],type:B.DI.TEXT},REPLACE:{example:p("Bitable_Formula_ReplaceExample"),funcDesc:p("Bitable_Formula_ReplaceDesc"),paramDesc:[p("Bitable_Formula_ReplaceArgument1Desc"),p("Bitable_Formula_ReplaceArgument2Desc"),p("Bitable_Formula_ReplaceArgument3Desc"),p("Bitable_Formula_ReplaceArgument4Desc")],paramName:[p("Bitable_Formula_ReplaceArgument1Name"),p("Bitable_Formula_ReplaceArgument2Name"),p("Bitable_Formula_ReplaceArgument3Name"),p("Bitable_Formula_ReplaceArgument4Name")],type:B.DI.TEXT},CONCATENATE:{example:p("Bitable_Formula_ConcatenateExample"),funcDesc:p("Bitable_Formula_ConcatenateDesc"),paramDesc:[p("Bitable_Formula_ConcatenateArgument1Desc"),p("Bitable_Formula_ConcatenateArgument2Desc")],paramName:[p("Bitable_Formula_ConcatenateArgument1Name"),p("Bitable_Formula_ConcatenateArgument2Name")],type:B.DI.TEXT},CHAR:{example:p("Bitable_Formula_CharExample"),funcDesc:p("Bitable_Formula_CharDesc"),paramDesc:[p("Bitable_Formula_CharArgument1Desc")],paramName:[p("Bitable_Formula_CharArgument1Name")],type:B.DI.TEXT},FIND:{helpLinkFeishu:p("Bitable_Formula_FindGuideFeishu"),helpLinkLark:p("Bitable_Formula_FindGuideLark"),example:p("Bitable_Formula_FindExample"),shortExample:p("Bitable_Formula_FindExampleShortVer"),funcDesc:p("Bitable_Formula_FindDesc"),paramDesc:[p("Bitable_Formula_FindArgument1Desc"),p("Bitable_Formula_FindArgument2Desc"),p("Bitable_Formula_FindArgument3Desc")],paramName:[p("Bitable_Formula_FindArgument1Name"),p("Bitable_Formula_FindArgument2Name"),p("Bitable_Formula_FindArgument3Name")],type:B.DI.TEXT},TODAY:{example:p("Bitable_Formula_TodayExample"),funcDesc:p("Bitable_Formula_TodayDesc"),paramDesc:[],paramName:[],type:B.DI.DATE},DATE:{example:p("Bitable_Formula_DateExample"),funcDesc:p("Bitable_Formula_DateDesc"),paramDesc:[p("Bitable_Formula_DateArgument1Desc"),p("Bitable_Formula_DateArgument2Desc"),p("Bitable_Formula_DateArgument3Desc")],paramName:[p("Bitable_Formula_DateArgument1Name"),p("Bitable_Formula_DateArgument2Name"),p("Bitable_Formula_DateArgument3Name")],type:B.DI.DATE},NOW:{example:p("Bitable_Formula_NowExample"),funcDesc:p("Bitable_Formula_NowDesc"),paramDesc:[],paramName:[],type:B.DI.DATE},DATEDIF:{example:p("Bitable_Formula_DatedifExample"),funcDesc:p("Bitable_Formula_DatedifDesc"),paramDesc:[p("Bitable_Formula_DatedifArgument1Desc"),p("Bitable_Formula_DatedifArgument2Desc"),p("Bitable_Formula_DatedifArgument3Desc")],paramName:[p("Bitable_Formula_DatedifArgument1Name"),p("Bitable_Formula_DatedifArgument2Name"),p("Bitable_Formula_DatedifArgument3Name")],type:B.DI.DATE},DAYS:{example:p("Bitable_Formula_DaysExample"),funcDesc:p("Bitable_Formula_DaysDesc"),paramDesc:[p("Bitable_Formula_DaysArgument1Desc"),p("Bitable_Formula_DaysArgument2Desc")],paramName:[p("Bitable_Formula_DaysArgument1Name"),p("Bitable_Formula_DaysArgument2Name")],type:B.DI.DATE},YEAR:{example:p("Bitable_Formula_YearExample"),funcDesc:p("Bitable_Formula_YearDesc"),paramDesc:[p("Bitable_Formula_YearArgument1Desc")],paramName:[p("Bitable_Formula_YearArgument1Name")],type:B.DI.DATE},MONTH:{example:p("Bitable_Formula_MonthExample"),funcDesc:p("Bitable_Formula_MonthDesc"),paramDesc:[p("Bitable_Formula_MonthArgument1Desc")],paramName:[p("Bitable_Formula_MonthArgument1Name")],type:B.DI.DATE},DAY:{example:p("Bitable_Formula_DayExample"),funcDesc:p("Bitable_Formula_DayDesc"),paramDesc:[p("Bitable_Formula_DayArgument1Desc")],paramName:[p("Bitable_Formula_DayArgument1Name")],type:B.DI.DATE},HOUR:{example:p("Bitable_Formula_HourExample"),funcDesc:p("Bitable_Formula_HourDesc"),paramDesc:[p("Bitable_Formula_HourArgument1Desc")],paramName:[p("Bitable_Formula_HourArgument1Name")],type:B.DI.DATE},MINUTE:{example:p("Bitable_Formula_MinuteExample"),funcDesc:p("Bitable_Formula_MinuteDesc"),paramDesc:[p("Bitable_Formula_MinuteArgument1Desc")],paramName:[p("Bitable_Formula_MinuteArgument1Name")],type:B.DI.DATE},SECOND:{example:p("Bitable_Formula_SecondExample"),funcDesc:p("Bitable_Formula_SecondDesc"),paramDesc:[p("Bitable_Formula_SecondArgument1Desc")],paramName:[p("Bitable_Formula_SecondArgument1Name")],type:B.DI.DATE},NETWORKDAYS:{example:p("Bitable_Formula_NetworkdaysExample"),funcDesc:p("Bitable_Formula_NetworkdaysDesc"),paramDesc:[p("Bitable_Formula_NetworkdaysArgument1Desc"),p("Bitable_Formula_NetworkdaysArgument2Desc"),p("Bitable_Formula_NetworkdaysArgument3Desc")],paramName:[p("Bitable_Formula_NetworkdaysArgument1Name"),p("Bitable_Formula_NetworkdaysArgument2Name"),p("Bitable_Formula_NetworkdaysArgument3Name")],type:B.DI.DATE},WEEKDAY:{example:p("Bitable_Formula_WeekdayExample"),funcDesc:p("Bitable_Formula_WeekdayDesc"),paramDesc:[p("Bitable_Formula_WeekdayArgument1Desc"),p("Bitable_Formula_WeekdayArgument2Desc")],paramName:[p("Bitable_Formula_WeekdayArgument1Name"),p("Bitable_Formula_WeekdayArgument2Name")],type:B.DI.DATE},WEEKNUM:{example:p("Bitable_Formula_WeeknumExample"),funcDesc:p("Bitable_Formula_WeeknumDesc"),paramDesc:[p("Bitable_Formula_WeeknumArgument1Desc"),p("Bitable_Formula_WeeknumArgument2Desc")],paramName:[p("Bitable_Formula_WeeknumArgument1Name"),p("Bitable_Formula_WeeknumArgument2Name")],type:B.DI.DATE},WORKDAY:{example:p("Bitable_Formula_WorkdayExample"),funcDesc:p("Bitable_Formula_WorkdayDesc"),paramDesc:[p("Bitable_Formula_WorkdayArgument1Desc"),p("Bitable_Formula_WorkdayArgument2Desc"),p("Bitable_Formula_WorkdayArgument3Desc")],paramName:[p("Bitable_Formula_WorkdayArgument1Name"),p("Bitable_Formula_WorkdayArgument2Name"),p("Bitable_Formula_WorkdayArgument3Name")],type:B.DI.DATE},IFERROR:{example:p("Bitable_Formula_IferrorExample"),funcDesc:p("Bitable_Formula_IferrorDesc"),paramDesc:[p("Bitable_Formula_IferrorArgument1Desc"),p("Bitable_Formula_IferrorArgument2Desc")],paramName:[p("Bitable_Formula_IferrorArgument1Name"),p("Bitable_Formula_IferrorArgument2Name")],type:B.DI.LOGIC},ISERROR:{example:p("Bitable_Formula_IserrorExample"),funcDesc:p("Bitable_Formula_IserrorDesc"),paramDesc:[p("Bitable_Formula_IserrorArgument1Desc")],paramName:[p("Bitable_Formula_IserrorArgument1Name")],type:B.DI.LOGIC},LIST:{helpLinkFeishu:p("Bitable_Formula_ListGuideFeishu"),helpLinkLark:p("Bitable_Formula_ListGuideLark"),example:p("Bitable_Formula_ListExample"),funcDesc:p("Bitable_Formula_ListDesc"),paramDesc:[p("Bitable_Formula_ListArgument1Desc")],paramName:[p("Bitable_Formula_ListArgument1Name")],type:B.DI.TEXT},LOOKUP:{helpLinkFeishu:p("Bitable_Formula_LookupGuideFeishu"),helpLinkLark:p("Bitable_Formula_LookupGuideLark"),example:p("Bitable_Formula_LookupExample"),funcDesc:p("Bitable_Formula_LookupDesc"),paramDesc:[p("Bitable_Formula_LookupArgument1Desc"),p("Bitable_Formula_LookupArgument2Desc"),p("Bitable_Formula_LookupArgument3Desc"),p("Bitable_Formula_LookupArgument4Desc")],paramName:[p("Bitable_Formula_LookupArgument1Name"),p("Bitable_Formula_LookupArgument2Name"),p("Bitable_Formula_LookupArgument3Name"),p("Bitable_Formula_LookupArgument4Name")],type:B.DI.LOGIC},TEXT:{helpLinkFeishu:p("Bitable_Formula_TextGuideFeishu"),helpLinkLark:p("Bitable_Formula_TextGuideLark"),example:p("Bitable_Formula_TextExample"),funcDesc:p("Bitable_Formula_TextDesc"),paramDesc:[p("Bitable_Formula_TextArgument1Desc"),p("Bitable_Formula_TextArgument2Desc")],paramName:[p("Bitable_Formula_TextArgument1Name"),p("Bitable_Formula_TextArgument2Name")],type:B.DI.TEXT},ISBLANK:{helpLinkFeishu:p("Bitable_Formula_IsblankAndIfblankGuideFeishu"),helpLinkLark:p("Bitable_Formula_IsblankAndIfblankGuideLark"),example:p("Bitable_Formula_IsblankExample"),funcDesc:p("Bitable_Formula_IsblankDesc"),paramDesc:[p("Bitable_Formula_IsblankArgument1Desc")],paramName:[p("Bitable_Formula_IsblankArgument1Name")],type:B.DI.LOGIC},IFBLANK:{helpLinkFeishu:p("Bitable_Formula_IsblankAndIfblankGuideFeishu"),helpLinkLark:p("Bitable_Formula_IsblankAndIfblankGuideLark"),example:p("Bitable_Formula_IfblankExample"),funcDesc:p("Bitable_Formula_IfblankDesc"),paramDesc:[p("Bitable_Formula_IfblankArgument1Desc"),p("Bitable_Formula_IfblankArgument2Desc")],paramName:[p("Bitable_Formula_IfblankArgument1Name"),p("Bitable_Formula_IfblankArgument2Name")],type:B.DI.LOGIC},LAST_MODIFIED_TIME:{example:p("Bitable_Formula_LastModifiedTimeExample"),funcDesc:p("Bitable_Formula_LastModifiedTimeDesc"),paramDesc:[p("Bitable_Formula_LastModifiedArgument1Desc")],paramName:[p("Bitable_Formula_LastModifiedArgument1Name")],type:B.DI.DATE},RECORD_ID:{example:p("Bitable_Formula_RecordIdExample"),funcDesc:p("Bitable_Formula_RecordIdDesc"),paramDesc:[],paramName:[],type:B.DI.LOGIC},NTH:{chainingMode:!0,example:p("Bitable_Formula_NthExample"),funcDesc:p("Bitable_Formula_NthDesc"),paramDesc:[p("Bitable_Formula_NthArgument1Desc"),p("Bitable_Formula_NthArgument2Desc")],paramName:[p("Bitable_Formula_NthArgument1Name"),p("Bitable_Formula_NthArgument2Name")],type:B.DI.LOGIC},UNIQUE:{example:p("Bitable_Formula_UniqueExample"),funcDesc:p("Bitable_Formula_UniqueDesc"),paramDesc:[p("Bitable_Formula_UniqueArgument1Desc"),p("Bitable_Formula_UniqueArgument2Desc")],paramName:[p("Bitable_Formula_UniqueArgument1Name"),p("Bitable_Formula_UniqueArgument2Name")],type:B.DI.LOGIC},LISTCOMBINE:{example:p("Bitable_Formula_ListCombineExample"),funcDesc:p("Bitable_Formula_ListCombineDesc"),paramDesc:[p("Bitable_Formula_ListCombineArgument1Desc"),p("Bitable_Formula_ListCombineArgument2Desc")],paramName:[p("Bitable_Formula_ListCombineArgument1Name"),p("Bitable_Formula_ListCombineArgument2Name")],type:B.DI.TEXT},HYPERLINK:{example:p("Bitable_Formula_HyperlinkExapmle"),funcDesc:p("Bitable_Formula_HyperlinkDesc"),paramDesc:[p("Bitable_Formula_HyperlinkArgument1Desc"),p("Bitable_Formula_HyperlinkArgument2Desc")],paramName:[p("Bitable_Formula_HyperlinkArgument1Name"),p("Bitable_Formula_HyperlinkArgument2Name")],type:B.DI.TEXT},ARRAYJOIN:{example:p("Bitable_Formula_ArrayjoinExample"),funcDesc:p("Bitable_Formula_ArrayjoinDesc"),paramDesc:[p("Bitable_Formula_ArrayjoinArgument1Desc"),p("Bitable_Formula_ArrayjoinArgument2Desc")],paramName:[p("Bitable_Formula_ArrayjoinArgument1Name"),p("Bitable_Formula_ArrayjoinArgument2Name")],type:B.DI.TEXT},POWER:{example:p("Bitable_Formula_PowerExample"),funcDesc:p("Bitable_Formula_PowerDesc"),paramDesc:[p("Bitable_Formula_PowerArgument1Desc"),p("Bitable_Formula_PowerArgument2Desc")],paramName:[p("Bitable_Formula_PowerArgument1Name"),p("Bitable_Formula_PowerArgument2Name")],type:B.DI.DIGITAL},VALUE:{example:p("Bitable_Formula_ValueExample"),funcDesc:p("Bitable_Formula_ValueDesc"),paramDesc:[p("Bitable_Formula_ValueArgumentDesc")],paramName:[p("Bitable_Formula_ValueArgumentName")],type:B.DI.DIGITAL},SWITCH:{example:p("Bitable_Formula_SwitchExample"),funcDesc:p("Bitable_Formula_SwitchDesc"),paramDesc:[p("Bitable_Formula_SwitchArgument1Desc"),p("Bitable_Formula_SwitchArgument2Desc"),p("Bitable_Formula_SwitchArgument3Desc"),p("Bitable_Formula_SwitchArgument4Desc"),p("Bitable_Formula_SwitchArgument5Desc")],paramName:[p("Bitable_Formula_SwitchArgument1Name"),p("Bitable_Formula_SwitchArgument2Name"),p("Bitable_Formula_SwitchArgument3Name"),p("Bitable_Formula_SwitchArgument4Name"),p("Bitable_Formula_SwitchArgument5Name")],type:B.DI.LOGIC},CONTAINTEXT:{example:p("Bitable_Formula_ContainTextExample"),funcDesc:p("Bitable_Formula_ContainTextDesc"),paramDesc:[p("Bitable_Formula_ContainTextArgument1Desc"),p("Bitable_Formula_ContainTextArgument2Desc")],paramName:[p("Bitable_Formula_ContainTextArgument1Name"),p("Bitable_Formula_ContainTextArgument2Name")],type:B.DI.TEXT},DISTANCE:{example:p("Bitable_Formula_DistanceExample"),funcDesc:p("Bitable_Formula_DistanceDesc"),paramDesc:[p("Bitable_Formula_DistanceArgument1Desc"),p("Bitable_Formula_DistanceArgument2Desc")],paramName:[p("Bitable_Formula_DistanceArgument1"),p("Bitable_Formula_DistanceArgument2")],type:B.DI.POSITION}},he=function(t){function n(e){var E;return Object(B.ov)(this,n),(E=t.call(this,e)||this).mode=k.b.ADVANCE,E.lock=!1,E.customRefs=[],E.getEditorText=function(e){var t,n;return e?null===(n=E.inputRef)||void 0===n?void 0:n.getEditorText():null===(t=E.inputRef)||void 0===t?void 0:t.getEditorIDReference()},E.toggleError=function(e,t){var n=t.name?": "+t.name:"",a=re[t.type]+n;E.setState({showError:e,msg:a}),B.ob.collectBitableEvent(B.On.BitableFormulaEditError,{formula_error_type:re[t.type],formula_error_msg:a})},E.toggleErrorKeyword=function(e){E.aloneHighlightKeyword(e)},E.searchRefs=function(e){var t,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"",a=E.props.searchRefs(e,n,E.mode);if(null!==(t=E.inputRef)&&void 0!==t&&t.isInsideMappableFunc()&&!n){var r=E.getCustomRefs(e);a.splice.apply(a,[0,0].concat(Object(B.hI)(r)))}return a},E.updateKeyword=function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"",n=2<arguments.length?arguments[2]:void 0;e=H(e);var a=E.props.getFunctions(e.toUpperCase()),r=E.searchRefs(e,t),i=null==n?0:E.getActiveItemIndex(n,r,a);E.setState({searchedFunctions:a,searchedRefs:r,activeIndex:i},function(){E.scrollIntoView()})},E.aloneHighlightKeyword=function(e){E.updateKeyword(e),E.setActiveItemByName(e)},E.clearKeyword=function(){E.setState({searchedFunctions:[],searchedRefs:[],activeIndex:0})},E.isTableRefKeyWord=function(t){return E.searchRefs(t,null).some(function(e){return e.type===B.rJ.Table&&e.showName===t})},E.itemToDetailContent=function(e){var t,n,a,r,i,o,l,c,s,u,m,p="",d="";return e instanceof B.wI?(t=E.props.i18nService.getFuncDesc(e.name),t=F.a.createElement(B.ix,{name:t}),n=E.props.i18nService.getFuncExample(e.name),r=null===(c=be[e.name])||void 0===c?void 0:c.shortExample,i=null===(s=be[e.name])||void 0===s?void 0:s.helpLinkFeishu,o=null===(u=be[e.name])||void 0===u?void 0:u.helpLinkLark,a=n,l=E.getFunctionParameters(e),d=null!==(m=be[e.name])&&void 0!==m&&m.chainingMode?E.getChainingModeSuffixAndPrefix(e).join(e.name):e.name+E.getFunctionNameSuffix(e)):(t=e.desc,d=e.title||"",a=n=e.example||""),{headline:d,descriptions:t||p,syntax:a,example:n,shortExample:r,paramsInfo:l,helpLinkLark:o,helpLinkFeishu:i}},E.onClickCancel=function(e){e.stopPropagation(),E.props.endEdit(!0)},E.onClickConfirm=function(e){e.stopPropagation(),E.props.endEdit(!1)},E.onClickModalConfirm=function(e){E.onClickConfirm(e)},E.onClickModalCancel=function(e){e.stopPropagation(),E.onModalClose()},E.enterEditorWithInitData=function(){E.focus(),E.startEdit(E.currentData||E.props.formula,E.state.showEstimatedExecutionTime)},E.handleMouseEnter=function(e){E.lock||E.state.activeIndex!==e&&E.isValidIndex(e)&&E.setState({activeIndex:e})},E.handleSelectRefsOrFuncToEditor=function(){var e,t=E.getActiveItem();t&&E.props.onClickSidebarItem&&E.props.onClickSidebarItem(t),null===(e=E.inputRef)||void 0===e||e.completeKeyName()},E.setInputRef=function(e){E.inputRef=e},E.onCompileTokens=function(e){return E.state.showError&&E.setState({showError:!1}),E.props.compileTokens(e)},E.getFunctionType=function(e){return E.props.i18nService.getFuncMeta(e.name).type},E.renderRefsList=function(){var e=E.state.searchedRefs,t=e.filter(function(e){return!!e.groupTitle}),n=e.filter(function(e){return!e.groupTitle});return F.a.createElement(F.a.Fragment,null,0<t.length?E.renderRefsListImpl(t,-1):null,0<n.length?E.renderRefsListImpl(n,t.length-1):null)},E.renderRefsListImpl=function(e,r){var i=E.groupRefByType(e),o=E.props.allTableRecordReadable;return Object.keys(i).map(function(e){var t=i[e],n=p("table"===e?"Bitable_Formula_TablesToReference_Title":"Bitable_Formula_FieldsToReference_Title"),a=t[0].groupTitle||n;return F.a.createElement(F.a.Fragment,null,0<t.length&&a&&F.a.createElement("span",{className:"sidebar-header"},a),t.map(function(e){return r++,E.renderSuggestionsComponent(e,r,Object(k.i)(e)?"property":"ref")}),e===B.rJ.Table&&!o&&F.a.createElement("div",{className:"permission-info"},p("Bitable_AdvancedPermission_NoPermTableFiltered_Toast")))})},E.renderFunctionList=function(){var e=E.state,t=e.searchedRefs,n=e.searchedFunctions,a=t.length-1,r=E.groupByType(n);return Object.keys(r).map(function(e,t){var n=r[e];return F.a.createElement(F.a.Fragment,null,0<n.length&&F.a.createElement("span",{key:t,className:"sidebar-header"},E.props.getFunctionsType(e)),n.map(function(e){return a++,E.renderSuggestionsComponent(e,a,"func")}))})},E.handleHeaderTextAreaClick=function(){var e;null===(e=E.inputRef)||void 0===e||e.focusAndSetSelectionToLast()},E.onModalClose=function(e){var t=E.props.setEditorMode;t&&t(k.b.ADVANCE,function(){return E.props.endEdit(!0)}),e&&e.keyCode===B.sx.Esc&&e.stopPropagation()},E.toggleFullScreen=function(e){var t,n=E.props,a=n.setEditorMode,r=n.serialize;if(E.currentData=(null===(t=E.inputRef)||void 0===t?void 0:t.getEditorIDReference())||null,E.currentData){var i=r(E.currentData);i&&!i.error||(E.currentData=null)}a&&a(e===k.b.ADVANCE?k.b.FULLSCREEN:k.b.ADVANCE,E.enterEditorWithInitData)},E.onFormulaChange=function(){E.setState({showEstimatedExecutionTime:!1})},E.renderBtnGroup=function(){return F.a.createElement("div",{className:"advanced-editor-header-btn-group"},F.a.createElement(de,{mode:E.props.mode,toggleFullScreen:E.toggleFullScreen}))},E.renderEmptyArea=function(){return F.a.createElement("div",{className:"advanced-editor-empty-area",onClick:E.handleHeaderTextAreaClick})},E.renderEditorBodyContent=function(){var e=E.state.activeIndex,t=E.getDetailByIndex(e),n=t.headline,a=t.descriptions,r=t.syntax,i=t.example,o=t.expected_result,l=t.paramsInfo,c=t.helpLinkFeishu,s=t.helpLinkLark;return F.a.createElement(F.a.Fragment,null,F.a.createElement("div",{className:"advanced-editor-sidebar"},F.a.createElement("div",{className:"sidebar-scrollable",ref:function(e){return E.sideBarRef=e}},E.renderRefsList(),E.renderFunctionList())),F.a.createElement(L,{headline:n,descriptions:a,syntax:r,example:i,expected_result:o,paramsInfo:l,helpLinkFeishu:c,helpLinkLark:s}))},E.cursorToShowFunc=function(e,t){for(var n=[],a=new Map,r=0;r<t.length&&t[r].startIndex<e;r++){if(t[r].type===B.EI.FunctionName){var i,o,l=t[r].text&&(null===(i=t[r].text)||void 0===i?void 0:i.slice(0,t[r].text.length-1).toUpperCase());l&&(n.push(l),(null===(o=t[r-1])||void 0===o?void 0:o.type)===B.EI.Point?a.set(l,1):a.set(l,0))}if(t[r].type===B.EI.Comma){var c=n[n.length-1];c&&a.set(c,(a.get(c)||0)+1)}t[r].type===B.EI.CloseParen&&n.pop()}var s=n[n.length-1];return s?{funcName:s,paramIndex:a.get(s)||0}:null},E.renderHighLightParam=function(e,t){var n=E.props.i18nService,a=be[e.name].chainingMode,r=n.getRequiredParams(e),i=n.getOptionalNotRepeatParams(e),o=n.getOptionalRepeatParams(e);if(null==r||null==i||null==o)return null;for(var l=r.length,c=i.length,s=e.repeatedLastParam,u=void 0===s?0:s,m=[],p=0;p<r.length;p++)m.push(F.a.createElement("span",{key:"operands_".concat(p),className:T()("hint-block-param",{"hint-block-param--active":p===t})},r[p].name));for(var d=0;d<i.length;d++)m.push(F.a.createElement("span",{key:"operands_option_no_repeat_".concat(d),className:T()("hint-block-param",{"hint-block-param--active":d===t-l})},"[".concat(i[d].name,"]")));var f=l+c;0<o.length&&f<t&&(t=(t-f)%u+f);for(var b=0,h=f;b<o.length;b++,h++)m.push(F.a.createElement("span",{key:"optional_repeat_operands_".concat(b),className:T()("hint-block-param",{"hint-block-param--active":h===t})},"[".concat(o[b].name,", ...]")));for(var v=[],g=0,_=m.length;g<_;g++)0!==g&&v.push(F.a.createElement("span",{key:"comma_".concat(g),className:"func-detail-panel__comma"},","," ")),v.push(m[g]);return a?F.a.createElement("div",{className:"hint-block-headline",onClick:function(){return E.handleClickHintBlockHeadline(e.name)}},F.a.createElement("span",null,v[0]),F.a.createElement("span",{className:"hint-block-func"},"."),F.a.createElement("span",{className:"hint-block-func"},e.name,"("),F.a.createElement("span",null,v.slice(2)),F.a.createElement("span",{className:"hint-block-func"},")")):F.a.createElement("div",{className:"hint-block-headline",onClick:function(){return E.handleClickHintBlockHeadline(e.name)}},F.a.createElement("span",{className:"hint-block-func"},e.name,"("),F.a.createElement("span",null,v),F.a.createElement("span",{className:"hint-block-func"},")"))},E.handleClickHintBlockHeadline=function(e){E.setActiveItemByName(e)},E.renderParamsTips=function(){var e,t,n=null===(e=E.inputRef)||void 0===e?void 0:e.getCaret(),a=null===(t=E.inputRef)||void 0===t?void 0:t.getTokens();if(null==n||null==a)return null;var r=E.cursorToShowFunc(n,a);if(!r)return null;var i=r.funcName,o=r.paramIndex,l=E.props.getFunctions().find(function(e){return e.name===i});if(!l)return null;var c=E.itemToDetailContent(l);return F.a.createElement("div",{className:"advanced-editor-hint-block"},E.renderHighLightParam(l,o),F.a.createElement("div",{className:"hint-block-example",onClick:function(){return E.handleClickHintBlockHeadline(l.name)}},F.a.createElement("span",{className:"hint-block-detail"},p("Bitable_Formula_Example")," ",c.shortExample||c.example)))},E.renderErrorOrEstimatedExecutionTime=function(){var e=E.state,t=e.showError,n=e.showEstimatedExecutionTime,a=e.msg;return t?F.a.createElement("div",{className:"formula-info invalid"},F.a.createElement(s.a,null),F.a.createElement("span",null,a)):n?F.a.createElement("div",{className:"formula-info"},F.a.createElement(u.a,null),F.a.createElement("span",null,a)):null},E.renderEditorBody=function(){var e=E.state,t=e.searchedFunctions,n=e.searchedRefs,a=E.props.mode===k.b.FULLSCREEN,r=0===t.length&&0===n.length;return a?F.a.createElement("div",{className:"advanced-editor-body"},r?F.a.createElement("div",{className:"advanced-editor-empty-info"},p("Bitable_Formula_EnterNameForTips")):F.a.createElement(F.a.Fragment,null,E.renderEditorBodyContent())):F.a.createElement("div",{className:"advanced-editor-body",style:{display:r?"none":"flex",maxHeight:350}},E.renderEditorBodyContent())},E.renderBaseContent=function(){var e=E.state.showError,t=E.props.mode===k.b.FULLSCREEN;return F.a.createElement("div",{className:"advanced-editor-wrapper"},F.a.createElement("div",{className:"advanced-editor-header"},F.a.createElement(fe,{mode:E.props.mode,setEditorMode:E.props.setEditorMode,toggleFullScreen:E.toggleFullScreen,onlyFullScreen:E.props.onlyFullScreen}),F.a.createElement("div",{className:"advanced-editor-input-container ".concat(e?"error":"")},F.a.createElement(se,{ref:E.setInputRef,context:Object(B.Cx)(E),serialize:E.props.serialize,compileTokens:function(e){return E.onCompileTokens(e)},endEdit:E.props.endEdit,onFormulaChange:E.onFormulaChange,isOpen:E.props.isOpen,getCalcCtx:E.props.getCalcCtx,isLinkRefChaining:E.props.isLinkRefChaining,serializeReference:E.props.serializeReference}),!t&&E.renderBtnGroup()),E.renderErrorOrEstimatedExecutionTime()),E.renderParamsTips(),E.renderEditorBody(),t?null:F.a.createElement(me,{mode:k.b.ADVANCE,onClickCancel:E.onClickCancel,onClickConfirm:E.onClickConfirm,setEditorMode:E.props.setEditorMode}))},E.renderFullScreenMode=function(){var e={mode:k.b.FULLSCREEN,onClickCancel:E.onClickModalCancel,onClickConfirm:E.onClickModalConfirm,setEditorMode:E.props.setEditorMode};return F.a.createElement(N.Dialog,{className:"formula-advanced-editor-modal",footer:F.a.createElement(me,e),visible:E.props.mode===k.b.FULLSCREEN,width:k.a,zIndex:100,keyboardClosable:!0,maskClosable:!1,closable:!1,onCancel:E.onModalClose},E.renderBaseContent())},E.state={searchedRefs:e.searchRefs("",null,E.mode),searchedFunctions:e.getFunctions(),activeIndex:0,showError:!1,showEstimatedExecutionTime:!1,msg:re.NONE},E.registerCustomRef(),E}return Object(B.bu)(n,t),Object(B.Pw)(n,[{key:"componentDidMount",value:function(){this.enterEditorWithInitData()}},{key:"startEdit",value:function(t,n){var a=this;Promise.resolve().then(function(){var e;null===(e=a.inputRef)||void 0===e||e.startEdit(t),n&&a.showEstimatedExecutionTimeWhenStart()})}},{key:"showEstimatedExecutionTimeWhenStart",value:function(){if(!this.state.showError){var e=this.getEditorText(),t=this.props.compile(e);if(null!=t&&t.formulaVar)try{var n=this.props.estimateExecutionTime(null==t?void 0:t.formulaVar),a=p("Bitable_Formula_ExpectedFormulaRunningTime"),r=+n<1?"".concat(a,"<1s"):"".concat(a).concat(n,"s");this.setState({showEstimatedExecutionTime:!0,msg:r})}catch(e){}}}},{key:"focus",value:function(){var t=this;Promise.resolve().then(function(){var e;null===(e=t.inputRef)||void 0===e||e.focus()})}},{key:"registerCustomRef",value:function(){var e=this.createCurrentValueRef();this.customRefs.push(e)}},{key:"createCurrentValueRef",value:function(){var e=ue();return Object.assign({},e,{showName:e.name,title:e.name,desc:p("Bitable_Formula_CurrentValueDesc"),example:p("Bitable_Formula_CurrentValueExample"),icon:a.a})}},{key:"getFunctionByName",value:function(e){return this.props.getFunctions(e.toUpperCase())[0]}},{key:"getRefsByName",value:function(t){return this.state.searchedRefs.filter(function(e){return e.type!==k.c.Property&&e.showName===t})}},{key:"getCustomRefs",value:function(t){return t?this.customRefs.filter(function(e){return e.name.toUpperCase().includes(t.toUpperCase())}):this.customRefs}},{key:"handleNavigate",value:function(e){var t=this.state.activeIndex+("UP"===e?-1:1);this.highlightActiveItem(t),this.lockActiveIndexWhenNavigate()}},{key:"getActiveItem",value:function(){var e,t=this.state,n=t.searchedRefs,a=t.searchedFunctions,r=t.activeIndex,i=n.length;return r<i&&0<i?e=n[r]:0<a.length&&(e=a[r-i]),e}},{key:"setActiveItemByName",value:function(e){var t=this.state,n=t.searchedRefs,a=t.searchedFunctions;this.highlightActiveItem(this.getActiveItemIndex(e,n,a))}},{key:"getActiveItemIndex",value:function(e,t,n){e=H(e);var a=t.map(function(e){return e.showName}),r=n.map(function(e){return e.name}),i=a.indexOf(e);if(-1===i){e=e.toUpperCase();var o=r.indexOf(e);i=-1===o?0:a.length+o}return i}},{key:"getFormulaService",value:function(){return this.props.formulaService}},{key:"highlightActiveItem",value:function(e){var t=this;this.isValidIndex(e)&&this.setState({activeIndex:e},function(){t.scrollIntoView()})}},{key:"isValidIndex",value:function(e){var t=this.state,n=t.searchedRefs,a=t.searchedFunctions,r=n.length+a.length;return!(e<0||r<=e)}},{key:"getDetailByIndex",value:function(e){var t,n=this.state,a=n.searchedRefs,r=n.searchedFunctions,i=a.length;return e<i&&0<i?t=a[e]:0<r.length&&(t=r[e-i]),t?this.itemToDetailContent(t):{headline:"",descriptions:"",syntax:"",example:""}}},{key:"getFunctionParameters",value:function(e){for(var t,n,a=this.props.i18nService,r=a.getRequiredParams(e)||[],i=(null===(t=a.getOptionalNotRepeatParams(e))||void 0===t?void 0:t.map(function(e){return e.name="[".concat(e.name,"]"),e}))||[],o=(null===(n=a.getOptionalRepeatParams(e))||void 0===n?void 0:n.map(function(e){return e.name="[".concat(e.name,", ...]"),e}))||[],l=[].concat(Object(B.hI)(r),Object(B.hI)(i),Object(B.hI)(o)),c=[],s=0;s<l.length;s++)c.push({name:l[s].name,desc:l[s].desc});return c}},{key:"getFunctionNameSuffix",value:function(e){for(var t=this.getFunctionParameters(e),n="(",a=0,r=t.length;a<r;a++)0!==a&&(n+=", "),n+=t[a].name;return n+")"}},{key:"getChainingModeSuffixAndPrefix",value:function(e){for(var t=this.getFunctionParameters(e),n="(",a=1,r=t.length;a<r;a++)1!==a&&(n+=", "),n+=t[a].name;return n+=")",[t[0].name+".",n]}},{key:"lockActiveIndexWhenNavigate",value:function(){var e=this;this.lock=!0,clearTimeout(this.lockTimeout),this.lockTimeout=setTimeout(function(){e.lock=!1},200)}},{key:"scrollIntoView",value:function(){if(this.sideBarRef){var e=this.sideBarRef,t=e.getElementsByClassName("suggestions-selected")[0];t&&this.scrollDOMToBottom(e,t)}}},{key:"scrollDOMToBottom",value:function(e,t){try{e.scrollTop=t.offsetTop+t.offsetHeight-e.offsetHeight}catch(e){console.error("scroll to viewport fail: container or target element invalid")}}},{key:"renderSuggestionsComponent",value:function(e,t,n){var a=this,r=e.icon,i="func"===n?e.name+"( )":e.showName,o="".concat(e.name,"_").concat(n,"_").concat(t),l=t===this.state.activeIndex;return F.a.createElement("div",{className:T()("suggestions ".concat(t),{"suggestions-selected":l}),key:o,onMouseEnter:function(){a.handleMouseEnter(t)},onMouseMove:function(){a.handleMouseEnter(t)},onClick:function(){a.handleSelectRefsOrFuncToEditor()}},("ref"===n||"property"===n)&&r&&F.a.createElement(r,null),F.a.createElement("span",{className:"suggestions-name"},i),l?F.a.createElement("span",{className:"suggestions-tab-hint"},"Tab"):null)}},{key:"groupByType",value:function(e){var a=this;return e.reduce(function(e,t){var n=a.getFunctionType(t);return e[n]||(e[n]=[]),e[n].push(t),e},{})}},{key:"groupRefByType",value:function(e){return e.reduce(function(e,t){var n=t.type;return e[n]||(e[n]=[]),e[n].push(t),e},{})}},{key:"render",value:function(){return this.props.mode===k.b.FULLSCREEN?this.renderFullScreenMode():this.renderBaseContent()}}]),n}(m.Component),ve=function(r){function i(){var t;Object(B.ov)(this,i);for(var e=arguments.length,n=new Array(e),a=0;a<e;a++)n[a]=arguments[a];return(t=r.call.apply(r,[this].concat(n))||this).setOptionListRef=function(e){t.listWrapper=e},t.getOptionListRef=function(){return t.listWrapper},t}return Object(B.bu)(i,r),Object(B.Pw)(i,[{key:"render",value:function(){var e=this.props,t=e.selectedId,n=e.optionsList,a=e.onChange,r=n.map(function(e){return{value:e.value,text:e.text,icon:e.icon}});return F.a.createElement("div",{className:"bitable-simple-editor-option-list-wrapper",ref:this.setOptionListRef},F.a.createElement(B.Tw,{className:""===t?"dropdown-no-select":"",selected:t,optionWidth:171,style:{position:"relative"},onChange:a,options:r,placeholder:p("bitable.formula.simple_editor_placeholder"),getContainer:this.getOptionListRef}))}}]),i}(F.a.PureComponent),ge=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e};function _e(e,t){var n={};for(var a in e)0<=t.indexOf(a)||Object.prototype.hasOwnProperty.call(e,a)&&(n[a]=e[a]);return n}var Ee=function(e){e.styles;var t=_e(e,["styles"]);return F.a.createElement("svg",ge({width:"20",height:"20",viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg"},t),F.a.createElement("circle",{cx:"10",cy:"10",r:"9",fill:"#FFA53D"}),F.a.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M10.208 7.917a1.042 1.042 0 1 0 0-2.084 1.042 1.042 0 0 0 0 2.084zm-3.975 1.25a.4.4 0 0 0-.4.4v.866c0 .221.18.4.4.4h7.534a.4.4 0 0 0 .4-.4v-.866a.4.4 0 0 0-.4-.4H6.233zm5.017 4.375a1.042 1.042 0 1 1-2.083 0 1.042 1.042 0 0 1 2.083 0z",fill:"#fff"}))},Fe=[{icon:F.a.createElement(e.a,null),type:B.sJ.Plus,entity:"+",name:"plus"},{icon:F.a.createElement(t.a,null),type:B.sJ.Minus,entity:"-",name:"subtract"},{icon:F.a.createElement(n.a,{style:{color:"var(--I400)"}}),type:B.sJ.Multiply,entity:"*",name:"multiply"},{icon:F.a.createElement(Ee,{fill:"var(--O400)"}),type:B.sJ.Divide,entity:"/",name:"divide"}],ye=function(t){function n(e){var s;return Object(B.ov)(this,n),(s=t.call(this,e)||this).editorRef=null,s.transferToSimepleRef=function(e){if(!e)return s.resetEditorValue(),!0;var t=s.props.compile(e);if(!t||null!==t.error)return s.resetEditorValue(),!1;var n=t.lexer;n.reset();var a=n.getAllTokens(),r="";if(1===a.length)return r=s.findFieldIdByName(a[0].text),s.setState({selectedField1:r,selectedField2:"",selectedArithmetic:0}),!0;if(3===a.length){var i=a[0],o=a[2],l=a[1],c=Fe.findIndex(function(e){return e.type===l.type});if(Z(i)&&Z(o)&&0<=c)return s.setState({selectedField1:s.findFieldIdByName(i.text),selectedField2:s.findFieldIdByName(o.text),selectedArithmetic:c}),!0}return s.setState({selectedField1:r,selectedField2:"",selectedArithmetic:0}),!1},s.getOpitonsList=function(){return s.props.refsList.map(function(e){return{value:e.id,text:e.showName||e.name,icon:e.icon}})},s.findFieldIdByName=function(t){var e=s.props.refsList;t=H(t);var n=e.find(function(e){return e.showName===t});return n?n.id:""},s.findIDReferenceByid=function(t){var e=s.props.refsList.find(function(e){return e.id===t});return e?e.referenceId:""},s.getEditorText=function(){var e=s.state,t=e.selectedField1,n=e.selectedField2,a=e.selectedArithmetic,r="";if(t&&n){var i=s.findIDReferenceByid(t),o=s.findIDReferenceByid(n);r=i+Fe[a].entity+o}else(t||n)&&(r=s.findIDReferenceByid(t||n));return r},s.handleField1Change=function(e){s.setState({selectedField1:e}),s.props.onSimpleEditorOptionListChange&&s.props.onSimpleEditorOptionListChange(e,k.d.Left)},s.handleField2Change=function(e){s.setState({selectedField2:e}),s.props.onSimpleEditorOptionListChange&&s.props.onSimpleEditorOptionListChange(e,k.d.Right)},s.handleArithmeticChange=function(e,t){s.setState({selectedArithmetic:t}),s.toggleArithmeticList(),s.props.onSimpleEditorArithmeticChange&&s.props.onSimpleEditorArithmeticChange(e)},s.toggleArithmeticList=function(){var e=s.state.showArithmeticList;s.setState({showArithmeticList:!e})},s.onClickCancel=function(e){e.stopPropagation(),s.props.endEdit(!0)},s.onClickConfirm=function(e){e.stopPropagation(),s.props.endEdit(!1)},s.state={selectedArithmetic:0,showArithmeticList:!1,selectedField1:"",selectedField2:""},s}return Object(B.bu)(n,t),Object(B.Pw)(n,[{key:"componentDidMount",value:function(){this.transferToSimepleRef(this.props.formula)}},{key:"startEdit",value:function(e){this.transferToSimepleRef(e)||this.props.setEditorMode(k.b.ADVANCE)}},{key:"toggleError",value:function(){}},{key:"focus",value:function(){this.editorRef&&this.editorRef.focus()}},{key:"resetEditorValue",value:function(){this.setState({selectedField1:"",selectedField2:"",selectedArithmetic:0})}},{key:"getArithmeticComps",value:function(){var n=this;return F.a.createElement("div",{className:"arithmetic-list"},Fe.map(function(e,t){return F.a.createElement("div",{className:"arithmetic-button",key:e.type,onClick:function(){return n.handleArithmeticChange(e,t)}},e.icon)}))}},{key:"render",value:function(){var t=this,e=this.state,n=e.showArithmeticList,a=e.selectedArithmetic,r=e.selectedField1,i=e.selectedField2,o=this.props.setEditorMode,l=this.getOpitonsList();return F.a.createElement("div",{className:"bitable-simple-editor-wrapper"},F.a.createElement("input",{readOnly:!0,className:"hidden-input",ref:function(e){return t.editorRef=e}}),F.a.createElement(fe,{mode:k.b.SIMPLE,setEditorMode:o}),F.a.createElement("div",{className:"selector-row"},F.a.createElement(ve,{selectedId:r,optionsList:l,onChange:this.handleField1Change}),F.a.createElement("div",{className:"arithmetic"},F.a.createElement("span",{onClick:this.toggleArithmeticList},Fe[a].icon),n?this.getArithmeticComps():null),F.a.createElement(ve,{selectedId:i,optionsList:l,onChange:this.handleField2Change})),F.a.createElement(me,{mode:k.b.SIMPLE,setEditorMode:o,onClickCancel:this.onClickCancel,onClickConfirm:this.onClickConfirm}))}}]),n}(m.Component);function Ie(e){var t="cannot create ref ",n="function ",a=e.getMessage();return null==a?null:-1<a.indexOf(t)?{type:"INVALID_REF",name:a.split(t)[1].split(" ")[0]}:-1<a.indexOf(n)?{type:"INVALID_FUNC",name:a.split(n)[1].split(" ")[0]}:null}var De,Be,ke,Ce,Ae,xe=function(t){function n(e){var d;return Object(B.ov)(this,n),(d=t.call(this,e)||this).startEdit=function(e){d.updateValue(e),d.editorRef&&d.editorRef.startEdit(e,!0)},d.endEdit=function(e){var t=d.state.mode===k.b.FULLSCREEN;if(e)return t?void d.setMode(k.b.ADVANCE,d.props.cancelEdit):void d.props.cancelEdit();var n=q(d.editorRef.getEditorText());if(""===n)return t?d.setMode(k.b.ADVANCE,function(){return d.props.submitEdit(n)}):d.props.submitEdit(n),!0;var a=d.checkFormulaError(n);return a&&(ie(a)&&(n=q(d.editorRef.getEditorText(!0)),a=d.checkFormulaError(n)),null!=a)?(d.editorRef.toggleError(!0,a),!1):(t?d.setMode(k.b.ADVANCE,function(){return d.props.submitEdit(n)}):d.props.submitEdit(n),!0)},d.focus=function(e,t){return d.editorRef.focus(),!1},d.setRef=function(e){d.editorRef=e},d.setEditorMode=function(e,t){var n=d.state.mode;d.setMode(e,function(){t&&t(),d.props.onSwitchMode&&d.props.onSwitchMode(d.state.mode,n)})},d.updateValue=function(e){d.setState({formula:e})},d.toggleErrorTips=function(e){d.editorRef&&(d.state.mode!==k.b.ADVANCE&&d.state.mode!==k.b.FULLSCREEN||d.editorRef.toggleErrorKeyword&&d.editorRef.toggleErrorKeyword(e))},d.checkFormulaError=function(e){var t=d.props.compile(e);return d.isResultVarTreeError(t)},d.isResultVarTreeError=function(e){if(!e||e.error)return{type:"INVALID_FORMULE"};var t=e.formulaVar,n=t.getRoot(),a=[];for(a.push(n);0<a.length;){var r=a.pop();if(r.isOp()){var i=r.op(),o=r.getArgs(),l=o.find(function(e){return e.isError()});if(l&&l.isError())return Ie(l);if(i instanceof B.yI)try{var c=r.getVar(d.props.getCalcCtx());if(c.isError())return Ie(c)}catch(e){return{type:"INVALID_FORMULE"}}if(i instanceof B.FI)continue;a.push.apply(a,Object(B.hI)(o))}else{if(r.isError())return Ie(r);if(r.isRef()){var s,u=null===(s=B.ob.MinaConfig)||void 0===s?void 0:s.getMinaBooleanConfig(B.JF.CcmBitableFormulaFilterEnable,!0),m=r.getRef();if(!u)return{type:"INVALID_TABLE"};if(Object(B.uI)(m)&&r===n)return{type:"INVALID_TABLE",name:m.name(Object.assign({},d.props.createDecompileCtx?d.props.createDecompileCtx():{},{ref:e.formulaVar.getRef()}))}}}}var p=t.predict();return p===B.GI?{type:"REJECT_TABLE_TIPS"}:p.isRef()&&Object(B.uI)(p.getRef())?(d.toggleErrorTips("FILTER"),{type:"INVALID_FILTER_RESULT"}):null},d.state={mode:e.mode||k.b.ADVANCE,formula:""},d}return Object(B.bu)(n,t),Object(B.Pw)(n,[{key:"getCurrentMode",value:function(){return this.state.mode}},{key:"getEditorText",value:function(){return this.editorRef.getEditorText()}},{key:"setMode",value:function(e,t){this.setState({mode:e},t)}},{key:"render",value:function(){var t=this,e=this.state,n=e.mode,a=void 0===n?k.b.ADVANCE:n,r=e.formula,i=this.props,o=i.compile,l=i.estimateExecutionTime,c=i.onlyFullScreen,s=i.searchRefs,u=i.getFunctions,m=i.getFunctionsType,p=i.compileTokens,d=i.serialize,f=i.serializeReference,b=function(){if(a===k.b.SIMPLE){var e=s("",null,a).filter(function(e){return e.type!==k.c.Property});return F.a.createElement(ye,{formula:r,refsList:e,setEditorMode:t.setEditorMode,compile:o,ref:t.setRef,endEdit:t.endEdit,onSimpleEditorOptionListChange:t.props.onSimpleEditorOptionListChange,onSimpleEditorArithmeticChange:t.props.onSimpleEditorArithmeticChange})}return F.a.createElement(he,{mode:a,formula:r,title:t.props.title,ref:t.setRef,setEditorMode:t.setEditorMode,compile:o,estimateExecutionTime:l,onlyFullScreen:c,serialize:d,compileTokens:p,getFunctions:u,getFunctionsType:m,searchRefs:s,endEdit:t.endEdit,i18nService:t.props.i18nService,formulaService:t.props.formulaService,isOpen:t.props.isOpen,onClickSidebarItem:t.props.onClickAdvancedEditorSibarItem,getCalcCtx:t.props.getCalcCtx,isLinkRefChaining:t.props.isLinkRefChaining,serializeReference:f,allTableRecordReadable:t.props.allTableRecordReadable})};return F.a.createElement("div",{className:"formula-editor"},b())}}]),n}(m.Component),Te=(Object(B.Ww)(Ce={},B.II.Attachment,(Object(B.Ww)(De={},B.HI.Link,{desc:p("Bitable_Formula_FieldPropertyUrlDescOfAttactment")}),Object(B.Ww)(De,B.HI.Name,{desc:p("Bitable_Formula_FieldPropertyNameDescOfAttachment")}),De)),Object(B.Ww)(Ce,B.II.Url,(Object(B.Ww)(Be={},B.JI.Link,{desc:p("Bitable_Formula_FieldPropertyUrlDescOfHyperlink")}),Object(B.Ww)(Be,B.JI.Name,{desc:p("Bitable_Formula_FieldPropertyNameDescOfHyperlink")}),Be)),Object(B.Ww)(Ce,B.II.Location,(Object(B.Ww)(ke={},B.KI.Province,{desc:p("Bitable_Formula_FieldPropertyProvinceDesc")}),Object(B.Ww)(ke,B.KI.City,{desc:p("Bitable_Formula_FieldPropertyCityDesc")}),Object(B.Ww)(ke,B.KI.District,{desc:p("Bitable_Formula_FieldPropertyDistrictDesc")}),Object(B.Ww)(ke,B.KI.Street,{desc:p("Bitable_Formula_FieldPropertyStreetDesc")}),Object(B.Ww)(ke,B.KI.FullAddress,{desc:p("Bitable_Formula_FieldPropertyFullAddressDesc")}),Object(B.Ww)(ke,B.KI.LatLong,{desc:p("Bitable_Formula_FieldPropertyLatLongDesc")}),ke)),Ce),Ne=[B.DI.DATE,B.DI.LOGIC,B.DI.TEXT,B.DI.DIGITAL,B.DI.POSITION],Re=(Object(B.Ww)(Ae={},B.DI.DATE,B.LI.SelectDateFunction),Object(B.Ww)(Ae,B.DI.LOGIC,B.LI.SelectLogicalFunction),Object(B.Ww)(Ae,B.DI.TEXT,B.LI.SelectTextFunction),Object(B.Ww)(Ae,B.DI.DIGITAL,B.LI.SelectMathFunction),Object(B.Ww)(Ae,B.DI.POSITION,B.LI.SelectPositionFunction),Object(B.Ww)(Ae,B.rJ.Field,B.LI.SelectField),Object(B.Ww)(Ae,B.rJ.Table,B.LI.SelectTable),Object(B.Ww)(Ae,B.rJ.Column,B.LI.SelectColumn),Object(B.Ww)(Ae,k.c.Property,B.LI.SelectProperty),Ae),Oe={0:p("bitable.formula.func.date"),1:p("bitable.formula.func.logic"),2:p("bitable.formula.func.text"),3:p("bitable.formula.func.digital"),4:p("Bitable_Formula_FunctionTypePosition")},Se="FORMULA_EDITOR_MODE",we=function(n){function a(e){var D;Object(B.ov)(this,a),(D=n.call(this,e)||this).preventOpen=!1,D.gridContext=null,D.allTableRecordReadable=!0,D.dependencyManager=new B.MI(D.props.bitableStore.base),D.getEditorMode=function(){return D.props.startMode||localStorage.getItem(Se)||k.b.ADVANCE},D.getEditorTitle=function(){var e,t=D.props.fieldId;if(!t)return"";var n=null===(e=D.table)||void 0===e?void 0:e.getField(t);return n?n.name:""},D.onStartEdit=function(t,n){if(D.editorRef){var e=function(){if(D.editorRef){if(t&&n){var e=D.deCompile2RefStyle(t,!1);D.editorRef.startEdit(e)}else D.editorRef.startEdit("");D.updateEditorPos(D.editorRef.getCurrentMode())}},a=D.getEditorMode();D.editorRef.setMode(a,e),D.collectViewEvent(a)}},D.onEndEdit=function(e){return!0},D.focus=function(e,t){if(D.props.editable&&D.editorRef){D.editorRef.focus();var n=D.editorRef.getCurrentMode();D.updateEditorPos(n)}},D.setEditorValue=function(e){D.editorRef&&D.editorRef.startEdit(e)},D.setDefaultValue=function(){},D.onSwitchMode=function(e,t){D.collectSwitchModeEvent(e,t),D.updateEditorPos(e),D.collectViewEvent(e)},D.compile=function(e){var t=D.props.bitableStore.base.calcEngine;if(!D.table||!D.props.fieldId)return null;var n=Object(B.NI)(D.table,D.props.fieldId);return t.compile({ref:n,onlyAnalyze:!0},e)},D.estimateExecutionTime=function(e){return(D.props.bitableStore.base.calcEngine.getFormulaComplexityService().getTotalComplexity(D.dependencyManager,e)/1e3).toFixed(1)},D.compileTokens=function(e){var t=D.props.bitableStore.base.calcEngine;return D.table&&D.props.fieldId?t.compileTokens(e):null},D.getFunctions=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"",t=D.props.bitableStore.base.calcEngine.getFunctionOpManager(),n=function(A,e){var t=D.sortFunctionsByType(A,e),n=D.sortFunctionsByName(A,e);return 0===t?n:t};return(e?t.getPrefixFunction(e):t.getFunctions()).filter(function(t){return B.OI.every(function(e){return e!==t.name})}).sort(n)},D.getFunctionsTypeName=function(t){var e=Ne.findIndex(function(e){return e===t});return Oe[e]},D._search=function(t,e){return e.filter(function(e){return(Object(k.i)(e)&&e.showName||e.name).toUpperCase().includes(t)})},D.searchRefs=function(e,t,n){var a;if(!D.table)return[];if(n===k.b.SIMPLE)return D.getSimpleRefsList();e=e.toUpperCase();var r=D.getTableMap(),i=D.getFieldMap(null===(a=D.table)||void 0===a?void 0:a.id),o=[].concat(Object(B.hI)(i),Object(B.hI)(r));if(!t)return D._search(e,o);var l=Object(B.PI)(t);if(null==l)return t=H(t),o=D.searchTableRefs(t,void 0,!0),D._search(e,o);if(l.type!==B.rJ.Field&&l.type!==B.rJ.Column||2!==l.refInfo.length){if(1===l.refInfo.length){var c=l.refInfo[0],s=c.refType,u=c.refId;s===B.rJ.Table&&(o=D.searchTableRefs(t,u,!0))}}else{var m=l.refInfo[0].refId,p=l.refInfo[1].refId,d=[],f=D.getLinkTableId(m,p);if(null!=f){var b=D.getFiledName(m,p);d=D.searchTableRefs(t,f,!0,b)}else{var h=D.getPropertyInfoFromField(m,p);null!=h&&(d=h)}o=d}return D._search(e,o)},D.getLinkTableId=function(e,t){return Object(B.QI)(D.props.bitableStore.base,e,t)},D.getFiledName=function(e,t){var n=D.props.bitableStore.base.getTableById(e);return null==n?null:n.getField(t).name},D.getPropertyInfoFromField=function(e,t){var n=D.props.bitableStore.base.getTableById(e);if(null==n)return null;var o=n.getField(t);if(Object(B.nG)(o)&&(o=o.getProxyField()),null==o)return null;var a=o.getCustomType(o);if(null==a)return null;var r=D.props.bitableStore.base.calcEngine,i=r.getCustomTypeAccessibleProperties(a);if(null==i)return null;var l=Object(B.RI)(a);if(null==l)return null;var c=r.getFormulaService().i18n.getCustomTypePropertyInfo(a);return null==c?null:Array.from(i.keys()).map(function(e){var t=c[e],n=l[e],a=o.fieldUIType,r=o.type,i=F.a.createElement(B.ix,{name:p("Bitable_Formula_FieldProperty_Web"),className:"bitable-formula-child-group-title-parent"},F.a.createElement("span",{className:"bitable-formula-child-group-title"},o.name));return{type:k.c.Property,name:e,showName:(null==n?void 0:n.showName)||e,desc:(null==t?void 0:t.desc)||"",title:(null==n?void 0:n.showName)||e,icon:Object(B.Uw)(a),groupTitle:i,isChildren:!0,parentType:r}})},D.searchTableRefs=function(e,t,n,a){if(!D.table)return[];var r=D.getFieldMap(t,n,a);if(0<r.length)return r;var i=D.table.base.getValidTableByName(e,D.getViewIdMap());return i&&(r=D.getFieldMap(i.id,n,a)),r},D.getTableMap=function(){var e,t=D.bitableStore.base.getValidTableInfo(D.getViewIdMap()),n=[],a=Object(B.WB)(t);try{for(a.s();!(e=a.n()).done;){var r=e.value,i=D.bitableStore.base.getTableById(r.id);if(i&&D.checkTableAllRecordReadable(i.id)){var o=i.getFieldCount()||0,l=D.serializeReference(Object(B.SI)(D.bitableStore.base,r.id));l&&n.push(Object.assign({},l,{showName:r.name,title:r.name,desc:p("bitable.formula.table_ref_desc",r.name,o),icon:f.a}))}}}catch(e){a.e(e)}finally{a.f()}return n},D.getFieldMap=function(e){var t,n,a,i=1<arguments.length&&void 0!==arguments[1]&&arguments[1],o=2<arguments.length?arguments[2]:void 0;if(!e)return[];var r=null===(t=D.table)||void 0===t?void 0:t.base.getValidTableById(e,D.getViewIdMap());if(!r)return[];var l=null===(n=D.table)||void 0===n?void 0:n.base.getTableById(e),c=r.name;if(null==l)return[];if(e!==D.props.tableId&&l.base.loadMeta(e),!l.metaLoaded)return[];if(null!==(a=D.table)&&void 0!==a&&a.base.isDeniedTable(l.id))return[];var s=l.fields,u=F.a.createElement(B.ix,{name:p("bitable.formula.field_ref_desc")},F.a.createElement("span",{className:"bitable-formula-desc-table"},F.a.createElement(f.a,null),c)),m=F.a.createElement(B.ix,{name:p("bitable.formula.column_ref_desc")},F.a.createElement("span",{className:"bitable-formula-desc-table"},F.a.createElement(f.a,null),c));return D.getFieldList(l,D.props.viewId).map(function(e){var t,n=s[e],a=i?D.serializeReference(Object(B.TI)(l,n.id)):D.serializeReference(Object(B.NI)(l,n.id)),r=i?m:u;return!i&&Object(B.vy)(n)&&(r=F.a.createElement(B.ix,{name:p("Bitable_Formula_ReferencedRecordsInField_Web")},F.a.createElement("span",{className:"bitable-formula-desc-table"},F.a.createElement(f.a,null),c),F.a.createElement("span",{className:"bitable-formula-linked-field-field"},n.name))),o&&(t=F.a.createElement(B.ix,{name:p("Bitable_Formula_TableField_Web"),className:"bitable-formula-child-group-title-parent"},F.a.createElement("span",{className:"bitable-formula-child-group-title"},o))),Object.assign({},a,{showName:n.name,title:i?"".concat(c,".").concat(n.name):n.name,desc:r,icon:Object(B.Uw)(n.fieldUIType),groupTitle:t,isChildren:!!o})})},D.getSimpleRefsList=function(){var e=D.props,t=e.bitableStore,n=e.tableId,a=e.viewId,r=t.base.getTableById(n);if(r){var i=r.fields;return D.getFieldList(r,a).map(function(e){return i[e]}).map(function(e){var t=Object(B.Uw)(e.fieldUIType),n=D.serializeReference(Object(B.NI)(r,e.id));return Object.assign({},n,{showName:e.name,icon:F.a.createElement(t,null)})})}return[]},D.setRef=function(e){D.editorRef=e},D.serialize=function(e){var t=D.props,n=t.bitableStore,a=t.fieldId;return D.table&&a?Object(y.k)(e,n.base.calcEngine,{ref:Object(B.NI)(D.table,a),activeViewIdMap:D.getViewIdMap()}):null},D.createDecompileCtx=function(){var e=D.props.fieldId;return D.table&&e?{ref:Object(B.NI)(D.table,e),activeViewIdMap:D.getViewIdMap()}:{}},D.serializeReference=function(e){var t=D.props.fieldId,n=void 0===t?"":t;if(!D.table)return null;var a={ref:Object(B.NI)(D.table,n),activeViewIdMap:D.getViewIdMap()},r=e.type()===B.rJ.Field;return Object(B.iI)(e,a,r)},D.updateEditorPos=function(e){var t,n,a=D.props,r=a.anchorRef,i=a.bitableStore,o={top:0,left:0};t=e===k.b.ADVANCE?{width:k.a,height:k.f}:{width:k.g,height:k.h},i.Options.isHistoryMode&&(n=document.querySelector(".bitable-in-doc-history-mode .bitable-container")),r&&Object(B.bE)(r,o,{width:t.width,height:t.height+1+B.vF,viewportRight:12},n),D.setState({top:o.top,left:o.left})},D.cancelEdit=function(){D.collectClickEvent(B.wJ.Cancel),D.props.endEdit(!0)},D.submitEdit=function(e){D.collectClickEvent(B.wJ.Confirm),D._submitEdit(e),D.props.endEdit(!1)},D._submitEdit=function(e){var t,n=D.props,a=n.tableId,r=n.viewId,i=n.fieldId,o=n.executeAction;if(D.table&&i&&D.editorRef){var l=D.table.getField(i),c={formula:D.deCompile2RefStyle(e,!1),formatter:l.property.formatter||"",currencyCode:l.property.currencyCode||""};if(l.validateProperty(c)){var s=l.toJSON();s.property=Object.assign({},c),o(function(){return{cmd:B.Fy.SetFieldAttr,tableId:a,viewId:r,fieldId:i,data:s}})}var u,m=D.props.bitableStore.base.calcEngine.compileTokens(e).tokens,p=Object(B.WB)(m);try{for(p.s();!(u=p.n()).done;){var d=u.value;if(d.type===B.EI.FunctionName&&"string"==typeof d.text){var f=d.text.slice(0,d.text.length-1).toUpperCase();B.ob.collectBitableEvent(B.On.BitableFunctionsUse,{table_id:a,view_id:r,op_item:f})}}}catch(e){p.e(e)}finally{p.f()}var b=D.compile(e),h=null==b||null===(t=b.formulaVar)||void 0===t?void 0:t.getRoot();if(null!=h&&h instanceof B.xJ){var v=D.getCalcCtx();h.predict(v);var g=v.chainingInfo;if(g)for(var _=0;_<g.length;++_){var E=g[_],F=void 0,y=void 0;switch(E.chainingType){case B.yJ.Link:F=B.lC[E.parentType],y=B.lC[E.childType];break;case B.yJ.Property:F=E.parentCustomType,y=E.childProperty}B.cz.collectBitableEvent(B.On.Chaining,{chaining_type:E.chainingType,parent_type:F,child_type:y})}}try{var I=D.editorRef.getCurrentMode();localStorage.setItem(Se,I),D.collectBitableFieldSetEvent({action:B.zJ.CHANGE_FEATURE,bitable_field_type:B.lC[l.fieldUIType],formula_mode:I===k.b.SIMPLE?0:1}),D.collectBitableRecordEditEvent({bitable_field_type:B.lC[l.fieldUIType],formula_mode:I===k.b.SIMPLE?0:1})}catch(e){}}},D.collectBitableRecordEditEvent=function(e){var t=D.props,n=t.tableId,a=t.viewId,r=t.fieldId,i=t.renderer,o=t.recordId,l=t.bitableStore,c=t.fieldSetSource;if(D.table){var s=D.table.getViewById(a);if(s){var u=i.activeBitableWidget.isFloatLayerOpen;B.ob.collectBitableEvent(B.On.BitableRecordEdit,Object.assign({smartable_token:l.md5Token,row:s.getVisibleRecordIndexById(o||""),col:s.getFieldIndexById(r||""),table_id:n,view_id:a,bitable_editor_type:c===B.iz.Card?"card":"cell",bitable_view_type:B.Cz[s.type],bitable_feature_change:-1,data_source:l.Options.module,is_record_floating:u},e,{},i.getRecordEditLogParams()),!0)}}},D.collectBitableFieldSetEvent=function(e){var t=D.props,n=t.tableId,a=t.viewId,r=t.fieldSetSource,i=t.bitableStore;if(D.table){var o=D.table.getViewById(a);o&&B.ob.collectBitableEvent(B.On.BitableFieldSet,Object.assign({table_id:n,view_id:a,bitable_view_type:B.Cz[o.type],fieldSetSource:r},e,{data_source:i.Options.module}),!0)}},D.collectSwitchModeEvent=function(e,t){if(e===k.b.ADVANCE&&t===k.b.FULLSCREEN)B.cz.collectClickEvent(B.Bc.CcmBitableFomulaSeniorModeClick,{click:B.LI.Collapse});else if(e===k.b.FULLSCREEN)return B.cz.collectClickEvent(B.Bc.CcmBitableFomulaSeniorModeClick,{click:B.LI.Expand}),void B.cz.collectBitableEvent(B.Rw.CcmBitableFomulaSeniorModeView,{is_expand:String(!0)});var n,a;e===k.b.SIMPLE?(n=B.Bc.CcmBitableFomulaSeniorModeClick,a=B.Rw.CcmBitableFomulaEasyModeView):(n=B.Bc.CcmBitableFomulaEasyModeClick,a=B.Rw.CcmBitableFomulaSeniorModeView),B.cz.collectBitableEvent(n,{click:B.wJ.SwitchMode,target:a})},D.collectClickEvent=function(e,t){if(D.editorRef){var n,a,r=D.editorRef.getCurrentMode();r===k.b.SIMPLE?n=B.Bc.CcmBitableFomulaEasyModeClick:(a=String(r===k.b.FULLSCREEN),n=B.Bc.CcmBitableFomulaSeniorModeClick),B.cz.collectClickEvent(n,Object.assign({click:e},t,{isExpand:a}))}},D.collectViewEvent=function(e){var t;e&&(t=e===k.b.SIMPLE?B.Rw.CcmBitableFomulaEasyModeView:B.Rw.CcmBitableFomulaSeniorModeView,B.cz.collectBitableEvent(t))},D.getFieldTypeByRefs=function(e){var t,n=e.id,a=null===(t=e.parent)||void 0===t?void 0:t.id;if(a){var r=D.props.bitableStore.base.getTableById(a),i=null==r?void 0:r.getField(n);return i&&B.lC[i.type]}},D.getSideBarItemClickOptions=function(e){var t={};if(e instanceof B.wI)return t.function=e.name,t;if(Object(k.i)(e))return t.property=e.name,t.parent_type=e.parentType,t;var n=D.getFieldTypeByRefs(e);return n&&(t.field_type=n),t},D.onClickAdvancedEditorSibarItem=function(e){var t=D.getClickItemType(e),n=Re[t],a=D.getSideBarItemClickOptions(e);n&&D.collectClickEvent(n,a)},D.getClickItemType=function(e){return e instanceof B.wI?D.getFunctionType(e):e.type},D.getFunctionType=function(e){return D.props.bitableStore.base.calcEngine.getI18nService().getFuncMeta(e.name).type},D.onSimpleEditorOptionListChange=function(e,t){t===k.d.Left?D.collectClickEvent(B.AJ.SelectFirstField):D.collectClickEvent(B.AJ.SelectSecondField)},D.onSimpleEditorArithmeticChange=function(e){D.collectClickEvent(B.AJ.OperationClick,{operator:e.name})},D.getCalcCtx=function(){var e=D.props.bitableStore.base.getTableById(D.props.tableId),t=null==e?void 0:e.getField(D.props.fieldId||"");return e&&t?{ref:Object(B.BJ)(e,t,Object.keys(e.records)[0]||""),service:D.props.bitableStore.base.calcEngine.getFormulaService(),info:{}}:{}},D.isLinkRefChaining=function(e,t){var n,a=e.referenceId.startsWith(B.tJ);if(a&&e.type===B.rJ.Column)return!1;var r=a?e.referenceId:"".concat(e.parent?e.parent.referenceId+".":"").concat(e.referenceId),i=Object(B.PI)(r);if(null==i||2!==i.refInfo.length)return!1;var o=i.refInfo[0].refId,l=i.refInfo[1].refId,c=Object(B.QI)(D.props.bitableStore.base,o,l);return null!=c&&(null===(n=t.parent)||void 0===n?void 0:n.id)===c},D.state={top:0,left:0},D.mode=D.getEditorMode();var t=e.bitableStore.base;return D.table=t.getTableById(e.tableId),t.calcEngine.getFormulaService().i18n.registerLang(be),t.calcEngine.getFormulaService().i18n.registerPropertyLang(Te),t.calcEngine.registerRefNameToRefFunc(D.props.tableId,D.getViewIdMap()),D}return Object(B.bu)(a,n),Object(B.Pw)(a,[{key:"componentDidMount",value:function(){if(this.props.renderer instanceof B.Xz&&(this.gridContext=this.props.renderer.activeBitableWidget.getGridWidget(),this.unbindContextEvent=this.bindContextEvent(),this.unbindDOMEvent=this.bindDOMEvent()),this.props.field){var e,t=null===(e=this.props.field.property)||void 0===e?void 0:e.formula;t&&this.setEditorValue(t)}}},{key:"componentDidUpdate",value:function(e){if(e&&e.tableId!==this.props.tableId){var t=e.bitableStore.base;this.table=t.getTableById(e.tableId)}}},{key:"componentWillUnmount",value:function(){this.unbindContextEvent&&this.unbindContextEvent(),this.unbindDOMEvent&&this.unbindDOMEvent(),this.props.bitableStore.base.calcEngine.registerRefNameWithParentToRefFunc()}},{key:"bindContextEvent",value:function(){var e=this,t=this.getContextListeners();return this.gridContext&&this.gridContext.addGridEventsBindListener(t),function(){e.gridContext&&e.gridContext.removeGridEventsBindListener(t)}}},{key:"bindDOMEvent",value:function(){var e=this,t=Object(r.a)(function(){e.editorRef&&e.updateEditorPos(e.editorRef.getCurrentMode())},500);return window.addEventListener("resize",t),function(){window.removeEventListener("resize",t)}}},{key:"getContextListeners",value:function(){var e,t=this;return Object(B.Ww)(e={},B.pC.CoverMouseDown,function(){t.props.isOpen?t.preventOpen=!0:t.preventOpen=!1}),Object(B.Ww)(e,B.pC.CoverClick,function(){t.preventOpen||(t.props.isOpen?t.cancelEdit():t.props.startEdit&&t.props.startEdit(!0))}),Object(B.Ww)(e,B.pC.ScrollChange,function(){t.editorRef&&t.updateEditorPos(t.editorRef.getCurrentMode())}),e}},{key:"preventOnEndEdit",get:function(){var e;return(null===(e=this.editorRef)||void 0===e?void 0:e.getCurrentMode())===k.b.FULLSCREEN}},{key:"bitableStore",get:function(){return this.props.bitableStore}},{key:"sortFunctionsByType",value:function(e,t){var n=this.props.bitableStore.base.calcEngine.getI18nService(),a=n.getFuncMeta(e.name).type,r=n.getFuncMeta(t.name).type,i=function(t){return Ne.findIndex(function(e){return e===t})};return i(a)-i(r)}},{key:"sortFunctionsByName",value:function(e,t){var n=e.name.toUpperCase(),a=t.name.toUpperCase();return n<a?-1:a<n?1:0}},{key:"checkTableAllRecordReadable",value:function(e){var t=Object(B.VG)(this.bitableStore,e);return this.allTableRecordReadable=this.allTableRecordReadable&&t,t}},{key:"getFieldList",value:function(t,e){var n=this;if(t){var a=t.getViewById(e)||t.views[0];return(a&&a.getAllFields()||Object.keys(t.fields)).filter(function(e){return!(t.isDeniedField(e)||!Object(B.CJ)(n.bitableStore,t.id,e)||e===n.props.fieldId&&(null==t?void 0:t.id)===n.props.tableId)})}return[]}},{key:"deCompile2RefStyle",value:function(e,t){var n=this.props.fieldId;if(!this.table||!n)return e;var a=this.props.bitableStore.base.calcEngine,r=Object(B.NI)(this.table,n),i=a.compile({ref:r,onlyAnalyze:!0},e);if(!i.formulaVar)return e;var o=i.formulaVar;return a.decompile(o,{ref:r,isShowRefName:t,formulaVar:o})}},{key:"getViewIdMap",value:function(){var e,t=this.props.bitableStore,n=this.props.renderer;return t.isEmbeddedInDoc&&(e=Object(B.Az)(n.reduxStore.getState())),e}},{key:"render",value:function(){if(!this.props.editable)return null;var e=this.state,t=e.left,n=e.top,a=this.props.isOpen,r=void 0===a||a,i=this.props.bitableStore.base.calcEngine,o=i.getI18nService(),l=i.getFormulaService();return F.a.createElement("div",{className:T()("bitable-formula-editor-container",{isSafari:B.rx.isSafari}),style:Object.assign({},this.props.style,{left:t,top:n,position:"absolute",zIndex:10})},F.a.createElement(xe,{mode:this.mode,getCalcCtx:this.getCalcCtx,title:this.getEditorTitle(),compile:this.compile,estimateExecutionTime:this.estimateExecutionTime,onlyFullScreen:this.props.startMode===k.b.FULLSCREEN,compileTokens:this.compileTokens,serialize:this.serialize,getFunctions:this.getFunctions,getFunctionsType:this.getFunctionsTypeName,searchRefs:this.searchRefs,ref:this.setRef,i18nService:o,formulaService:l,cancelEdit:this.cancelEdit,submitEdit:this.submitEdit,isOpen:function(){return r},onSwitchMode:this.onSwitchMode,createDecompileCtx:this.createDecompileCtx,onClickAdvancedEditorSibarItem:this.onClickAdvancedEditorSibarItem,onSimpleEditorOptionListChange:this.onSimpleEditorOptionListChange,onSimpleEditorArithmeticChange:this.onSimpleEditorArithmeticChange,isLinkRefChaining:this.isLinkRefChaining,serializeReference:this.serializeReference,allTableRecordReadable:this.allTableRecordReadable}))}}]),a}(m.Component)}.call(this,je("vb163"))},vb1284:function(e,t,n){"use strict";var a=n("vb144"),r=n.n(a),i=n("vb103"),o=n("vb151");function l(e){return i.createElement("svg",r()({width:"1em",height:"1em",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},e),i.createElement("path",{d:"M18.648 9.417h-2.6l4.48-4.48a1.019 1.019 0 0 0-.005-1.435.979.979 0 0 0-1.388 0l-4.487 4.486V5.417a1 1 0 1 0-2 0v5a.997.997 0 0 0 1 1h5a1 1 0 1 0 0-2ZM5.38 14.596h2.6l-4.48 4.48a1.019 1.019 0 0 0 .005 1.435.979.979 0 0 0 1.389 0l4.486-4.486v2.571a1 1 0 1 0 2 0v-5a.997.997 0 0 0-1-1h-5a1 1 0 1 0 0 2Z",fill:"currentColor"}))}var c=i.forwardRef(function(e,t){return i.createElement(o.a,r()({icon:l},e,{ref:t,svgProps:{"data-icon":"MinimizeOutlined"}}))});t.a=c},vb1906:function(e,t,n){"use strict";var a=n("vb144"),r=n.n(a),i=n("vb103"),o=n("vb151");function l(e){return i.createElement("svg",r()({width:"1em",height:"1em",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},e),i.createElement("path",{d:"M11 8a1 1 0 1 1 2 0v3h3a1 1 0 1 1 0 2h-4a1 1 0 0 1-1-1V8Z",fill:"currentColor"}),i.createElement("path",{d:"M12 23c6.075 0 11-4.925 11-11S18.075 1 12 1 1 5.925 1 12s4.925 11 11 11Zm0-2a9 9 0 1 1 0-18 9 9 0 0 1 0 18Z",fill:"currentColor"}))}var c=i.forwardRef(function(e,t){return i.createElement(o.a,r()({icon:l},e,{ref:t,svgProps:{"data-icon":"TimeOutlined"}}))});t.a=c},vb1907:function(e,t,n){"use strict";var a=n("vb144"),r=n.n(a),i=n("vb103"),o=n("vb151");function l(e){return i.createElement("svg",r()({width:"1em",height:"1em",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},e),i.createElement("path",{d:"M18.75 16a3.622 3.622 0 0 1-2.637-1.156A5 5 0 1 1 17 12c0 1.105.784 2 1.75 2 1.512 0 1.776-2 1.776-2 .08-.548.138-.903.138-1.568C20.664 6.997 17.164 3 12 3s-8.98 3.836-8.98 9 3.816 9.01 8.98 9.01c1.807 0 3.487-.634 4.916-1.544a.823.823 0 0 1 .853-.028l.041.024.903.519a.41.41 0 0 1 .067.682A10.953 10.953 0 0 1 12 23C5.925 23 1 18.075 1 12S5.925 1 12 1s10.657 4.265 10.657 9.432c0 .256.014.522-.136 1.794C22.296 14.326 20.75 16 18.75 16ZM12 15a3 3 0 1 0 0-6 3 3 0 0 0 0 6Z",fill:"currentColor"}))}var c=i.forwardRef(function(e,t){return i.createElement(o.a,r()({icon:l},e,{ref:t,svgProps:{"data-icon":"AtOutlined"}}))});t.a=c},vb2226:function(e,t,n){"use strict";var a=n("vb144"),r=n.n(a),i=n("vb103"),o=n("vb151"),l=n("vb409"),c={light:{c1:"#F54A45"},dark:{c1:"#F0544F"}};function s(e){var t=Object(l.b)(),n=c[t]||c.light;return i.createElement("svg",r()({width:"1em",height:"1em",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},e),i.createElement("path",{d:"M12 23c6.075 0 11-4.925 11-11S18.075 1 12 1 1 5.925 1 12s4.925 11 11 11Z",fill:n.c1}),i.createElement("path",{d:"M12 7a1 1 0 0 0-1 1v5a1 1 0 1 0 2 0V8a1 1 0 0 0-1-1Zm0 10a1 1 0 1 0 0-2 1 1 0 0 0 0 2Z",fill:"#fff"}))}var u=i.forwardRef(function(e,t){return i.createElement(o.a,r()({icon:s},e,{ref:t}))});t.a=u},vb2227:function(e,t,n){"use strict";var a=n("vb144"),r=n.n(a),i=n("vb103"),o=n("vb151"),l=n("vb409"),c={light:{c1:"#34C724"},dark:{c1:"#55C948"}};function s(e){var t=Object(l.b)(),n=c[t]||c.light;return i.createElement("svg",r()({width:"1em",height:"1em",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},e),i.createElement("path",{d:"M12 23c6.075 0 11-4.925 11-11S18.075 1 12 1 1 5.925 1 12s4.925 11 11 11Z",fill:n.c1}),i.createElement("path",{d:"M12 7a1 1 0 0 0-1 1v3H8a1 1 0 1 0 0 2h3v3a1 1 0 1 0 2 0v-3h3a1 1 0 1 0 0-2h-3V8a1 1 0 0 0-1-1Z",fill:"#fff"}))}var u=i.forwardRef(function(e,t){return i.createElement(o.a,r()({icon:s},e,{ref:t}))});t.a=u},vb2228:function(e,t,n){"use strict";var a=n("vb144"),r=n.n(a),i=n("vb103"),o=n("vb151"),l=n("vb409"),c={light:{c1:"#F54A45"},dark:{c1:"#F0544F"}};function s(e){var t=Object(l.b)(),n=c[t]||c.light;return i.createElement("svg",r()({width:"1em",height:"1em",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},e),i.createElement("path",{d:"M1 12c0 6.075 4.925 11 11 11s11-4.925 11-11S18.075 1 12 1 1 5.925 1 12Z",fill:n.c1}),i.createElement("path",{d:"M16.5 11h-9a.499.499 0 0 0-.5.5v1a.5.5 0 0 0 .5.5h9a.498.498 0 0 0 .5-.5v-1a.498.498 0 0 0-.5-.5Z",fill:"#fff"}))}var u=i.forwardRef(function(e,t){return i.createElement(o.a,r()({icon:s},e,{ref:t}))});t.a=u},vb420:function(e,t,n){"use strict";function a(e,t,n,a){var r=-1,i=null==e?0:e.length;for(a&&i&&(n=e[++r]);++r<i;)n=t(n,e[r],r,e);return n}var i=a,o=n("vb501"),l=n("vb313");function r(e,a,r,i,t){return t(e,function(e,t,n){r=i?(i=!1,e):a(r,e,t,n)}),r}var c=r,s=n("vb178");function u(e,t,n){var a=Object(s.a)(e)?i:c,r=arguments.length<3;return a(e,Object(l.a)(t,4),n,r,o.a)}t.a=u},vb444:function(e,t,n){"use strict";n.d(t,"a",function(){return l}),n.d(t,"b",function(){return s}),n.d(t,"c",function(){return c});var a=n("vb143"),r=n("vb103"),o=n("vb138"),i=(n("vb147"),n("vb148"),{getData:function(e,t){return a.ob.ClipboardHelper.getData({clipboardData:e,type:[t]})[t]},setData:function(e,t,n){a.ob.ClipboardHelper.setData({clipboardData:e,data:Object(a.Ww)({},t,n)})},getTypes:function(e){return e.types}}),l=function(e){function t(){return Object(a.ov)(this,t),e.apply(this,arguments)||this}return Object(a.bu)(t,e),Object(a.Pw)(t,[{key:"render",value:function(){return r.createElement(o.EditorComponent,Object(a.Kx)({},this.props,{businessKey:"lark-bitable",enableVirtualScroll:!1,domPurifyConfig:{enable:!0,config:{WHOLE_DOCUMENT:!0,FORCE_BODY:!0,ADD_URI_SAFE_ATTR:["xmlns:o","xmlns:x","xmlns:w"],ADD_TAGS:["meta","google-sheets-html-origin","byte-sheet-html-origin","melo-data","mention","highlight"],ADD_ATTR:["sheet-word-wrap","xmlns:o","xmlns:x","xmlns:w"],FORBID_TAGS:["noscript"],KEEP_CONTENT:!1}},proxyClipboard:i}))}}]),t}(r.Component);function c(e){var t=e.getRep(),n=t.lines.length()-1,a=t.lines.atIndex(n),r=a&&a.text.length,i=e.getContentState().getActiveZone().getZoneId(),o=[n,r],l=[n,r];e.selection.setSelection({start:{line:o[0],offset:o[1],zoneId:i},end:{line:l[0],offset:l[1],zoneId:i}},!0)}function s(e,t,n){if(e.getContentState()._clearStoreAttributes(),Array.isArray(t)){var a=e.repManager.getRep("0").alltext.length-1,r=(new o.ZoneDelta).delete(a).concat(n(t));e.getContentState().apply(r)}else if(e.listView)e.replaceAllText(t);else{var i=(new o.ZoneDelta).insert(t);e.getContentState().apply(i)}e.undoModule.stack.clearStack()}},vb488:function(e,t,n){"use strict";n.d(t,"a",function(){return C}),n.d(t,"b",function(){return N}),n.d(t,"c",function(){return f}),n.d(t,"d",function(){return a}),n.d(t,"e",function(){return r}),n.d(t,"f",function(){return T}),n.d(t,"g",function(){return c}),n.d(t,"h",function(){return x}),n.d(t,"i",function(){return R}),n.d(t,"j",function(){return O});var B=n("vb143"),p=n("vb319"),k=n("vb139"),d=(n("vb147"),n("vb103"),n("vb148"),n("vb420")),C={MENTION:"mention",HYPERLINK:"url",TEXT:"text",REFBLOCK:"REF_BLOCK",TAGBLOCK:"TAG_BLOCK"},f={AT_USER_BLOCK:"at-user-block"},x="mention-link",T="mention-type",N="mention-token",R="mention-notify",O="mention-icon";function a(e){return e.reduce(function(e,t){return e[t[0]]=t[1],e},{})}function b(t){return Object.keys(t).map(function(e){return[e,t[e]]})}function r(e){return e.attributes&&0===Object.keys(e.attributes).length&&delete e.attributes,e}var o=/url-/,l=/cellPosition/,i=[String.fromCharCode(8203)],S=function(e){return"string"==typeof e?e.replace(new RegExp(i.join("|"),"g"),""):e};function w(e){for(var t="",n=Object.keys(e),a=0;a<n.length;a++){var r=n[a];if(o.test(r)){t=e[r];break}}return t}function L(e,t){var n={type:"text"},a=t.hooks.callAll("collectText",{attributes:b(e)});a&&a.length&&(n.text=Object(p.a)(a));var r=Object(k.getBlockPropsFromAttributesMap)(e);if(r&&r.props.data)if(r.blockType===B.Dz.AT_USER_BLOCK){var i=r.props.data,o=i.user,l=i.mentionNotify;o&&(n.name=o.name||o.cn_name,n.en_name=o.en_name,n.category=f.AT_USER_BLOCK,n.type=C.MENTION,n.mentionType=B.EH.USER,n.token=o.id,n.link=o.avatar_url,n.mentionNotify=l,n.mentionId=o.mentionId,n.not_notify=o.not_notify,n.block_notify=o.block_notify)}else if(r.blockType===B.Dz.FILE_CARD_BLOCK){var c=r.props.data.fileInfo;c&&(n.text=c.name)}if(r&&r.props&&(r.blockType===C.REFBLOCK||r.blockType===C.TAGBLOCK)){var s=r.props,u=s.content,m=s.context;n.content=u,n.context=m,n.text=u}return n}function j(e,t){for(var n,l=C.HYPERLINK,c=C.TEXT,s=e+t,a=s.length,r=new RegExp(B.GH),i=[];n=r.exec(s);){var o=n[0],u=n.index;i.push({startIndex:u,endIndex:u+o.length,text:o})}var m=[];if(i.length){i.unshift({startIndex:0,endIndex:0});var p=Object(d.a)(i.slice(1),function(e,t){var n=e.endIndex,a=t.startIndex,r=t.endIndex,i=s.slice(n,a);i&&m.push({text:i,type:c});var o=s.slice(a,r);return m.push({text:o,type:l}),t},i[0]);p.endIndex<a&&m.push({text:s.slice(p.endIndex,a),type:c})}return m}function M(e){for(var t=Object.keys(e),n={},a=0;a<t.length;a++){var r=t[a],i=/mention-token|mention-type|mention-link|mention-notify|mention-sharePermHeldBack|mention-icon/.exec(r);i&&(n[i[0]]=r.replace(/^[^_]*?_/,"")||e[r])}return n}function P(e,t){for(var n=C.TEXT,a=Object.keys(t),r=0;r<a.length;r++){var i=a[r];if(new RegExp(C.MENTION+"-token").test(i)){n=C.MENTION;break}(o.test(i)||l.test(i))&&(n=C.HYPERLINK)}return n===C.TEXT&&Object(B.FH)(e)&&(n=C.HYPERLINK),n}function c(e){for(var t=[],n=e.getContentState().getActiveZone(),a=n.length(),r="",i=0;i<a;i++){var o=n.getLine(i);if(o)for(var l=o.getOps(),c=l.length,s=0;s<c;s++){var u=l[s],m=u.attributes||{},p=u.insert||"",d=P(p,m),f={type:d,text:p};if(null==m.lmkr){switch(d){case C.MENTION:var b=M(m),h=b[T],v=b[N],g=b[x],_=b[R],E=b[O],F=null===_||"true"===_,y=Object(B.DH)(decodeURIComponent(g));t.push(Object.assign({},f,{text:p,type:d,mentionType:parseInt(h,10),mentionNotify:F,token:v,link:y,icon:E&&JSON.parse(E)}));continue;case C.HYPERLINK:var I=j(r,p),D=w(m);!D&&I.length?t.push.apply(t,Object(B.hI)(I)):(r.length&&t.push({text:r,type:C.TEXT}),t.push({text:p,type:d,link:D?Object(B.CH)(D):""})),r="";continue;case C.TEXT:Object(k.isBlockAttributes)(m)&&Object.assign(f,L(m,e)),f.text=S(f.text),t.push(f);continue}Object(k.isBlockAttributes)(m)&&Object.assign(f,L(m,e)),t.push(f)}}}return t}},vb537:function(e,t,n){},vb651:function(e,t,n){"use strict";n.d(t,"a",function(){return s}),n.d(t,"b",function(){return r}),n.d(t,"c",function(){return a}),n.d(t,"d",function(){return i}),n.d(t,"e",function(){return f}),n.d(t,"f",function(){return u}),n.d(t,"g",function(){return m}),n.d(t,"h",function(){return p}),n.d(t,"i",function(){return d});var a,r,i,o,l,c=n("vb143"),s=632,u=530,m=420,p=150;function d(e){return!(e instanceof c.wI)&&e.type===a.Property}function f(e){return!(e instanceof c.wI)&&e.type!==a.Property}(a||(a={})).Property="property",(l=r||(r={})).SIMPLE="simple",l.ADVANCE="advance",l.FULLSCREEN="fullScreen",(o=i||(i={})).Left="left",o.Right="right"},vb773:function(e,t,n){"use strict";var a=n("vb144"),r=n.n(a),i=n("vb103"),o=n("vb151");function l(e){return i.createElement("svg",r()({width:"1em",height:"1em",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},e),i.createElement("path",{d:"M22 3a1 1 0 0 0-1-1h-7a1 1 0 0 0 0 2h4.586l-6.293 6.293a1 1 0 0 0 1.414 1.414L20 5.414V10a1 1 0 1 0 2 0V3Z",fill:"currentColor"}),i.createElement("path",{d:"M4 5h6v2H4v13h16v-5.5h2V20a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V7a2 2 0 0 1 2-2Z",fill:"currentColor"}))}var c=i.forwardRef(function(e,t){return i.createElement(o.a,r()({icon:l},e,{ref:t,svgProps:{"data-icon":"WindowNewOutlined"}}))});t.a=c},vb957:function(e,t,n){"use strict";n.d(t,"a",function(){return b}),n.d(t,"b",function(){return x}),n.d(t,"c",function(){return y}),n.d(t,"d",function(){return i}),n.d(t,"e",function(){return D}),n.d(t,"f",function(){return C}),n.d(t,"g",function(){return k}),n.d(t,"h",function(){return I}),n.d(t,"i",function(){return B}),n.d(t,"j",function(){return p}),n.d(t,"k",function(){return T});var g=n("vb143"),a=n("vb103"),o=n.n(a),r=n("vb159"),l=n.n(r),i=(n("vb167"),n("vb147"),n("vb148"),n("vb152"),n("vb112"),n("vb164"),n("vb113"),function(n){function a(e){var t;return Object(g.ov)(this,a),(t=n.call(this,e)||this).state={isSelected:!1},t}return Object(g.bu)(a,n),Object(g.Pw)(a,[{key:"componentDidMount",value:function(){}},{key:"render",value:function(){var e=this.props,t=e.content,n=e.isActive,a=e.context,r=this.state.isSelected,i=l()("ref-block",{"ref-block-highlight":n,"ref-block-placeholder":r,"ref-block-disable":a.status===g.DJ.Denied});return o.a.createElement("div",{className:i,contentEditable:!1},o.a.createElement("span",null,t))}}]),a}(a.Component)),c=function(){function a(e,t,n){Object(g.ov)(this,a),this._index=e,this._content=t,this._type=n,e<0&&(console.error("op token index inValid"),this._index=0)}return Object(g.Pw)(a,[{key:"index",value:function(){return this._index}},{key:"content",value:function(){return this._content}},{key:"type",value:function(){return this._type}},{key:"token",value:function(){return"".concat(this._type).concat(this._content)}}]),a}(),s=function(a){function r(e,t){var n;return Object(g.ov)(this,r),(n=a.call(this,e,"",g.qJ.Reference)||this)._refInfo=t,n}return Object(g.bu)(r,a),Object(g.Pw)(r,[{key:"refInfo",value:function(){return this._refInfo}}]),r}(c),u=function(n){function a(e,t){return Object(g.ov)(this,a),n.call(this,e,t,g.qJ.Constant)||this}return Object(g.bu)(a,n),a}(c),m=function(n){function a(e,t){return Object(g.ov)(this,a),n.call(this,e,t,g.qJ.Property)||this}return Object(g.bu)(a,n),a}(c),p=function(e){function t(){return Object(g.ov)(this,t),e.apply(this,arguments)||this}return Object(g.bu)(t,e),t}(s),d=function(e){function t(){return Object(g.ov)(this,t),e.apply(this,arguments)||this}return Object(g.bu)(t,e),t}(s),f=function(e){function t(){return Object(g.ov)(this,t),e.apply(this,arguments)||this}return Object(g.bu)(t,e),t}(s),b=function(e){function t(){return Object(g.ov)(this,t),e.apply(this,arguments)||this}return Object(g.bu)(t,e),t}(u),h=function(e){function t(){return Object(g.ov)(this,t),e.apply(this,arguments)||this}return Object(g.bu)(t,e),t}(u),v=function(t){function n(e){return Object(g.ov)(this,n),t.call(this,e,"")||this}return Object(g.bu)(n,t),n}(u),_=function(e){function t(){return Object(g.ov)(this,t),e.apply(this,arguments)||this}return Object(g.bu)(t,e),t}(m),E=function(e){function t(){return Object(g.ov)(this,t),e.apply(this,arguments)||this}return Object(g.bu)(t,e),t}(m),F=function(e){function t(){return Object(g.ov)(this,t),e.apply(this,arguments)||this}return Object(g.bu)(t,e),t}(m),y=function(){function i(e,t,n,a,r){Object(g.ov)(this,i),this.targetToken=e,this.targetIndex=t,this.start=n,this.size=a,this.refInfo=r}return Object(g.Pw)(i,[{key:"ops",value:function(){var e=this.start,t=this.targetToken,n=this.targetIndex,a=this.size,r=this.refInfo,i=t.substr(1).substr(e+a),o=[];return o.push(new v(n)),o.push(new d(n-1,r)),i&&o.push(new b(n,i)),o}}]),i}(),I=function(){function i(e,t,n,a,r){Object(g.ov)(this,i),this.targetToken=e,this.targetIndex=t,this.start=n,this.size=a,this.refInfo=r}return Object(g.Pw)(i,[{key:"ops",value:function(){var e=this.start,t=this.targetToken,n=this.size,a=this.refInfo,r=this.targetIndex,i=t[0]===g.qJ.Constant||t[0]===g.qJ.Property,o=i?t.substr(1):"",l=o.substr(e+n),c="";i&&(c=o.substr(0,e));var s=[new v(r)];return c&&(s.push(new b(r,c)),r++),s.push(new p(r,a)),r++,l&&s.push(new b(r,l)),s}}]),i}(),D=function(){function i(e,t,n,a,r){Object(g.ov)(this,i),this.targetToken=e,this.targetIndex=t,this.start=n,this.size=a,this.content=r}return Object(g.Pw)(i,[{key:"ops",value:function(){var e=this.start,t=this.targetToken,n=this.targetIndex,a=this.size,r=this.content,i=t.substr(1),o=i.substr(0,e),l=i.substr(e+a);return[new h(n,o+r+l)]}}]),i}(),B=function(){function i(e,t,n,a,r){Object(g.ov)(this,i),this.targetToken=e,this.targetIndex=t,this.start=n,this.size=a,this.refInfo=r}return Object(g.Pw)(i,[{key:"ops",value:function(){var e=this.start,t=this.targetToken,n=this.size,a=this.refInfo,r=this.targetIndex,i=t.substr(1).substr(e+n),o=[];return r++,o.push(new b(r,".")),r++,o.push(new p(r,a)),r++,i&&o.push(new b(r,i)),o}}]),i}(),k=function(){function i(e,t,n,a,r){Object(g.ov)(this,i),this.targetToken=e,this.targetIndex=t,this.start=n,this.size=a,this.propertyName=r}return Object(g.Pw)(i,[{key:"ops",value:function(){var e=this.start,t=this.targetToken,n=this.size,a=this.propertyName,r=this.targetIndex,i=t.substr(1).substr(e+n),o=[];return r++,o.push(new b(r,".")),r++,o.push(new _(r,a)),r++,i&&o.push(new b(r,i)),o}}]),i}(),C=function(){function i(e,t,n,a,r){Object(g.ov)(this,i),this.targetToken=e,this.targetIndex=t,this.start=n,this.size=a,this.propertyName=r}return Object(g.Pw)(i,[{key:"ops",value:function(){var e=this.start,t=this.targetToken,n=this.size,a=this.propertyName,r=this.targetIndex,i=t.substr(1),o=i.substr(e+n),l="";t[0]===g.qJ.Constant&&(l=i.substr(0,e));var c=[new v(r)];return l&&(c.push(new b(r,l)),r++),c.push(new _(r,a)),r++,o&&c.push(new b(r,o)),c}}]),i}(),x=function(){function a(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:[];Object(g.ov)(this,a),this.tokens=[],this.tokenInfo=[],this.tokens=e,this.refs=t||{},this.tokenInfo=n}return Object(g.Pw)(a,[{key:"getRefsID",value:function(){return Object.values(this.refs).length+1}},{key:"parseTokensToString",value:function(e){var t=this.tokens,n=this.refs;if(null==t)throw new Error("failed to compile formula without tokens");var a,r="",i=Object(g.WB)(t);try{for(i.s();!(a=i.n()).done;){var o=a.value;switch(o[0]){case g.qJ.Property:case g.qJ.Constant:r+=o.substring(1);break;case g.qJ.Reference:if(!n||!n[o])throw new Error("failed to compile formula without refs");var l=n[o];r+=e?l.name:l.referenceId}}}catch(e){i.e(e)}finally{i.f()}return r}},{key:"getNamesText",value:function(){return this.parseTokensToString(!0)}},{key:"getIdReferencesText",value:function(){return this.parseTokensToString(!1)}},{key:"getRefByCaret",value:function(e){var t=this.getTokenByCaret(e);return this.refs[t]}},{key:"getTokenByCaret",value:function(e){var t=this.getIndexStartByCaret(e).segIndex;return this.tokens[t]}},{key:"getIndexStartByCaret",value:function(e){var t,n=this.tokens,a=this.refs,r=0,i=0,o=0,l=Object(g.WB)(n.entries());try{for(l.s();!(t=l.n()).done;){var c=Object(g.xz)(t.value,2),s=c[0],u=c[1],m=o;if(u[0]===g.qJ.Constant||u[0]===g.qJ.Property?o+=u.substr(1).length:o+=a[u].name.length,m<=e&&e<=o){r=s,i=m;break}}}catch(e){l.e(e)}finally{l.f()}return{segIndex:r,startIndex:i}}},{key:"updateDataByOps",value:function(e){var t=this;e.forEach(function(e){return t.updateByOp(e)})}},{key:"updateByOp",value:function(e){e instanceof b?this.addConstantToken(e):e instanceof v?this.deleteToken(e):e instanceof h&&this.updateConstantToken(e),e instanceof p?this.addRefToken(e):e instanceof f?this.deleteToken(e):e instanceof d&&this.updateRefToken(e),e instanceof _?this.addConstantToken(e):e instanceof F?this.deleteToken(e):e instanceof E&&this.updateConstantToken(e)}},{key:"deleteToken",value:function(e){var t=e.index();this.tokens.splice(t,1)}},{key:"addConstantToken",value:function(e){var t=e.index(),n=e.token();this.tokens.splice(t,0,n)}},{key:"updateConstantToken",value:function(e){var t=e.index(),n=e.token();this.tokens[t]=n}},{key:"addRefToken",value:function(e){var t=e.index(),n="".concat(e.type())+this.getRefsID();this.tokens.splice(t,0,n),this.refs[n]=e.refInfo()}},{key:"updateRefToken",value:function(e){var t=this.tokens[e.index()];t&&t[0]===g.qJ.Reference&&(this.refs[t]=e.refInfo())}},{key:"getTokens",value:function(){return this.tokens}},{key:"getRefs",value:function(){return this.refs}},{key:"getTokenInfo",value:function(){return this.tokenInfo}},{key:"setTokens",value:function(e){this.tokens=e}},{key:"setRefs",value:function(e){this.handleIndependRef(e),this.refs=e}},{key:"handleIndependRef",value:function(e){for(var t=Object.keys(e),n=0;n<t.length;n++){var a=t[n],r=e[a];if(r.type===g.rJ.Field){var i,o=this.tokens.indexOf(a);this.isIntersetTokenInfo(o)||(r.referenceId=(null===(i=r.parent)||void 0===i?void 0:i.referenceId)+"."+r.referenceId)}}}},{key:"isIntersetTokenInfo",value:function(t){return this.tokenInfo.some(function(e){return e.includes(t)})}},{key:"setTokenInfo",value:function(e){this.tokenInfo=e}},{key:"reset",value:function(){this.refs={},this.tokens=[]}}]),a}();function T(e,t,n){var a=t.forceCompile(e,{ref:n.ref,onlyAnalyze:!0}),r=a.tokens,i=a.refMap,o=a.tokenVariants,l=a.combinedTokens,c=a.chainingParentMap,s=a.error;if(0!==o.size){var u,m=Object(g.WB)(o.entries());try{for(m.s();!(u=m.n()).done;){var p=Object(g.xz)(u.value,2),d=p[0],f=p[1];if(f.isOp()&&null!=r[d]&&null!=r[d+1]&&r[d+1].startsWith(g.qJ.Constant)&&f.op()instanceof g.EJ){var b=r[d+1].slice(1),h=N(f,b,{executeMode:g.FJ.PREDICT,ref:n.ref,service:t.getFormulaService(),info:{}});r[d+1]="".concat(g.qJ.Property).concat(h||b)}}}catch(e){m.e(e)}finally{m.f()}}var v=Object(g.hK)(n,r,i||{});return Object.assign({error:s,tokenVariants:o,combinedTokens:l,chainingParentMap:c},v)}function N(e,t,n){var a=e.getArgs()[0];if(null==a)return null;var r=null;if(a.isOp()?r=a.predict(n):Object(g.iK)(a)&&(r=a.getPredictResult()),null==r||!r.isCollection()||!r.isRef())return null;var i=r.getRef();return Object(g.jK)(i,t,g.kK.CompileForEditor)}}}]);
//# sourceMappingURL=//slardar.bytedance.net/api_v2/browser/jserr/get_sourcemap?bid=docs_pc&js_filename=c16a5320fa47.be933d7e95.chunk.js