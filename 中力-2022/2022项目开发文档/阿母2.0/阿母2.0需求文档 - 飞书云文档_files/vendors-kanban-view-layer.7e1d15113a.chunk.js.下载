(window.webpackJsonp=window.webpackJsonp||[]).push([["8c4909b9176f"],{vb1302:function(e,V,D){"use strict";D.r(V),function(C){D.d(V,"KanbanViewLayer",function(){return T});var e,t,O=D("vb143"),n=D("vb152"),c=D.n(n),s=D("vb145"),p=D("vb161"),i=D("vb103"),_=D.n(i),o=D("vb110"),x=D.n(o),r=(D("vb118"),D("vb147"),D("vb148"),D("vb116"),D("vb120"),D("vb112"),D("vb164"),D("vb167"),D("vb113"),D("vb114")),v=(D("vb119"),D("vb155"),D("vb174"),D("vb121"),D("vb117"),D("vb115"),D("vb111"),D("vb126"),D("vb125"),D("vb653")),y=D("vb292"),m=D("vb326"),f=D("vb358"),w=D("vb413"),g=D("vb495"),a=D("vb185"),I=(D("vb129"),D("vb223"),D("vb214"),D("vb232"),D("vb187"),D("vb225"),D("vb224"),D("vb128"),D("vb122"),D("vb233"),D("vb234"),D("vb235"),D("vb123"),D("vb236"),D("vb193"),D("vb237"),D("vb238"),D("vb124"),D("vb239"),D("vb104"),D("vb159"),D("vb240"),D("vb134"),D("vb131"),D("vb226"),D("vb241"),D("vb242"),D("vb127"),D("vb132"),D("vb227"),D("vb135"),D("vb228"),D("vb229"),D("vb133"),D("vb243"),D("vb262"),D("vb244"),D("vb245"),D("vb246"),D("vb247"),D("vb194"),D("vb248"),D("vb249"),D("vb201"),D("vb260"),D("vb267"),D("vb250"),D("vb136"),D("vb251"),D("vb130"),D("vb252"),D("vb356"),function(i){function o(){var h;Object(O.ov)(this,o);for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return(h=i.call.apply(i,[this].concat(t))||this).collectFieldUpdateOptionEvent=function(e){var t=h.props,n=t.tableId,i=t.viewId,o=t.bitableStore,r=t.renameSource,a=t.groupFieldType,c=Object(O.fK)(o,n,i);r===O.cK.NEW_GROUP?O.ob.collectBitableEvent(O.On.BitableAddGroup,{table_id:n,view_id:i,bitable_view_type:O.Cz[h.viewType],group_field_type:a&&O.gK.instance.getStringType(a)},!0):O.ob.collectBitableEvent(O.On.BitableSelectUpdateOption,Object.assign({table_id:n,view_id:i,bitable_view_type:O.Cz[h.viewType],scene:O.zE.KanbanGroup},e,{data_source:o.Options.module,bitable_field_type:c}),!0)},h.bindContextEvent=function(){var e=h.getContextListeners(),t=h.props,n=t.bitableStore,i=t.tableId;n.addEventListeners(i,e)},h.getContextListeners=function(){var e;return Object(O.Ww)(e={},O.ay.ChangesetApplied,h.updateIfGroupChanged),Object(O.Ww)(e,O.ay.OperationProduced,h.onOperationProduced),e},h.onOperationProduced=function(e){var t=e.updateActions;h.updateIfGroupChanged({updateActions:t})},h.updateIfGroupChanged=function(e){var t=e.updateActions,n=h.props,i=n.tableId,o=n.viewId,r=n.bitableStore,a=h.getActiveTableAndView(i,o).view,c=!!a&&a.type===O.az.Kanban&&!a.isValid(),l=r.base.getTableById(i),d=Object(O.NA)(t,l,i,o,c);o&&i&&d&&h.props.handleEditorExitEdit()},h.getActiveTableAndView=function(e,t){var n=h.props.bitableStore,i=e&&n.base.getTableById(e),o=i&&t&&i.getViewById(t);return{table:i,view:o}},h.unbindContextEvent=function(){var e=h.getContextListeners(),t=h.props,n=t.bitableStore,i=t.tableId;n.removeEventListeners(i,e)},h.renderNewCardEditor=function(){var e,t=h.props,n=t.viewId,i=t.renderer,o=t.tableId,r=t.editable,a=t.bitableStore,c=t.isFullScreenMode,l=t.viewLayerOverlay,d=t.mountOption,b=t.isOpenSidebar,u=t.showNewCardEditor,s=t.editorNeedUndo,p=t.recordId,v=t.groupValue,m=t.renameSource,f=t.groupFieldType,w=t.addTriggerButton,C=t.isParentBlockInView;if(u===O.YJ.NONE||!n)return null;var g=0;if(h.isEmbededInDoc&&!c&&d){var y=d.operator.getBitablePosition();g=y&&y.left||0}h.isEmbededInDoc||(g=b?O.JK-O.KK:0);var I=_.a.createElement(O.vJ,{groupValue:v,renderer:i,onExitEdit:h.props.handleEditorExitEdit,viewId:n,recordId:p,tableId:o,bitableStore:a,editable:r,EditContainerType:u,collectFieldUpdateOptionEvent:h.collectFieldUpdateOptionEvent,needUndo:s,isDocBlock:h.isEmbededInDoc&&!c,trigger:w,groupFieldType:f,renameSource:m,overlayOffsetX:g,hiddenEditor:!C,isFullScreenMode:c});return null!==(e=a.bitableConfig.ui)&&void 0!==e&&e.kanbanNewRecordOverlay&&l||u===O.YJ.RENAME&&l?x.a.createPortal(I,l):I},h}return Object(O.bu)(o,i),Object(O.Pw)(o,[{key:"componentDidMount",value:function(){this.bindContextEvent()}},{key:"componentWillUnmount",value:function(){this.unbindContextEvent()}},{key:"isEmbededInDoc",get:function(){return this.props.bitableStore.isEmbeddedInDoc}},{key:"viewType",get:function(){var e=this.props,t=e.tableId,n=e.viewId,i=e.bitableStore.base.getTableById(t),o=i&&i.getViewById(n);return o&&o.type||O.az.NotSupport}},{key:"render",value:function(){return this.renderNewCardEditor()}}]),o}(_.a.Component)),l=function(e){var t,n=e.recordId,i=e.groupValue,o=e.permission,r=e.tableId,a=e.editable,c=e.operator,l=e.view,d=e.isSyncTable,b=null===(t=l.getGroupField())||void 0===t?void 0:t.id,u=function(){c.onInsertRow(n,i,O.qC.Up),Object(f.a)(O.LK.InsertAbove)},s=C("bitable.insert_record_above"),p=!d&&!Object(w.g)({permission:o,tableId:r,editable:a}),v=d||!o.hasPermission(O.qy.Field,{tableId:r,fieldId:b},O.ry.Submittable),m=Object(g.h)({isSyncTable:d});return Object(g.j)({text:s,hidden:p,onClick:u,disabled:v,tooltipConfig:m})},d=function(e){var t,n=e.recordId,i=e.groupValue,o=e.permission,r=e.tableId,a=e.editable,c=e.operator,l=e.view,d=e.isSyncTable,b=function(){c.onInsertRow(n,i,O.qC.Down),Object(f.a)(O.LK.InsertBelow)},u=C("bitable.insert_record_below"),s=null===(t=l.getGroupField())||void 0===t?void 0:t.id,p=!d&&!Object(w.g)({permission:o,tableId:r,editable:a}),v=d||!o.hasPermission(O.qy.Field,{tableId:r,fieldId:s},O.ry.Submittable),m=Object(g.h)({isSyncTable:d});return Object(g.b)({text:u,hidden:p,onClick:b,disabled:v,tooltipConfig:m})},b=function(e){var t=e.operator,n=function(){t.onAddComment(e.recordId),Object(f.a)(O.LK.AddComment,{target:O.Rw.CcmCommentView})};return Object(g.d)({hidden:!e.showComment,onClick:n})},u=function(e){var t=e.recordId,n=e.operator,i=O.ob.config.ui.disableRecordCardMode;return Object(g.f)({onClick:function(){n.onShowEditPopup(t),Object(f.a)(O.LK.ExpandRecord,{target:O.Rw.CcmBitableCardView})},hidden:i})},h=function(e){var t=e.recordId,n=e.permission,i=e.tableId,o=e.editable,r=e.view,a=e.operator,c=e.isSyncTable,l=!c&&!Object(w.a)({permission:n,tableId:i,viewId:r.id,editable:o,recordId:t}),d=c,b=Object(g.h)({isSyncTable:c});return Object(g.e)({hidden:l,onClick:function(){a.onDeleteRow([t]),Object(f.a)(O.LK.DeleteRecord)},disabled:d,tooltipConfig:b})},E=function(e){var t=e.view,n=e.recordId,i=e.operator,o=t.table.getPrimaryKey();return n&&o?Object(g.c)({onClick:function(){return i.onCopyLink(n,o)},hidden:Boolean(O.ob.config.disableRecordLink)}):null},k=function(e){var t=e.groupValue,n=e.recordId,i=e.permission,o=e.tableId,r=e.editable,a=e.operator,c=function(){a.onCopyRecord(n,t),Object(f.a)(O.LK.Copy)},l=!Object(w.g)({permission:i,tableId:o,editable:r});return Object(g.g)({hidden:l,onClick:c})},S=function(e){return e?{title:e}:void 0},B=function(e){var t=e.groupValue,n=e.closeCb,i=e.view,o=e.editable,r=e.operator,a=e.disabled,c=e.tooltipGroupRenameTitle,l=null==i?void 0:i.getGroupField();return i&&l?{id:y.a.GroupRename,text:O.sy.instance.get(l.type).kanbanRenameText,icon:_.a.createElement(O.IB.RenameIconSvg,{className:"icon"}),onClick:function(){r.onChangeGroupName(t),n&&n(),Object(f.c)(l)},disabled:a,tooltipConfig:S(c),tooltipFollowText:!0,hidden:!o}:null},R=function(e){var t=e.groupValue,n=e.editable,i=e.operator,o=e.disabled,r=e.tooltipDeleteGroupTitle;return{id:y.a.DeleteGroup,text:C("bitable.delete_group"),icon:_.a.createElement(O.IB.DeleteIconSvg,{className:"icon"}),onClick:function(){i.onDeleteGroup(t),O.cz.collectClickEvent(O.Bc.CcmBitableKanbanGroupMoreClick,{click:"delete",target:O.Rw.CcmBitableGroupDeleteView})},disabled:o,tooltipConfig:S(r),tooltipFollowText:!0,hidden:!n}},M=(Object(O.Ww)(e={},y.b.KanbanCardContextMenu,[l,d,k,u,E,b,h]),Object(O.Ww)(e,y.b.KanbanCardListMoreContextMenu,[B,R]),e),j=new Set([O.og.Formula,O.og.Location]),T=Object(r.connect)(function(e,t){var n=Object(O.Fz)(e),i=n&&n.status.translated;return{onboardingGridTableId:Object(O.gI)(e),onboardingKanbanTableId:Object(O.fI)(e),fullScreenTableId:Object(O.DG)(e),isNotDefaultMode:Object(O.yx)(e),haveCommentPermission:Object(O.Hz)(e)&&!i,isPureBitable:Object(O.Ay)(e),isCommentDataInit:Object(O.By)(e)}},null)(t=Object(a.b)(function(e){return{setFloatToolbarVisibility:e.toolbarStore.toggleFloatToolbar}})(t=function(t){function i(e){var g,n;return Object(O.ov)(this,i),(g=t.call(this,e)||this).selfDom=null,g.kanbanPopupTimer=null,g.hyperLinkRef=null,g.getViewOperation=function(){return{onDeleteRow:g.onDeleteRow,onInsertRow:g.executeAddRecord,onShowEditPopup:g.onShowEditPopup,onAddComment:g.onAddComment,onCopyRecord:g.executeCopyRecord,onChangeGroupName:g.onChangeGroupName,onDeleteGroup:g.onDeleteGroup,onCopyLink:g.onCopyLink}},g.executeCopyRecord=function(t,e,n){var i=Object(O.Cx)(g),o=i.activeTable,r=i.activeView,a=g.props,c=a.bitableStore,l=a.addRecordInCard,d=g.getAddRecordIndex(t,e,n);if(l)g.props.onAddRecord&&g.props.onAddRecord(null,d,n);else{var b=c.getCommandManager(),u=o.getFieldIds().filter(function(e){return null!=o.getCellValue(t,e)}),s=b.execute({cmd:O.Fy.AddRecord,tableId:o.id,viewId:r.id,index:d,groupValue:e,record:g.getKanbanAddRecordData(e)});s.result===O.Ey.Success&&b.execute({cmd:O.Fy.PasteSetRecords,tableId:o.id,viewId:r.id,fields:u,stdValues:r.getStdValueMatrixFromIds({fieldIds:u,recordIds:[t]},!1).stdValueMatrix,pasteTargetFieldIds:u,pasteRecordIds:[s.data.recordId]})}},g.handleCardContextMenu=function(e){var t=g.props,n=t.bitableStore,i=t.editable,o=t.tableId,r=t.haveCommentPermission,a=t.isCommentDataInit,c=t.contextMenuService,l=n.getPermissionStore(),d=Object(m.b)(n.bitableConfig)&&r&&a,b=g.getViewOperation(),u=n.isSyncTable(o),s=Object.assign({},e,{tableId:o,view:g.activeView,permission:l,editable:i,showComment:d,operator:b,isSyncTable:u});null==c||c.showContextMenu(y.b.KanbanCardContextMenu,{getContextMenuConfig:function(){var e;return{x:g.props.contextMenuPositionX,y:g.props.contextMenuPositionY,hidden:null===(e=g.props.bitableStore.bitableConfig.ui)||void 0===e?void 0:e.disableContextMenu}},getContext:function(){return s}})},g.handleCardListMoreContextMenu=function(e){var t,n=g.props.renderer.activeBitableWidget.getKanbanWidget(),i=e.rect,o=e.closeCb;g.closeHdDpMenu=function(){o&&o()};var r=i.x+i.width;r=n.isDocBlock?r-O.IE.cardMoreMenuWidth+O.IE.cardIconWidth+O.IE.cardHMargin:r-O.IE.cardMoreMenuWidth+O.IE.cardHMargin-4;var a=i.y+i.height+O.vF,c=g.props,l=c.bitableStore,d=c.editable,b=c.tableId,u=c.contextMenuService,s=l.getPermissionStore(),p=g.getViewOperation(),v=g.activeView.getGroupField().isDynamic?{disabled:!0,tooltipDeleteGroupTitle:C("Bitable_SingleOption_UnableToDelete_Web"),tooltipGroupRenameTitle:C("Bitable_SingleOption_UnableToRename_Web")}:{},m=l.isSyncTable(b),f=Object.assign({},e,{},v,{permission:s,tableId:b,view:g.activeView,editable:d,operator:p,isSyncTable:m}),w={x:r,y:a,isRelativeContainer:!0,container:g.props.viewLayerOverlay||g.selfDom,onClose:function(){o&&o()},hidden:null===(t=g.props.bitableStore.bitableConfig.ui)||void 0===t?void 0:t.disableContextMenu};null==u||u.showContextMenu(y.b.KanbanCardListMoreContextMenu,{getContextMenuConfig:function(){return w},getContext:function(){return f}})},g.collectDeleteOptionEvent=function(e){var t=Object(O.XE)(g.activeView);O.ob.collectBitableEvent(O.On.BitableSelectDeleteOption,Object.assign({table_id:g.activeTable.id,view_id:g.activeView.id,bitable_view_type:O.Cz[g.activeView.type],bitable_select_type:t,scene:O.zE.KanbanGroup},e,{data_source:g.props.bitableStore.Options.module}),!0)},g.collectMoveOptionEvent=function(e){O.ob.collectBitableEvent(O.On.BitableSelectMoveOption,Object.assign({table_id:g.activeTable.id,view_id:g.activeView.id,bitable_view_type:O.Cz[g.activeView.type],bitable_select_type:O.MK.Single,scene:O.zE.KanbanGroup},e,{data_source:g.props.bitableStore.Options.module}),!0)},g.toggleFloatToolbarVisibility=function(e){var t=g.props,n=t.bitableStore,i=t.isFullScreenMode,o=t.setFloatToolbarVisibility;n.isEmbeddedInDoc&&!i&&(null==o||o(e))},g.renameGroupValue=function(e,t,n){g.showEditor({showNewCardEditor:O.YJ.RENAME,groupValue:e,groupFieldType:n,renameSource:t,editorNeedUndo:t===O.cK.NEW_GROUP})},g.onCopyLink=(n=Object(O.uY)(c.a.mark(function e(t,n){var i,o,r,a;return c.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return i=g.props,o=i.viewId,r=i.tableId,a=i.renderer,e.next=3,Object(v.a)({tableId:r,viewId:o,renderer:a,fieldId:n,recordId:t});case 3:case"end":return e.stop()}},e)})),function(e,t){return n.apply(this,arguments)}),g.executeAddRecord=function(e,t,n,i){var o=Object(O.Cx)(g),r=o.activeTable,a=o.activeView,c=g.props,l=c.bitableStore,d=c.showCardModal,b=c.addRecordInCard,u=c.renderer,s=g.getAddRecordIndex(e,t,n);if(O.ob.config.cardSyncMode===O.tx.OnDemand||b)g.props.onAddRecord&&g.props.onAddRecord([t],s,n);else{var p=l.getCommandManager().execute({cmd:O.Fy.AddRecord,tableId:r.id,viewId:a.id,index:s,groupValue:t,record:g.getKanbanAddRecordData(t)});if(O.ob.collectBitableEvent(O.On.BitableRecordAdd,{table_id:g.activeTable.id,view_id:g.activeView.id,bitable_view_type:"kanban",bitable_record_direction:n||O.qC.Bottom,data_source:l.Options.module,action:O.UC.Click,record_number:1},!0),p.result!==O.Ey.Success)return;var v=l.getBasePermission(O.ry.Manageable),m=l.base.isPro();if(v||!m||b||!t?d(p.data.recordId,void 0,void 0,!0):g.showEditor({showNewCardEditor:O.YJ.NEW_CARD,groupValue:t,recordId:p.data.recordId,editorNeedUndo:!0,addTriggerButton:O.IF.TopButton}),i){var f=u.activeBitableWidget.getKanbanWidget();t||f.revealRecords([p.data.recordId])}O.ob.collectBitableEvent(O.On.BitableCardOpen,{bitable_view_type:"kanban",source:O.NK.ContextMenuAddRecord,data_source:l.Options.module}),O.cz.collectBitableEvent(O.Rw.CcmBitableCardView,{source:O.NK.ContextMenuAddRecord})}},g.onAddComment=function(e){var t=g.props,n=t.smartableCommentManager,i=t.mountOption,o=t.renderer,r=(o.activeBitableWidget&&o.activeBitableWidget.getGridWidget()).source.gridView.getVisibleRecords()[0],a=e||r;a&&n&&(n.triggerCreateComment(a,O.YH.ContextMenu,i),O.cz.collectBitableEvent(O.Rw.CcmCommentView,{sub_view:"part_comment"}))},g.onShowEditPopup=function(e){g.props.showCardModal(e),O.ob.collectBitableEvent(O.On.BitableCardOpen,{table_id:g.activeTable.id,view_id:g.activeView.id,bitable_view_type:"kanban",source:O.NK.ContextMenu,data_source:g.props.bitableStore.Options.module}),O.cz.collectBitableEvent(O.Rw.CcmBitableCardView,{source:O.NK.ContextMenu})},g.onClickHyperLink=function(e){if(e&&g.hyperLinkRef){var t=Object(O.Cx)(g),n=t.activeTable,i=t.activeView;g.hyperLinkRef.onClickHyperLink(Object.assign({},e,{activeTable:n,activeView:i}))}},g.onClickMention=function(e){var t=Object(O.Cx)(g),n=t.activeTable,i=t.activeView;O.lx.openMention(Object.assign({},e,{activeTable:n,activeView:i}))},g.onDeleteRow=function(e){var t=g.props.bitableStore,n=t.getCommandManager(),i=g.activeTable.id;n.execute({cmd:O.Fy.DeleteRecords,tableId:i,viewId:g.activeView.id,recordIds:e}),O.ob.collectBitableEvent(O.On.BitableRecordDelete,{table_id:g.activeTable.id,view_id:g.activeView.id,bitable_view_type:"kanban",data_source:t.Options.module},!0)},g.closeContextMenu=function(){var e;null===(e=g.props.contextMenuService)||void 0===e||e.closeContextMenu(),g.toggleFloatToolbarVisibility(!1)},g.closeDropdownMenu=function(){g.closeDpMenu&&(g.closeDpMenu(),g.closeDpMenu=null,g.setState({groupValue:""}))},g.closeHdDropdownMenu=function(){g.closeHdDpMenu&&(g.closeHdDpMenu(),g.closeHdDpMenu=null)},g.onChangeGroupName=function(e){var t=g.activeView.getGroupField();t&&(g.renameGroupValue(e,O.cK.RENAME,t.type),g.closeHdDropdownMenu())},g.onAddRecord=function(){g.closeDropdownMenu()},g.onDeleteGroup=function(t){var e=g.props,n=e.bitableStore,i=e.tableId,o=e.editable,r=Object(O.Cx)(g),a=r.activeView,c=r.activeTable;o&&a&&(Object(O.rB)({title:C("bitable.delete_group_confirm"),message:C("bitable.to_delete_group"),className:"bitable-kanban-group_delete",buttons:[{text:C("common.cancel")},{text:C("comment.delete"),type:O.YA.warn,onClick:function(){var e=n.getCommandManager();c&&t&&(Object(O.fJ)(g.activeView.getGroupField())||(e.execute({cmd:O.Fy.DeleteGroup,tableId:i,viewId:a.id,groupValue:t}),g.collectDeleteOptionEvent()))}}]}),O.cz.collectBitableEvent(O.Rw.CcmBitableGroupDeleteView)),g.closeHdDropdownMenu()},g.setRef=function(e){g.selfDom=e},g.setHyperLinkRef=function(e){g.hyperLinkRef=e},g.showEditor=function(e){g.setState(e)},g.handleEditorExitEdit=function(){g.hideKanbanEditor()},g.renderNewCardEditor=function(){var e=g.state,t=e.showNewCardEditor,n=e.addTriggerButton,i=e.groupValue,o=e.recordId,r=e.groupFieldType,a=e.renameSource,c=e.editorNeedUndo,l=g.props,d=l.viewId,b=l.renderer,u=l.tableId,s=l.editable,p=l.bitableStore,v=l.isFullScreenMode,m=l.viewLayerOverlay,f=l.mountOption,w=l.isOpenSidebar,C=l.isParentBlockInView;return g.shouldHideKanbanEditor()||!d?null:_.a.createElement(I,{addTriggerButton:n,editorNeedUndo:c,showNewCardEditor:t,groupValue:i,groupFieldType:r,renameSource:a,recordId:o,tableId:u,viewId:d,bitableStore:p,renderer:b,editable:s,viewLayerOverlay:m,mountOption:f,isOpenSidebar:!!w,isFullScreenMode:!!v,handleEditorExitEdit:g.handleEditorExitEdit,isParentBlockInView:C})},g.state={expandCol:-1,groupValue:"",tooltip:{show:!1,x:0,y:0,width:0,height:0,title:""},recordId:"",showNewCardEditor:O.YJ.NONE,editorNeedUndo:!1,groupFieldType:null,renameSource:O.cK.RENAME,addTriggerButton:O.IF.BottomButton},g.initContextMenuService(),g}return Object(O.bu)(i,t),Object(O.Pw)(i,[{key:"componentDidMount",value:function(){this.updateActiveModel(this.props)&&(this.clearListener=this.bindFasterEvent(this.activeTable,this.activeView))}},{key:"UNSAFE_componentWillReceiveProps",value:function(e){this.props.tableId===e.tableId&&this.props.viewId===e.viewId||(this.clearListener&&this.clearListener(),this.updateActiveModel(e)&&(this.clearListener=this.bindFasterEvent(this.activeTable,this.activeView)));var t=e.view,n=this.props.view;this.props.tableId===e.tableId&&t&&n&&t.id===n.id&&t.publicLevel!==n.publicLevel&&t.publicLevel===O.fB.PERSONAL&&(this.hidePopup(),this.setState({tooltip:Object.assign({},this.state.tooltip,{show:!1})}))}},{key:"componentWillUnmount",value:function(){this.clearListener&&this.clearListener()}},{key:"initContextMenuService",value:function(){var e=this.props,i=e.bitableStore,t=e.contextMenuService,n=Object(O.Ww)({},y.b.KanbanCardContextMenu,function(e,t){if(i.isEmbedded||i.Options.isHistoryMode||i.Options.module===O.Bz.Template)return Object.assign({},e,{items:e.items.filter(function(e){return e.id!==y.a.CopyLink})});var n=e.items.find(function(e){return e.id===y.a.DeleteRecord});return n&&Object(g.i)(n,i,t),e});null==t||t.setContextMenus(M),null==t||t.setContextServiceOption({customContextMenus:n})}},{key:"getTable",value:function(){var e=this.props,t=e.bitableStore,n=e.tableId;return t.base.getTableById(n)}},{key:"getView",value:function(){var e=this.props.viewId,t=this.getTable();return t&&t.getViewById(e)}},{key:"updateActiveModel",value:function(e){var t=e.bitableStore,n=e.tableId,i=e.viewId,o=t.base.getTableById(n),r=o&&o.getViewById(i);return!(!o||!r||(this.activeTable=o,this.activeView=r,0))}},{key:"bindFasterEvent",value:function(e,t){var n,i,u=this,o=this.props,r=o.smartableCommentManager,a=o.operate,c=this.props.renderer.activeBitableWidget,l=c.getKanbanWidget(),d=(Object(O.Ww)(n={},O.rC.MoveGroup,function(e){var t=e.from,n=e.to,i=u.activeView,o=i.getGroupField();if(o){var r=o.getGroups(i).map(function(e){return e.key}),a=o.id;if(r[0]===O.wz&&(t++,n++),r&&r.length)Object(O.OK)(r,t,n);else if(o.type===O.og.SingleSelect||o.type===O.og.MultiSelect){var c,l,d=Object(p.a)((null===(c=(l=o).getOptions)||void 0===c?void 0:c.call(l))||[]);Object(O.OK)(d,t,n),r=d.map(function(e){return e.id})}u.props.bitableStore.getCommandManager().execute({cmd:O.Fy.MoveGroupOrder,tableId:u.activeTable.id,viewId:u.activeView.id,fieldId:a,data:{groupOrder:r,field:o,from:t}}),O.ob.collectBitableEvent(O.On.BitableKbDragColumn,{table_id:u.activeTable.id,view_id:u.activeView.id,bitable_view_type:"kanban",data_source:u.props.bitableStore.Options.module},!0),u.collectMoveOptionEvent()}}),Object(O.Ww)(n,O.rC.MoveRecord,function(e){var t=e.recordId,n=e.groupValue,i=e.fromGroupValue,o=e.afterRecordId,r=u.activeView,a=u.props,c=a.bitableStore,l=a.tableId;c.getCommandManager().execute({cmd:O.Fy.MoveGroupRecord,tableId:l,viewId:r.id,recordId:t,sourceGroup:i,targetGroup:n,afterRecordId:o});var d=Object(O.XE)(r),b=r.getGroupField();Object(g.k)(O.PK.DragGroup,null==b?void 0:b.fieldUIType,n),O.ob.collectBitableEvent(O.On.BitableKbDragCard,{table_id:u.activeTable.id,view_id:u.activeView.id,bitable_view_type:"kanban",data_source:u.props.bitableStore.Options.module,bitable_select_type:d}),O.ob.collectBitableEvent(O.On.BitableRecordMove,{table_id:u.activeTable.id,view_id:u.activeView.id,bitable_view_type:O.Cz[u.activeView.type],scene:O.zE.KanbanGroup,data_source:u.props.bitableStore.Options.module},!0),O.cz.collectClickEvent(O.Bc.CcmBitableRecordDragClick,{click:O.QK.KanbanRecordDrag,from_group_id:String(i),to_group_id:String(n)})}),Object(O.Ww)(n,O.rC.CardContextMenu,this.handleCardContextMenu),Object(O.Ww)(n,O.rC.ClickCardListMore,this.handleCardListMoreContextMenu),Object(O.Ww)(n,O.rC.BoardScroll,function(){u.closeContextMenu(),u.closeHdDropdownMenu()}),Object(O.Ww)(n,O.rC.CardListScroll,function(){u.closeContextMenu(),u.closeHdDropdownMenu()}),Object(O.Ww)(n,O.rC.AbortDrag,function(e){var t=e.reason;t&&O.ob.Toast.error({key:"abort_drag",content:t,duration:3e3})}),Object(O.Ww)(n,O.rC.AppendRecord,function(e){var t=e.groupValue,n=e.recordId,i=e.needScrollToAddedRecord,o=void 0!==i&&i;u.executeAddRecord(t,n,O.qC.Top,o)}),Object(O.Ww)(n,O.rC.AddRecord,function(e){var t=e.groupValue,n=e.trigger,i=void 0===n?O.IF.BottomButton:n;O.ob.collectBitableEvent(O.On.BitableRecordAdd,{table_id:u.activeTable.id,view_id:u.activeView.id,bitable_view_type:"kanban",source:"button",bitable_record_direction:i,data_source:u.props.bitableStore.Options.module,action:O.UC.Click,record_number:1},!0);var o=i===O.IF.TopButton?0:void 0;if(O.ob.config.cardSyncMode===O.tx.OnDemand||u.props.addRecordInCard)u.props.onAddRecord&&u.props.onAddRecord([t],o);else{var r=u.activeView,a=u.props.bitableStore.getCommandManager().execute({cmd:O.Fy.AddRecord,tableId:u.props.tableId,viewId:r.id,index:o,record:u.getKanbanAddRecordData(t),groupValue:t});a.result===O.Ey.Success&&(u.showEditor({showNewCardEditor:O.YJ.NEW_CARD,groupValue:t,recordId:a.data.recordId,editorNeedUndo:!0,addTriggerButton:i}),O.ob.collectBitableEvent(O.On.BitableCardOpen,{table_id:u.activeTable.id,view_id:u.activeView.id,bitable_view_type:"kanban",source:O.NK.ButtonAddRecord,data_source:u.props.bitableStore.Options.module}),O.cz.collectBitableEvent(O.Rw.CcmBitableCardView,{source:O.NK.ButtonAddRecord}))}}),Object(O.Ww)(n,O.rC.RenameGroup,function(e){var t=e.groupValue,n=e.fieldType;O.cz.collectClickEvent(O.Bc.CcmBitableKanbanGroupNameClick,{click:"rename",field_type:O.lC[n]}),u.renameGroupValue(t,O.cK.RENAME,n)}),Object(O.Ww)(n,O.rC.ExpandRecord,function(e){var t=e.recordId;O.ob.config.ui.disableRecordCardMode||(u.closeContextMenu(),u.closeDropdownMenu(),u.props.showCardModal(t),O.ob.collectBitableEvent(O.On.BitableCardOpen,{table_id:u.activeTable.id,view_id:u.activeView.id,bitable_view_type:"kanban",source:O.NK.ClickCard,data_source:u.props.bitableStore.Options.module}),O.cz.collectBitableEvent(O.Rw.CcmBitableCardView,{source:O.NK.ClickCard}))}),Object(O.Ww)(n,O.rC.AddGroup,function(e){u.renameGroupValue("",O.cK.NEW_GROUP,e)}),Object(O.Ww)(n,O.rC.ClickCheckbox,function(e){var t=u.activeTable,n=u.props,i=n.bitableStore,o=n.viewId,r=e.recordId,a=e.isChecked,c=e.field;i.getCommandManager().execute({cmd:O.Fy.SetRecord,tableId:t.id,recordId:r,viewId:o,data:Object(O.Ww)({},c.getId(),{type:c.getType(),value:a})}),O.ob.collectBitableEvent(O.On.BitableRecordEdit,{smartable_token:i.md5Token,row:u.activeView.getVisibleRecordIndexById(r),col:u.activeView.getFieldIndexById(c.getId()),table_id:u.activeTable.id,view_id:u.activeView.id,bitable_editor_type:"cell",bitable_view_type:O.Cz[u.activeView.type],bitable_field_type:O.lC[c.getFieldUIType()],bitable_feature_change:-1,data_source:u.props.bitableStore.Options.module},!0)}),Object(O.Ww)(n,O.rC.KanbanWidgetClick,function(){u.props.smartableCommentManager&&u.props.smartableCommentManager.handleDeactivateComment()}),Object(O.Ww)(n,O.rC.ClickMention,this.onClickMention),Object(O.Ww)(n,O.rC.ClickHyperlink,this.onClickHyperLink),n);l.events.addListeners(d);var b=(Object(O.Ww)(i={},O.kC.ShowTooltip,function(e){var t=e.x,n=e.y,i=e.width,o=e.height,r=e.title,a=e.direction,c=e.className,l=e.style,d=e.showArrow;u.setState({tooltip:{x:t,y:n,width:i,height:o,title:r,show:!0,direction:a,className:c,style:l,showArrow:d}})}),Object(O.Ww)(i,O.kC.ShowReminderTooltip,function(e){var t=e.x,n=e.y,i=e.reminder,o=e.direction,r=e.className,a=Object(O.RK)(i,u.activeTable);u.setState({tooltip:{x:t,y:n,title:a,show:!0,direction:o,className:r}}),O.ob.collectBitableEvent(O.On.SetBitableReminder,{action:O.SK.HOVER_CLOCK_ICON,table_id:u.props.tableId,view_id:u.props.viewId,bitable_view_type:O.Cz[O.az.Kanban],source:O.mC.OUTSIZE_RECORD_DETAIL})}),Object(O.Ww)(i,O.kC.HideTooltip,function(){u.setState({tooltip:Object.assign({},u.state.tooltip,{show:!1})})}),Object(O.Ww)(i,O.kC.ShowMentionPopover,function(e){if(!u.props.isAnonymousAccess){var t="",n="";e.mentionType===O.mx.User&&(t=Object(s.a)(u.activeTable.getI18nUserItemById(e.token),"name","")),u.props.smartableMentionManager&&u.props.smartableMentionManager.getMentionInfoByUserId(u.props.tableId,e.token)&&(n=u.props.tableId),O.lx.open(Object.assign({name:t,tableId:n},e))}}),Object(O.Ww)(i,O.kC.HideMentionPopover,function(){O.lx.close()}),Object(O.Ww)(i,O.kC.CommentBubbleClick,function(e){O.cz.collectClickEvent(O.Bc.CcmBitableRecordCommentClick,{click:"click_record",target:O.Rw.CcmCommentView}),r&&r.onCommentBubbleClick(e)}),Object(O.Ww)(i,O.kC.ShowViewLockedModal,function(e){return Object(v.b)({bitableStore:u.props.bitableStore,renderer:u.props.renderer,source:e,operate:a})}),Object(O.Ww)(i,O.kC.ShowAttachPopover,function(e){g.a.open(e)}),Object(O.Ww)(i,O.kC.HideAttachPopover,function(){g.a.close()}),i);return c.events.addListeners(b),function(){l.events.removeListeners(d),c.events.removeListeners(b)}}},{key:"hidePopup",value:function(){this.closeContextMenu(),this.closeHdDropdownMenu(),this.closeDropdownMenu(),this.hideKanbanEditor()}},{key:"getAddRecordIndex",value:function(e,t,n){var i=0,o=this.activeView.getGroupedRecords().get(t||O.wz);return o&&e&&(-1===(i=o.indexOf(e))?i=0:n===O.qC.Down&&i++),i}},{key:"getKanbanAddRecordData",value:function(e){if(e){var t=this.activeTable,n=this.activeView;if(t&&n&&n.type===O.az.Kanban){var i=n.getGroupField();if(i){var o=Object.assign({},t.getDefaultNewRecord(),n.getDefaultNewRecord());return o[i.id]={value:i.convertGroupValue(e)},o}}}}},{key:"hideKanbanEditor",value:function(){this.setState({showNewCardEditor:O.YJ.NONE,groupValue:"",editorNeedUndo:!1})}},{key:"isDisableInput",value:function(e){var t;return!!j.has(e.type)||e.type===O.og.Text&&!1===(null===(t=e.allowedEditModes)||void 0===t?void 0:t.manual)}},{key:"shouldHideKanbanEditor",value:function(){var e=this.state.showNewCardEditor;if(e===O.YJ.NONE)return!0;if(e===O.YJ.NEW_CARD){var t=this.getTable(),n=null==t?void 0:t.getPrimaryField();if(n&&this.isDisableInput(n))return!0}return!1}},{key:"render",value:function(){var e=this.props.fasterDom,t=this.state.tooltip;return _.a.createElement("div",{className:"kanban-overlay",ref:this.setRef},_.a.createElement(O.uL,{ref:this.setHyperLinkRef}),_.a.createElement(O.vL,{container:this.props.tooltipOverlayRef,x:t.x,y:t.y,width:t.width,height:t.height,title:t.title,visible:t.show,direction:t.direction,className:"".concat(t.className),style:t.style,showArrow:t.showArrow}),e&&x.a.createPortal(this.renderNewCardEditor(),e))}}]),i}(_.a.PureComponent))||t)||t}.call(this,D("vb163"))},vb292:function(e,t,n){"use strict";var i,o,r,a;n.d(t,"a",function(){return o}),n.d(t,"b",function(){return i}),(a=i||(i={})).GridContentContextMenu="GridContentContextMenu",a.GridFieldHeaderMenu="GridFieldHeaderMenu",a.GridGroupTitleContextMenu="GridGroupTitleContextMenu",a.KanbanCardContextMenu="KanbanContextMenu",a.KanbanCardListMoreContextMenu="KanbanCardListMoreContextMenu",a.GalleryCardContextMenu="GalleryCardContextMenu",a.GanttBarContextMenu="GanttBarContextMenu",a.BlockCreationMenu="BlockCreationMenu",a.BlockContextMenu="BlockContextMenu",(r=o||(o={})).InsertAbove="InsertAbove",r.InsertBelow="InsertBelow",r.InsertLeft="InsertLeft",r.InsertRight="InsertRight",r.ExpendRow="ExpendRow",r.CopyLink="CopyLink",r.Comment="Comment",r.FilterItem="FilterItem",r.Reminder="Reminder",r.DeleteRecord="DeleteRecord",r.ExpendSubGroups="ExpendSubGroups",r.FoldSubGroups="FoldSubGroups",r.ModifyField="ModifyField",r.ModifyDescription="ModifyDescription",r.DuplicateField="DuplicateField",r.InsertFieldLeft="InsertFieldLeft",r.InsertFieldRight="InsertFieldRight",r.FrozenField="FrozenField",r.SetSortAZ="SetSortAZ",r.SetSortZA="SetSortZA",r.SetGroup="SetGroup",r.SetFilter="SetFilter",r.CreateView="CreateView",r.HideField="HideField",r.DeleteField="DeleteField",r.CopyRecord="CopyRecord",r.GroupRename="GroupRename",r.DeleteGroup="DeleteGroup",r.ExportAttachment="ExportAttachment",r.DeleteGanttTask="DeleteGanttTask",r.AddTable="AddTable",r.AddDashboard="AddDashboard",r.RenameBlock="RenameBlock",r.CopyTable="CopyTable",r.DeleteBlcok="DeleteBlcok",r.CopyBlock="CopyBlock"},vb326:function(e,t,n){"use strict";function i(e){var t;return(null==e||null===(t=e.ui)||void 0===t?void 0:t.showComment)||!1}function o(e){return!(null!=e&&e.disableReminder)}n.d(t,"a",function(){return o}),n.d(t,"b",function(){return i})},vb356:function(e,i,o){"use strict";(function(d){o.d(i,"a",function(){return n}),o.d(i,"b",function(){return s});var e=o("vb152"),b=o.n(e),u=o("vb143");o("vb147"),o("vb103"),o("vb148");function s(e,t,n,i){var o=Object(u.uO)({table:e,view:t,record:n,field:i});return"".concat(location.origin).concat(location.pathname,"?").concat(o)}var t,n=(t=Object(u.uY)(b.a.mark(function e(t){var n,i,o,r,a,c,l;return b.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.viewId,i=t.tableId,o=t.recordId,r=t.fieldId,a=t.onCopy,c=void 0===a?function(){return!0}:a,l=s(i,n,o,r),e.next=4,c(l);case 4:e.sent?u.ob.Toast.show({type:"info",content:d("Bitable_Record_CopyLinkSuccessfullyToast"),duration:3e3,closable:!1}):u.ob.Toast.show({type:"info",content:d("Bitable_Record_UnableToCopyLinkToast"),duration:3e3,closable:!1});case 6:case"end":return e.stop()}},e)})),function(e){return t.apply(this,arguments)})}).call(this,o("vb163"))},vb358:function(e,t,n){"use strict";n.d(t,"a",function(){return l}),n.d(t,"b",function(){return p}),n.d(t,"c",function(){return c}),n.d(t,"d",function(){return d});var i,o,s=n("vb143"),r=(Object(s.Ww)(i={},s.og.SingleSelect,s.zL.Rename),Object(s.Ww)(i,s.og.MultiSelect,s.zL.Rename),Object(s.Ww)(i,s.og.User,s.zL.ChangeThePerson),Object(s.Ww)(i,s.og.SingleLink,s.zL.ChangeTheRecord),Object(s.Ww)(i,s.og.DuplexLink,s.zL.ChangeTheRecord),i),a=(Object(s.Ww)(o={},s.og.User,s.Rw.CcmMentionPanelView),Object(s.Ww)(o,s.og.SingleLink,s.Rw.CcmBitableRelationFieldModifyView),Object(s.Ww)(o,s.og.DuplexLink,s.Rw.CcmBitableRelationFieldModifyView),o),c=function(e){s.cz.collectClickEvent(s.Bc.CcmBitableKanbanGroupMoreClick,{click:r[e.type],target:a[e.type]})},l=function(e,t){s.cz.collectClickEvent(s.Bc.CcmBitableRecordOperateClick,Object.assign({click:e},t))},p=function(e,t,n){s.cz.collectClickEvent(s.Bc.CcmBitableFieldOperateClick,Object.assign({click:s.AL[e],target:n||s.Rw.None},t))},d=function(e,t,n){var i=n.isIndexColumn,o=n.fieldType,r=n.indexes,a=n.tempFrozenColCount;if(Object(s.kD)(e)){var c=e.getFrozenColumnCount(),l=c,d=r[0],b=e.mapVisibleColToRealCol(d);(t===s.BL.InsertLeft?b:b+1)<c&&(l+=1);var u=0===a?0:e.mapVisibleColToRealCol(a-1)+1;if(c!==l)return void p(t,{is_index_column:i,field_type:o,before_freeze_field_count:c,after_freeze_field_count:l,is_temporary_frozen:(u<l).toString()})}p(t,{is_index_column:i,field_type:o})}},vb413:function(e,t,n){"use strict";n.d(t,"a",function(){return u}),n.d(t,"b",function(){return i}),n.d(t,"c",function(){return o}),n.d(t,"d",function(){return r}),n.d(t,"e",function(){return c}),n.d(t,"f",function(){return s}),n.d(t,"g",function(){return b}),n.d(t,"h",function(){return d}),n.d(t,"i",function(){return l});var a=n("vb143"),i=function(e){var t=e.permission,n=e.editable,i=e.tableId,o=e.recordId,r=e.viewId;return n&&t.hasPermission(a.qy.Record,{tableId:i,viewId:r,recordId:o},a.ry.Editable)},o=function(e){var t=e.fieldId,n=e.permission,i=e.tableId;return n.hasPermission(a.qy.Field,{tableId:i,fieldId:t},a.ry.Editable)},r=function(e){var t=e.permission,n=e.tableId;return t.hasPermission(a.qy.Field,{tableId:n},a.ry.Addable)},c=function(e){var t=e.permission,n=e.tableId,i=e.fieldId;return t.hasPermission(a.qy.Field,{tableId:n,fieldId:i},a.ry.Copyable)},l=function(e){var t=e.permission,n=e.view,i=e.tableId,o=e.fieldIndexes,r=n.getVisibleFields();return o.map(function(e){return r[e]}).every(function(e){return t.hasPermission(a.qy.Field,{tableId:i,viewId:n.id,fieldId:e},a.ry.Deletable)})},d=function(e){var t=e.permission,n=e.tableId;return t.hasPermission(a.qy.View,{tableId:n},a.ry.Addable)},b=function(e){var t=e.permission,n=e.editable,i=e.tableId;return n&&t.hasPermission(a.qy.Record,{tableId:i},a.ry.Addable)},u=function(e){var t=e.permission,n=e.editable,i=e.tableId,o=e.viewId,r=e.recordId;return n&&t.hasPermission(a.qy.Record,{tableId:i,viewId:o,recordId:r},a.ry.Deletable)},s=function(e){var t=e.permission,n=e.tableId,i=e.viewId;return e.editable&&t.hasPermission(a.qy.View,{tableId:n,viewId:i},a.ry.Editable)}},vb495:function(e,O,_){"use strict";(function(d){_.d(O,"a",function(){return h}),_.d(O,"b",function(){return o}),_.d(O,"c",function(){return l}),_.d(O,"d",function(){return c}),_.d(O,"e",function(){return b}),_.d(O,"f",function(){return u}),_.d(O,"g",function(){return p}),_.d(O,"h",function(){return v}),_.d(O,"i",function(){return m}),_.d(O,"j",function(){return t}),_.d(O,"k",function(){return g}),_.d(O,"l",function(){return s}),_.d(O,"m",function(){return r});var f=_("vb103"),w=_.n(f),C=_("vb143"),n=_("vb292"),e=(_("vb147"),_("vb148"),_("vb110")),i=_.n(e),a=(_("vb152"),_("vb112"),_("vb164"),_("vb167"),_("vb113"),_("vb155"),_("vb116"),_("vb118"),_("vb120"),_("vb174"),_("vb119"),_("vb121"),_("vb117"),_("vb115"),_("vb111"));function t(e){var t=e.text;return Object.assign({},e,{id:n.a.InsertAbove,icon:w.a.createElement(C.IB.AddRightIconSvg,{className:"icon rotate-270"}),text:t||d("bitable.grid_insert_record_above",1)})}function o(e){var t=e.text;return Object.assign({},e,{id:n.a.InsertAbove,icon:w.a.createElement(C.IB.AddLeftIconSvg,{className:"icon rotate-270"}),text:t||d("bitable.grid_insert_record_below",1)})}function r(e){var t=e.text;return Object.assign({},e,{id:n.a.Reminder,text:t||d("smartable.reminder.reminder_helper_title"),icon:w.a.createElement(C.IB.ReminderSvg,{className:"icon"})})}function c(e){var t=e.text;return Object.assign({},e,{id:n.a.Comment,text:t||d("bitable.add_comment"),icon:w.a.createElement(C.IB.CommentSvg,{className:"icon"})})}function l(e){return Object.assign({},e,{id:n.a.CopyLink,text:d("Bitable_Record_CopyRecordLink"),icon:w.a.createElement(C.IB.UrlSvg,{className:"icon"})})}var b=function(e){var t=e.text;return Object.assign({},e,{id:n.a.DeleteRecord,text:t||d("bitable.delete_record"),icon:w.a.createElement(C.IB.DeleteIconSvg,{className:"icon"}),isDivider:!0})},u=function(e){var t=e.text;return Object.assign({},e,{id:n.a.ExpendRow,text:t||d("bitable.expand_record"),icon:w.a.createElement(C.IB.ExpandRecordIconSvg,{className:"icon"})})};function s(e){var t=e.text;return Object.assign({},e,{id:n.a.FilterItem,text:w.a.createElement(C.ix,{className:"bitable-layout-row bitable-layout-cross-center",name:d("bitable.common_filter_from_value")},w.a.createElement("p",{className:"b-menu__field_text"},t||d("common.unnamed_value"))),icon:w.a.createElement(C.IB.FilterSvg,{className:"icon"})})}function p(e){var t=e.text;return Object.assign({},e,{id:n.a.CopyRecord,text:t||d("Bitable_Record_Duplicate"),icon:w.a.createElement(C.IB.CopyIconSvg,{className:"icon"})})}var v=function(e){var t=e.isSyncTable,n=e.isNoSpaceToFreeze;return t?{placement:"top",title:d("Bitable_DataReference_SyncFromOtherBase_ActionNotSupported_Tooltip")}:n?{title:d("Bitable_Freeze_NoSpaceToFreeze_Tooltip")}:void 0};function m(e,t,n){var i=n.tableId,o=n.recordId,r=t.getBasePermission(C.ry.Editable),a=t.hasPermission(C.qy.Record,{tableId:i,recordId:o},C.ry.Editable),c=t.hasPermission(C.qy.Record,{tableId:i,recordId:o},C.ry.Deletable),l=C.wL.getTableRecordOperationPermission(t,i,C.Od.DeleteRecord);r&&a&&!c&&!1===l&&(e.disabled=!0,e.hidden=!1,e.tooltipConfig={title:d("Bitable_AdvancedPermission_NoPermissionToDeleteRecord"),placement:"left"})}function g(e,t,n){C.cz.collectClickEvent(C.Bc.CcmBitableCellEditClick,{field_type:t&&C.lC[t],edit_cell_type:e,click:"cell_content_change",is_empty:n&&0!==String(n).length?"false":"true"})}var y=function(e){var t=e.name,n=e.attachmentToken,i=e.thumbnailUrl,o=e.tableId,r=e.extra,a=e.mimeType,c=e.base64Data,l=Object(f.useState)(),d=Object(C.xz)(l,2),b=d[0],u=d[1],s=Object(f.useState)(),p=Object(C.xz)(s,2),v=p[0],m=p[1];return Object(f.useEffect)(function(){m(Object(C.xL)(t)),i?u(i):C.WI.getBlobUrl({attach:{attachmentToken:n,name:t,tableId:o,extra:r,mimeType:a,base64Data:c},updateCallback:function(e){u(e.coverUrl)},quality:C.yL.HIGH,isUseCacheBeforeFetchNew:!0})},[n,i,t,o,r,a,c]),w.a.createElement("div",{className:"attachment-popover-container"},w.a.createElement("div",{className:"attachment-popover-title"},t),w.a.createElement("div",{className:"attachment-popover-img-container"},b?w.a.createElement("img",{className:"attachment-popover-img",src:b}):w.a.createElement("img",{className:"attachment-popover-default-img",src:v})))},I=["rect"],h=function(o){function r(){var e;Object(C.ov)(this,r);for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return(e=o.call.apply(o,[this].concat(n))||this).state={visible:!1,contentProps:null,rectStyle:{top:"0",left:"0",width:"0",height:"0"}},e}return Object(C.bu)(r,o),Object(C.Pw)(r,[{key:"show",value:function(e){var t=this,n=e.rect,i=Object(C.nA)(e,I);this.setState({rectStyle:{top:"".concat(n.y,"px"),left:"".concat(n.x,"px"),width:"".concat(n.width,"px"),height:"".concat(n.height,"px")}},function(){t.setState({visible:!0,contentProps:i})})}},{key:"hide",value:function(){this.setState({visible:!1})}},{key:"render",value:function(){var e=this.state,t=e.contentProps,n=e.visible,i=e.rectStyle;return w.a.createElement(a.Popover,{content:t?w.a.createElement(y,t):null,visible:n,overlayClassName:"attachment-popover-overlay"},w.a.createElement("div",{style:Object.assign({position:"fixed",pointerEvents:"none",zIndex:-999},i)}))}}],[{key:"open",value:function(t){r.instantiation?r.instantiation.show(t):(r.dom||(r.dom=document.createElement("div"),document.body.appendChild(r.dom)),i.a.render(w.a.createElement(r,{ref:function(e){return r.instantiation=e}}),r.dom,function(){var e;return null===(e=r.instantiation)||void 0===e?void 0:e.show(t)}))}},{key:"close",value:function(){var e;null===(e=r.instantiation)||void 0===e||e.hide()}}]),r}(f.PureComponent);h.dom=null,h.instantiation=null}).call(this,_("vb163"))},vb653:function(e,d,b){"use strict";(function(f){b.d(d,"a",function(){return a}),b.d(d,"b",function(){return r});var t,i,o,e=b("vb152"),u=b.n(e),w=b("vb143"),n=(b("vb147"),b("vb103")),C=b.n(n),c=(b("vb148"),b("vb356")),l=b("vb358"),g=(o=Object(w.uY)(u.a.mark(function e(t,n,i){var o,r,a,c,l,d,b;return u.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(o=t.bitableStore,r=t.renderer,a=t.operate,c=o.base,!(l=c.getTableById(n))){e.next=11;break}return e.next=6,a.tableOperate.copyView({tableId:n,viewId:i});case 6:if(!(d=e.sent)||d.result!==w.Ey.Success){e.next=11;break}return b=l.views[d.data.index],r.switchView(o.base,n,d.data.viewId),e.abrupt("return",b);case 11:return e.abrupt("return",null);case 12:case"end":return e.stop()}},e)})),function(e,t,n){return o.apply(this,arguments)}),s=function(t){return new Promise(function(e){Object(w.HU)({title:f("bitable.view_attribute_unlock_popup_title"),content:C.a.createElement(w.ix,{name:f("bitable.view_attribute_unlock_popup_description")},C.a.createElement("span",{className:"bitable-view-unlock-confirm-modal-view-name"},t)),enableCancelButton:!0,wrapClassName:"bitable-view-unlock-confirm-modal",onOk:function(){return e(!0)},onCancel:function(){return e(!1)},okText:f("common.confirm"),cancelText:f("common.cancel")})})},y=(i=Object(w.uY)(u.a.mark(function e(t,n,i){var o,r,a,c,l,d,b;return u.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(o=t.bitableStore,r=o.base,!(a=r.getTableById(n))){e.next=11;break}if(c=a.getViewById(i)){e.next=7;break}return e.abrupt("return");case 7:return e.next=9,s(c.name);case 9:e.sent&&(w.ob.collectBitableEvent(w.On.BitableViewAttribute,{tableId:n,viewId:i,bitable_view_type:w.Cz[c.type],source:t.source,action:"confirm",attribute:w.YB[w.fB.PUBLIC]}),l=o.getCommandManager(),(d=l.execute({cmd:w.Fy.SetViewPublicLevel,tableId:n,viewId:i,publicLevel:w.fB.PUBLIC}))&&d.result===w.Ey.Success&&(b="un_lock_toast_key",w.ob.Toast.show({key:b,type:"success",content:f("bitable.view_attribute_unlock_successfully"),duration:3e3})));case 11:case"end":return e.stop()}},e)})),function(e,t,n){return i.apply(this,arguments)}),r=function(e){var a=e.renderer,t=e.bitableStore;if(t.getBasePermission(w.ry.Editable)){var c=a.getActiveTableId(),n=a.getActiveView();if(n&&n.viewPermission.publicLevel===w.fB.LOCKED){var i,l=n.id,d=a.reduxStore,o=function(){var e=d.getState(),t=e&&e.bitable&&e.bitable.Tables&&e.bitable.Tables.tableMap,n=!!t[c],i=n&&t[c].viewMap[l],o=a.getActiveViewId()===l,r=i&&t[c].viewMap[l].publicLevel===w.fB.LOCKED;!(n&&i&&r&&o)&&m()},r=function(){t.getBasePermission(w.ry.Editable)||m()},b=d.subscribe(o);t.getPermissionStore().subscribe(r);var u={tableId:c,viewId:l,bitable_view_type:w.Cz[n.type],source:e.source},s=function(){w.ob.collectBitableEvent(w.On.BitableViewProtectPopup,Object.assign({},u,{action:"unprotect"})),y(e,c,l)},p=function(){w.ob.collectBitableEvent(w.On.BitableViewProtectPopup,Object.assign({},u,{action:"saveas"})),g(e,c,l)},v=t.hasPermission(w.qy.View,{tableId:c,viewId:l},w.ry.Editable)&&t.hasPermission(w.qy.View,{tableId:c,viewId:l},w.ry.Lockable);i=Object(w.HU)({title:f("Bitable_AdvancedPermission_ViewLocked_Title"),content:C.a.createElement("div",{className:"bitable-layout-row bitable-layout-cross-center"},C.a.createElement("span",{className:"bitable-view-locked-tip-modal-text"},f("bitable.view_attribute_cannot_edit"))),maskClosable:!0,wrapClassName:"bitable-view-locked-tip-modal",enableCancelButton:v,cancelButtonProps:{onClick:function(){s(),m()}},onOk:function(){p(),m()},onCancel:m,cancelText:f("bitable.view_attribute_button_unlock"),okText:f("bitable.view_attribute_button_save_as")})}}function m(){i&&i(),b&&b(),t.getPermissionStore().unsubscribe(r)}},a=(t=Object(w.uY)(u.a.mark(function e(t){var n,i,o,r,a;return u.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.viewId,i=t.tableId,o=t.renderer,r=t.recordId,a=t.fieldId,e.next=3,Object(c.a)({viewId:n,tableId:i,recordId:r,fieldId:a,onCopy:function(){var t=Object(w.uY)(u.a.mark(function e(t){return u.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,o.clipboardHelper.setClipboardValue(t);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e)}));function e(e){return t.apply(this,arguments)}return e}()});case 3:Object(l.a)(w.LK.CopyRecordLink);case 4:case"end":return e.stop()}},e)})),function(e){return t.apply(this,arguments)})}).call(this,b("vb163"))}}]);
//# sourceMappingURL=//slardar.bytedance.net/api_v2/browser/jserr/get_sourcemap?bid=docs_pc&js_filename=vendors-kanban-view-layer.7e1d15113a.chunk.js