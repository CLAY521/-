(window.webpackJsonp=window.webpackJsonp||[]).push([["676ae28109f6"],{vb1303:function(e,Re,Le){"use strict";Le.r(Re),function(k){Le.d(Re,"GridViewLayer",function(){return Ve});var Q=Le("vb143"),e=Le("vb152"),w=Le.n(e),l=Le("vb145"),o=Le("vb180"),ee=Le("vb103"),te=Le.n(ee),t=Le("vb110"),a=Le.n(t),d=(Le("vb448"),Le("vb147"),Le("vb148"),Le("vb153")),r=(Le("vb112"),Le("vb164"),Le("vb167"),Le("vb113"),Le("vb118"),Le("vb116"),Le("vb120"),Le("vb114")),i=Le("vb127"),ie=Le("vb382"),g=Le("vb342"),n=Le("vb159"),c=Le.n(n),p=(Le("vb155"),Le("vb174"),Le("vb119")),C=(Le("vb121"),Le("vb117"),Le("vb115"),Le("vb653")),s=Le("vb543"),u=Le("vb104"),b=Le.n(u),y=Le("vb111"),S=Le("vb292"),I=Le("vb358"),F=Le("vb326"),_=Le("vb413"),j=Le("vb495"),v=Le("vb185");Le("vb129"),Le("vb223"),Le("vb214"),Le("vb232"),Le("vb187"),Le("vb225"),Le("vb224"),Le("vb128"),Le("vb122"),Le("vb233"),Le("vb234"),Le("vb235"),Le("vb123"),Le("vb236"),Le("vb193"),Le("vb237"),Le("vb238"),Le("vb124"),Le("vb239"),Le("vb240"),Le("vb134"),Le("vb131"),Le("vb226"),Le("vb241"),Le("vb125"),Le("vb242"),Le("vb132"),Le("vb227"),Le("vb135"),Le("vb228"),Le("vb229"),Le("vb133"),Le("vb126"),Le("vb243"),Le("vb262"),Le("vb244"),Le("vb245"),Le("vb246"),Le("vb247"),Le("vb194"),Le("vb248"),Le("vb249"),Le("vb201"),Le("vb260"),Le("vb267"),Le("vb250"),Le("vb136"),Le("vb251"),Le("vb130"),Le("vb252"),Le("vb356");function h(e,t,i){var n=e.getService(Q.kx.PERMISSION);n&&n.enabled&&n.getCalcService().getTablePermLevel(t)===Q.Os.READ||e.sendCursor(t,i)}function f(e){var t=e.items,i=e.itemClassName,n=e.wrapperClassName;return e.loading?te.a.createElement("div",{className:c()("bitable-data-counter",n)},te.a.createElement("div",{className:c()("bitable-data-counter-item",i)},k("bitable.formula.calculating"))):te.a.createElement("div",{className:c()("bitable-data-counter",n)},t.map(function(e){return te.a.createElement("div",{key:e.key,className:c()("bitable-data-counter-item",i,e.className)},te.a.createElement("span",null,e.header),": ",te.a.createElement("span",null,e.result))}))}function m(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:3,i=e.toString().split(".")[1]||"";return Object(Q.CL)(e,Math.min(i.length,t))}var O=15;function x(e,t){return Object(r.shallowEqual)(e.records,t.records)&&Object(r.shallowEqual)(e.fields,t.fields)&&e.table===t.table}var E,T=function(i){function n(e){var t;return Object(Q.ov)(this,n),(t=i.call(this,e)||this).nonBlockingIter=null,t.state={sum:0,cellCount:0,calcCellCount:0,calculating:!1},t}return Object(Q.bu)(n,i),Object(Q.Pw)(n,[{key:"componentDidMount",value:function(){this.handleUpdateCalcItems()}},{key:"shouldComponentUpdate",value:function(e,t){return!x(this.props,e)||!Object(r.shallowEqual)(t,this.state)}},{key:"componentDidUpdate",value:function(e){x(e,this.props)||this.handleUpdateCalcItems()}},{key:"componentWillUnmount",value:function(){this.nonBlockingIter&&(this.nonBlockingIter.abort(),this.nonBlockingIter=null)}},{key:"handleUpdateCalcItems",value:function(){var t=Object(Q.uY)(w.a.mark(function e(t){var i,n,o,d,c,s,u,b,l=this;return w.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(i=t||this.props,n=i.records,o=i.fields,d=i.table,n&&0!==n.length&&o&&0!==o.length){e.next=3;break}return e.abrupt("return");case 3:this.nonBlockingIter&&(this.nonBlockingIter.abort(),this.setState({sum:0,cellCount:0,calcCellCount:0})),this.setState({calculating:!0}),c=d.fields,this.nonBlockingIter=new Q.EL(o,n).nonBlocking(new p.FIdleScheduler(Q.FL)),b=u=s=0,this.nonBlockingIter.forEach(function(e){var t=e[0],i=t.fieldId,n=t.recordId,o=c[i],l=d.getCellValue(n,i,!1);if(null!=l||o.type===Q.og.Checkbox){u++;var r=Object(Q.GL)(o).field;if(Q.sy.instance.get(o.type).calcable&&Q.sy.instance.get(r.type).calcable){var a=o.cellValueToNumber(l);Number.isNaN(a)||(s+=a,b++)}}}).then(function(){l.setState({sum:s,cellCount:u,calcCellCount:b})}).catch(function(e){console.log("abort nonBlockingIter",e)}).finally(function(){l.setState({calculating:!1}),l.nonBlockingIter=null});case 11:case"end":return e.stop()}},e,this)}));function e(e){return t.apply(this,arguments)}return e}()},{key:"getViewerItems",value:function(){var e=this.props,t=e.records,i=e.fields;if(!t||0===t.length||!i||0===i.length)return[];var n=this.state,o=n.calcCellCount,l=n.cellCount,r=Object(Q.DL)(this.state.sum,O),a=0<o?Object(Q.DL)(r/o,O):0;return[{header:k("bitable.stat.average"),key:"average",result:m(a)},{header:k("bitable.stat.count"),key:"count",result:l},{header:k("bitable.stat.sum"),key:"sum",result:m(r)}]}},{key:"render",value:function(){var e=this.props,t=e.records,i=e.fields,n=e.commentBarOpened;if(!t||0===t.length||!i||0===i.length)return null;var o=c()("bitable-grid-data-counter",{"comment-opened":n});return te.a.createElement(f,{loading:this.state.calculating,wrapperClassName:o,items:this.getViewerItems()})}}]),n}(te.a.Component),B=Object(r.connect)(function(e){return{commentBarOpened:Object(Q.UF)(e)}})(T),V=Object(Q.Uy)(Object(Q.uY)(w.a.mark(function e(){return w.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Le.e("2baeb21d1326").then(Le.bind(null,"vb1952"));case 2:return e.abrupt("return",e.sent.NewCardEditor);case 3:case"end":return e.stop()}},e)}))),ne=Object(Q.Ty)(b()({loader:function(){var e=Object(Q.uY)(w.a.mark(function e(){return w.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Le.e("f457c545a9de").then(Le.bind(null,"vb1305"));case 2:return e.abrupt("return",e.sent.FieldDescription);case 3:case"end":return e.stop()}},e)}));function t(){return e.apply(this,arguments)}return t}(),loading:Q.HL})),oe=Object(Q.Ty)(b()({loader:function(){var e=Object(Q.uY)(w.a.mark(function e(){return w.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Le.e("73278a4a8696").then(Le.bind(null,"vb1953"));case 2:return e.abrupt("return",e.sent.EditFieldDescription);case 3:case"end":return e.stop()}},e)}));function t(){return e.apply(this,arguments)}return t}(),loading:Q.HL})),R=50,L=function(e,t){if(!e||1!==e.length||!e[0])return null;var i=e[0],n=i.row,o=i.col,l=i.rowCount,r=i.colCount;return t?{recordId:t.getVisibleRecords()[n],fieldId:t.getVisibleFields()[o],row:n,col:o,rowCount:l,colCount:r}:void 0},D=function(e){return!!(e&&0<e.length&&(1<e.length||e[0]&&1<e[0].rowCount))},M=function(e){return 1<e.length},P=function(e){return e.includes(0)},N=function(e,t){var n=[],o=t.getVisibleRecords();return e.forEach(function(e){if(e)for(var t=e.row,i=t+(e.rowCount?e.rowCount:1);t<i;t++)n.push(o[t])}),Object(Q.hI)(new Set(n))},z=function(e){var n=e.field,t=e.recordId,i=e.table,o=e.filterInfo;if(n&&t){var l=i.getCellValue(t,n.id);if(l){var r=o||{},a=r.conjunction,d=r.conditions,c=d&&d.some(function(e){switch(e.fieldType){case Q.og.DateTime:case Q.og.CreatedTime:case Q.og.ModifiedTime:if(e.fieldId!==n.id)return!1;if(!e.value)return e.operator!==Q.Xw.IsNotEmpty;var t=e.value[0],i=e.value[1];return t!==Q.IL.ExactDate||i;default:return e.fieldId===n.id&&e.value}});if(d&&a!==Q.ky.Or&&!c&&d.length<R||!d)return Q.sy.instance.get(n.type).getContextMenuFilterData(n,l)}}return null},W=["max","min","onChange","className"],H=function(t){function i(e){var r;return Object(Q.ov)(this,i),(r=t.call(this,e)||this).handleChange=function(e){var t=Object(Q.Cx)(r).props,i=t.max,n=t.min,o=e.target.value;o=o&&o.replace(/([^0-9]+)/g,"");var l=parseInt(o,10);void 0!==(l=isNaN(l)?void 0:l)&&(Object(d.a)(i)&&i<l&&(l=i),Object(d.a)(n)&&l<n&&(l=n)),t.onChange&&t.onChange(l),r.setState({value:l})},r.state={value:r.props.value||1},r}return Object(Q.bu)(i,t),Object(Q.Pw)(i,[{key:"render",value:function(){var e=this.props;e.max,e.min,e.onChange;var t=e.className,i=Object(Q.nA)(e,W),n=this.state.value;return te.a.createElement("input",Object(Q.Kx)({},i,{value:n,className:c()("bitable-input-number",t),onChange:this.handleChange,onClick:this.props.onClick}))}}]),i}(te.a.PureComponent),U=function(t){var e=Object(ee.useState)(1),i=Object(Q.xz)(e,2),n=i[0],o=i[1],l=function(e){null!=e&&(o(e),t.onChange&&t.onChange(e))},r=function(e){e.stopPropagation()};return te.a.createElement(Q.ix,{name:t.text},te.a.createElement(H,{className:"sheet-menu__input-number",value:n,min:1,max:100,onClick:function(e){return e.stopPropagation()},onKeyUp:function(e){return t.onKeyUp&&t.onKeyUp(e)},onKeyDown:r,onChange:l,disabled:t.disabled}))};function K(e,t,i,n){return Q.sy.instance.get(e).renderContextMenuOrderText(t,i,n)||te.a.createElement("div",{className:c()("order",i),style:n},k(t?"bitable.Z_to_A":"bitable.A_to_Z"))}var q,Y=function(e,t){var i,n=e.selections,o=e.groupValues,l=e.addRecordInCard,r=e.permission,a=e.editable,d=e.tableId,c=e.operator,s=e.view,u=e.isSyncTable,b=D(n),p=1,v=(null===(i=n[0])||void 0===i?void 0:i.row)||0,f=s.getGroupFields().some(function(e){return!r.hasPermission(Q.qy.Field,{tableId:d,fieldId:e.id},Q.ry.Submittable)}),m=Object(j.h)({isSyncTable:u}),h=!u&&!Object(_.g)({permission:r,editable:a,tableId:d})||b,g=function(){c.onInsertRow(o,p,v,Q.qC.Up),Object(I.a)(Q.LK.InsertAbove),t&&t()},w=te.a.createElement(U,{text:k("bitable.grid_insert_record_above"),onKeyUp:function(e){return ce(e,g)},onChange:function(e){return p=e},disabled:f||u});return Object(j.j)(l?{hidden:h,onClick:g,disabled:u,tooltipConfig:m}:{text:w,hidden:h,onClick:g,disabled:f||u,tooltipConfig:m})},J=function(e,t){var i,n=e.selections,o=e.groupValues,l=e.addRecordInCard,r=e.permission,a=e.editable,d=e.tableId,c=e.operator,s=e.view,u=e.isSyncTable,b=D(n),p=1,v=(null===(i=n[0])||void 0===i?void 0:i.row)||0,f=!u&&!Object(_.g)({permission:r,editable:a,tableId:d})||b,m=s.getGroupFields().some(function(e){return!r.hasPermission(Q.qy.Field,{tableId:d,fieldId:e.id},Q.ry.Submittable)}),h=Object(j.h)({isSyncTable:u}),g=function(){c.onInsertRow(o,p,v,Q.qC.Down),Object(I.a)(Q.LK.InsertAbove),t&&t()},w=te.a.createElement(U,{text:k("bitable.grid_insert_record_below"),onKeyUp:function(e){return ce(e,g)},onChange:function(e){return p=e},disabled:m||u});return Object(j.b)(l?{hidden:f,onClick:g,disabled:u,tooltipConfig:h}:{text:w,hidden:f,onClick:g,disabled:m||u,tooltipConfig:h})},Z=function(e){var t=e.selections,i=e.editable,n=e.tableId,o=e.view,l=e.permission,r=e.recordId,a=e.operator,d=D(t),c=Q.ob.config.ui.disableRecordCardMode||d,s=Object(_.b)({tableId:n,editable:i,permission:l,viewId:o.id})?k("bitable.card_edit"):k("bitable.expand_record");return Object(j.f)({text:s,onClick:function(){a.onShowEditPopup(r),Object(I.a)(Q.LK.ExpandRecord,{target:Q.Rw.CcmBitableCardView})},hidden:c})},X=function(e){var t=e.selections,i=e.fieldId,n=e.recordId,o=e.operator;if(!n||!i)return null;var l=D(t)||Q.ob.config.disableRecordLink;return Object(j.c)({onClick:function(){return o.onCopyLink(n,i)},hidden:l})},le=function(e){var t=e.showComment,i=e.recordId,n=e.operator,o=D(e.selections);return Object(j.d)({hidden:!t||o,onClick:function(){n.onAddComment(i),Object(I.a)(Q.LK.AddComment,{target:Q.Rw.CcmCommentView})}})},re=function(e){var t=e.permission,i=e.tableId,n=e.view,o=e.cellInfo,l=e.cellFilterInfo,r=e.operator;if(!o||!l)return null;var a=o.fieldId,d=o.rowCount,c=o.colCount,s=1===d&&1===c,u=l.text||k("common.unnamed_value"),b=function(){r.onSetFilter(a,l.conditionValue)},p=!s||!t.hasPermission(Q.qy.View,{tableId:i,viewId:n.id},Q.ry.Editable);return Object(j.l)({text:u,hidden:p,onClick:b})},ae=function(e){if(Q.ob.config.disableReminder)return null;var t=e.permission,i=e.editable,n=e.tableId,o=e.view,l=e.cellInfo,r=e.operator,a=e.isSyncTable;if(!l||1!==l.rowCount)return null;var d=!a&&!Object(_.b)({recordId:l.recordId,tableId:n,editable:i,permission:t,viewId:o.id}),c=a,s=Object(j.h)({isSyncTable:a});return Object(j.m)({hidden:d,onClick:function(){r.onSetReminder(Q.mC.CONTEXT_MENU),Object(I.a)(Q.LK.Reminder)},disabled:c,tooltipConfig:s})},de=function(e){var t=e.selections,i=e.permission,n=e.tableId,o=e.editable,l=e.view,r=e.operator,a=e.isSyncTable,d=N(t,l),c=!a&&!Object(_.a)({permission:i,tableId:n,editable:o,viewId:l.id,recordId:d[0]}),s=a,u=Object(j.h)({isSyncTable:a});return Object(j.e)({hidden:c,onClick:function(){r.onDeleteRow(d);var e=1<d.length;Object(I.a)(Q.LK.DeleteRecord,{is_multiple_line:String(e),record_count:d.length})},disabled:s,tooltipConfig:u})},ce=function(e,t){e.stopPropagation(),e.keyCode===Q.sx.Enter&&t&&t()},se=function(e){return{id:S.a.FoldSubGroups,text:k("bitable.close_sub_groups"),icon:te.a.createElement(Q.IB.OpenIconSvg,{className:"icon rotate-270",style:{fontSize:"10px"}}),onClick:function(){e.operator.onToggleSubGroup(e.gridRow,!0)}}},ue=function(e){return{id:S.a.ExpendSubGroups,text:k("bitable.expend_sub_groups"),icon:te.a.createElement(Q.IB.OpenIconSvg,{className:"icon",style:{fontSize:"10px"}}),onClick:function(){e.operator.onToggleSubGroup(e.gridRow,!1)}}},be=function(e,t){var i=e.downgradeMananger,n=e.tableId,o=t.id;return i.checkFieldCantEdit({fieldId:o,tableId:n})},pe=function(e){var t=e.field,i=e.indexes,n=e.permission,o=e.tableId,l=e.operator,r=e.isSyncTable;if(!t)return null;var a=P(i),d=!r&&!Object(_.c)({fieldId:t.id,permission:n,tableId:o})||M(i),c=Object(j.h)({isSyncTable:r});return{id:S.a.ModifyField,text:k("bitable.common_modify_field"),icon:te.a.createElement(Q.IB.EditIconSvg,{className:"icon"}),hidden:d,tooltipConfig:c,disabled:r||be(e,t)||Object(Q.Xy)(t.fieldUIType)||Object(Q.Yy)(t),onClick:function(){l.onOpenFieldModify(i),Object(I.b)(Q.BL.Modify,{is_index_column:null==a?void 0:a.toString(),field_type:Q.lC[t.fieldUIType],target:Q.Rw.CcmBitableFieldModifyView})}}},ve=function(e){var t=e.field,i=e.indexes,n=e.permission,o=e.tableId,l=e.operator,r=e.isSyncTable,a=P(i);if(!t)return null;var d=!r&&!Object(_.c)({fieldId:t.id,permission:n,tableId:o})||M(i),c=r||be(e,t),s=Object(j.h)({isSyncTable:r});return{id:S.a.ModifyDescription,text:k("Bitable_Field_EditFieldDesc"),icon:te.a.createElement(Q.IB.DescriptionIcon,{className:"icon"}),hidden:d,disabled:c,tooltipConfig:s,onClick:function(){l.onOpenFieldDescription(t,i),Object(I.b)(Q.BL.ModifyDescription,{is_index_column:null==a?void 0:a.toString(),field_type:Q.lC[t.fieldUIType],target:Q.Rw.CcmBitableFieldDescriptionModifyView})}}},fe=function(e){var t=e.field,i=e.indexes,n=e.permission,o=e.tableId,l=e.operator,r=e.isSyncTable,a=P(i);if(!t)return null;var d=!r&&(!Object(_.d)({permission:n,tableId:o})||!Object(_.e)({permission:n,fieldId:t.id,tableId:o}))||M(i),c=r||be(e,t),s=Object(j.h)({isSyncTable:r});return{id:S.a.DuplicateField,text:k("bitable.common_copy_field"),icon:te.a.createElement(Q.IB.CopyIconSvg,{className:"icon"}),hidden:d,disabled:c,tooltipConfig:s,onClick:function(){l.onCopyField(t,i),Object(I.b)(Q.BL.Duplicate,{is_index_column:null==a?void 0:a.toString(),field_type:Q.lC[t.fieldUIType]})}}},me=function(e){var t=e.field,i=e.indexes,n=e.permission,o=e.tableId,l=e.view,r=e.operator,a=e.tempFrozenColCount,d=e.isSyncTable,c=P(i);if(!t)return null;var s=!d&&!Object(_.d)({permission:n,tableId:o})||c||M(i),u=d,b=Object(j.h)({isSyncTable:d});return{id:S.a.InsertFieldLeft,text:k("bitable.insert_left"),icon:te.a.createElement(Q.IB.AddLeftIconSvg,{className:"icon"}),hidden:s,isDivider:!0,disabled:u,tooltipConfig:b,onClick:function(){r.onInsertField({fieldIndexes:i,description:"left"}),Object(I.d)(l,Q.BL.InsertLeft,{isIndexColumn:null==c?void 0:c.toString(),fieldType:Q.lC[t.fieldUIType],indexes:i,tempFrozenColCount:a})}}},he=function(e){var t=e.field,i=e.indexes,n=e.permission,o=e.tableId,l=e.view,r=e.operator,a=e.tempFrozenColCount,d=e.isSyncTable,c=P(i);if(!t)return null;var s=!d&&!Object(_.d)({permission:n,tableId:o})||M(i),u=d,b=Object(j.h)({isSyncTable:d});return{id:S.a.InsertFieldRight,text:k("bitable.insert_right"),icon:te.a.createElement(Q.IB.AddRightIconSvg,{className:"icon"}),hidden:s,disabled:u,tooltipConfig:b,onClick:function(){r.onInsertField({fieldIndexes:i,description:"right"}),Object(I.d)(l,Q.BL.InsertRight,{isIndexColumn:null==c?void 0:c.toString(),fieldType:Q.lC[t.fieldUIType],indexes:i,tempFrozenColCount:a})}}},ge=function(e){var t=e.field,i=e.indexes,n=e.view,o=e.tableId,l=e.permission,r=e.editable,a=e.operator,d=e.tempFrozenColCount,c=e.isSyncTable,s=n.type===Q.az.Grid,u=!Object(_.f)({permission:l,tableId:o,viewId:n.id,editable:r})||!s||M(i),b=i[i.length-1],p="number"==typeof d&&d<=b,v=c||p,f=Object(j.h)({isSyncTable:c,isNoSpaceToFreeze:p});return{id:S.a.FrozenField,text:k("Bitable_Freeze_MenuOption"),icon:te.a.createElement(Q.IB.FrozenIconSvg,{className:"icon"}),hidden:u,disabled:v,tooltipConfig:f,onClick:function(){a.onSetFrozenColumn(t,i)}}},we=function(e){var t=e.field,i=e.indexes,n=e.permission,o=e.tableId,l=e.view,r=e.editable,a=e.operator,d=P(i);if(!t)return null;var c=!Object(_.f)({permission:n,tableId:o,viewId:l.id,editable:r})||M(i);return{id:S.a.SetSortAZ,text:te.a.createElement(Q.ix,{className:"bitable-layout-row bitable-layout-cross-center",name:k("bitable.common_sort_from_field")},K(t.type,!1,"bitable-layout-row bitable-layout-cross-center order-padding",{padding:"0 5px"})),hidden:c,isDivider:!0,icon:te.a.createElement(Q.IB.SortAtoZ,{className:"icon"}),onClick:function(){a.onSetSort(t,!1),Object(I.b)(Q.BL.SortAtoZ,{is_index_column:null==d?void 0:d.toString(),field_type:Q.lC[t.fieldUIType]})}}},Ce=function(e){var t=e.field,i=e.indexes,n=e.permission,o=e.tableId,l=e.view,r=e.editable,a=e.operator,d=P(i);if(!t)return null;var c=!Object(_.f)({permission:n,tableId:o,viewId:l.id,editable:r})||M(i);return{id:S.a.SetSortZA,text:te.a.createElement(Q.ix,{className:"bitable-layout-row bitable-layout-cross-center",name:k("bitable.common_sort_from_field")},K(t.type,!0,"bitable-layout-row bitable-layout-cross-center order-padding",{padding:"0 5px"})),icon:te.a.createElement(Q.IB.SortZtoA,{className:"icon"}),hidden:c,onClick:function(){a.onSetSort(t,!0),Object(I.b)(Q.BL.SortZtoA,{is_index_column:null==d?void 0:d.toString(),field_type:Q.lC[t.fieldUIType]})}}},ye=function(e){var t=e.field,i=e.indexes,n=e.groupInfo,o=e.view,l=e.permission,r=e.tableId,a=e.editable,d=e.operator,c=P(i),s=!!n&&n.some(function(e){return e.fieldId===t.id}),u=!n||n.length<Q.JL[o.type],b=!Object(_.f)({permission:l,tableId:r,viewId:o.id,editable:a})||!(u||s)||M(i);return{id:S.a.SetGroup,text:te.a.createElement(Q.ix,{className:"bitable-layout-row bitable-layout-cross-center",name:k(s?"Bitable_Field_Ungroup":"bitable.common_group_from_field")},te.a.createElement("p",{className:"b-menu__field_text"},t.name)),icon:te.a.createElement(Q.IB.GroupIcon,{className:"icon"}),onClick:function(){d.onSetGroup(t),Object(I.b)(Q.BL.SetGroup,{is_index_column:null==c?void 0:c.toString(),field_type:Q.lC[t.fieldUIType]})},hidden:b,isDivider:!0}},Ie=function(e){var t=e.field,i=e.indexes,n=e.groupInfo,o=e.view,l=e.permission,r=e.tableId,a=e.editable,d=e.operator;if(!t)return null;var c=P(i),s=!n||n.length<Q.JL[o.type],u=!Object(_.f)({permission:l,tableId:r,viewId:o.id,editable:a})||M(i);return{id:S.a.SetFilter,text:te.a.createElement(Q.ix,{className:"bitable-layout-row bitable-layout-cross-center",name:k("bitable.common_filter_from_value")},te.a.createElement("p",{className:"b-menu__field_text"},t.name)),icon:te.a.createElement(Q.IB.FilterSvg,{className:"icon"}),hidden:u,onClick:function(){d.onShowFilter(i),Object(I.b)(Q.BL.SetFilter,{is_index_column:null==c?void 0:c.toString(),field_type:Q.lC[t.fieldUIType]})},isDivider:!s}},Fe=function(e){var t=e.tableId,i=e.field,n=e.permission,o=e.addViewInfo,l=e.operator,r=e.indexes,a=P(r);if(!i||!o)return null;var d=!Object(_.h)({permission:n,tableId:t})||M(r),c=o.createViewText,s=o.createViewType,u=o.property,b=o.createViewName,p=o.createViewIcon;return{id:S.a.CreateView,text:c,icon:p,hidden:d,onClick:function(){l.onCreateNewView(s,u,b),Object(I.b)(Q.BL.CreateView,{is_index_column:null==a?void 0:a.toString(),field_type:Q.lC[i.fieldUIType],create_view_type:Q.Cz[s]})}}},_e=function(e){var t=e.indexes,i=e.field,n=e.permission,o=e.tableId,l=e.view,r=e.editable,a=e.operator,d=P(t);if(!i)return null;var c=!Object(_.f)({permission:n,tableId:o,viewId:l.id,editable:r})||d;return{id:S.a.HideField,text:k("bitable.hide_column"),icon:te.a.createElement(Q.IB.InvisibleIconSvg,{className:"icon"}),onClick:function(){a.onHideField(t),Object(I.b)(Q.BL.HideColumn,{is_index_column:null==d?void 0:d.toString(),field_type:Q.lC[i.fieldUIType]})},hidden:c}},Se=function(e){var t,i,n=e.field,o=e.operator,l=!(null!==(t=(i=Q.ob.CommonUtil).checkHasDownloadPermission)&&void 0!==t&&t.call(i))||!Object(Q.uy)(n.type)||Q.ob.config.disableAttachmentDownload;return{id:S.a.ExportAttachment,text:k("Bitable_Download_BatchDownloadAttachment"),icon:te.a.createElement(Q.IB.DownloadIconSvg,{className:"icon"}),onClick:function(){o.onExportAttachment(n.id),Object(I.b)(Q.BL.DownloadAttachment,void 0,Q.Rw.CcmBitableExportSettingView)},isDivider:!0,hidden:l}},Oe=function(e){var t=e.indexes,i=e.permission,n=e.tableId,o=e.view,l=e.field,r=e.operator,a=e.isSyncTable,d=P(t),c=!a&&!Object(_.i)({fieldIndexes:t,permission:i,tableId:n,view:o})||d,s=a,u=Object(j.h)({isSyncTable:a});return{id:S.a.DeleteField,text:1<t.length?k("bitable.delete_fields"):k("bitable.delete_field"),icon:te.a.createElement(Q.IB.DeleteIconSvg,{className:"icon"}),onClick:function(){r.onDeleteField(l,t),Object(I.b)(Q.BL.DeleteColumn,{is_index_column:null==d?void 0:d.toString(),field_type:Q.lC[l.fieldUIType]})},hidden:c,isDivider:!0,disabled:s,tooltipConfig:u}},xe=(Object(Q.Ww)(E={},S.b.GridContentContextMenu,[Y,J,Z,X,le,re,ae,de]),Object(Q.Ww)(E,S.b.GridGroupTitleContextMenu,[se,ue]),Object(Q.Ww)(E,S.b.GridFieldHeaderMenu,[pe,ve,fe,_e,me,he,ge,we,Ce,ye,Ie,Fe,Se,Oe]),E);function Ee(e,t,i,n,o){var l=e.getViewById(t);return l?Q.sy.instance.get(i.type).getContextMenuAddViewData(i,e,l,n,o):null}var Te=180,ke=420,je=Q.JK-Q.KK,Be={offsetDown:36,offsetUp:0},Ve=Object(Q.oA)(function(e,t){var i=e.operate,n=e.base,o=t.tableId,l=t.viewId;return{onFieldsDelete:function(e){return i.tableOperate.delFields({tableId:o,viewId:l,fieldIds:e})},base:n}})(q=Object(v.b)(function(e){var t=e.toolbarStore;return{setFloatToolbarVisibility:t.toggleFloatToolbar,toggleFilter:t.toggleFilter}})(q=Object(r.connect)(function(e,t){var i=Object(Q.Fz)(e),n=i&&i.status.translated;return{isNotDefaultMode:Object(Q.yx)(e),isFieldEditPanelOpen:Object(Q.KL)(e,t.tableId),fullScreenTableId:Object(Q.DG)(e),onboardingGridTableId:Object(Q.gI)(e),onboardingKanbanTableId:Object(Q.fI)(e),haveCommentPermission:Object(Q.Hz)(e)&&!n,isPureBitable:Object(Q.Ay)(e),filterInfo:Object(Q.LL)(e,t.tableId,t.viewId),editing:Object(Q.ML)(e,t.tableId),isCommentDataInit:Object(Q.By)(e)}},function(e){return Object(i.bindActionCreators)({toggleFieldEditPanel:Q.NL},e)},null,{areStatePropsEqual:function(e,t){return Object(s.a)(t,e,["view"])}})(q=function(t){function n(e){var T,i;return Object(Q.ov)(this,n),(T=t.call(this,e)||this).prevActiveCell=null,T.headerSelected=!1,T.selfDom=null,T.hyperLinkRef=null,T.addDownRowCount=1,T.addUpRowCount=1,T.windowResizeCb=Object(o.a)(function(){var e=T.props.renderer.activeBitableWidget;if(T.props.isFieldEditPanelOpen||T.state.showStatList){var t={col:T.state.currentCol,row:T.state.currentRow},i=e.getGridWidget().getCellVisualRect(t),n=T.state.editFieldPosition,o=T.validateFieldPositionX(i.x);T.props.isFieldEditPanelOpen&&o!==n.x&&T.setState({editFieldPosition:{x:o,y:T.colHeaderBottom}})}},300),T.hiddenNewField=function(){var e=T.props.renderer;T.toggleFloatToolbarVisibility(!1),e.eventManager.emit(Q.ay.ExitFieldCardEdit),T.state.showNewField&&T.setState({showNewField:!1})},T.toggleFloatToolbarVisibility=function(e){var t=T.props,i=t.bitableStore,n=t.isFullScreenMode,o=t.setFloatToolbarVisibility;i.isEmbeddedInDoc&&!n&&(null==o||o(e))},T.collectFieldSetEvent=function(e){Q.ob.collectBitableEvent(Q.On.BitableFieldSet,Object.assign({table_id:T.activeTable.id,view_id:T.activeView.id,bitable_view_type:Q.Cz[T.activeView.type],source:Q.iz.Column},e,{data_source:T.props.bitableStore.Options.module}),!0)},T.collectArggregateEvent=function(e){Q.ob.collectBitableEvent(Q.On.BitableRecordAggregate,Object.assign({table_id:T.activeTable.id,view_id:T.activeView.id,bitable_view_type:Q.Cz[T.activeView.type]},e,{data_source:T.props.bitableStore.Options.module}),!0)},T.collectFieldDeleteWindowEvent=function(e,t){Q.cz.collectClickEvent(Q.Bc.CcmBitableFieldDeleteClick,Object.assign({click:e,scene_type:Q.yE.GridBoard},t))},T.shouldChangeFloatRecordId=function(e){var t=T.props.renderer.activeBitableWidget,i=t.isFloatLayerOpen,n=t.floatRecordId;return i&&e!==n?n:e},T.getGridViewOperator=function(){return{onDeleteRow:T.onDeleteRow,onInsertRow:T.executeAddRecord,onShowEditPopup:T.onShowEditPopup,onAddComment:T.onAddComment,onSetReminder:T.autoSetReminder,onToggleSubGroup:T.onToggleSubGroup,onOpenFieldModify:T.openFieldModify,onOpenFieldDescription:T.openFieldDescription,onCopyField:T.onCopyField,onInsertField:T.onInsertField,onSetFrozenColumn:T.setFrozenColumn,onSetSort:T.onSetSort,onSetGroup:T.setGroup,onShowFilter:T.onShowFilter,onCreateNewView:T.createNewView,onHideField:T.onChangeFieldVisible,onDeleteField:T.onDeleteColumn,onSetFilter:T.onSetFilter,onCopyLink:T.onCopyLink,onExportAttachment:T.onExportAttachment}},T.handleContentContextMenu=function(e){var t=T.props,i=t.editable,n=t.bitableStore,o=t.addRecordInCard,l=t.filterInfo,r=t.haveCommentPermission,a=t.isCommentDataInit,d=t.contextMenuService,c=e.selections,s=e.recordId,u=L(c,T.activeView),b=(null==u?void 0:u.fieldId)||e.fieldId||"",p=T.activeTable.fields[b],v=z({table:T.activeTable,recordId:s,field:p,filterInfo:l}),f=Object(F.b)(n.bitableConfig)&&r&&a,m=T.getGridViewOperator(),h=T.isSyncTable(),g=Object.assign({},e,{tableId:T.activeTable.id,view:T.activeView,editable:i,permission:n.getPermissionStore(),addRecordInCard:o,cellInfo:u,cellFilterInfo:v,showComment:f,operator:m,isSyncTable:h});null==d||d.showContextMenu(S.b.GridContentContextMenu,{getContextMenuConfig:function(){var e;return{x:T.props.contextMenuPositionX,y:T.props.contextMenuPositionY,onShow:function(){T.setState({showNewField:!1}),T.props.smartableCommentManager&&T.props.smartableCommentManager.handleDeactivateComment(),T.ensureFieldEditPanelClose()},hidden:null===(e=T.props.bitableStore.bitableConfig.ui)||void 0===e?void 0:e.disableContextMenu}},getContext:function(){return g}})},T.handleGroupTitleContextMenu=function(e){var t=T.props,i=t.editable,n=t.bitableStore,o=t.contextMenuService,l=T.getGridViewOperator(),r=T.isSyncTable(),a=Object.assign({},e,{tableId:T.activeTable.id,view:T.activeView,editable:i,permission:n.getPermissionStore(),operator:l,isSyncTable:r});null==o||o.showContextMenu(S.b.GridGroupTitleContextMenu,{getContextMenuConfig:function(){var e;return{x:T.props.contextMenuPositionX,y:T.props.contextMenuPositionY,onShow:function(){T.props.smartableCommentManager&&T.props.smartableCommentManager.handleDeactivateComment(),T.ensureFieldEditPanelClose()},hidden:null===(e=T.props.bitableStore.bitableConfig.ui)||void 0===e?void 0:e.disableContextMenu}},getContext:function(){return a}})},T.handleFieldHeaderContextMenu=function(e){var t=T.props,i=t.bitableStore,n=t.editable,o=t.contextMenuService,l=T.activeTable,r=T.activeView,a=Object(Q.YE)(r).getGroupInfo();if(l&&r){var d=T.props.renderer.activeBitableWidget.getGridWidget(),c=e.indexes,s=e.x,u=e.y,b=c.includes(0),p=r.id,v=l.id,f=r.getVisibleFields()[c[0]],m=l.fields[f],h=r.type===Q.az.Gantt,g=Ee(l,p,m,c,h),w=i.getPermissionStore(),C=i.downgradeManager,y=T.getGridViewOperator(),I=d.source.frozen.tempFrozenColumnCount,F=T.isSyncTable(),_=Object.assign({},e,{view:r,field:m,tableId:v,viewId:p,editable:n,permission:w,addViewInfo:g,groupInfo:a,operator:y,tempFrozenColCount:I,downgradeMananger:C,isSyncTable:F});T.ensureFieldEditPanelClose(),T.setState({isFirstField:b,showNewField:!1},function(){null==o||o.showContextMenu(S.b.GridFieldHeaderMenu,{getContextMenuConfig:function(){var e;return{x:s,y:u+Q.vF,className:"b-menu_field",hidden:null===(e=T.props.bitableStore.bitableConfig.ui)||void 0===e?void 0:e.disableContextMenu}},getContext:function(){return _}}),Q.cz.collectBitableEvent(Q.Rw.CcmBitableFieldOperateView,{field_type:Q.lC[m.fieldUIType],is_index_column:null==b?void 0:b.toString()})})}},T.renameGroupValue=function(e,t,i,n,o,l){T.showEditor({showNewCardEditor:Q.OL.RENAME,groupValue:e,groupFieldType:i,renameSource:t,editorNeedUndo:t===Q.cK.NEW_GROUP,fieldId:n,editorWidth:o,gridRow:l})},T.showEditor=function(e){T.setState(e)},T.handleEditorExitEdit=function(){T.hideKanbanEditor()},T.renderNewCardEditor=function(){var e=T.state,t=e.showNewCardEditor,i=e.groupValue,n=e.groupFieldType,o=e.renameSource,l=e.editorNeedUndo,r=e.fieldId,a=e.editorWidth,d=e.gridRow,c=T.props,s=c.viewId,u=c.renderer,b=c.tableId,p=c.editable,v=c.bitableStore,f=c.isFullScreenMode,m=c.viewLayerOverlay,h=c.mountOption,g=c.isOpenSidebar;return t!==Q.OL.NONE&&s?te.a.createElement(V,{editorNeedUndo:l,showNewCardEditor:t,groupValue:i,groupFieldType:n,renameSource:o,tableId:b,viewId:s,bitableStore:v,renderer:u,editable:p,viewLayerOverlay:m,mountOption:h,isOpenSidebar:!!g,isFullScreenMode:!!f,handleEditorExitEdit:T.handleEditorExitEdit,fieldId:r,editorWidth:a,gridRow:d||0}):null},T.onClickHyperLink=function(e){if(e&&T.hyperLinkRef){var t=Object(Q.Cx)(T),i=t.activeTable,n=t.activeView;T.hyperLinkRef.onClickHyperLink(Object.assign({},e,{activeTable:i,activeView:n}))}},T.onClickMention=function(e){var t=Object(Q.Cx)(T),i=t.activeTable,n=t.activeView;Q.lx.openMention(Object.assign({},e,{activeTable:i,activeView:n}))},T.closeContextMenu=function(){T.setState({contextMenuRange:[]},function(){var e;null===(e=T.props.contextMenuService)||void 0===e||e.closeContextMenu(),T.toggleFloatToolbarVisibility(!1)})},T.onDeleteRow=function(e){if(e.length){var t=T.props,i=t.bitableStore,n=t.tableId,o=t.renderer,l=i.getCommandManager(),r=o.activeBitableWidget.getGridWidget(),a=T.activeView;if(!a)return;T.beforeDeleteRecords(e),l.execute({cmd:Q.Fy.DeleteRecords,tableId:n,recordIds:e,viewId:a.id}),r.setSelection(null),Q.ob.collectBitableEvent(Q.On.BitableRecordDelete,{table_id:n,view_id:a.id,bitable_view_type:Q.Cz[a.type],data_source:i.Options.module},!0)}},T.handleTypeChange=function(e,t){var i=T.state.currentCol,n=T.props.renderer.activeBitableWidget.getGridWidget();n.setSelection(null);var o=n.getCellRect({col:i,row:0});T.setState({editFieldPosition:{x:T.validateFieldPositionX(o.x),y:T.colHeaderBottom},currentFieldType:e,currentFieldUIType:t})},T.handleExpandFieldMenu=function(e){var t=e.sourceEventType,i=e.col,n=e.pointPos,o=e.indexes,l=T.props.renderer.activeBitableWidget.getGridWidget();l.setSelection(null);var r=l.getCellRect({col:i,row:0}),a=T.activeView.getVisibleFields()[i],d=T.activeView.table.id,c=T.activeTable.fields[a];T.setState({showNewField:!1,currentCol:i,currentRow:0,editFieldPosition:{x:T.validateFieldPositionX(r.x),y:T.colHeaderBottom},fieldDescriptionEditPanel:Object.assign({},T.state.fieldDescriptionEditPanel,{show:!1}),currentFieldType:c.type,currentFieldUIType:c.fieldUIType,editFieldId:a,isFirstField:!i}),T.toggleFloatToolbarVisibility(!0),"click"===t&&n?T.handleFieldHeaderContextMenu({indexes:o,x:Number(n.pointX),y:Number(n.pointY)}):(T.props.toggleFieldEditPanel(d,!0),Q.ob.collectBitableEvent(Q.On.BitableFieldOpenEditor,{table_id:T.activeTable.id,view_id:T.activeView.id,bitable_view_type:Q.Cz[T.activeView.type],source:t,data_source:T.props.bitableStore.Options.module}))},T.onShowEditPopup=function(e){e&&(T.showCardModalIfEnabled(e,Q.NK.ContextMenu),Q.cz.collectBitableEvent(Q.Rw.CcmBitableCardView,{source:Q.NK.ContextMenu}))},T.onShowEditPopupByCommand=function(){var e=T.props.renderer.activeBitableWidget.getGridWidget().getActiveCell();if(e){var t=e.row,i=T.activeView.getVisibleRecords()[t];T.showCardModalIfEnabled(i,Q.NK.ContextMenu),Q.cz.collectBitableEvent(Q.Rw.CcmBitableCardView,{source:Q.NK.ContextMenu})}},T.showCardModalIfEnabled=function(e,t){if(!Q.ob.config.ui.disableRecordCardMode){var i,n=T.props.renderer.activeBitableWidget.getGridWidget().getActiveCell();if(n){var o=n.col;i=T.activeView&&T.activeView.getVisibleFields()[o]}T.props.showCardModal(e,i),Q.ob.collectBitableEvent(Q.On.BitableCardOpen,{table_id:T.activeTable.id,view_id:T.activeView.id,bitable_view_type:Q.Cz[T.activeView.type],source:t,data_source:T.props.bitableStore.Options.module})}},T.onShowFilter=function(e){var t=T.props,i=t.bitableStore,n=t.renderer,o=t.tableId,l=t.viewId,r=t.operate,a=t.base,d=t.toggleFilter;if(T.activeView&&T.activeView.viewPermission.publicLevel===Q.fB.LOCKED)Object(C.b)({bitableStore:T.props.bitableStore,renderer:n,source:"other",operate:r});else{var c=null==a?void 0:a.getTable(o);if(e.length){var s=i.getCommandManager(),u=T.activeTable.fields,b=[],p=T.activeView.getVisibleFields();if(!c)return;e.forEach(function(e){var t=p[e],i=u[t];b.push({type:Q.PL.AddCondition,condition:Object(Q.QL)(Object(Q.bI)(c),i)})}),Q.ob.collectBitableEvent(Q.On.BitableToolbarFilterAdd,{table_id:o,view_id:l,bitable_view_type:T.activeView&&Q.Cz[T.activeView.type],data_source:i.Options.module,source:Q.gJ.ColumnContextMenu},!0),s.execute({cmd:Q.Fy.SetFilters,tableId:o,viewId:l,conditions:b})}null==d||d(!0),Q.ob.collectBitableEvent(Q.On.BitableToolbarFilterOpen,{table_id:o,view_id:l,bitable_view_type:Q.Cz[T.activeView.type],is_open:1,source:"contextMenu",data_source:i.Options.module})}},T.onAddComment=function(e){var t=T.props,i=t.smartableCommentManager,n=t.mountOption,o=t.renderer,l=(o.activeBitableWidget&&o.activeBitableWidget.getGridWidget()).source.gridView.getVisibleRecords()[0],r=e||l;r&&i&&(i.triggerCreateComment(r,Q.YH.ContextMenu,n),Q.cz.collectBitableEvent(Q.Rw.CcmCommentView,{sub_view:"part_comment"}))},T.executeAddRecord=function(i,e,t,n){var o,l=Object(Q.Cx)(T),r=l.activeTable,a=l.activeView,d=T.props,c=d.bitableStore,s=d.renderer,u=d.addRecordInCard,b=d.tableId,p=d.viewId,v=d.base,f=d.filterInfo,m=null===(o=v.getTable(b))||void 0===o?void 0:o.getView(p),h=null==m?void 0:m.getGroupInfo(),g=c.getCommandManager();if(i&&0!==i.length&&h&&h.forEach(function(e,t){Object(j.k)(Q.PK.AddNewRecord,T.activeTable.fields[e.fieldId].fieldUIType,null===i[t]?"":"true")}),null!=t&&(t=a.getAllRecordIndexById(a.getVisibleRecords()[t]),t=n===Q.qC.Down?t+1:t),Q.ob.config.cardSyncMode===Q.tx.OnDemand||u)T.props.onAddRecord&&T.props.onAddRecord(i,t,n);else{var w=s.activeBitableWidget,C=w.getGridWidget(),y=g.execute({cmd:Q.Fy.AddRecords,tableId:r.id,viewId:a.id,groupCellValues:i||void 0,index:t,count:e});if(y.result!==Q.Ey.Success)return;if(Q.ob.collectBitableEvent(Q.On.BitableRecordAdd,{table_id:T.activeTable.id,view_id:T.activeView.id,bitable_view_type:Q.Cz[T.activeView.type],bitable_record_direction:n||"bottom",data_source:c.Options.module,action:Q.UC.Click,record_number:e},!0),f&&f.conditions.forEach(function(e){var t,i,n=null===(t=T.activeTable)||void 0===t||null===(i=t.getField)||void 0===i?void 0:i.call(t,e.fieldId);Object(j.k)(Q.PK.AddNewRecord,null==n?void 0:n.fieldUIType,e.value)}),y.result!==Q.Ey.Success)return;var I=n===Q.qC.Down?y.data.length-1:0,F=y.data[I].recordId;if(!a.viewFilter.checkConditions(F)){if(1<e)return void Q.ob.Toast.show({type:"info",content:k("bitable.grid_filter_added_record",e),duration:3e3,closable:!1});if(0===a.getVisibleRecords().length||a.type===Q.az.Gantt)return T.props.showCardModal(F,T.activeView&&T.activeView.getAllFields()[0]),Q.ob.collectBitableEvent(Q.On.BitableCardOpen,{table_id:T.activeTable.id,view_id:T.activeView.id,bitable_view_type:Q.Cz[T.activeView.type],source:Q.NK.AddRecord,data_source:c.Options.module}),void Q.cz.collectBitableEvent(Q.Rw.CcmBitableCardView,{source:Q.NK.AddRecord});var _=w.getFloatGridWidget();s.toggleFloatLayerVisible(!0,F,Q.RL.isMeetFilter,!0),C.rebuild();var S=new Q.qK(0,0,1,1);_.setSelection(S)}var O=T.activeView&&T.activeView.table.getPrimaryField(),x=(null==O?void 0:O.type)===Q.og.Formula,E=(null==O?void 0:O.type)===Q.og.DateTime&&O.property.autoFill;if(x||E)return;T.tryToEditRecord(F)}},T.openFieldModify=function(e){T.handleExpandFieldMenu({col:e[0],sourceEventType:Q.gJ.ColumnContextMenu,indexes:e})},T.openFieldDescription=function(e,t){var i=T.props.renderer.activeBitableWidget.getGridWidget();i.setSelection(null);var n=i.getCellRect({col:t[0],row:0}),o=n.x;i.isInGantt||(o=T.validateFieldPositionX(n.x,ke)),T.setState({fieldDescriptionEditPanel:{show:!0,x:o,y:T.colHeaderBottom+Q.vF,fieldId:e.id}})},T.onCopyField=function(e,t){T.onInsertField({fieldId:e.id,fieldIndexes:t,fieldType:e.type,fieldUIType:e.fieldUIType,property:e.property,description:"right_duplicate",isCopy:!0,tableName:T.getTableName()})},T.onSetSort=function(t){var e,i,n,o=1<arguments.length&&void 0!==arguments[1]&&arguments[1],l=T.props,r=l.bitableStore,a=l.tableId,d=l.viewId,c=null===(e=l.base.getTable(a))||void 0===e?void 0:e.getView(d),s=null!==(i=null==c?void 0:c.getSortInfo())&&void 0!==i?i:[],u=null!==(n=null==c?void 0:c.isAutoSort())&&void 0!==n&&n,b=T.activeView,p=s.filter(function(e){return e.fieldId!==t.id}),v=s.some(function(e){return e.fieldId===t.id})?Q.SL.SORT:Q.SL.ADD,f={table_id:a,view_id:d,data_source:r.Options.module,bitable_view_type:b&&Q.Cz[b.type],bitable_field_type:Q.lC[t.fieldUIType],source:Q.gJ.ColumnContextMenu};T.sendSortOrGroupCommand(Q.Fy.SortRecord,{autoSort:!!u,sortInfo:[].concat(Object(Q.hI)(p||[]),[{fieldId:t.id,desc:o}])},Q.On.BitableSetSort,Object.assign({direction:o?Q.nC.InvertedOrder:Q.nC.InOrder,auto_sort:!!u,action:v},f))},T.setGroup=function(t){var e=T.props,i=e.tableId,n=e.viewId,o=e.bitableStore,l=T.activeView,r=Object(Q.YE)(l).getGroupInfo(),a=[];a=r&&r.some(function(e){return e.fieldId===t.id})?(r||[]).filter(function(e){return e.fieldId!==t.id}):[].concat(Object(Q.hI)(r||[]),[{fieldId:t.id,desc:!1}]);var d={table_id:i,view_id:n,data_source:o.Options.module,bitable_view_type:l&&Q.Cz[l.type],bitable_field_type:Q.lC[t.fieldUIType],source:Q.gJ.ColumnContextMenu};T.sendSortOrGroupCommand(Q.Fy.SetGroup,{group:a},Q.On.BitableSetGroup,Object.assign({},d,{action:Q.SL.ADD,direction:Q.nC.InOrder}))},T.onChangeFieldVisible=function(e){var t=T.props,i=t.bitableStore,n=t.renderer,o=t.operate;if(T.activeView&&T.activeView.viewPermission.publicLevel===Q.fB.LOCKED)Object(C.b)({bitableStore:T.props.bitableStore,renderer:n,source:"other",operate:o});else if(e.length){var l=i.getCommandManager(),r=T.activeTable.id,a=T.activeView.id,d=[],c=[],s=n.activeBitableWidget.getGridWidget(),u=T.activeView.getVisibleFields(),b=r&&i.base.getTableById(r);if(!b)return;e.forEach(function(e){e&&(d.push(u[e]),c.push(Q.lC[b.fields[u[e]].fieldUIType]||""))}),l.execute({cmd:Q.Fy.SetFieldHidden,tableId:r,fieldIds:d,viewId:a,data:{hidden:!0}}),T.collectFieldSetEvent({action:"change_visibility",source:Q.gJ.ColumnContextMenu,bitable_field_type:c}),s.setSelection(null)}},T.onDeleteColumn=function(e,o){var t,i=T.props,n=i.bitableStore,l=i.tableId,r=T.activeView,a=T.getContextMenuHeaderFields(o,!1),d=a.some(function(e){return e.type===Q.og.DuplexLink}),c=a.filter(function(e){return Object(g.a)(n,e,l)}),s=a.map(function(e){return e.name}).join(", "),u=Object(Q.TL)(e).join("ï¼Œ"),b=0<u.length,p=y.Dialog.confirm,v=k("Bitable_Field_DeleteFieldPopupTitleNew",{num:a.length}),f=null===(t=o.includes(0))||void 0===t?void 0:t.toString(),m=[{conditions:0<c.length,title:k("Bitable_AdvancedPermission_DeleteFieldPopupTitle"),message:function(){return k("Bitable_AdvancedPermission_DeleteFieldPopupDesc",c.map(function(e){return e.name}).join(", "),"".concat(k("common.undo"),"(").concat(Q.JD.undo,")"))}},{conditions:b,message:function(){return k("Bitable_SingleOption_DeleteFieldPopupContent_Web",{tableName:u})}},{conditions:d,message:function(){return k("Bitable_Field_DeleteFieldWithDuplexLinkDesc",{num:a.length},s,"".concat(k("common.undo"),"(").concat(Q.JD.undo,")"))}},{conditions:!0,message:function(){return k("Bitable_Field_DeleteFieldPopupDescNew",{num:a.length},s,"".concat(k("common.undo"),"(").concat(Q.JD.undo,")"))}}].find(function(e){return e.conditions}),h={is_quote:b?1:0,field_type:Q.lC[e.fieldUIType]};p({title:(null==m?void 0:m.title)||v,content:null==m?void 0:m.message(),okText:k("comment.delete"),enableCancelButton:!0,cancelText:k("common.cancel"),okButtonProps:{danger:!0},onCancel:function(){T.collectFieldDeleteWindowEvent(Q.aC.Cancel,h)},onOk:function(){var e=Object(Q.uY)(w.a.mark(function e(){var t,i,n;return w.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=0,Object(Q.kD)(r)&&(t=r.getFrozenColumnCount()),e.next=4,T.deleteColumn(o);case 4:i=0,Object(Q.kD)(r)&&(i=r.getFrozenColumnCount()),n={},t!==i&&(n={is_index_column:f,is_change_freeze_range:"true",before_freeze_field_count:t,after_freeze_field_count:i}),T.collectFieldDeleteWindowEvent(Q.aC.Confirm,Object.assign({},h,{},n));case 9:case"end":return e.stop()}},e)}));function t(){return e.apply(this,arguments)}return t}()}),Q.cz.collectBitableEvent(Q.Rw.CcmBitableFieldDeleteView,{field_type:Q.lC[e.fieldUIType],is_quote:b?1:0})},T.onSetFilter=function(e,t){var i=T.props,n=i.bitableStore,o=i.renderer,l=i.tableId,r=i.viewId,a=i.operate;if(T.activeView.viewPermission.publicLevel!==Q.fB.LOCKED){var d=n.getCommandManager(),c=T.activeTable.fields;d.execute({cmd:Q.Fy.SetFilter,tableId:l,viewId:r,condition:{fieldId:e,fieldType:c[e].type,operator:Q.Xw.Is,value:t},type:Q.PL.AddCondition})}else Object(C.b)({bitableStore:n,renderer:o,source:"other",operate:a})},T.onCopyLink=(i=Object(Q.uY)(w.a.mark(function e(t,i){var n,o,l,r;return w.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=T.props,o=n.viewId,l=n.tableId,r=n.renderer,e.next=3,Object(C.a)({tableId:l,viewId:o,renderer:r,fieldId:i,recordId:t});case 3:case"end":return e.stop()}},e)})),function(e,t){return i.apply(this,arguments)}),T.onExportAttachment=function(e){var t=T.props,i=t.viewId,n=t.tableId,o=t.bitableStore;Object(Q.rG)(o,{tableId:n,type:"attach",viewId:i,fieldId:e,source:"attachment_field"})},T.onInsertField=function(e){var t=e.fieldIndexes,i=e.fieldId,n=void 0===i?"":i,o=e.fieldType,l=void 0===o?Q.og.Text:o,r=e.fieldUIType,a=void 0===r?Q.ex.Text:r,d=e.description,c=void 0===d?"right":d,s=e.property,u=void 0===s?null:s,b=e.tableName,p=void 0===b?"":b,v=e.isCopy,f=void 0!==v&&v;if(t.length){var m=t[t.length-1],h=T.activeView.mapVisibleColToRealCol(m)+1;"left"===c&&(m=t[0],h=T.activeView.mapVisibleColToRealCol(m)),T.setState({newFieldIndex:h},function(){T.insertColumn({id:n,type:l,fieldUIType:a,property:u,direction:c,isCopy:f,tableName:p})})}},T.setFrozenColumn=function(e,t){if(t.length&&Object(Q.kD)(T.activeView)){var i=T.props,n=i.bitableStore,o=i.renderer,l=i.operate;if(T.activeView&&T.activeView.viewPermission.publicLevel===Q.fB.LOCKED)return void Object(C.b)({bitableStore:n,renderer:o,source:"other",operate:l});var r=t[t.length-1],a=T.activeView.mapVisibleColToRealCol(r)+1,d=o.activeBitableWidget.getGridWidget(),c=d.source.realLeftColumnCount,s=r+1,u=t.includes(0).toString();if(s===c)return;var b=n.getCommandManager(),p=T.activeTable.id,v=T.activeView.id,f=d.board.width,m=d.getCellRectDocPos({col:s,row:0}).x;if(f<=(c<s?d.source.leftDocWidth+m:m))return y.toast.warning(k("Bitable_Freeze_WindowTooSmall")),void Object(I.b)(Q.BL.SetFrozenColumn,{is_index_column:u,field_type:Q.lC[e.fieldUIType],is_change_freeze_range:"false",before_freeze_field_count:a,after_freeze_field_count:a,is_reach_limit:"true"});var h=T.activeView.getFrozenColumnCount();b.execute({cmd:Q.Fy.SetGridFrozenColumn,tableId:p,viewId:v,col:a}),Object(I.b)(Q.BL.SetFrozenColumn,{is_index_column:u,field_type:Q.lC[e.fieldUIType],is_change_freeze_range:"true",before_freeze_field_count:h,after_freeze_field_count:a,is_reach_limit:"false"})}},T.onToggleSubGroup=function(e,t){var i=T.props,n=i.tableId,o=i.viewId;T.props.renderer.activeBitableWidget.getGridWidget().source.toggleSubGroup(e,t),Q.ob.collectBitableEvent(Q.On.BitableExpandGroup,{table_id:n,view_id:o,bitable_view_type:Q.Cz[T.activeView.type],is_open:t?0:1,source:"contextMenu",data_source:T.props.bitableStore.Options.module})},T.autoSetReminder=function(e){var t;Q.ob.collectBitableEvent(Q.On.SetBitableReminder,{action:Q.SK.CLICK_CLOCK_ICON,table_id:T.props.tableId,view_id:T.props.viewId,bitable_view_type:Q.Cz[null===(t=T.activeView)||void 0===t?void 0:t.type],source:e});var i=T._getReminderRecordId();if(i){var n=T._getReminderDateTimeFieldId(i);if(n){var o=function(){return requestAnimationFrame(function(){T.props.renderer.activeBitableWidget.events.emit(Q.kC.AutoSetReminder)})};T.tryToEditRecord(i,n,o)}}},T.createNewView=function(e,t,i){var n=T.props,o=n.tableId,l=n.viewId,r=n.bitableStore,a=n.operate,d=n.base;if(l){var c=a.tableOperate.addViewSync({activeViewId:l,tableId:o,type:e,propertyParams:t});if(c.result===Q.Ey.Success){var s=Object(Q.hC)(d.getTable(o).getView(c.data.viewId));T.props.renderer.switchView(r.base,o,s.id),Q.ob.collectBitableEvent(Q.On.BitableViewCreate,{action:Q.bB.CreateNew,bitable_id:Object(Q.QB)(r.base.token),table_id:o,view_id:s.id,bitable_view_type:Q.Cz[s.type],view_type:Q.Cz[s.type],source:Q.gJ.ColumnContextMenu},!0),setTimeout(function(){T.props.renameToolbarView(s)},200)}}},T.handleCopy=function(e){T.props.renderer.clipboardHelper.copy(e,T.headerSelected)},T.handleCut=function(e){T.props.renderer.clipboardHelper.cut(e,T.headerSelected)},T.handlePaste=function(e){T.props.renderer.clipboardHelper.paste(e)},T.getNewFieldName=function(){var e=T.props,t=e.bitableStore,i=e.tableId,n=t.base.getTableById(i);return n&&n.getNewFieldDefaultName()||k("bitable.new_field_name")},T.getOverlayRef=function(){return T.props.isFullScreenMode&&T.selfDom?$(T.selfDom).closest(".embeded-faster-view")[0]:T.selfDom},T.onFasterDomMouseLeave=function(){T.state.tooltip.show&&T.setState({tooltip:Object.assign({},T.state.tooltip,{show:!1})})},T.setRef=function(e){T.selfDom=e},T.toggleFieldPanel=function(e){T.setState({showFieldPanel:e})},T.setHyperLinkRef=function(e){T.hyperLinkRef=e},T._getFieldCardOffset=function(){return{x:0,y:Q.vF}},T.state={newFieldPosition:{x:0,y:0},newFieldType:Q.og.Text,newFieldUIType:Q.ex.Text,newFieldGroupType:Q.TK.Basic,isListHoverTipVisible:!1,showNewField:!1,editFieldPosition:{x:0,y:0},currentFieldType:Q.og.Text,editFieldId:"",isFirstField:!1,contextMenuRange:[],newFieldIndex:-1,currentCol:-1,tooltip:{show:!1,x:0,y:0,title:""},showToolTip:!1,toolTipPosition:{x:0,y:0},showStatList:!1,statListLeft:0,direction:!1,statListTop:0,currentRow:0,updatePosition:0,floatLayerTooltip:{show:!1,tipType:"",x:0,y:0},showFieldPanel:!1,selectedRecords:null,selectedFields:null,fieldDescriptionEditPanel:{x:0,y:0,show:!1,fieldId:""},showNewCardEditor:Q.OL.NONE,editorNeedUndo:!1,groupFieldType:null,renameSource:Q.cK.RENAME,editorWidth:0,gridRow:0,fieldId:"",groupValue:"",fieldDescriptionTips:{x:0,y:0,show:!1,fieldId:"0"}},T.initContextMenuService(),T}return Object(Q.bu)(n,t),Object(Q.Pw)(n,[{key:"componentDidMount",value:function(){this.updateActiveModel(this.props)&&(this.clearListener=this.bindFasterEvent());var e=this.props,t=e.bitableStore,i=e.tableId;t.addEventListeners(i,this.getListeners()),window.addEventListener("resize",this.windowResizeCb),this.bindDomEvent()}},{key:"UNSAFE_componentWillReceiveProps",value:function(e){if(this.props.tableId!==e.tableId||this.props.viewId!==e.viewId){this.clearListener&&this.clearListener(),this.updateActiveModel(e)&&(this.clearListener=this.bindFasterEvent());var t=this.props.bitableStore;t.removeEventListeners(this.props.tableId,this.getListeners()),t.addEventListeners(e.tableId,this.getListeners())}var i=e.view,n=this.props.view;this.props.tableId===e.tableId&&i&&n&&i.id===n.id&&i.publicLevel!==n.publicLevel&&i.publicLevel===Q.fB.PERSONAL&&(this.hidePopup(),this.setState({tooltip:Object.assign({},this.state.tooltip,{show:!1})}))}},{key:"componentWillUnmount",value:function(){this.clearListener&&this.clearListener(),this.selfDom=null,window.clearTimeout(this.showTooltipTimeout);var e=this.props,t=e.bitableStore,i=e.tableId;t.removeEventListeners(i,this.getListeners()),window.removeEventListener("resize",this.windowResizeCb),this.unbindDomEvent()}},{key:"initContextMenuService",value:function(){var e,t=this.props,n=t.bitableStore,i=t.contextMenuService,o=(Object(Q.Ww)(e={},S.b.GridFieldHeaderMenu,function(e){var t=e.items;return n.isEmbeddedInDoc&&(t=t.filter(function(e){return e.id!==S.a.FrozenField})),(n.isEmbedded||n.Options.isHistoryMode||n.Options.module===Q.Bz.Template)&&(t=t.filter(function(e){return e.id!==S.a.ExportAttachment})),Object.assign({},e,{items:t})}),Object(Q.Ww)(e,S.b.GridContentContextMenu,function(e,t){if(n.isEmbedded||n.Options.isHistoryMode||n.Options.module===Q.Bz.Template)return Object.assign({},e,{items:e.items.filter(function(e){return e.id!==S.a.CopyLink})});var i=e.items.find(function(e){return e.id===S.a.DeleteRecord});return i&&Object(j.i)(i,n,t),e}),e);null==i||i.setContextMenus(xe),null==i||i.setContextServiceOption({customContextMenus:o})}},{key:"updateActiveModel",value:function(e){var t=e.bitableStore,i=e.tableId,n=e.viewId,o=t.base.getTableById(i),l=o&&o.getViewById(n);return!(!o||!l||(this.activeTable=o,this.activeView=l,0))}},{key:"hiddenEditField",value:function(){this.toggleFloatToolbarVisibility(!1),this.ensureFieldEditPanelClose()}},{key:"ensureFieldEditPanelClose",value:function(){var e=this.props.tableId;this.props.isFieldEditPanelOpen&&this.props.toggleFieldEditPanel(e,!1)}},{key:"editStatSubmit",value:function(e){var t=this.state.editFieldId;this.props.bitableStore.getCommandManager().execute({cmd:Q.Fy.SetGridFieldStatType,tableId:this.activeTable.id,viewId:this.activeView.id,fieldId:t,statType:e}).result===Q.Ey.Fail?(Object(Q.rB)({title:k("bitable.stat.has_delete"),message:k("bitable.stat.has_delete"),buttons:[{text:k("common.confirm"),type:Q.YA.primary}]}),this.toggleFloatToolbarVisibility(!1)):this.hiddenStatList();var i=this.state,n=i.direction,o=i.currentFieldUIType;Q.ob.collectBitableEvent(Q.On.BitableStatChange,{table_id:this.activeTable.id,view_id:this.activeView.id,bitable_stat_position:n?"group":"bottom",bitable_field_type:Q.lC[o],bitable_stat_type:Q.UK[e],data_source:this.props.bitableStore.Options.module},!0)}},{key:"hiddenStatList",value:function(){this.toggleFloatToolbarVisibility(!1),this.state.showStatList&&this.setState({showStatList:!1})}},{key:"bindFasterEvent",value:function(){var e,t,f=this,b=this.activeTable,p=this.activeView,i=this.props,u=i.renderer,r=i.bitableStore,s=i.operate,m=u.activeBitableWidget,c=m.getGridWidget();this.colHeaderBottom=c.colHeaderBottom;var n=(Object(Q.Ww)(e={},Q.pC.ResizeColHeader,function(e){var t=e.width,i=e.col,n=f.props.bitableStore;if(f.activeView&&f.activeView.viewPermission.publicLevel===Q.fB.LOCKED)Object(C.b)({bitableStore:n,renderer:u,source:"other",operate:s});else if(n.getCommandManager().execute({cmd:Q.Fy.SetGridFieldWidth,tableId:b.id,viewId:p.id,fieldId:p.getVisibleFields()[i],width:t}),f.state.showStatList){var o=m.getGridWidget().getCellRect({col:f.state.currentCol,row:f.state.currentRow});f.setState({statListLeft:o.x+(o.width-Te)})}}),Object(Q.Ww)(e,Q.pC.SetFrozenColumn,function(e){var t=e.col,i=e.isReachLimit,n=e.isTempFrozen,o=f.props,l=o.bitableStore,r=o.renderer;if(f.activeView&&f.activeView.viewPermission.publicLevel===Q.fB.LOCKED||null==t)Object(C.b)({bitableStore:l,renderer:r,source:"other",operate:s});else{var a=p.getInvisibleBeforeCol(t,!1)+t,d=r.activeBitableWidget.getGridWidget().source.realLeftColumnCount;l.getCommandManager().execute({cmd:Q.Fy.SetGridFrozenColumn,tableId:b.id,viewId:p.id,col:a}),Q.cz.collectClickEvent(Q.Bc.CcmBitableFreezeFieldClick,{click:"freeze_field",before_freeze_field_count:d,after_freeze_field_count:a,is_change_freeze_range:"true",is_reach_limit:i.toString(),is_temporary_frozen:n.toString()})}}),Object(Q.Ww)(e,Q.pC.AppendRow,function(e){var t=e.values,i=e.insertIndex,n=e.direction;f.executeAddRecord(t,1,i,n)}),Object(Q.Ww)(e,Q.pC.RenameGroup,function(e){var t=e.fieldType,i=e.value,n=e.fieldId,o=e.width,l=e.gridRow;f.renameGroupValue(i,Q.cK.RENAME,t,n,o,l)}),Object(Q.Ww)(e,Q.pC.AddGroup,function(e){var t=e.fieldType,i=e.fieldId,n=e.width;f.renameGroupValue("",Q.cK.NEW_GROUP,t,i,n),Q.cz.collectClickEvent(Q.Bc.CcmBitableAddGroupClick,{click:"add_group"})}),Object(Q.Ww)(e,Q.pC.AppendColumn,function(e){var t=e.fieldType,i=p,n=i.getVisibleColumnCount(),o=i.getVisibleFields()[n-1],l=i.getFieldIndexById(o),r=m.getGridWidget().getCellRect({col:n,row:0});f.setState({newFieldType:t||Q.og.Text,newFieldGroupType:t&&Object(Q.EE)(t)||Q.TK.Basic,showNewField:!0,currentCol:n,currentRow:0,newFieldPosition:{x:r.x-1,y:f.colHeaderBottom},newFieldIndex:l+1}),f.ensureFieldEditPanelClose(),f.toggleFloatToolbarVisibility(!0),Q.ob.collectBitableEvent(Q.On.BitableFieldOpenEditor,{table_id:f.activeTable.id,view_id:f.activeView.id,bitable_view_type:Q.Cz[f.activeView.type],source:Q.VK.Plusbutton,data_source:f.props.bitableStore.Options.module}),Q.cz.collectClickEvent(Q.Bc.CcmBitableAddFieldClick,{click:"rightmost",target:Q.Rw.CcmBitableFieldModifyView})}),Object(Q.Ww)(e,Q.pC.ExpandFieldMenu,this.handleExpandFieldMenu),Object(Q.Ww)(e,Q.pC.HeaderContextMenu,this.handleFieldHeaderContextMenu),Object(Q.Ww)(e,Q.pC.CellContextMenu,this.handleContentContextMenu),Object(Q.Ww)(e,Q.pC.RowHeaderContextMenu,this.handleContentContextMenu),Object(Q.Ww)(e,Q.pC.GroupTitleContextMenu,this.handleGroupTitleContextMenu),Object(Q.Ww)(e,Q.pC.ClickCell,function(){f.props.smartableCommentManager&&f.props.smartableCommentManager.handleDeactivateComment()}),Object(Q.Ww)(e,Q.pC.ScrollChange,function(){if(f.closeContextMenu(),f.props.isFieldEditPanelOpen||f.state.showStatList){var e={col:f.state.currentCol,row:f.state.currentRow},t=m.getGridWidget(),i=t.getCellVisualRect(e),n=t.getShortScrollTopDiff(),o=f.state,l=o.editFieldPosition,r=o.direction,a=f.validateFieldPositionX(i.x);if(f.props.isFieldEditPanelOpen&&a!==l.x&&f.setState({editFieldPosition:{x:a,y:f.colHeaderBottom}}),f.state.showStatList){var d=t.getCellRect({col:0,row:0}),c=document.querySelector(".stat-list"),s=c?c.offsetLeft:i.x;if(0!==f.state.currentCol&&(d.x+d.width>s||r&&i.y+Q.WK<f.colHeaderBottom))f.hiddenStatList();else{var u=c?c.offsetTop:0,b=c?c.offsetHeight:0,p=document.querySelector(".".concat(Q.UA)),v=p?p.offsetHeight:0;(u<f.colHeaderBottom||r&&v-Q.WK<u+b)&&f.hiddenStatList(),f.setState({statListLeft:i.x+(i.width-Te),statListTop:t.isShortCeiling?i.y-n:i.y})}}}}),Object(Q.Ww)(e,Q.pC.ExpandRow,function(e){if(!Q.ob.config.ui.disableRecordCardMode){var t=c.getActiveCell(),i=f.shouldChangeFloatRecordId(f.activeView.getVisibleRecords()[e]),n=t&&t.row===e?f.activeView.getVisibleFields()[t.col]:void 0;f.props.showCardModal(i,n),Q.cz.collectClickEvent(Q.Bc.CcmBitableRecordExpandClick,{click:"expand",target:Q.Rw.CcmBitableRecordOperateView}),Q.ob.collectBitableEvent(Q.On.BitableCardOpen,{table_id:f.activeTable.id,view_id:f.activeView.id,bitable_view_type:Q.Cz[f.activeView.type],source:Q.NK.Icon,data_source:f.props.bitableStore.Options.module}),Q.cz.collectBitableEvent(Q.Rw.CcmBitableCardView,{source:Q.NK.Icon})}}),Object(Q.Ww)(e,Q.pC.SelectionChange,function(e){if((!e||1===e.rowCount&&1===e.colCount)&&f.hideDataCounter(),f.props.editable){var t=f.props.bitableStore.sendCursor,i=c.getActiveCell();if(!e)return f.headerSelected=!1,void(f.prevActiveCell&&!i&&t(f.activeTable.id,{table_id:f.activeTable.id,view_id:f.activeView.id,record_id:"",field_id:""}));if(i){if(f.prevActiveCell!==i){var n=p,o=n.getVisibleRecords(),l=n.getVisibleFields(),r=o.length;e.rowCount!==r&&(f.headerSelected=!1);var a=o[i.row],d=l[i.col];h(f.props.bitableStore,f.activeTable.id,{table_id:f.activeTable.id,view_id:f.activeView.id,record_id:a,field_id:d}),f.prevActiveCell=i}}else f.headerSelected=!1}}),Object(Q.Ww)(e,Q.pC.SelectionChangeEnd,function(){var e=f.activeView,t=c.getSelection();if(e&&t&&(1!==t.rowCount||1!==t.colCount)){var i=t.row,n=t.rowCount,o=t.col,l=t.colCount;f.setState({selectedRecords:e.getVisibleRecords().slice(i,i+n),selectedFields:e.getVisibleFields().slice(o,o+l)})}else f.hideDataCounter()}),Object(Q.Ww)(e,Q.pC.RowHeaderSelected,function(){var e=f.activeView,t=c.getSelectRecords().filter(function(e){return!!e});e&&0!==t.length?f.setState({selectedRecords:t,selectedFields:e.getVisibleFields()}):f.hideDataCounter()}),Object(Q.Ww)(e,Q.pC.SelectAll,function(){var e=f.activeView;e?f.setState({selectedRecords:e.getVisibleRecords(),selectedFields:e.getVisibleFields()}):f.hideDataCounter()}),Object(Q.Ww)(e,Q.pC.ClickMention,this.onClickMention),Object(Q.Ww)(e,Q.pC.ExpandFieldStatMenu,function(e){var t=e.col,i=e.row,n=e.direction,o=m.getGridWidget();o.setSelection(null);var l=f.activeView.id,r=f.activeTable.id,a=f.props.bitableStore;if(f.activeView.viewPermission.publicLevel!==Q.fB.LOCKED&&a.hasPermission(Q.qy.View,{tableId:r,viewId:l},Q.ry.Editable)){var d=n?o.getCellVisualRect({col:t,row:i}):o.getCellRect({col:t,row:i}),c=o.getShortScrollTopDiff(),s=p.getVisibleFields()[t],u=b.fields[s];f.setState({showStatList:!0,showNewField:!1,statListLeft:d.x+(d.width-Te),currentFieldType:u.type,currentFieldUIType:u.fieldUIType,currentCol:t,currentRow:i,editFieldId:s,direction:n,statListTop:o.isShortCeiling?d.y-c:d.y,isFirstField:!t}),f.toggleFloatToolbarVisibility(!0),f.ensureFieldEditPanelClose()}}),Object(Q.Ww)(e,Q.pC.MoveColumn,function(e){var t=e.fields,i=e.index,n=e.fromIndex,o=f.activeTable,l=f.activeView;if(l&&l.viewPermission.publicLevel===Q.fB.LOCKED)Object(C.b)({bitableStore:f.props.bitableStore,renderer:u,source:"other",operate:s});else{var r=f.props.bitableStore.getCommandManager(),a=0;Object(Q.kD)(l)&&(a=l.getFrozenColumnCount()),r.execute({cmd:Q.Fy.MoveField,tableId:o.id,viewId:l.id,fields:t,target:i});var d=0;if(Object(Q.kD)(l)&&(d=l.getFrozenColumnCount()),Q.ob.collectBitableEvent(Q.On.BitableColumnMove,{table_id:f.activeTable.id,view_id:f.activeView.id,bitable_view_type:Q.Cz[f.activeView.type],bitable_field_type:t.map(function(e){return Q.lC[f.activeTable.fields[e].fieldUIType]}).join(","),data_source:f.props.bitableStore.Options.module,source:Q.iz.Column},!0),Object(Q.kD)(l)&&a!==d){var c=u.activeBitableWidget.getGridWidget().source.frozen.isTempFrozen;Q.cz.collectClickEvent(Q.Bc.CcmBitableFieldDragClick,{click:"field_drag",field_type:t.map(function(e){return Q.lC[f.activeTable.fields[e].fieldUIType]}).join(","),from_group_id:String(n),to_group_id:String(i),before_freeze_field_count:a,after_freeze_field_count:d,is_index_column:"false",is_change_freeze_range:"true",is_temporary_frozen:c.toString()})}else Q.cz.collectClickEvent(Q.Bc.CcmBitableFieldDragClick,{click:"field_drag",field_type:t.map(function(e){return Q.lC[f.activeTable.fields[e].fieldUIType]}).join(","),from_group_id:String(n),to_group_id:String(i)})}}),Object(Q.Ww)(e,Q.pC.MoveRow,function(e){var t,i=e.records,n=e.index,o=e.values,l=e.fromIndex,r=e.afterRecordId,a=f.activeTable,d=f.activeView,c=f.props,s=c.base,u=c.tableId,b=c.viewId,p=null===(t=s.getTable(u))||void 0===t?void 0:t.getView(b),v=null==p?void 0:p.getGroupInfo();f.props.bitableStore.getCommandManager().execute({cmd:Q.Fy.MoveRecords,tableId:a.id,viewId:d.id,records:i,target:n,groupCellValues:o,afterRecordId:r}),Q.ob.collectBitableEvent(Q.On.BitableRecordMove,{table_id:f.activeTable.id,view_id:f.activeView.id,bitable_view_type:Q.Cz[f.activeView.type],scene:Q.zE.GridColumn,data_source:f.props.bitableStore.Options.module},!0),Q.cz.collectClickEvent(Q.Bc.CcmBitableRecordDragClick,{click:Q.QK.RecordDrag,from_record_idx:String(l),to_card_idx:String(n)}),v&&v.forEach(function(e,t){Object(j.k)(Q.PK.DragGroup,f.activeTable.fields[e.fieldId].fieldUIType,o&&null===o[t]?"":"true")})}),Object(Q.Ww)(e,Q.pC.ClickHeader,function(){f.headerSelected=!0}),Object(Q.Ww)(e,Q.pC.DBClickCell,function(){f.updatePosition()}),Object(Q.Ww)(e,Q.pC.ClickCheckbox,function(e){var t,i=f.activeTable,n=f.props,o=n.bitableStore,l=n.viewId,r=e.isChecked,a=e.recordId,d=e.field,c=o.getCommandManager();Object(j.k)(Q.PK.DirectInCell,null===(t=d.getFieldUIType)||void 0===t?void 0:t.call(d),r?"true":""),c.execute({cmd:Q.Fy.SetRecord,tableId:i.id,recordId:f.shouldChangeFloatRecordId(a),viewId:l,data:Object(Q.Ww)({},d.getId(),{type:d.getType(),value:r})});var s=u.activeBitableWidget.isFloatLayerOpen;Q.ob.collectBitableEvent(Q.On.BitableRecordEdit,Object.assign({smartable_token:o.md5Token,row:f.activeView.getVisibleRecordIndexById(a),col:f.activeView.getFieldIndexById(d.getId()),table_id:f.activeTable.id,view_id:f.activeView.id,bitable_editor_type:"cell",bitable_view_type:Q.Cz[f.activeView.type],bitable_field_type:Q.lC[d.getFieldUIType()],bitable_feature_change:-1,data_source:f.props.bitableStore.Options.module,is_record_floating:s},u.getRecordEditLogParams()),!0),r&&Q.cz.collectClickEvent(Q.Bc.CcmBitableCheckboxFieldClick,{click:"checkbox_select"})}),Object(Q.Ww)(e,Q.pC.FillOnVertical,function(e){var h=e.originRange,g=e.fillRange,l=e.isDescending,t=f.props,i=t.bitableStore;if(t.editable)if(f.activeTable&&f.activeView){var r=f.activeView.getVisibleRecords(),n=d(f.activeTable,r.slice(g.row,g.row+g.rowCount),f.activeView.getVisibleFields()),o=n.fillRecordData,a=n.fillResource;i.getCommandManager().execute({cmd:Q.Fy.SetRecords,tableId:f.activeTable.id,viewId:f.activeView.id,data:o,resource:a}),Q.ob.collectBitableEvent(Q.On.EditCellContent,{action:"auto_fill"})}else console.error("table or view is not exist");function d(e,t,i){for(var n=t.reduce(function(e,t){return e[t]={},e},{}),o={},l=0;l<h.colCount;l++){var r=i[h.col+l],a=e.getField(r);if(a&&a.fillable){var d=a.type,c=w(a);if(c)for(var s=0;s<g.rowCount;s++){var u,b,p,v=t[s],f={type:d,value:void 0===c[s]?null:c[s]};if(d===Q.og.DateTime){var m=C(e,r,f.value,s);o[v]=Object(Q.Ww)({},r,m?{reminders:{reminder:m}}:null),f.reminder=m}d===Q.og.Attachment&&0<(null===(u=a.property)||void 0===u||null===(b=u.capture)||void 0===b?void 0:b.length)||d===Q.og.Location&&(null===(p=a.property)||void 0===p?void 0:p.inputType)===Q.FK.ONLY_MOBILE||(n[v][r]=f)}}}return{fillRecordData:n,fillResource:o}}function w(e){for(var t=[],i=0;i<h.rowCount;i++){var n=r[h.row+i],o=e.getCellValue(n,!1,!0);t.push(void 0===o?null:o)}return e.calcFillValues(t,g,l)}function C(e,t,i,n){if("number"!=typeof i)return null;var o=n%h.rowCount,l=e.getReminder(r[h.row+o],t);return l?Object(Q.XK)(i,l.notifyStrategy,l.notifyEntities,l.isSpecificTime,e.getTimeZone()):null}}),Object(Q.Ww)(e,Q.pC.ToggleFloatLayerToolTip,function(e){var t=e.isShow,i=e.tipType,n=e.x,o=e.y;if(t){var l=f.props,r=l.isOpenSidebar,a=n;!l.bitableStore.isEmbeddedInDoc&&r&&(a+=Q.JK),f.setState({floatLayerTooltip:{show:!0,tipType:i,x:a,y:o-c.y}})}else{var d=f.state.floatLayerTooltip;f.setState({floatLayerTooltip:Object.assign({},d,{show:!1})})}}),Object(Q.Ww)(e,Q.pC.ToggleFieldPanel,function(e){var t=e.isOpen;e.col,f.setState({showFieldPanel:t})}),Object(Q.Ww)(e,Q.pC.ClickHyperlink,this.onClickHyperLink),Object(Q.Ww)(e,Q.pC.MouseDescIconHover,function(e){var t=e.point,i=e.fieldId;Q.cz.collectBitableEvent(Q.Bc.CcmBitableFieldTitleClick,{click:"description_icon_hover",target:Q.Rw.None}),f.setState({fieldDescriptionTips:{show:!0,x:t.x,y:t.y,fieldId:i}})}),Object(Q.Ww)(e,Q.pC.MouseDescIconLeave,function(){f.setState({fieldDescriptionTips:Object.assign({},f.state.fieldDescriptionTips,{show:!1})})}),Object(Q.Ww)(e,Q.pC.ClickFieldDescriptionIcon,function(e){var t=e.col,i=e.indexs,n=f.activeView.getVisibleFields()[t],o=f.activeView.table.id;r.hasPermission(Q.qy.Field,{tableId:o,fieldId:n},Q.ry.Editable)&&(Q.cz.collectBitableEvent(Q.Bc.CcmBitableFieldTitleClick,{click:"description_icon",target:Q.Rw.CcmBitableFieldDescriptionModifyView}),f.openFieldDescription(f.activeTable.fields[n],i),f.setState({fieldDescriptionTips:Object.assign({},f.state.fieldDescriptionTips,{show:!1})}))}),Object(Q.Ww)(e,Q.pC.SetProgressValue,function(e){var t,i=r.getCommandManager(),n=e.recordId,o=e.fieldId,l=e.data;n&&o&&i.execute({cmd:Q.Fy.SetRecord,tableId:f.props.tableId,viewId:null===(t=f.activeView)||void 0===t?void 0:t.id,recordId:n,data:Object(Q.Ww)({},o,l)})}),e);c.addGridEventsBindListener(n);var o=(Object(Q.Ww)(t={},Q.kC.ShowTooltip,function(e){var t=e.x,i=e.y,n=e.width,o=e.height,l=e.title,r=e.direction,a=e.className,d=e.style,c=e.animate,s=e.showArrow,u=e.showDelay;window.clearTimeout(f.showTooltipTimeout),u?f.showTooltipTimeout=window.setTimeout(function(){f.setState({tooltip:{x:t,y:i,width:n,height:o,title:l,show:!0,direction:r,className:a,style:d,animate:c,showArrow:s}})},u):f.setState({tooltip:{x:t,y:i,width:n,height:o,title:l,show:!0,direction:r,className:a,style:d,animate:c,showArrow:s}})}),Object(Q.Ww)(t,Q.kC.ShowReminderTooltip,function(e){var t=e.x,i=e.y,n=e.reminder,o=e.direction,l=e.className;window.clearTimeout(f.showTooltipTimeout);var r=Object(Q.RK)(n,f.activeTable);f.setState({tooltip:{x:t,y:i,title:r,show:!0,direction:o,className:l}}),Q.ob.collectBitableEvent(Q.On.SetBitableReminder,{action:Q.SK.HOVER_CLOCK_ICON,table_id:f.props.tableId,view_id:f.props.viewId,bitable_view_type:Q.Cz[Q.az.Grid],source:Q.mC.OUTSIZE_RECORD_DETAIL})}),Object(Q.Ww)(t,Q.kC.HideTooltip,function(e){var t=e.animate;window.clearTimeout(f.showTooltipTimeout),f.setState({tooltip:Object.assign({},f.state.tooltip,{show:!1,animate:t})})}),Object(Q.Ww)(t,Q.kC.ShowMentionPopover,function(e){if(!f.props.isAnonymousAccess){var t="",i="";e.mentionType===Q.mx.User&&(t=Object(l.a)(f.activeTable.getI18nUserItemById(e.token),"name","")),f.props.smartableMentionManager&&f.props.smartableMentionManager.getMentionInfoByUserId(f.props.tableId,e.token)&&(i=f.props.tableId),Q.lx.open(Object.assign({name:t,tableId:i},e))}}),Object(Q.Ww)(t,Q.kC.ShowAttachPopover,function(e){j.a.open(e)}),Object(Q.Ww)(t,Q.kC.HideAttachPopover,function(){j.a.close()}),Object(Q.Ww)(t,Q.kC.HideMentionPopover,function(){Q.lx.close()}),Object(Q.Ww)(t,Q.kC.CommentBubbleClick,function(e){var t=f.props.smartableCommentManager;Q.cz.collectClickEvent(Q.Bc.CcmBitableRecordCommentClick,{click:"click_record",target:Q.Rw.CcmCommentView}),t&&t.onCommentBubbleClick(e)}),Object(Q.Ww)(t,Q.kC.ShowViewLockedModal,function(e){return Object(C.b)({bitableStore:f.props.bitableStore,renderer:u,source:e,operate:s})}),Object(Q.Ww)(t,Q.kC.SetReminder,this.autoSetReminder),t);return m.events.addListeners(o),function(){c.removeGridEventsBindListener(n),m.events.removeListeners(o)}}},{key:"isSyncTable",value:function(){var e;return null===(e=this.props.base.getTable(this.activeTable.id))||void 0===e?void 0:e.isSyncTable()}},{key:"hideDataCounter",value:function(){this.setState({selectedFields:null,selectedRecords:null})}},{key:"hideKanbanEditor",value:function(){this.setState({showNewCardEditor:Q.OL.NONE,editorNeedUndo:!1})}},{key:"validateFieldPositionX",value:function(e,t){var i,n=this.props.renderer.activeBitableWidget.getGridWidget(),o=n.board.width;n.isInGantt?o+=Q.dL:this.props.isOpenSidebar&&(o-=je);var l=this.state.currentFieldType;return i=t&&0<t?t:l===Q.og.Lookup?Q.ob.config.ui.useSimpleFieldEdit?180:332:Q.ob.config.ui.useSimpleFieldEdit?180:244,e<44?e=44:o<e+i&&(e=o-i),e-2}},{key:"beforeDeleteRecords",value:function(e){var t=this.props,i=t.bitableStore,n=t.renderer,o=t.tableId,l=t.viewId,r=n.activeBitableWidget.getActiveWidget();if(Object(Q.YK)(r)){var a=o&&i.base.getTableById(o);if(!a)return;var d=a&&l&&a.getViewById(l);if(!d)return;var c=d.getVisibleRecords();if(!c||!c.length)return;var s=e.reduce(function(e,t){return e[t]=!0,e},{}),u={};c.forEach(function(e,t){s[e]&&(u[t]=!0)}),r.removeHighlightCoverByRows(u)}}},{key:"onUICommand",value:function(e,t){if(this.state.contextMenuRange){var i=this.props.renderer;if(e===Q.my.Paste)return void Q.ob.Toast.show({type:"info",content:k("bitable.info.paste_not_support"),duration:3e3,closable:!1});i.keybindingService.uiCommandManager.execute(e),document.execCommand(t)}}},{key:"tryToEditRecord",value:function(e,t,i){var n=this.props.renderer.activeBitableWidget.getActiveGridWidget(),o=n.source.getRowByRecordId(e),l=t?n.source.getColByFieldId(t):0;if(0<=o&&0<=l){var r=new Q.qK(o,l,1,1);n.setSelection(r)}requestAnimationFrame(function(){n.events.emit(Q.pC.EditRecord,{keepValue:!0}),i&&i()})}},{key:"insertColumn",value:function(){var t=Object(Q.uY)(w.a.mark(function e(t){var i,n,o,l,r,a,d,c,s,u,b,p,v,f,m,h,g;return w.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.id,o=t.type,l=t.fieldUIType,r=t.property,a=t.direction,d=t.isCopy,c=t.tableName,s=this.activeTable,u=this.activeView,b=u.type===Q.az.Gantt&&u.viewPermission.publicLevel!==Q.fB.LOCKED,p=-1<this.state.newFieldIndex?this.state.newFieldIndex:void 0,!d){e.next=13;break}return f={tableId:s.id,viewId:u.id,sourceFieldId:n,index:p,tableName:c},b&&(f.hidden=!1),e.next=10,this.props.operate.tableOperate.copyField(f);case 10:v=e.sent,e.next=16;break;case 13:m={tableId:s.id,viewId:u.id,index:p,data:{type:o,name:this.getNewFieldName(),property:null,fieldUIType:l}},b&&(m.hidden=!1),v=this.props.operate.tableOperate.addField(m);case 16:return((h=null)===(i=v)||void 0===i?void 0:i.result)===Q.Ey.Success&&(h=v.data.fieldId),g=h?s.fields[h].property:null,Q.ob.collectBitableEvent(Q.On.BitableFieldCreate,{table_id:this.activeTable.id,view_id:this.activeView.id,bitable_view_type:Q.Cz[this.activeView.type],bitable_field_type:Q.lC[l],bitable_field_direction:a,field_feature:Object(Q.kL)(o,g),field_select_number:Object(Q.lL)(o,g),data_source:this.props.bitableStore.Options.module,source:Q.gJ.ColumnContextMenu,scene_type:"right_duplicate"===a?Q.yE.CopyField:Q.yE.InsertField},!0),v.result===Q.Ey.Fail&&this.handleInsertColumnFailed(v,r),e.abrupt("return",h);case 22:case"end":return e.stop()}},e,this)}));function e(e){return t.apply(this,arguments)}return e}()},{key:"handleInsertColumnFailed",value:function(e,t){e.reason===Q.qB.LinkTableFieldCountExceeded&&t&&this.handleLinkTableFieldCountExceeded(t)}},{key:"handleLinkTableFieldCountExceeded",value:function(e){var t=e.tableId;if(t){var i=this.getTableName(t);Object(Q.ZK)(i)}}},{key:"deleteColumn",value:function(){var t=Object(Q.uY)(w.a.mark(function e(t){var i,n,o,l,r,a,d,c,s=this;return w.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.length){e.next=10;break}return o=this.props.bitableStore,l=this.activeTable.id,r=this.activeView.id,a=this.activeView.type,d=[],c=this.activeView.getVisibleFields(),t.forEach(function(e){if(e){var t=c[e];d.push(t);var i=s.activeTable.fields[t].fieldUIType;i&&Q.ob.collectBitableEvent(Q.On.BitableFieldDelete,{table_id:l,view_id:r,bitable_view_type:Q.Cz[a],bitable_field_type:Q.lC[i],scene:Q.zE.GridColumn,data_source:o.Options.module,source:Q.gJ.ColumnContextMenu})}},!0),e.next=10,null===(i=(n=this.props).onFieldsDelete)||void 0===i?void 0:i.call(n,d);case 10:case"end":return e.stop()}},e,this)}));function e(e){return t.apply(this,arguments)}return e}()},{key:"_getReminderDateTimeFieldId",value:function(t){var i=this,e=function(e){return Q.ob.Toast.show({content:e,type:"info"})},n=function(e){return Q.gK.instance.getFieldCtor(i.activeTable.fields[e].type).supportReminder},o=function(e){return i.props.bitableStore.hasPermission(Q.qy.Cell,{tableId:i.activeTable.id,recordId:t,fieldId:e},Q.ry.Editable)},l=this.props.renderer.activeBitableWidget.getActiveGridWidget().getActiveField();if(l&&n(l)&&o(l))return l;var r=this.activeView.getVisibleFields().filter(n),a=!!r.length;if(a){var d=r.find(o);if(d)return d}e(this.activeView.getHiddenFields().filter(n).some(o)?k("Bitable_Reminder_DateFieldIsHidden"):k(a?"Bitable_Reminder_AddDateFieldToSet":"Bitable_Reminder_NoDateFieldFound"))}},{key:"_getReminderRecordId",value:function(){var t=this.activeTable.id,i=this.activeView.id,e=function(e){return r.hasPermission(Q.qy.Record,{tableId:t,viewId:i,recordId:e},Q.ry.Editable)},n=function(e){return Q.ob.Toast.show({content:e,type:"info"})},o=this.props,l=o.renderer,r=o.bitableStore,a=l.activeBitableWidget.getActiveGridWidget().getActiveRecord();if(a)return e(a)?a:void n(k("Bitable_Reminder_UnableToEditThisRecord"));var d=this.activeView.getVisibleRecords();if(d.length){if(a=d.find(e))return a;n(k("Bitable_Reminder_UnableToEditRecord"))}else n(k("Bitable_Reminder_AtLeastOneRecordIsNecessary"))}},{key:"getTableName",value:function(e){var t=this.props,i=t.bitableStore,n=t.tableId,o=t.renderer;return Object(Q.aL)(i,o,null!=e?e:n)}},{key:"getContextMenuHeaderFields",value:function(e){var i=this,n=!(1<arguments.length&&void 0!==arguments[1])||arguments[1],o=this.activeView.getVisibleFields(),l=[];return e.forEach(function(e){if(n||0!==e){var t=o[e];l.push(i.activeTable.fields[t])}}),l}},{key:"sendSortOrGroupCommand",value:function(e,t,i,n){var o=this.props,l=o.bitableStore,r=o.tableId,a=o.viewId,d=o.renderer,c=o.operate;if(this.activeView&&this.activeView.viewPermission.publicLevel===Q.fB.LOCKED)Object(C.b)({bitableStore:this.props.bitableStore,renderer:d,source:"other",operate:c});else{var s=l.getCommandManager(),u=Object.assign({cmd:e,tableId:r,viewId:a},t);s.execute(u),Q.ob.collectBitableEvent(i,n,!0)}}},{key:"getListeners",value:function(){return Object(Q.Ww)({},Q.my.ExpandRecord,this.onShowEditPopupByCommand)}},{key:"hidePopup",value:function(){this.closeContextMenu(),this.hiddenEditField(),this.hiddenNewField(),this.hideDataCounter(),this.hideKanbanEditor(),this.hiddenStatList(),this.setState({showFieldPanel:!1,fieldDescriptionEditPanel:Object.assign({},this.state.fieldDescriptionEditPanel,{show:!1})})}},{key:"bindDomEvent",value:function(){this.props.fasterDom&&this.props.fasterDom.addEventListener("mouseleave",this.onFasterDomMouseLeave,!1)}},{key:"unbindDomEvent",value:function(){this.props.fasterDom&&this.props.fasterDom.removeEventListener("mouseleave",this.onFasterDomMouseLeave,!1)}},{key:"updatePosition",value:function(){var e=this.props,t=e.bitableStore,i=e.isFullScreenMode;t.isEmbeddedInDoc&&!i&&this.setState(function(e){return{updatePosition:1-e.updatePosition}})}},{key:"renderDataCounter",value:function(){var e,t=this,i=this.props.bitableStore;if(i.isEmbeddedInDoc||null!==(e=i.bitableConfig.ui)&&void 0!==e&&e.disableGridDataCounter)return null;var n=this.state,o=n.selectedRecords,l=n.selectedFields,r=Q.bL.Consumer;return te.a.createElement(r,null,function(e){return a.a.createPortal(te.a.createElement(B,{table:t.activeTable,records:o,fields:l}),e()||document.body)})}},{key:"setFieldHoverTipVisible",value:function(e){this.setState({isListHoverTipVisible:e})}},{key:"render",value:function(){var e,t,i,n=this,o=this.props,l=o.renderer,r=o.editable,a=o.bitableStore,d=o.tableId,c=o.viewId,s=o.editing,u=o.isFullScreenMode,b=o.isFieldEditPanelOpen,p=o.fullScreenTableId,v=o.isNotDefaultMode,f=o.mountOption,m=o.smartableCommentManager,h=o.isAnonymousAccess,g=o.getOffsetX,w=o.isParentBlockInView,C=b&&(!(""!==p)||u),y=l.activeBitableWidget;if(!y)return null;var I=y.getActiveWidget(),F=a.isEmbeddedInDoc&&u&&Object(Q.YK)(I),Container=r?Q.iL:Q.jL,_=this.state.tooltip,S=l.activeBitableWidget.getGridWidget(),O=te.a.createElement("div",null,te.a.createElement(Q.uL,{ref:this.setHyperLinkRef}),te.a.createElement(Container,{tableId:d,viewId:c,editable:r,editing:s,bitableStore:a,renderer:l,onCopy:this.handleCopy,onCut:this.handleCut,onPaste:this.handlePaste,fasterDom:this.props.fasterDom,isNotDefaultMode:v,showCardModal:this.props.showCardModal,recordEditMode:Q.ob.config.recordEditMode,isFullScreenMode:u,mountOption:f,smartableCommentManager:m,isAnonymousAccess:h,isEditorHidden:!w}),te.a.createElement(Q.vL,{container:this.props.tooltipOverlayRef,x:_.x,y:_.y,width:_.width,height:_.height,title:_.title,visible:_.show,direction:_.direction,className:_.className,style:_.style,animate:_.animate,showArrow:_.showArrow}),te.a.createElement(ne,{field:this.activeTable&&(null===(e=this.activeTable.fields[this.state.fieldDescriptionTips.fieldId])||void 0===e||null===(t=e.toJSON)||void 0===t?void 0:t.call(e)),key:"description-read"+this.state.fieldDescriptionTips.fieldId,isShow:this.state.fieldDescriptionTips.show&&(!this.state.fieldDescriptionEditPanel.show||this.state.fieldDescriptionEditPanel.fieldId!==this.state.fieldDescriptionTips.fieldId),x:this.state.fieldDescriptionTips.x,y:this.state.fieldDescriptionTips.y,bitableStore:a,table:this.activeTable,gridWidget:S}),this.renderDataCounter()),x=[Q.qy.View,Q.qy.Table,Q.qy.Record,Q.qy.Field];if(!(r||x.some(function(e){return a.hasPermission(e,{tableId:d,viewId:c},Q.ry.Editable)})||x.some(function(e){return a.hasPermission(e,{tableId:d,viewId:c},Q.ry.Addable)})||x.some(function(e){return a.hasPermission(e,{tableId:d,viewId:c},Q.ry.Deletable)})))return te.a.createElement("div",{className:"faster-overlay"},O);var E=this.state,T=E.showNewField,k=E.newFieldPosition,j=E.editFieldPosition,B=E.editFieldId,V=E.currentFieldType,R=E.isFirstField,L=E.showStatList,D=E.statListLeft,M=E.statListTop,P=E.direction,N=E.floatLayerTooltip,z=E.showFieldPanel,W=E.newFieldType,H=E.newFieldUIType,U=E.newFieldGroupType,K=E.isListHoverTipVisible,q=this.activeView?this.activeView.getFieldStatType(B):void 0,Y=this.activeTable&&this.activeTable.fields[this.state.editFieldId],J=this.activeTable&&this.activeTable.fields[this.state.fieldDescriptionEditPanel.fieldId],Z=this.props.viewLayerOverlay||void 0,X=Q.cL[N.tipType];return null==q&&(q=R?Q.UK.CountAll:Q.sy.instance.get(V).defaultStatType||Q.UK.None),te.a.createElement(ee.Fragment,null,te.a.createElement("div",{className:"faster-overlay",ref:this.setRef},te.a.createElement(Q.vL,{container:Z,x:N.x,y:N.y,width:_.width,height:_.height,title:X,visible:N.show,className:"bitable-float-layer-tooltip J-bitable-float-layer-tooltip",style:_.style,showArrow:_.showArrow}),O,T&&te.a.createElement(Q.fz,{fromType:Q.gz.HeaderColumnAdd,newFieldType:W,newFieldUIType:H,newFieldGroupType:U,x:k.x,y:k.y-2,onClose:function(){return n.hiddenNewField()},table:this.activeTable,ref:function(e){return n.newFieldComp=e},bitableStore:a,renderer:l,getAnchorRef:this.getOverlayRef,vLayoutInfo:Be,getPositionOffset:this._getFieldCardOffset,view:this.activeView,source:Q.gJ.ColumnContextMenu,isListHoverTipVisible:K,setFieldHoverTipVisible:function(e){return n.setFieldHoverTipVisible(e)}}),C&&Y&&te.a.createElement(Q.hz,{fromType:Q.gz.HeaderColumnEdit,key:Y.id,onClose:this.hiddenEditField.bind(this),x:j.x,y:j.y-2,field:Object.assign({},Y.toJSON(),{fieldUIType:Y.fieldUIType}),isFirstField:R,ref:function(e){return n.editFieldComp=e},table:this.activeTable,bitableStore:a,renderer:l,getAnchorRef:this.getOverlayRef,handleTypeChange:this.handleTypeChange,vLayoutInfo:Be,getPositionOffset:this._getFieldCardOffset,view:this.activeView,source:Q.iz.Column,isListHoverTipVisible:K,setFieldHoverTipVisible:function(e){return n.setFieldHoverTipVisible(e)}}),te.a.createElement(oe,{key:"edit-field-desc-".concat((null==J?void 0:J.id)||"default"),field:null==J||null===(i=J.toJSON)||void 0===i?void 0:i.call(J),isShow:this.state.fieldDescriptionEditPanel.show,viewId:this.props.viewId,x:this.state.fieldDescriptionEditPanel.x,y:this.state.fieldDescriptionEditPanel.y,bitableStore:a,table:this.activeTable,onCancel:function(){return n.setState({fieldDescriptionEditPanel:Object.assign({},n.state.fieldDescriptionEditPanel,{show:!1})})},onSubmit:function(e){}}),z&&te.a.createElement(ie.a,{isOpen:z,toggleFieldPanel:this.toggleFieldPanel,bitableStore:a,tableId:d,getOffsetX:g,renderer:l,anchorInfo:{getAnchorRef:this.getOverlayRef,anchorWidth:Q.dL+S._leftColHeader.width+S.rowHeaderWidth-Q.eL.padding[1]-Q.fL-Q.gL/2}}),a.isEmbeddedInDoc&&L&&te.a.createElement(Q.hL,{showStatList:L,x:D,y:M,overlay:this.getOverlayRef(),direction:P,onSubmit:this.editStatSubmit.bind(this),onClose:this.hiddenStatList.bind(this),fieldType:V,statType:q,headerBottom:this.colHeaderBottom,collectEvent:this.collectArggregateEvent,bitableStore:a})),F&&te.a.createElement("div",{className:"bottom-border"}),!a.isEmbeddedInDoc&&L&&te.a.createElement(Q.hL,{showStatList:L,x:D,y:M,overlay:this.getOverlayRef(),direction:P,onSubmit:this.editStatSubmit.bind(this),onClose:this.hiddenStatList.bind(this),fieldType:V,statType:q,headerBottom:this.colHeaderBottom,collectEvent:this.collectArggregateEvent,bitableStore:a}),this.renderNewCardEditor())}}]),n}(te.a.PureComponent))||q)||q)||q}.call(this,Le("vb163"))},vb292:function(e,t,i){"use strict";var n,o,l,r;i.d(t,"a",function(){return o}),i.d(t,"b",function(){return n}),(r=n||(n={})).GridContentContextMenu="GridContentContextMenu",r.GridFieldHeaderMenu="GridFieldHeaderMenu",r.GridGroupTitleContextMenu="GridGroupTitleContextMenu",r.KanbanCardContextMenu="KanbanContextMenu",r.KanbanCardListMoreContextMenu="KanbanCardListMoreContextMenu",r.GalleryCardContextMenu="GalleryCardContextMenu",r.GanttBarContextMenu="GanttBarContextMenu",r.BlockCreationMenu="BlockCreationMenu",r.BlockContextMenu="BlockContextMenu",(l=o||(o={})).InsertAbove="InsertAbove",l.InsertBelow="InsertBelow",l.InsertLeft="InsertLeft",l.InsertRight="InsertRight",l.ExpendRow="ExpendRow",l.CopyLink="CopyLink",l.Comment="Comment",l.FilterItem="FilterItem",l.Reminder="Reminder",l.DeleteRecord="DeleteRecord",l.ExpendSubGroups="ExpendSubGroups",l.FoldSubGroups="FoldSubGroups",l.ModifyField="ModifyField",l.ModifyDescription="ModifyDescription",l.DuplicateField="DuplicateField",l.InsertFieldLeft="InsertFieldLeft",l.InsertFieldRight="InsertFieldRight",l.FrozenField="FrozenField",l.SetSortAZ="SetSortAZ",l.SetSortZA="SetSortZA",l.SetGroup="SetGroup",l.SetFilter="SetFilter",l.CreateView="CreateView",l.HideField="HideField",l.DeleteField="DeleteField",l.CopyRecord="CopyRecord",l.GroupRename="GroupRename",l.DeleteGroup="DeleteGroup",l.ExportAttachment="ExportAttachment",l.DeleteGanttTask="DeleteGanttTask",l.AddTable="AddTable",l.AddDashboard="AddDashboard",l.RenameBlock="RenameBlock",l.CopyTable="CopyTable",l.DeleteBlcok="DeleteBlcok",l.CopyBlock="CopyBlock"},vb326:function(e,t,i){"use strict";function n(e){var t;return(null==e||null===(t=e.ui)||void 0===t?void 0:t.showComment)||!1}function o(e){return!(null!=e&&e.disableReminder)}i.d(t,"a",function(){return o}),i.d(t,"b",function(){return n})},vb342:function(e,t,i){"use strict";i.d(t,"a",function(){return n});var s=i("vb143");i("vb147"),i("vb103"),i("vb148");function n(e,t,i){var n=e.getService(s.kx.PERMISSION);if(n){var o,l=n.getRecordConditions(i),r=Object(s.WB)(l);try{for(r.s();!(o=r.n()).done;){var a=o.value,d=a.fieldId,c=a.fieldType;if(t.id===d&&t.type===c)return!0}}catch(e){r.e(e)}finally{r.f()}}return!1}},vb356:function(e,n,o){"use strict";(function(c){o.d(n,"a",function(){return i}),o.d(n,"b",function(){return b});var e=o("vb152"),s=o.n(e),u=o("vb143");o("vb147"),o("vb103"),o("vb148");function b(e,t,i,n){var o=Object(u.uO)({table:e,view:t,record:i,field:n});return"".concat(location.origin).concat(location.pathname,"?").concat(o)}var t,i=(t=Object(u.uY)(s.a.mark(function e(t){var i,n,o,l,r,a,d;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return i=t.viewId,n=t.tableId,o=t.recordId,l=t.fieldId,r=t.onCopy,a=void 0===r?function(){return!0}:r,d=b(n,i,o,l),e.next=4,a(d);case 4:e.sent?u.ob.Toast.show({type:"info",content:c("Bitable_Record_CopyLinkSuccessfullyToast"),duration:3e3,closable:!1}):u.ob.Toast.show({type:"info",content:c("Bitable_Record_UnableToCopyLinkToast"),duration:3e3,closable:!1});case 6:case"end":return e.stop()}},e)})),function(e){return t.apply(this,arguments)})}).call(this,o("vb163"))},vb358:function(e,t,i){"use strict";i.d(t,"a",function(){return d}),i.d(t,"b",function(){return p}),i.d(t,"c",function(){return a}),i.d(t,"d",function(){return c});var n,o,b=i("vb143"),l=(Object(b.Ww)(n={},b.og.SingleSelect,b.zL.Rename),Object(b.Ww)(n,b.og.MultiSelect,b.zL.Rename),Object(b.Ww)(n,b.og.User,b.zL.ChangeThePerson),Object(b.Ww)(n,b.og.SingleLink,b.zL.ChangeTheRecord),Object(b.Ww)(n,b.og.DuplexLink,b.zL.ChangeTheRecord),n),r=(Object(b.Ww)(o={},b.og.User,b.Rw.CcmMentionPanelView),Object(b.Ww)(o,b.og.SingleLink,b.Rw.CcmBitableRelationFieldModifyView),Object(b.Ww)(o,b.og.DuplexLink,b.Rw.CcmBitableRelationFieldModifyView),o),a=function(e){b.cz.collectClickEvent(b.Bc.CcmBitableKanbanGroupMoreClick,{click:l[e.type],target:r[e.type]})},d=function(e,t){b.cz.collectClickEvent(b.Bc.CcmBitableRecordOperateClick,Object.assign({click:e},t))},p=function(e,t,i){b.cz.collectClickEvent(b.Bc.CcmBitableFieldOperateClick,Object.assign({click:b.AL[e],target:i||b.Rw.None},t))},c=function(e,t,i){var n=i.isIndexColumn,o=i.fieldType,l=i.indexes,r=i.tempFrozenColCount;if(Object(b.kD)(e)){var a=e.getFrozenColumnCount(),d=a,c=l[0],s=e.mapVisibleColToRealCol(c);(t===b.BL.InsertLeft?s:s+1)<a&&(d+=1);var u=0===r?0:e.mapVisibleColToRealCol(r-1)+1;if(a!==d)return void p(t,{is_index_column:n,field_type:o,before_freeze_field_count:a,after_freeze_field_count:d,is_temporary_frozen:(u<d).toString()})}p(t,{is_index_column:n,field_type:o})}},vb382:function(e,U,K){"use strict";(function(h){K.d(U,"a",function(){return H}),K.d(U,"b",function(){return k}),K.d(U,"c",function(){return T}),K.d(U,"d",function(){return E}),K.d(U,"e",function(){return j});var _=K("vb143"),e=K("vb196"),t=K("vb185"),i=K("vb103"),I=K.n(i),n=(K("vb147"),K("vb148"),K("vb152")),u=K.n(n),o=K("vb159"),F=K.n(o),l=K("vb114"),g=K("vb201"),r=K("vb111"),a=K("vb2183"),d=K("vb540"),p=K("vb952"),v=K("vb2201"),f=K("vb2173"),w=K("vb2177"),b=(K("vb112"),K("vb164"),K("vb167"),K("vb113"),K("vb342")),m=(K("vb174"),K("vb155"),Object(g.SortableHandle)(function(e){var t=e.draggable,i=e.preCls;return I.a.createElement(a.a,{className:F()("".concat(i,"__field-dragbar"),Object(_.Ww)({},"".concat(i,"__field-function_disabled"),!t))})})),c=function(n){function o(){var l;Object(_.ov)(this,o);for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];return(l=n.call.apply(n,[this].concat(t))||this).handleMoreClick=function(e){var t=l.props,i=t.onContextMenu,n=t.field,o=t.onClickFieldMore;o&&o(n),i(e,n)},l}return Object(_.bu)(o,n),Object(_.Pw)(o,[{key:"componentDidUpdate",value:function(e){e.fieldEditable&&!this.props.fieldEditable&&(this.props.hiddenFieldCard(!0),this.props.closeContextMenu())}},{key:"renderPrimaryFieldTooltip",value:function(){if(_.ob.config.ui.hidePrimaryFieldTooltip)return null;var e=this.props.preCls;return I.a.createElement(r.Tooltip,{title:h("bitable.field.primary_tip"),placement:"top",mouseEnterDelay:200},I.a.createElement(d.a,{className:"".concat(e,"__field-lock")}))}},{key:"render",value:function(){var e=this.props,t=e.draggable,i=e.preCls,n=e.field,o=e.isPrimaryField,l=e.visible,r=e.contextMenuOpen,a=e.handleToggleHiddenField,d=e.fieldEditable,c=e.fieldMovable,s=Object(_.aD)(n),u=Object(_.Uw)(s),b=l?p.a:v.a;return I.a.createElement("div",{className:"".concat(i,"__item_wrapper")},I.a.createElement("div",{className:F()("".concat(i,"__item ").concat(i,"__field"),Object(_.Ww)({},"".concat(i,"__item ").concat(i,"__field_invisible"),!l))},o?this.renderPrimaryFieldTooltip():c?I.a.createElement(m,{draggable:t,preCls:i}):null,I.a.createElement(u,{className:"".concat(i,"__field-type")}),I.a.createElement("span",{className:"".concat(i,"__field-name bitable-noselect")},n.name),o?null:I.a.createElement("div",{className:"bitable-common-hover-press-background icon-background bitable-layout-row bitable-layout-cross-center",style:{marginLeft:4,cursor:"pointer"},onClick:function(){return a(n)}},I.a.createElement(b,{className:F()("".concat(i,"__field-visible"))})),d&&I.a.createElement("div",{onClick:this.handleMoreClick,className:"bitable-common-hover-press-background icon-background bitable-layout-row bitable-layout-cross-center",style:{marginLeft:4,cursor:"pointer"}},I.a.createElement(f.a,{className:F()("".concat(i,"__field-more"),Object(_.Ww)({},"".concat(i,"__field-more_open"),r))}))))}}]),o}(i.Component),C=Object(_.oA)(function(e,t){var i=e.permissionStore,n=t.tableId,o=t.fieldId;return{fieldEditable:i.hasPermission(_.qy.Field,{tableId:n,fieldId:o},_.ry.Editable),fieldMovable:i.hasPermission(_.qy.Field,{tableId:n,fieldId:o},_.ry.Movable)}},void 0,function(i,e,t){t(function(e){var t=i.permissionStore;return t.subscribe(e),function(){return t.unsubscribe(e)}})})(c),s=40,S=36,O=8,x=12,y=40,E=36,T=80,k=42,j=32,B=4,V=2*B+1,R=10,L=8,D=Object(g.SortableElement)(function(e){var t=e.fieldMap,i=e.isPrimaryField,n=e.draggable,o=e.preCls,l=e.hiddenFieldsSet,r=e.contextMenuSelectField,a=e.fieldId,d=e.onContextMenu,c=e.handleToggleHiddenField,s=e.tableId,u=e.hiddenFieldCard,b=e.closeContextMenu,p=e.onClickFieldMore;return I.a.createElement(C,{field:t[a],draggable:n,isPrimaryField:i,preCls:o,visible:!l.has(a),contextMenuOpen:!!r&&r.id===a,onContextMenu:d,handleToggleHiddenField:c,tableId:s,fieldId:a,hiddenFieldCard:u,closeContextMenu:b,onClickFieldMore:p})}),M=Object(g.SortableContainer)(function(n){function o(){var y;Object(_.ov)(this,o);for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];return(y=n.call.apply(n,[this].concat(t))||this).getCurItem=function(){return y.props.editingField?document.querySelector(".".concat(y.props.editingField.id)):null},y.getPositionOffset=function(){var e=y.props,t=e.preCls,i=e.editingField;if(i){var n=document.querySelector(".".concat(i.id)),o=document.querySelector(".".concat(t));if(n&&o)return{x:0,y:n.getBoundingClientRect().y-o.getBoundingClientRect().y}}return{x:0,y:0}},y.renderRow=function(e){var t=e.index,i=e.style,n=y.props,o=n.fieldList,l=n.preCls,r=n.editingField,a=n.fieldMap,d=n.contextMenuSelectField,c=n.hiddenFieldsSet,s=n.onContextMenu,u=n.handleToggleHiddenField,b=n.hiddenFieldCard,p=n.onClickFieldMore,v=n.activeTable,f=n.closeContextMenu,m=n.frozenColInfo,h=o[t],g=0!==t,w=null;if(0!==t&&(null==m?void 0:m.renderDivider)&&m.dividerIndex===t){var C={position:"absolute",top:i.top-B-1};w=I.a.createElement("div",{className:"".concat(l,"__frozen_divider"),style:C})}return I.a.createElement(I.a.Fragment,null,w,I.a.createElement("div",{className:F()("".concat(l,"__fields__field-wrap ").concat(h),{"bitable-field-editing":r&&r.id===h}),key:h,style:i},I.a.createElement(D,{fieldMap:a,fieldId:h,index:t,isPrimaryField:h===v.getPrimaryKey(),preCls:l,contextMenuSelectField:d,hiddenFieldsSet:c,onContextMenu:s,disabled:!g,draggable:g,handleToggleHiddenField:u,tableId:v.id,hiddenFieldCard:b,closeContextMenu:f,onClickFieldMore:p})))},y.setVirtualListRef=function(e){y.virtualListRef=e},y.getRowExtraOffset=function(e){var t=y.props.frozenColInfo;return null!=t&&t.renderDivider&&0!==t.dividerIndex&&e>=t.dividerIndex?V:0},y}return Object(_.bu)(o,n),Object(_.Pw)(o,[{key:"componentDidUpdate",value:function(e){if(this.virtualListRef){var t=!Object(l.shallowEqual)(e.frozenColInfo,this.props.frozenColInfo);Object(l.shallowEqual)(e.hiddenFieldsSet,this.props.hiddenFieldsSet)&&Object(l.shallowEqual)(e.fieldMap,this.props.fieldMap)&&!t||(t&&this.virtualListRef.clearItemStyleCache(),this.virtualListRef.forceUpdate())}}},{key:"render",value:function(){var e=this.props,t=e.preCls,i=e.fieldList,n=e.editingField,o=e.activeTable,l=e.activeView,r=e.setEditFieldCompRef,a=e.hiddenFieldCard,d=e.onFieldEdited,c=e.sorting,s=e.bitableStore,u=e.renderer,b=e.className,p=e.contentHeight,v=e.isListHoverTipVisible,f=e.setFieldHoverTipVisible,m=!1,h=!1;if(n&&i){var g=i.indexOf(n.id);-1!==g&&(m=!0,h=0===g)}return I.a.createElement(I.a.Fragment,null,I.a.createElement(_.VD,{className:F()("".concat(t,"__fields-wrap"),"b-ud-scrollbar",b,Object(_.Ww)({},"".concat(t,"__fields-wrap_sorting"),c)),itemSize:S,ref:this.setVirtualListRef,itemCount:i.length,width:"100%",height:p,getRowExtraOffset:this.getRowExtraOffset},this.renderRow),n&&m&&I.a.createElement(_.hz,{fromType:_.gz.FloatToolbarEdit,getAnchorRef:this.getCurItem,getPositionOffset:this.getPositionOffset,x:260,y:0,onClose:a,onFieldEdited:d,table:o,field:Object.assign({},n,{fieldUIType:Object(_.aD)(n)}),bitableStore:s,isFirstField:h,ref:r,renderer:u,vLayoutInfo:{offsetUp:-S},view:l,source:_.iz.Toolbar,isListHoverTipVisible:void 0!==v&&v,setFieldHoverTipVisible:f&&function(e){return f(e)}}))}}]),o}(i.Component)),P=function(i){function n(e){var m,t;return Object(_.ov)(this,n),(m=i.call(this,e)||this).collectFieldSetClickEvent=function(e,t){var i=m.props.renderer;if(Object(_.kD)(i.getActiveView())){var n=i.activeBitableWidget.getGridWidget().source.frozen.isTempFrozen;_.cz.collectClickEvent(_.Bc.CcmBitableFieldSetClick,Object.assign({click:e,is_temporary_frozen:n.toString()},t))}else _.cz.collectClickEvent(_.Bc.CcmBitableFieldSetClick,Object.assign({click:e},t))},m.hiddenFieldCard=function(){var e=m.state,t=e.editingField,i=e.showNewField,n=e.isListHoverTipVisible;m.isEdited&&!m.isForceCloseFieldCard||(t||i)&&(n||(m.newFieldCompRef=null,m.editFieldCompRef=null,m.setState({editingField:null,showNewField:!1})))},m.onFieldEdited=function(e,t){m.isEdited=e,m.isForceCloseFieldCard=t},m.handleAddClick=function(){m.collectFieldSetClickEvent(_.xD.FieldAdd),m.setState({showNewField:!0})},m.setAddFieldRef=function(e){m.newFieldCompRef=e},m.setEditFieldRef=function(e){m.editFieldCompRef=e},m.setAddItemRef=function(e){m.addItemRef=e},m.getAddItemRef=function(){return m.addItemRef},m.editField=function(){var e=m.props,t=e.source,i=e.module,n=m.state.contextMenuSelectField;m.setState(function(e){return{editingField:e.contextMenuSelectField}},function(){m.closeContextMenu(),_.ob.collectBitableEvent(_.On.BitableFieldOpenEditor,{table_id:m.activeTable.id,view_id:m.activeView.id,bitable_view_type:_.Cz[m.activeView.type],source:t,data_source:i}),n&&m.collectFieldSetClickEvent(_.xD.FieldEdit,{field_type:_.lC[n.fieldUIType]})})},m.deleteField=function(){var e,i=m.state.contextMenuSelectField;if(i){var t,n=m.props,o=n.bitableStore,l=n.tableId,r=Object(b.a)(o,i,l),a=(null===(e=m.state.contextMenuSelectField)||void 0===e?void 0:e.type)===_.og.DuplexLink,d=i.name,c="".concat(h("common.undo"),"(").concat(_.JD.undo,")"),s=h("Bitable_Field_DeleteFieldPopupTitleNew",{num:1});t=h(a?"Bitable_Field_DeleteFieldWithDuplexLinkDesc":"Bitable_Field_DeleteFieldPopupDescNew",{num:1},d,c),r&&(s=h("Bitable_AdvancedPermission_DeleteFieldPopupTitle"),t=h("Bitable_AdvancedPermission_DeleteFieldPopupDesc",d,c)),Object(_.rB)({title:s,message:t,buttons:[{text:h("common.cancel"),type:_.YA.default},{text:h("sheet.confirm_delete"),type:_.YA.warn,onClick:function(){var e=Object(_.uY)(u.a.mark(function e(){return u.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,m.excuteDeleteField(i);case 2:case"end":return e.stop()}},e)}));function t(){return e.apply(this,arguments)}return t}()}]}),i&&m.collectFieldSetClickEvent(_.xD.FieldDelete,{field_type:_.lC[i.fieldUIType]}),i&&_.cz.collectClickEvent(_.Bc.CcmBitableFieldDeleteClick,{scene_type:_.yE.TopBoard,field_type:_.lC[i.fieldUIType],target:_.Rw.None})}},m.excuteDeleteField=(t=Object(_.uY)(u.a.mark(function e(t){var i,n,o;return u.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return i=m.props,n=i.onFieldDelete,o=i.module,e.next=3,n(t.id);case 3:_.ob.collectBitableEvent(_.On.BitableFieldDelete,{table_id:m.activeTable.id,view_id:m.activeView.id,bitable_view_type:_.Cz[m.activeView.type],bitable_field_type:_.lC[t.fieldUIType],scene:_.zE.Toolbar,data_source:o},!0);case 4:case"end":return e.stop()}},e)})),function(e){return t.apply(this,arguments)}),m.onContextMenu=function(e,o){var t=m.state.contextMenuSelectField;if(t&&t.id===o.id)m.closeContextMenu();else{var l=e.currentTarget,i=Object(_.mB)(l),r={x:i.right+R,y:i.top-L};m.setState({contextMenuSelectField:o},function(){var e=m.props,t=e.fieldList,i=e.isEditFieldEnabled,n=[{text:h("common.edit"),onClick:m.editField,disabled:i(o.id)||Object(_.Xy)(o.fieldUIType),icon:I.a.createElement(_.IB.EditIconSvg,{className:"icon bitable-field__contextmenu-icon"})},{text:h("common.delete"),onClick:m.deleteField,icon:I.a.createElement(_.IB.DeleteIconSvg,{className:"icon bitable-field__contextmenu-icon"})}];0===t.indexOf(o.id)&&n.pop(),m.closeCtxMenu=Object(_.NB)({x:r.x,y:r.y,items:n,triggerElement:l,onClose:function(){m.setState({contextMenuSelectField:null})},className:"bitable-field__contextmenu-more"})}),e.persist()}},m.onClickFieldMore=function(e){var t=m.props.fieldList;e&&m.collectFieldSetClickEvent(_.xD.FieldMore,{field_type:_.lC[e.fieldUIType],is_index_column:String(0===t.indexOf(e.id))})},m.closeContextMenu=function(){m.closeCtxMenu&&m.closeCtxMenu(!0)},m.collectFieldSetEvent=function(e){var t=m.props,i=t.isEmbeddedInDoc,n=t.module,o=i?"doc":void 0;_.ob.collectBitableEvent(_.On.BitableFieldSet,Object.assign({table_id:m.activeTable.id,view_id:m.activeView.id,bitable_view_type:_.Cz[m.activeView.type],source:_.iz.Toolbar},e,{data_source:n,module:o}),!0)},m.handleSortStart=function(){m.setState({sorting:!0})},m.handleSortOver=function(e){var t=e.oldIndex,i=e.newIndex,n=m.props,o=n.renderer,l=n.frozenColInfo,r=n.resetFrozenColInfo,a=o.getActiveView();if(Object(_.kD)(a)&&l&&r){var d=l.dividerIndex;t<d&&d<=i?d--:d<=t&&i<d&&d++,r(d+l.deniedColCount)}},m.handleSortEnd=function(e){var t=e.oldIndex,i=e.newIndex,n=m.props,o=n.fieldList,l=n.allFieldList,r=n.fieldMap,a=n.renderer,d=n.onMoveField,c=a.getActiveView(),s=Object(g.arrayMove)(o,t,i);if(t=l.indexOf(o[t]),i=l.indexOf(o[i]),c&&c.viewPermission.publicLevel===_.fB.LOCKED)a.activeBitableWidget.events.emit(_.kC.ShowViewLockedModal,"toolbar");else{var u=r[l[t]],b=0;Object(_.kD)(c)&&(b=c.getFrozenColumnCount()),d(u.id,t<i?i+1:i);var p,v,f=0;Object(_.kD)(c)&&(f=c.getFrozenColumnCount(),null===(p=(v=m.props).resetFrozenColInfo)||void 0===p||p.call(v,f)),_.ob.collectBitableEvent(_.On.BitableColumnMove,{table_id:m.activeTable.id,view_id:m.activeView.id,bitable_view_type:_.Cz[m.activeView.type],bitable_field_type:_.lC[u.fieldUIType],data_source:m.props.bitableStore.Options.module,source:_.iz.Toolbar},!0),m.collectFieldDragEvent(c,t,i,b,f),m.setState({sorting:!1,fieldList:s})}},m.handleToggleHiddenField=function(e){var t=m.props,i=t.hiddenFieldsSet,n=t.renderer,o=t.onSetFieldHidden,l=n.getActiveView();if(l&&l.viewPermission.publicLevel===_.fB.LOCKED)n.activeBitableWidget.events.emit(_.kC.ShowViewLockedModal,"toolbar");else{var r=i.has(e.id);o(e.id,!r||null),m.collectFieldSetEvent({action:"change_visibility",visibility:r?1:0}),m.collectFieldSetClickEvent(_.xD.VisibleClick,{is_visible:r?"visible":"invisible",field_type:_.lC[e.fieldUIType]})}},m.state={contextMenuSelectField:null,editingField:null,showNewField:!1,sorting:!1,frozenColumnCount:m.getFrozenColCount(),isListHoverTipVisible:!1,fieldList:m.props.fieldList},m.updateActiveModel(e),m}return Object(_.bu)(n,i),Object(_.Pw)(n,[{key:"componentDidMount",value:function(){this.setState({fieldList:this.props.fieldList})}},{key:"UNSAFE_componentWillReceiveProps",value:function(e){this.props.tableId===e.tableId&&this.props.viewId===e.viewId||this.updateActiveModel(e),!this.props.hideAddField&&e.hideAddField&&this.state.showNewField&&this.hiddenFieldCard(),this.setState({fieldList:e.fieldList})}},{key:"updateActiveModel",value:function(e){var t=e.bitableStore,i=e.tableId,n=e.viewId,o=t.base.getTableById(i),l=o&&o.getViewById(n);o&&l&&(this.activeTable=o,this.activeView=l)}},{key:"getFrozenColCount",value:function(){var e=this.props.renderer.getActiveView(),t=null;return Object(_.kD)(e)&&(t=e.getFrozenColumnCount()),t}},{key:"collectFieldDragEvent",value:function(e,t,i,n,o){e&&Object(_.kD)(e)&&n!==o?this.collectFieldSetClickEvent(_.xD.FieldDrag,{from_field_idx:t,to_field_idx:i,before_freeze_field_count:n,after_freeze_field_count:o,is_index_column:"false",is_change_freeze_range:"true"}):this.collectFieldSetClickEvent(_.xD.FieldDrag,{from_field_idx:t,to_field_idx:i})}},{key:"setFieldHoverTipVisible",value:function(e){this.setState({isListHoverTipVisible:e}),this.props.setListHoverTipVisible(e)}},{key:"render",value:function(){var t=this,e=this.props,i=e.fieldMap,n=e.hideAddField,o=e.hiddenFieldsSet,l=e.bitableStore,r=e.renderer,a=e.contentHeight,d=e.frozenColInfo,c=this.state.fieldList,s=this.state,u=s.showNewField,b=s.contextMenuSelectField,p=s.editingField,v=s.sorting,f=s.isListHoverTipVisible,m="bitable-field";return I.a.createElement(I.a.Fragment,null,I.a.createElement(M,{helperClass:"".concat(m,"__dragging"),lockAxis:"y",useDragHandle:!0,onSortStart:this.handleSortStart,onSortEnd:this.handleSortEnd,onSortOver:this.handleSortOver,frozenColInfo:d,preCls:m,fieldList:c,fieldMap:i,contentHeight:a,hiddenFieldsSet:o,contextMenuSelectField:b,editingField:p,onContextMenu:this.onContextMenu,activeView:this.activeView,activeTable:this.activeTable,setEditFieldCompRef:this.setEditFieldRef,hiddenFieldCard:this.hiddenFieldCard,onFieldEdited:this.onFieldEdited,bitableStore:l,handleToggleHiddenField:this.handleToggleHiddenField,sorting:v,renderer:r,className:n?"":"".concat(m,"__fields-wrap-border"),closeContextMenu:this.closeContextMenu,onClickFieldMore:this.onClickFieldMore,isListHoverTipVisible:f,setFieldHoverTipVisible:function(e){return t.setFieldHoverTipVisible(e)}}),!n&&I.a.createElement("div",{ref:this.setAddItemRef,onClick:this.handleAddClick,className:F()("".concat(m,"__add ").concat(m,"__item"),{"list-hover-tip-open":f&&u})},I.a.createElement(w.a,{className:"".concat(m,"__add-icon")}),I.a.createElement("span",{className:"".concat(m,"__add-text bitable-noselect")},h("bitable.create_field")),u&&I.a.createElement(_.fz,{fromType:_.gz.FloatToolbarAdd,x:256,y:0,getAnchorRef:this.getAddItemRef,onClose:this.hiddenFieldCard,table:this.activeTable,ref:this.setAddFieldRef,bitableStore:l,renderer:r,vLayoutInfo:{offsetUp:-32},view:this.activeView,isListHoverTipVisible:f,setFieldHoverTipVisible:function(e){return t.setFieldHoverTipVisible(e)}})))}}]),n}(i.Component),N=Object(_.oA)(function(e){var t=e.env;return{module:t.getModuleType(),isEmbeddedInDoc:t.isEmbeddedType(_.pA.EmbeddedInDoc)}},function(e,t){var i=e.operate,n=e.base,o=t.tableId,l=t.viewId,r=n.getTable(o);function a(e){return i.tableOperate.delField({tableId:o,viewId:l,fieldId:e})}function d(e){if(r){var t=r.getField(e);return!!t&&Object(_.AE)(t)}return!1}function c(e,t){i.tableOperate.moveFieldSync({fields:[e],tableId:o,target:t,viewId:l})}function s(e,t){i.tableOperate.setFieldHiddenSync({fieldIds:[e],hidden:t,tableId:o,viewId:l})}return{onFieldDelete:a,isEditFieldEnabled:d,onMoveField:c,onSetFieldHidden:s}})(P),z=function(e){function t(){return Object(_.ov)(this,t),e.apply(this,arguments)||this}return Object(_.bu)(t,e),Object(_.Pw)(t,[{key:"render",value:function(){var e=this.props,t=e.title,i=e.action,n="bitable-field";return I.a.createElement("div",{className:"".concat(n,"__title-wrap")},I.a.createElement("div",{className:"bitable-noselect ".concat(n,"__title ").concat(n,"__item")},I.a.createElement("span",null,t,I.a.createElement(_.uD,{action:i}))))}}]),t}(i.PureComponent),W=function(t){function i(e){var u;return Object(_.ov)(this,i),(u=t.call(this,e)||this).resetFrozenColInfo=function(e){var t=u.props,i=t.renderer,n=t.fieldList,o=i.getActiveView(),l=!1,r=-1,a=0;if(Object(_.kD)(o)){e=e||o.getFrozenColumnCount();for(var d=o.getAllFields(),c=0;c<e;c++)o.table.isDeniedField(d[c])&&a++;0<=e&&e<n.length&&(l=!0,r=e-a)}var s=u.state.frozenColInfo;l===s.renderDivider&&r===s.dividerIndex||u.setState({frozenColInfo:{renderDivider:l,dividerIndex:r,deniedColCount:a}})},u.handleDocumentClick=function(e){if(u.props.isOpen&&!u.state.isListHoverTipVisible){for(var t=e.target;t;){if(t.className&&t.className.indexOf){var i,n;if(~t.className.indexOf("bitable-float-toolbar-btn-field")||~t.className.indexOf("toolbar-field-wrapper"))return void(u.fieldList&&u.fieldList.hiddenFieldCard());if(t.className.match(/(b-field-popover)|(bitable-field-popover)|(bitable-view-locked-tip-modal)|(J-bitable-alert)|(ellipsis)|(bitable-dropdown--list-title)|(bitable_autoNumber_field)|(field-option-list)/)||null!==(i=document)&&void 0!==i&&null!==(n=i.querySelector(".select-dropdown--list"))&&void 0!==n&&n.contains(t))return;if(t===u.state.selfRef||~t.className.indexOf("bitable-field__contextmenu-more")||"spark-popup"===t.getAttribute("data-sel"))return void(u.fieldList&&u.fieldList.hiddenFieldCard())}t=t.parentElement}u.fieldList&&u.fieldList.hiddenFieldCard(),u.toggleFieldPanel(u.props.tableId,!1)}},u.toggleFieldPanel=function(e,t){var i=u.props,n=i.toggleFieldPanel,o=i.setFloatToolbarVisibility;i.embeddedType===_.pA.EmbeddedInDoc&&o(t),n(t)},u.setSelfRef=function(e){u.setState({selfRef:e})},u.setFieldListRef=function(e){u.fieldList=e},u.setListHoverTipVisible=function(e){u.setState({isListHoverTipVisible:e})},u.state={selfRef:null,frozenColInfo:{renderDivider:!1,dividerIndex:-1,deniedColCount:0},isListHoverTipVisible:!1},u}return Object(_.bu)(i,t),Object(_.Pw)(i,[{key:"componentDidMount",value:function(){document.addEventListener("mousedown",this.handleDocumentClick),this.bitableContainer=Object(_.IC)(this.props.embeddedType)}},{key:"UNSAFE_componentWillReceiveProps",value:function(e){var t=this;if(this.props.isOpen!==e.isOpen){var i=e.tableId,n=e.viewId,o=e.isOpen,l=e.renderer.getActiveView();if(!l)return;_.ob.collectBitableEvent(_.On.BitableOpenFieldsSetting,{table_id:i,view_id:n,bitable_view_type:_.Cz[l.type],is_open:o?1:0,source:"toolbar",data_source:this.props.module})}(this.props.tableId!==e.tableId||this.props.viewId!==e.viewId&&this.props.isOpen&&e.isOpen)&&this.toggleFieldPanel(this.props.tableId,!1),!this.props.isOpen&&e.isOpen&&(this.onShow(),this.resetFrozenColInfo()),(1===e.fieldList.length&&1<this.props.fieldList.length||1<e.fieldList.length&&1===this.props.fieldList.length)&&setTimeout(function(){return t.resetFrozenColInfo()},0)}},{key:"componentWillUnmount",value:function(){document.removeEventListener("mousedown",this.handleDocumentClick)}},{key:"onShow",value:function(){var e=this.props.renderer.getActiveView(),t=null==e?void 0:e.type,i=null==e?void 0:e.getColumnCount(),n=null==e?void 0:e.getVisibleFields().length,o=function(e){var t=null==e?void 0:e.toString();_.cz.collectBitableEvent(_.Rw.CcmBitableFieldSetView,{field_count:i,is_visible_field:t,visible_field_count:n})};t===_.az.Kanban?o(e.getCardConfig().showFieldName):t===_.az.Gallery?o(e.getGalleryConfig().showFieldName):o()}},{key:"getPanelOtherHeight",value:function(){var e=this.props,t=e.panelContentHeight,i=e.fieldAddable,n="number"==typeof t?t:0;return n+=this.props.panelTitle?y:0,i&&(n+=s),n}},{key:"getPanelStyle",value:function(){var e=this.props,t=e.anchorInfo,i=e.fieldList,n=e.fieldPanelWidth,o=void 0===n?_.CE:n,l=e.getOffsetX,r=e.isDeniedField,a=e.embeddedType,d=this.state,c=d.selfRef,s=d.frozenColInfo,u=t&&t.anchorWidth;u||(u=_.DE);var b={left:u-o/2,top:_.wC,transform:"none",width:o};l&&(b.left+=l());var p=s.renderDivider?V:0,v=i.filter(function(e){return!r(e)}).length*S+O+p+1;if(t){var f=null;t.isParent&&c?f=c.parentElement:t.getAnchorRef&&(f=t.getAnchorRef());var m=this.getPanelOtherHeight(),h=m+v+2;if(f){var g=a,w=g===_.pA.EmbeddedInDoc,C={height:h,offsetDown:w?_.vC:_.wC,offsetUp:w?_.xC:_.yC,paddingBottom:x,viewportTop:Object(_.zC)(g)},y={childSelector:".bitable-field .bitable-field__fields-wrap",otherHeight:m},I=Object(_.tC)(f,C,y),F=Object(_.BE)(f,C,y);F&&(v=F),Object.assign(b,I),Object(_.bE)(f,b,{width:o},this.bitableContainer)}}return{style:b,childContentHeight:v}}},{key:"render",value:function(){var e=this.props,t=e.isOpen,i=e.fieldList,n=e.fieldMap,o=e.hiddenFieldsSet,l=e.bitableStore,r=e.renderer,a=e.tableId,d=e.viewId,c=e.ExtraContent,s=e.panelTitle,u=e.guideAction,b=e.panelTitleDivider,p=e.fieldAddable;if(!t)return null;var v=r.getActiveTable(),f="bitable-field",m=this.getPanelStyle(),h=m.style,g=m.childContentHeight,w=!!this.state.selfRef,C=i;return v&&(C=i.filter(function(e){return!v.isDeniedField(e)})),I.a.createElement("div",{className:f,ref:this.setSelfRef,style:h},I.a.createElement(_.AC,{panelStyle:h}),s&&I.a.createElement(z,{tableId:a,title:s,action:u||_.WD.CustomizeColumns}),b&&I.a.createElement("div",{className:"".concat(f,"-divider")}),c,c&&I.a.createElement("div",{className:"".concat(f,"-divider")}),w&&I.a.createElement(N,{ref:this.setFieldListRef,bitableStore:l,tableId:a,viewId:d,fieldList:C,allFieldList:i,fieldMap:n,contentHeight:g,hiddenFieldsSet:o,renderer:r,hideAddField:!p,source:_.iz.Toolbar,frozenColInfo:this.state.frozenColInfo,resetFrozenColInfo:this.resetFrozenColInfo,setListHoverTipVisible:this.setListHoverTipVisible}))}}]),i}(i.Component),H=Object(e.a)(t.c,Object(t.b)(function(e){return{setFloatToolbarVisibility:e.toolbarStore.toggleFloatToolbar}}),Object(_.oA)(function(e,t){var i,n,o,l=e.permissionStore,r=e.base,a=e.env,d=t.tableId,c=r.getTable(d),s=null!==(i=null==c?void 0:c.getActiveViewId())&&void 0!==i?i:"",u=null==c?void 0:c.getView(s),b=null!==(n=null==u?void 0:u.getAllFields())&&void 0!==n?n:[],p=b.reduce(function(e,t){var i=c.getField(t);if(i){var n=i.getFieldUIType();e[t]={id:t,type:i.getType(),name:i.getName(),fieldUIType:n,allowedEditModes:i.getAllowedEditModes(),property:i.getProperty(),groupType:Object(_.EE)(n)}}return e},{}),v=new Set(null!==(o=null==u?void 0:u.getHiddenFields())&&void 0!==o?o:[]);return{fieldAddable:l.hasPermission(_.qy.Field,{tableId:d},_.ry.Addable),fieldList:Object(_.hI)(b),fieldMap:p,hiddenFieldsSet:v,viewId:s,embeddedType:a.getEmbeddedType(),module:a.getModuleType()}},function(e,t){var i=e.base,n=t.tableId,o=i.getTable(n);function l(e){return o.isDeniedField(e)}return{isDeniedField:l}},function(i,e,t){var n,o=e.tableId,l=i.base.getTable(o),r=null!==(n=null==l?void 0:l.getActiveViewId())&&void 0!==n?n:"";t(function(e){var t=i.permissionStore;return t.subscribe(e),function(){return t.unsubscribe(e)}}),t(function(e){var t;return null==l?void 0:l.batchBind((Object(_.Ww)(t={},_.uA.AddField,e),Object(_.Ww)(t,_.uA.DeleteField,e),Object(_.Ww)(t,_.uA.ActiveViewChange,e),Object(_.Ww)(t,_.uA.FieldAttrChange,e),t))},[o]),t(function(e){var t,i=null==l?void 0:l.getView(r);return null==i?void 0:i.batchBind((Object(_.Ww)(t={},_.uA.HiddenFieldChange,e),Object(_.Ww)(t,_.uA.MoveField,e),t))},[l,r])}))(W)}).call(this,K("vb163"))},vb413:function(e,t,i){"use strict";i.d(t,"a",function(){return u}),i.d(t,"b",function(){return n}),i.d(t,"c",function(){return o}),i.d(t,"d",function(){return l}),i.d(t,"e",function(){return a}),i.d(t,"f",function(){return b}),i.d(t,"g",function(){return s}),i.d(t,"h",function(){return c}),i.d(t,"i",function(){return d});var r=i("vb143"),n=function(e){var t=e.permission,i=e.editable,n=e.tableId,o=e.recordId,l=e.viewId;return i&&t.hasPermission(r.qy.Record,{tableId:n,viewId:l,recordId:o},r.ry.Editable)},o=function(e){var t=e.fieldId,i=e.permission,n=e.tableId;return i.hasPermission(r.qy.Field,{tableId:n,fieldId:t},r.ry.Editable)},l=function(e){var t=e.permission,i=e.tableId;return t.hasPermission(r.qy.Field,{tableId:i},r.ry.Addable)},a=function(e){var t=e.permission,i=e.tableId,n=e.fieldId;return t.hasPermission(r.qy.Field,{tableId:i,fieldId:n},r.ry.Copyable)},d=function(e){var t=e.permission,i=e.view,n=e.tableId,o=e.fieldIndexes,l=i.getVisibleFields();return o.map(function(e){return l[e]}).every(function(e){return t.hasPermission(r.qy.Field,{tableId:n,viewId:i.id,fieldId:e},r.ry.Deletable)})},c=function(e){var t=e.permission,i=e.tableId;return t.hasPermission(r.qy.View,{tableId:i},r.ry.Addable)},s=function(e){var t=e.permission,i=e.editable,n=e.tableId;return i&&t.hasPermission(r.qy.Record,{tableId:n},r.ry.Addable)},u=function(e){var t=e.permission,i=e.editable,n=e.tableId,o=e.viewId,l=e.recordId;return i&&t.hasPermission(r.qy.Record,{tableId:n,viewId:o,recordId:l},r.ry.Deletable)},b=function(e){var t=e.permission,i=e.tableId,n=e.viewId;return e.editable&&t.hasPermission(r.qy.View,{tableId:i,viewId:n},r.ry.Editable)}},vb448:function(e,t,i){"use strict";i.d(t,"a",function(){return r});var n=i("vb152"),o=i.n(n),l=i("vb143"),r=(i("vb147"),i("vb103"),i("vb148"),Object(l.Uy)(Object(l.uY)(o.a.mark(function e(){return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,i.e("5ef059938ba7").then(i.bind(null,"vb980"));case 2:return e.abrupt("return",e.sent.ExportSetting);case 3:case"end":return e.stop()}},e)}))))},vb495:function(e,F,_){"use strict";(function(c){_.d(F,"a",function(){return I}),_.d(F,"b",function(){return o}),_.d(F,"c",function(){return d}),_.d(F,"d",function(){return a}),_.d(F,"e",function(){return s}),_.d(F,"f",function(){return u}),_.d(F,"g",function(){return p}),_.d(F,"h",function(){return v}),_.d(F,"i",function(){return f}),_.d(F,"j",function(){return t}),_.d(F,"k",function(){return w}),_.d(F,"l",function(){return b}),_.d(F,"m",function(){return l});var m=_("vb103"),h=_.n(m),g=_("vb143"),i=_("vb292"),e=(_("vb147"),_("vb148"),_("vb110")),n=_.n(e),r=(_("vb152"),_("vb112"),_("vb164"),_("vb167"),_("vb113"),_("vb155"),_("vb116"),_("vb118"),_("vb120"),_("vb174"),_("vb119"),_("vb121"),_("vb117"),_("vb115"),_("vb111"));function t(e){var t=e.text;return Object.assign({},e,{id:i.a.InsertAbove,icon:h.a.createElement(g.IB.AddRightIconSvg,{className:"icon rotate-270"}),text:t||c("bitable.grid_insert_record_above",1)})}function o(e){var t=e.text;return Object.assign({},e,{id:i.a.InsertAbove,icon:h.a.createElement(g.IB.AddLeftIconSvg,{className:"icon rotate-270"}),text:t||c("bitable.grid_insert_record_below",1)})}function l(e){var t=e.text;return Object.assign({},e,{id:i.a.Reminder,text:t||c("smartable.reminder.reminder_helper_title"),icon:h.a.createElement(g.IB.ReminderSvg,{className:"icon"})})}function a(e){var t=e.text;return Object.assign({},e,{id:i.a.Comment,text:t||c("bitable.add_comment"),icon:h.a.createElement(g.IB.CommentSvg,{className:"icon"})})}function d(e){return Object.assign({},e,{id:i.a.CopyLink,text:c("Bitable_Record_CopyRecordLink"),icon:h.a.createElement(g.IB.UrlSvg,{className:"icon"})})}var s=function(e){var t=e.text;return Object.assign({},e,{id:i.a.DeleteRecord,text:t||c("bitable.delete_record"),icon:h.a.createElement(g.IB.DeleteIconSvg,{className:"icon"}),isDivider:!0})},u=function(e){var t=e.text;return Object.assign({},e,{id:i.a.ExpendRow,text:t||c("bitable.expand_record"),icon:h.a.createElement(g.IB.ExpandRecordIconSvg,{className:"icon"})})};function b(e){var t=e.text;return Object.assign({},e,{id:i.a.FilterItem,text:h.a.createElement(g.ix,{className:"bitable-layout-row bitable-layout-cross-center",name:c("bitable.common_filter_from_value")},h.a.createElement("p",{className:"b-menu__field_text"},t||c("common.unnamed_value"))),icon:h.a.createElement(g.IB.FilterSvg,{className:"icon"})})}function p(e){var t=e.text;return Object.assign({},e,{id:i.a.CopyRecord,text:t||c("Bitable_Record_Duplicate"),icon:h.a.createElement(g.IB.CopyIconSvg,{className:"icon"})})}var v=function(e){var t=e.isSyncTable,i=e.isNoSpaceToFreeze;return t?{placement:"top",title:c("Bitable_DataReference_SyncFromOtherBase_ActionNotSupported_Tooltip")}:i?{title:c("Bitable_Freeze_NoSpaceToFreeze_Tooltip")}:void 0};function f(e,t,i){var n=i.tableId,o=i.recordId,l=t.getBasePermission(g.ry.Editable),r=t.hasPermission(g.qy.Record,{tableId:n,recordId:o},g.ry.Editable),a=t.hasPermission(g.qy.Record,{tableId:n,recordId:o},g.ry.Deletable),d=g.wL.getTableRecordOperationPermission(t,n,g.Od.DeleteRecord);l&&r&&!a&&!1===d&&(e.disabled=!0,e.hidden=!1,e.tooltipConfig={title:c("Bitable_AdvancedPermission_NoPermissionToDeleteRecord"),placement:"left"})}function w(e,t,i){g.cz.collectClickEvent(g.Bc.CcmBitableCellEditClick,{field_type:t&&g.lC[t],edit_cell_type:e,click:"cell_content_change",is_empty:i&&0!==String(i).length?"false":"true"})}var C=function(e){var t=e.name,i=e.attachmentToken,n=e.thumbnailUrl,o=e.tableId,l=e.extra,r=e.mimeType,a=e.base64Data,d=Object(m.useState)(),c=Object(g.xz)(d,2),s=c[0],u=c[1],b=Object(m.useState)(),p=Object(g.xz)(b,2),v=p[0],f=p[1];return Object(m.useEffect)(function(){f(Object(g.xL)(t)),n?u(n):g.WI.getBlobUrl({attach:{attachmentToken:i,name:t,tableId:o,extra:l,mimeType:r,base64Data:a},updateCallback:function(e){u(e.coverUrl)},quality:g.yL.HIGH,isUseCacheBeforeFetchNew:!0})},[i,n,t,o,l,r,a]),h.a.createElement("div",{className:"attachment-popover-container"},h.a.createElement("div",{className:"attachment-popover-title"},t),h.a.createElement("div",{className:"attachment-popover-img-container"},s?h.a.createElement("img",{className:"attachment-popover-img",src:s}):h.a.createElement("img",{className:"attachment-popover-default-img",src:v})))},y=["rect"],I=function(o){function l(){var e;Object(g.ov)(this,l);for(var t=arguments.length,i=new Array(t),n=0;n<t;n++)i[n]=arguments[n];return(e=o.call.apply(o,[this].concat(i))||this).state={visible:!1,contentProps:null,rectStyle:{top:"0",left:"0",width:"0",height:"0"}},e}return Object(g.bu)(l,o),Object(g.Pw)(l,[{key:"show",value:function(e){var t=this,i=e.rect,n=Object(g.nA)(e,y);this.setState({rectStyle:{top:"".concat(i.y,"px"),left:"".concat(i.x,"px"),width:"".concat(i.width,"px"),height:"".concat(i.height,"px")}},function(){t.setState({visible:!0,contentProps:n})})}},{key:"hide",value:function(){this.setState({visible:!1})}},{key:"render",value:function(){var e=this.state,t=e.contentProps,i=e.visible,n=e.rectStyle;return h.a.createElement(r.Popover,{content:t?h.a.createElement(C,t):null,visible:i,overlayClassName:"attachment-popover-overlay"},h.a.createElement("div",{style:Object.assign({position:"fixed",pointerEvents:"none",zIndex:-999},n)}))}}],[{key:"open",value:function(t){l.instantiation?l.instantiation.show(t):(l.dom||(l.dom=document.createElement("div"),document.body.appendChild(l.dom)),n.a.render(h.a.createElement(l,{ref:function(e){return l.instantiation=e}}),l.dom,function(){var e;return null===(e=l.instantiation)||void 0===e?void 0:e.show(t)}))}},{key:"close",value:function(){var e;null===(e=l.instantiation)||void 0===e||e.hide()}}]),l}(m.PureComponent);I.dom=null,I.instantiation=null}).call(this,_("vb163"))},vb540:function(e,t,i){"use strict";var n=i("vb144"),o=i.n(n),l=i("vb103"),r=i("vb151");function a(e){return l.createElement("svg",o()({width:"1em",height:"1em",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},e),l.createElement("path",{d:"M16.583 9.333V7.111c0-2.453-2.053-4.444-4.583-4.444-2.53 0-4.583 1.99-4.583 4.444v2.222H5.733c-.589 0-1.066.478-1.066 1.067v9.867c0 .589.477 1.066 1.066 1.066h12.534c.589 0 1.066-.477 1.066-1.066V10.4c0-.59-.477-1.067-1.066-1.067h-1.684ZM12 16.89c-1.013 0-1.834-.796-1.834-1.778s.82-1.778 1.834-1.778c1.013 0 1.833.796 1.833 1.778S13.013 16.89 12 16.89ZM9.158 9.333V7.111c0-1.52 1.274-2.756 2.842-2.756 1.567 0 2.841 1.236 2.841 2.756v2.222H9.159Z",fill:"currentColor"}))}var d=l.forwardRef(function(e,t){return l.createElement(r.a,o()({icon:a},e,{ref:t,svgProps:{"data-icon":"BitableLockOutlined"}}))});t.a=d},vb543:function(e,t,i){"use strict";i.d(t,"a",function(){return a});var n=i("vb154"),o=i("vb192"),l=i("vb200"),r=i("vb114");function a(e,t,i){return Object(r.shallowEqual)(Object(l.a)(e,i),Object(l.a)(t,i))&&Object(n.a)(Object(o.a)(e,i),Object(o.a)(t,i))}},vb653:function(e,c,s){"use strict";(function(m){s.d(c,"a",function(){return r}),s.d(c,"b",function(){return l});var t,n,o,e=s("vb152"),u=s.n(e),h=s("vb143"),i=(s("vb147"),s("vb103")),g=s.n(i),a=(s("vb148"),s("vb356")),d=s("vb358"),w=(o=Object(h.uY)(u.a.mark(function e(t,i,n){var o,l,r,a,d,c,s;return u.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(o=t.bitableStore,l=t.renderer,r=t.operate,a=o.base,!(d=a.getTableById(i))){e.next=11;break}return e.next=6,r.tableOperate.copyView({tableId:i,viewId:n});case 6:if(!(c=e.sent)||c.result!==h.Ey.Success){e.next=11;break}return s=d.views[c.data.index],l.switchView(o.base,i,c.data.viewId),e.abrupt("return",s);case 11:return e.abrupt("return",null);case 12:case"end":return e.stop()}},e)})),function(e,t,i){return o.apply(this,arguments)}),b=function(t){return new Promise(function(e){Object(h.HU)({title:m("bitable.view_attribute_unlock_popup_title"),content:g.a.createElement(h.ix,{name:m("bitable.view_attribute_unlock_popup_description")},g.a.createElement("span",{className:"bitable-view-unlock-confirm-modal-view-name"},t)),enableCancelButton:!0,wrapClassName:"bitable-view-unlock-confirm-modal",onOk:function(){return e(!0)},onCancel:function(){return e(!1)},okText:m("common.confirm"),cancelText:m("common.cancel")})})},C=(n=Object(h.uY)(u.a.mark(function e(t,i,n){var o,l,r,a,d,c,s;return u.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(o=t.bitableStore,l=o.base,!(r=l.getTableById(i))){e.next=11;break}if(a=r.getViewById(n)){e.next=7;break}return e.abrupt("return");case 7:return e.next=9,b(a.name);case 9:e.sent&&(h.ob.collectBitableEvent(h.On.BitableViewAttribute,{tableId:i,viewId:n,bitable_view_type:h.Cz[a.type],source:t.source,action:"confirm",attribute:h.YB[h.fB.PUBLIC]}),d=o.getCommandManager(),(c=d.execute({cmd:h.Fy.SetViewPublicLevel,tableId:i,viewId:n,publicLevel:h.fB.PUBLIC}))&&c.result===h.Ey.Success&&(s="un_lock_toast_key",h.ob.Toast.show({key:s,type:"success",content:m("bitable.view_attribute_unlock_successfully"),duration:3e3})));case 11:case"end":return e.stop()}},e)})),function(e,t,i){return n.apply(this,arguments)}),l=function(e){var r=e.renderer,t=e.bitableStore;if(t.getBasePermission(h.ry.Editable)){var a=r.getActiveTableId(),i=r.getActiveView();if(i&&i.viewPermission.publicLevel===h.fB.LOCKED){var n,d=i.id,c=r.reduxStore,o=function(){var e=c.getState(),t=e&&e.bitable&&e.bitable.Tables&&e.bitable.Tables.tableMap,i=!!t[a],n=i&&t[a].viewMap[d],o=r.getActiveViewId()===d,l=n&&t[a].viewMap[d].publicLevel===h.fB.LOCKED;!(i&&n&&l&&o)&&f()},l=function(){t.getBasePermission(h.ry.Editable)||f()},s=c.subscribe(o);t.getPermissionStore().subscribe(l);var u={tableId:a,viewId:d,bitable_view_type:h.Cz[i.type],source:e.source},b=function(){h.ob.collectBitableEvent(h.On.BitableViewProtectPopup,Object.assign({},u,{action:"unprotect"})),C(e,a,d)},p=function(){h.ob.collectBitableEvent(h.On.BitableViewProtectPopup,Object.assign({},u,{action:"saveas"})),w(e,a,d)},v=t.hasPermission(h.qy.View,{tableId:a,viewId:d},h.ry.Editable)&&t.hasPermission(h.qy.View,{tableId:a,viewId:d},h.ry.Lockable);n=Object(h.HU)({title:m("Bitable_AdvancedPermission_ViewLocked_Title"),content:g.a.createElement("div",{className:"bitable-layout-row bitable-layout-cross-center"},g.a.createElement("span",{className:"bitable-view-locked-tip-modal-text"},m("bitable.view_attribute_cannot_edit"))),maskClosable:!0,wrapClassName:"bitable-view-locked-tip-modal",enableCancelButton:v,cancelButtonProps:{onClick:function(){b(),f()}},onOk:function(){p(),f()},onCancel:f,cancelText:m("bitable.view_attribute_button_unlock"),okText:m("bitable.view_attribute_button_save_as")})}}function f(){n&&n(),s&&s(),t.getPermissionStore().unsubscribe(l)}},r=(t=Object(h.uY)(u.a.mark(function e(t){var i,n,o,l,r;return u.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return i=t.viewId,n=t.tableId,o=t.renderer,l=t.recordId,r=t.fieldId,e.next=3,Object(a.a)({viewId:i,tableId:n,recordId:l,fieldId:r,onCopy:function(){var t=Object(h.uY)(u.a.mark(function e(t){return u.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,o.clipboardHelper.setClipboardValue(t);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e)}));function e(e){return t.apply(this,arguments)}return e}()});case 3:Object(d.a)(h.LK.CopyRecordLink);case 4:case"end":return e.stop()}},e)})),function(e){return t.apply(this,arguments)})}).call(this,s("vb163"))},vb952:function(e,t,i){"use strict";var n=i("vb144"),o=i.n(n),l=i("vb103"),r=i("vb151");function a(e){return l.createElement("svg",o()({width:"1em",height:"1em",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},e),l.createElement("path",{d:"M11.985 18.5c3.238 0 6.236-2.06 9.015-6.513C18.292 7.55 15.3 5.5 11.985 5.5 8.67 5.5 5.689 7.549 3 11.987c2.76 4.454 5.748 6.513 8.985 6.513ZM1.502 12.89a1.782 1.782 0 0 1 .023-1.838C4.428 6.017 7.915 3.5 11.984 3.5c4.086 0 7.594 2.538 10.523 7.614l.028.048c.296.519.294 1.16-.01 1.675-3.006 5.108-6.52 7.663-10.541 7.663-4.007 0-7.501-2.537-10.482-7.61ZM12 16a4 4 0 1 1 0-8 4 4 0 0 1 0 8Zm0-2a2 2 0 1 0 0-4 2 2 0 0 0 0 4Z",fill:"currentColor"}))}var d=l.forwardRef(function(e,t){return l.createElement(r.a,o()({icon:a},e,{ref:t,svgProps:{"data-icon":"VisibleOutlined"}}))});t.a=d}}]);
//# sourceMappingURL=//slardar.bytedance.net/api_v2/browser/jserr/get_sourcemap?bid=docs_pc&js_filename=vendors-grid-view-layer.89668e6791.chunk.js