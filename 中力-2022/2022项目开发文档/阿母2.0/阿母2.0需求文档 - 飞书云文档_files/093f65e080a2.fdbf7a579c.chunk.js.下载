(window.webpackJsonp=window.webpackJsonp||[]).push([["093f65e080a2"],{vb1300:function(e,n,r){"use strict";r.r(n),function(o){r.d(n,"ReadonlyEditor",function(){return t});var m=r("vb143"),i=r("vb157"),e=r("vb103"),g=r.n(e),t=(r("vb147"),r("vb148"),r("vb152"),r("vb112"),r("vb164"),r("vb167"),r("vb113"),r("vb119"),r("vb116"),r("vb155"),r("vb118"),r("vb120"),r("vb174"),r("vb121"),r("vb117"),r("vb115"),r("vb111"),r("vb126"),r("vb125"),r("vb129"),r("vb223"),r("vb214"),r("vb232"),r("vb187"),r("vb225"),r("vb224"),r("vb128"),r("vb122"),r("vb233"),r("vb234"),r("vb235"),r("vb123"),r("vb236"),r("vb193"),r("vb237"),r("vb238"),r("vb124"),r("vb239"),r("vb104"),r("vb159"),r("vb240"),r("vb134"),r("vb131"),r("vb226"),r("vb241"),r("vb114"),r("vb110"),r("vb242"),r("vb127"),r("vb132"),r("vb227"),r("vb135"),r("vb228"),r("vb229"),r("vb133"),r("vb243"),r("vb262"),r("vb244"),r("vb245"),r("vb246"),r("vb247"),r("vb194"),r("vb248"),r("vb249"),r("vb201"),r("vb260"),r("vb267"),r("vb250"),r("vb136"),r("vb251"),r("vb130"),r("vb252"),function(t){function n(e){var f;return Object(m.ov)(this,n),(f=t.call(this,e)||this).editorRef=null,f.refreshEditorValueAfterSetRef=!1,f.setEditorContainerRef=function(e){f.editorContainerRef=e},f.focus=function(){var e=f.getScroller(),t=e?e.scrollTop:0;f.editorRef&&f.editorRef.focus(),e&&(e.scrollTop=t),setTimeout(function(){e&&(e.scrollTop=t)},0)},f.updateEditorPosition=function(){var e=f.state,t=e.recordId,n=e.fieldId,o=f.state.cell;if(o&&t&&n){var i=Object(m.IJ)(f.gridContext,t,n,o);-1===i.col&&(i=o);var r=Object(m.GK)(f.gridContext,i);f.setState({cell:i,rect:r})}},f.onSetSelection=function(){var e=f.gridContext;e.setIsEditing(!1);var t=e.getActiveCell();if(!t)return e.getSelection()?void f.forceUpdate(function(){setTimeout(function(){f.focus()})}):void f.setState({field:null});var n=e.view,o=n.getVisibleRecords()[t.row],i=n.getVisibleFields()[t.col],r=n.table.id;f.setState({field:Object(m.XJ)(f.gridContext),rect:Object(m.GK)(f.gridContext),cell:{col:t.col,row:t.row},fieldId:i,tableId:r,recordId:o,viewId:n.id,isShowAllContent:!1},function(){var e=f.props.smartableCommentManager;e&&e.activeCommentInfo||setTimeout(function(){f.focus()})})},f.onSelectionChangeEnd=function(){document.activeElement&&Object(i.a)(document.activeElement.blur)&&document.activeElement.blur(),f.focus()},f.onDBClickCell=function(){var e=f.state.field;if(f.props.bitableStore.uiEventManager.emit(m.my.DoubleClickCell),e){var t=f.gridContext.view;f.setState({isShowAllContent:!0,cellValue:t.table.getCellValue(f.state.recordId,f.state.fieldId)},function(){f.openEditor()})}},f.onScrollChange=function(){f.updateEditorPosition()},f.bindDomEvent=function(){var e=f.props.bitableStore.isEmbeddedInDoc?document.body:window,t=Object(m.Cx)(f).editorContainerRef;return e.addEventListener("mousedown",f.onMouseDown,!1),m.RJ.useTextArea||(t.addEventListener("copy",f.handleCopy,!0),t.addEventListener("cut",f.handleCut,!0),t.addEventListener("paste",f.handlePaste,!0)),function(){e.removeEventListener("mousedown",f.onMouseDown,!1),m.RJ.useTextArea||(t.removeEventListener("copy",f.handleCopy,!0),t.removeEventListener("cut",f.handleCut,!0),t.removeEventListener("paste",f.handlePaste,!0))}},f.setWidgetListeners=function(){var e,t=(Object(m.Ww)(e={},m.pC.ScrollChange,f.onScrollChange),Object(m.Ww)(e,m.pC.SelectionChange,f.onSetSelection),Object(m.Ww)(e,m.pC.SelectionChangeEnd,f.onSelectionChangeEnd),Object(m.Ww)(e,m.pC.DBClickCell,f.onDBClickCell),Object(m.Ww)(e,m.pC.ClickCell,f.onSetSelection),Object(m.Ww)(e,m.pC.OpenReadOnlyEditor,f.onDBClickCell),e);return f.gridContext.events.addListeners(t),function(){f.gridContext.events.removeListeners(t)}},f.setContainerListeners=function(){var t={keydown:function(e){e.keyCode===m.sx.Esc?f.setState({isShowAllContent:!1}):e.keyCode===m.sx.Space&&f.onDBClickCell()}};return Object.keys(t).forEach(function(e){f.editorContainerRef.addEventListener(e,t[e])}),function(){Object.keys(t).forEach(function(e){f.editorContainerRef.removeEventListener(e,t[e])})}},f.getEditorStyle=function(){return f.state.isShowAllContent&&f.state.rect?{width:f.state.rect.width,minHeight:f.state.rect.height}:{width:0,height:10,border:"none",padding:0,overflow:"hidden"}},f.handleCopy=function(e){var t=f.props,n=t.isNotDefaultMode,o=t.onCopy;o&&!n&&o(e)},f.handleCut=function(){f.toastReadOnly(!0)},f.handlePaste=function(){f.toastReadOnly(!1)},f.toastReadOnly=function(e){!f.props.isNotDefaultMode&&m.ob.Toast.show({type:"error",content:o("Bitable_AdvancedPermission_NoPermissionToEditSomeRecords"),duration:3e3,closable:!1})},f.onMouseDown=function(e){var t=Object(m.Cx)(f),n=t.rootAppDom,o=t.bitableContainer,i=t.editorContainerRef,r=t.gridContext,l=["J-card-edit-modal","link-field-panel-editor"],d=function(t){return t.classList&&l.some(function(e){return t.classList.contains(e)})};if(!Object(m.GJ)(e.target,d)&&n){for(var s=e.target,a="canvas"!==s.tagName.toLowerCase()&&i&&!i.contains(s),c=!("canvas"!==s.tagName.toLowerCase()||!o||o.contains(s)),v=[document.getElementById("toolbar-cell-keep-focus"),document.getElementById("bitable-contextmenu")],b=0;b<v.length;b++){var u=v[b];if(u&&u.contains(s))return}(a||c)&&r.setSelection(null)}},f.state={tableId:"",viewId:"",recordId:"",fieldId:"",cellValue:null,rect:null,field:null,isShowAllContent:!1},f}return Object(m.bu)(n,t),Object(m.Pw)(n,[{key:"componentDidMount",value:function(){var e=this.props.fasterDom;this.gridContext=this.props.renderer.activeBitableWidget.getGridWidget(),this.rootAppDom=Object(m.TJ)(this.editorContainerId),this.bitableContainer=Object(m.UJ)(e,m.gF),this.unbindDomEvent=this.bindDomEvent(),this.unbindWidgetListeners=this.setWidgetListeners(),this.unbindContainerListeners=this.setContainerListeners()}},{key:"UNSAFE_componentWillReceiveProps",value:function(e){this.props.isEditorHidden&&!e.isEditorHidden&&(this.refreshEditorValueAfterSetRef=!0)}},{key:"componentWillUnmount",value:function(){this.rootAppDom=null,this.bitableContainer=null,this.unbindDomEvent(),this.unbindWidgetListeners(),this.unbindContainerListeners()}},{key:"getScroller",value:function(){var e=this.props.bitableStore,t=null;return e.isEmbeddedInDoc&&(t=e.Options.isHistoryMode?document.querySelector(".docx-history-content"):document.querySelector(".bear-web-x-container")),t}},{key:"openEditor",value:function(){this.editorRef instanceof m.WJ||(null!=this.state.cellValue?(this.gridContext.setIsEditing(!0),this.editorRef&&this.editorRef.onStartEdit(this.state.cellValue,!0,{from:m.uH.NoPermissionContainer})):this.setState({isShowAllContent:!1}))}},{key:"editorContainerId",get:function(){var e=this.props,t=e.renderer,n=e.isFullScreenMode,o=t.getActiveTable();return Object(m.VJ)(Boolean(n),o?o.id:"")}},{key:"renderFocusOnlyEditor",value:function(){var r=this,l=this.props.bitableStore;return g.a.createElement(m.WJ,{ref:function(e){if(r.editorRef=e,l.Options.isHistoryMode){var t,n,o=r.getScroller(),i=null!==(t=null==o?void 0:o.scrollTop)&&void 0!==t?t:0;null===(n=r.editorRef)||void 0===n||n.focus(void 0,void 0,void 0,!0),o&&o.scrollTop!==i&&(o.scrollTop=i)}},style:{width:0,height:10,border:"none",padding:0,overflow:"hidden"}})}},{key:"render",value:function(){var e,t=this,n=this.state,o=n.tableId,i=n.viewId,r=n.recordId,l=n.fieldId,d=n.rect,s=n.cellValue,a=n.field,c={x:0,y:0},v=this.props,b=v.bitableStore,u=v.renderer,f=v.isEditorHidden,h=null===(e=b.bitableConfig.ui)||void 0===e?void 0:e.disableCellEditor;d&&(c.x=d.x,c.y=d.y);var C=null;if(a&&!f){var p=m.sy.instance.get(a.type);C=p.renderValueEditor({ref:function(e){t.editorRef=e,t.refreshEditorValueAfterSetRef&&t.editorRef&&(t.refreshEditorValueAfterSetRef=!1,t.editorRef.setEditorValue(t.state.cellValue))},anchorRef:this.editorContainerRef,renderer:u,tableId:o,viewId:i,bitableStore:b,recordId:r,fieldId:l,rect:d,field:a,value:s,style:this.getEditorStyle(),editable:!1,cardSyncMode:m.ob.config.cardSyncMode||m.tx.RealTime,executeAction:b.executeCommandImmediately,copyable:u.isCopyable()}),d&&p.valueEditorPositionUnderCell&&(c.y+=d.height)}return C||(C=this.renderFocusOnlyEditor()),g.a.createElement("div",{id:this.editorContainerId,className:"bitable-editor-container",style:{left:c.x,top:c.y},ref:this.setEditorContainerRef},h&&this.renderFocusOnlyEditor(),!h&&C)}}]),n}(g.a.Component))}.call(this,r("vb163"))}}]);
//# sourceMappingURL=//slardar.bytedance.net/api_v2/browser/jserr/get_sourcemap?bid=docs_pc&js_filename=093f65e080a2.fdbf7a579c.chunk.js