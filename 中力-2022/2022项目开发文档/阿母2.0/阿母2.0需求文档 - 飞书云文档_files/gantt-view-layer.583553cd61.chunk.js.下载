(window.webpackJsonp=window.webpackJsonp||[]).push([["0749921ca56a"],{vb2244:function(e,t,i){"use strict";var n=i("vb144"),o=i.n(n),a=i("vb103"),r=i("vb151");function l(e){return a.createElement("svg",o()({width:"1em",height:"1em",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},e),a.createElement("path",{d:"M5 15h15.415a1.5 1.5 0 0 0 1.303-2.244l-2.434-4.26a1 1 0 0 1 0-.992l2.434-4.26A1.5 1.5 0 0 0 20.415 1H5a2 2 0 0 0-2 2v19a1 1 0 0 0 2 .003V15Z",fill:"currentColor"}))}var s=a.forwardRef(function(e,t){return a.createElement(r.a,o()({icon:l},e,{ref:t,svgProps:{"data-icon":"FlagFilled"}}))});t.a=s},vb292:function(e,t,i){"use strict";var n,o,a,r;i.d(t,"a",function(){return o}),i.d(t,"b",function(){return n}),(r=n||(n={})).GridContentContextMenu="GridContentContextMenu",r.GridFieldHeaderMenu="GridFieldHeaderMenu",r.GridGroupTitleContextMenu="GridGroupTitleContextMenu",r.KanbanCardContextMenu="KanbanContextMenu",r.KanbanCardListMoreContextMenu="KanbanCardListMoreContextMenu",r.GalleryCardContextMenu="GalleryCardContextMenu",r.GanttBarContextMenu="GanttBarContextMenu",r.BlockCreationMenu="BlockCreationMenu",r.BlockContextMenu="BlockContextMenu",(a=o||(o={})).InsertAbove="InsertAbove",a.InsertBelow="InsertBelow",a.InsertLeft="InsertLeft",a.InsertRight="InsertRight",a.ExpendRow="ExpendRow",a.CopyLink="CopyLink",a.Comment="Comment",a.FilterItem="FilterItem",a.Reminder="Reminder",a.DeleteRecord="DeleteRecord",a.ExpendSubGroups="ExpendSubGroups",a.FoldSubGroups="FoldSubGroups",a.ModifyField="ModifyField",a.ModifyDescription="ModifyDescription",a.DuplicateField="DuplicateField",a.InsertFieldLeft="InsertFieldLeft",a.InsertFieldRight="InsertFieldRight",a.FrozenField="FrozenField",a.SetSortAZ="SetSortAZ",a.SetSortZA="SetSortZA",a.SetGroup="SetGroup",a.SetFilter="SetFilter",a.CreateView="CreateView",a.HideField="HideField",a.DeleteField="DeleteField",a.CopyRecord="CopyRecord",a.GroupRename="GroupRename",a.DeleteGroup="DeleteGroup",a.ExportAttachment="ExportAttachment",a.DeleteGanttTask="DeleteGanttTask",a.AddTable="AddTable",a.AddDashboard="AddDashboard",a.RenameBlock="RenameBlock",a.CopyTable="CopyTable",a.DeleteBlcok="DeleteBlcok",a.CopyBlock="CopyBlock"},vb326:function(e,t,i){"use strict";function n(e){var t;return(null==e||null===(t=e.ui)||void 0===t?void 0:t.showComment)||!1}function o(e){return!(null!=e&&e.disableReminder)}i.d(t,"a",function(){return o}),i.d(t,"b",function(){return n})},vb358:function(e,t,i){"use strict";i.d(t,"a",function(){return s}),i.d(t,"b",function(){return m}),i.d(t,"c",function(){return l}),i.d(t,"d",function(){return d});var n,o,b=i("vb143"),a=(Object(b.Ww)(n={},b.og.SingleSelect,b.zL.Rename),Object(b.Ww)(n,b.og.MultiSelect,b.zL.Rename),Object(b.Ww)(n,b.og.User,b.zL.ChangeThePerson),Object(b.Ww)(n,b.og.SingleLink,b.zL.ChangeTheRecord),Object(b.Ww)(n,b.og.DuplexLink,b.zL.ChangeTheRecord),n),r=(Object(b.Ww)(o={},b.og.User,b.Rw.CcmMentionPanelView),Object(b.Ww)(o,b.og.SingleLink,b.Rw.CcmBitableRelationFieldModifyView),Object(b.Ww)(o,b.og.DuplexLink,b.Rw.CcmBitableRelationFieldModifyView),o),l=function(e){b.cz.collectClickEvent(b.Bc.CcmBitableKanbanGroupMoreClick,{click:a[e.type],target:r[e.type]})},s=function(e,t){b.cz.collectClickEvent(b.Bc.CcmBitableRecordOperateClick,Object.assign({click:e},t))},m=function(e,t,i){b.cz.collectClickEvent(b.Bc.CcmBitableFieldOperateClick,Object.assign({click:b.AL[e],target:i||b.Rw.None},t))},d=function(e,t,i){var n=i.isIndexColumn,o=i.fieldType,a=i.indexes,r=i.tempFrozenColCount;if(Object(b.kD)(e)){var l=e.getFrozenColumnCount(),s=l,d=a[0],c=e.mapVisibleColToRealCol(d);(t===b.BL.InsertLeft?c:c+1)<l&&(s+=1);var u=0===r?0:e.mapVisibleColToRealCol(r-1)+1;if(l!==s)return void m(t,{is_index_column:n,field_type:o,before_freeze_field_count:l,after_freeze_field_count:s,is_temporary_frozen:(u<s).toString()})}m(t,{is_index_column:n,field_type:o})}},vb413:function(e,t,i){"use strict";i.d(t,"a",function(){return u}),i.d(t,"b",function(){return n}),i.d(t,"c",function(){return o}),i.d(t,"d",function(){return a}),i.d(t,"e",function(){return l}),i.d(t,"f",function(){return b}),i.d(t,"g",function(){return c}),i.d(t,"h",function(){return d}),i.d(t,"i",function(){return s});var r=i("vb143"),n=function(e){var t=e.permission,i=e.editable,n=e.tableId,o=e.recordId,a=e.viewId;return i&&t.hasPermission(r.qy.Record,{tableId:n,viewId:a,recordId:o},r.ry.Editable)},o=function(e){var t=e.fieldId,i=e.permission,n=e.tableId;return i.hasPermission(r.qy.Field,{tableId:n,fieldId:t},r.ry.Editable)},a=function(e){var t=e.permission,i=e.tableId;return t.hasPermission(r.qy.Field,{tableId:i},r.ry.Addable)},l=function(e){var t=e.permission,i=e.tableId,n=e.fieldId;return t.hasPermission(r.qy.Field,{tableId:i,fieldId:n},r.ry.Copyable)},s=function(e){var t=e.permission,i=e.view,n=e.tableId,o=e.fieldIndexes,a=i.getVisibleFields();return o.map(function(e){return a[e]}).every(function(e){return t.hasPermission(r.qy.Field,{tableId:n,viewId:i.id,fieldId:e},r.ry.Deletable)})},d=function(e){var t=e.permission,i=e.tableId;return t.hasPermission(r.qy.View,{tableId:i},r.ry.Addable)},c=function(e){var t=e.permission,i=e.editable,n=e.tableId;return i&&t.hasPermission(r.qy.Record,{tableId:n},r.ry.Addable)},u=function(e){var t=e.permission,i=e.editable,n=e.tableId,o=e.viewId,a=e.recordId;return i&&t.hasPermission(r.qy.Record,{tableId:n,viewId:o,recordId:a},r.ry.Deletable)},b=function(e){var t=e.permission,i=e.tableId,n=e.viewId;return e.editable&&t.hasPermission(r.qy.View,{tableId:i,viewId:n},r.ry.Editable)}},vb495:function(e,x,M){"use strict";(function(d){M.d(x,"a",function(){return I}),M.d(x,"b",function(){return o}),M.d(x,"c",function(){return s}),M.d(x,"d",function(){return l}),M.d(x,"e",function(){return c}),M.d(x,"f",function(){return u}),M.d(x,"g",function(){return m}),M.d(x,"h",function(){return v}),M.d(x,"i",function(){return p}),M.d(x,"j",function(){return t}),M.d(x,"k",function(){return C}),M.d(x,"l",function(){return b}),M.d(x,"m",function(){return a});var f=M("vb103"),h=M.n(f),w=M("vb143"),i=M("vb292"),e=(M("vb147"),M("vb148"),M("vb110")),n=M.n(e),r=(M("vb152"),M("vb112"),M("vb164"),M("vb167"),M("vb113"),M("vb155"),M("vb116"),M("vb118"),M("vb120"),M("vb174"),M("vb119"),M("vb121"),M("vb117"),M("vb115"),M("vb111"));function t(e){var t=e.text;return Object.assign({},e,{id:i.a.InsertAbove,icon:h.a.createElement(w.IB.AddRightIconSvg,{className:"icon rotate-270"}),text:t||d("bitable.grid_insert_record_above",1)})}function o(e){var t=e.text;return Object.assign({},e,{id:i.a.InsertAbove,icon:h.a.createElement(w.IB.AddLeftIconSvg,{className:"icon rotate-270"}),text:t||d("bitable.grid_insert_record_below",1)})}function a(e){var t=e.text;return Object.assign({},e,{id:i.a.Reminder,text:t||d("smartable.reminder.reminder_helper_title"),icon:h.a.createElement(w.IB.ReminderSvg,{className:"icon"})})}function l(e){var t=e.text;return Object.assign({},e,{id:i.a.Comment,text:t||d("bitable.add_comment"),icon:h.a.createElement(w.IB.CommentSvg,{className:"icon"})})}function s(e){return Object.assign({},e,{id:i.a.CopyLink,text:d("Bitable_Record_CopyRecordLink"),icon:h.a.createElement(w.IB.UrlSvg,{className:"icon"})})}var c=function(e){var t=e.text;return Object.assign({},e,{id:i.a.DeleteRecord,text:t||d("bitable.delete_record"),icon:h.a.createElement(w.IB.DeleteIconSvg,{className:"icon"}),isDivider:!0})},u=function(e){var t=e.text;return Object.assign({},e,{id:i.a.ExpendRow,text:t||d("bitable.expand_record"),icon:h.a.createElement(w.IB.ExpandRecordIconSvg,{className:"icon"})})};function b(e){var t=e.text;return Object.assign({},e,{id:i.a.FilterItem,text:h.a.createElement(w.ix,{className:"bitable-layout-row bitable-layout-cross-center",name:d("bitable.common_filter_from_value")},h.a.createElement("p",{className:"b-menu__field_text"},t||d("common.unnamed_value"))),icon:h.a.createElement(w.IB.FilterSvg,{className:"icon"})})}function m(e){var t=e.text;return Object.assign({},e,{id:i.a.CopyRecord,text:t||d("Bitable_Record_Duplicate"),icon:h.a.createElement(w.IB.CopyIconSvg,{className:"icon"})})}var v=function(e){var t=e.isSyncTable,i=e.isNoSpaceToFreeze;return t?{placement:"top",title:d("Bitable_DataReference_SyncFromOtherBase_ActionNotSupported_Tooltip")}:i?{title:d("Bitable_Freeze_NoSpaceToFreeze_Tooltip")}:void 0};function p(e,t,i){var n=i.tableId,o=i.recordId,a=t.getBasePermission(w.ry.Editable),r=t.hasPermission(w.qy.Record,{tableId:n,recordId:o},w.ry.Editable),l=t.hasPermission(w.qy.Record,{tableId:n,recordId:o},w.ry.Deletable),s=w.wL.getTableRecordOperationPermission(t,n,w.Od.DeleteRecord);a&&r&&!l&&!1===s&&(e.disabled=!0,e.hidden=!1,e.tooltipConfig={title:d("Bitable_AdvancedPermission_NoPermissionToDeleteRecord"),placement:"left"})}function C(e,t,i){w.cz.collectClickEvent(w.Bc.CcmBitableCellEditClick,{field_type:t&&w.lC[t],edit_cell_type:e,click:"cell_content_change",is_empty:i&&0!==String(i).length?"false":"true"})}var y=function(e){var t=e.name,i=e.attachmentToken,n=e.thumbnailUrl,o=e.tableId,a=e.extra,r=e.mimeType,l=e.base64Data,s=Object(f.useState)(),d=Object(w.xz)(s,2),c=d[0],u=d[1],b=Object(f.useState)(),m=Object(w.xz)(b,2),v=m[0],p=m[1];return Object(f.useEffect)(function(){p(Object(w.xL)(t)),n?u(n):w.WI.getBlobUrl({attach:{attachmentToken:i,name:t,tableId:o,extra:a,mimeType:r,base64Data:l},updateCallback:function(e){u(e.coverUrl)},quality:w.yL.HIGH,isUseCacheBeforeFetchNew:!0})},[i,n,t,o,a,r,l]),h.a.createElement("div",{className:"attachment-popover-container"},h.a.createElement("div",{className:"attachment-popover-title"},t),h.a.createElement("div",{className:"attachment-popover-img-container"},c?h.a.createElement("img",{className:"attachment-popover-img",src:c}):h.a.createElement("img",{className:"attachment-popover-default-img",src:v})))},g=["rect"],I=function(o){function a(){var e;Object(w.ov)(this,a);for(var t=arguments.length,i=new Array(t),n=0;n<t;n++)i[n]=arguments[n];return(e=o.call.apply(o,[this].concat(i))||this).state={visible:!1,contentProps:null,rectStyle:{top:"0",left:"0",width:"0",height:"0"}},e}return Object(w.bu)(a,o),Object(w.Pw)(a,[{key:"show",value:function(e){var t=this,i=e.rect,n=Object(w.nA)(e,g);this.setState({rectStyle:{top:"".concat(i.y,"px"),left:"".concat(i.x,"px"),width:"".concat(i.width,"px"),height:"".concat(i.height,"px")}},function(){t.setState({visible:!0,contentProps:n})})}},{key:"hide",value:function(){this.setState({visible:!1})}},{key:"render",value:function(){var e=this.state,t=e.contentProps,i=e.visible,n=e.rectStyle;return h.a.createElement(r.Popover,{content:t?h.a.createElement(y,t):null,visible:i,overlayClassName:"attachment-popover-overlay"},h.a.createElement("div",{style:Object.assign({position:"fixed",pointerEvents:"none",zIndex:-999},n)}))}}],[{key:"open",value:function(t){a.instantiation?a.instantiation.show(t):(a.dom||(a.dom=document.createElement("div"),document.body.appendChild(a.dom)),n.a.render(h.a.createElement(a,{ref:function(e){return a.instantiation=e}}),a.dom,function(){var e;return null===(e=a.instantiation)||void 0===e?void 0:e.show(t)}))}},{key:"close",value:function(){var e;null===(e=a.instantiation)||void 0===e||e.hide()}}]),a}(f.PureComponent);I.dom=null,I.instantiation=null}).call(this,M("vb163"))},vb971:function(e,T,O){"use strict";O.r(T),function(C){O.d(T,"M",function(){return n}),O.d(T,"g",function(){return L});var n,e,y=O("vb143"),o=O("vb103"),u=O.n(o),t=(O("vb147"),O("vb148"),O("vb118"),O("vb116"),O("vb120"),O("vb152")),i=O.n(t),a=O("vb104"),r=O.n(a),l=O("vb2244"),s=O("vb114"),m=O("vb292"),v=O("vb326"),b=O("vb358"),p=O("vb413"),h=O("vb495"),w=Object(y.Ty)(r()({loader:function(){var e=Object(y.uY)(i.a.mark(function e(){return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,O.e("c45147dee729").then(O.bind(null,"vb1954"));case 2:return e.abrupt("return",e.sent.MilestoneEditor);case 3:case"end":return e.stop()}},e)}));function t(){return e.apply(this,arguments)}return t}(),loading:y.HL}));(e=n||(n={})).Set="Set",e.Add="Add";var d,c=function(e){var t=e.permission,i=e.tableId,n=e.view,o=e.editable,a=e.operator,r=e.isSyncTable,l=!r&&!Object(p.f)({permission:t,tableId:i,viewId:n.id,editable:o}),s=r,d=Object(h.h)({isSyncTable:r});return{id:m.a.DeleteGanttTask,text:C("bitable.gantt_delete_task"),icon:u.a.createElement(y.IB.ClearDateSvg,{className:"icon"}),onClick:function(){a.onSetGanttBarValue(e),Object(b.a)(y.LK.DeleteTimeline)},hidden:l,disabled:s,tooltipConfig:d}},f=function(e){var t=e.permission,i=e.tableId,n=e.editable,o=e.recordId,a=e.operator,r=!Object(p.g)({permission:t,tableId:i,editable:n});return Object(h.f)({onClick:function(){a.onShowEditPopup(o),Object(b.a)(y.LK.ExpandRecord,{target:y.Rw.CcmBitableCardView})},hidden:r})},g=function(e){var t=e.showComment,i=e.operator;return Object(h.d)({hidden:!t,onClick:function(){i.onAddComment(e.recordId),Object(b.a)(y.LK.AddComment,{target:y.Rw.CcmCommentView})}})},I=function(e){var t=e.recordId,i=e.permission,n=e.tableId,o=e.editable,a=e.view,r=e.operator,l=e.isSyncTable,s=!l&&!Object(p.a)({permission:i,tableId:n,editable:o,viewId:a.id,recordId:t}),d=l,c=Object(h.h)({isSyncTable:l});return Object(h.e)({hidden:s,onClick:function(){r.onDeleteRow([t]),Object(b.a)(y.LK.DeleteRecord)},disabled:d,tooltipConfig:c})},x=Object(y.Ww)({},m.b.GanttBarContextMenu,[c,f,g,I]),M=163,S=Object(s.connect)(function(e,t){var i=Object(y.Fz)(e),n=i&&i.status.translated;return{haveCommentPermission:Object(y.Hz)(e)&&!n,isPureBitable:Object(y.Ay)(e),isCommentDataInit:Object(y.By)(e)}})(d=function(t){function i(e){var f;return Object(y.ov)(this,i),(f=t.call(this,e)||this).selfDom=null,f.milestoneListRef=null,f.hoverExtraMilestone=!1,f.hoverMilestoneList=!1,f.milestoneDestroyTimeout=Date.now(),f.onShowEditPopup=function(e){var t=f.props.showCardModal;t&&t(e)},f.openSetMilestoneCard=function(e){return y.cz.collectClickEvent(y.Bc.CcmBitableMilestoneSetClick,{click:y.nL.MilestoneClick,target:y.Rw.CcmBitableMilestoneSetView}),f.setState({milestoneCard:{type:n.Set,show:!0,x:e.x,y:e.y,milestone:e.milestone}}),!1},f.showAddMilestoneTips=function(e){return console.log(e),!0},f.openAddMilestoneCard=function(e){y.cz.collectClickEvent(y.Bc.CcmBitableMilestoneSetClick,{click:y.nL.NewMilestone,target:y.Rw.CcmBitableMilestoneSetView});var t="mls"+Object(y.BH)(y.oL.GANTT_RANDOM_STRING_LENGTH);return f.setState({milestoneCard:{type:n.Add,show:!0,x:e.x,y:e.y,milestone:{date:e.date,id:t,description:""}}}),!1},f.showMilestoneTips=function(e){f.setState({milestoneTips:{show:!0,x:e.x,y:e.y,milestone:e.milestone}})},f.hideMilestoneTips=function(){f.setState({milestoneTips:Object.assign({},f.state.milestoneTips,{show:!1})})},f.showCurColMilestoneList=function(e){f.hoverExtraMilestone=!0,f.state.milestoneCard.show||f.setState({milestoneList:{show:!0,x:e.x,y:e.y,milestonesList:e.milestones}})},f.mouseLeaveCurColMilestoneList=function(){f.hoverExtraMilestone=!1,f.handleMilestoneListClose()},f.mouseEnterMilestoneList=function(){f.hoverMilestoneList=!0},f.mouseLeaveMilestoneList=function(){f.hoverMilestoneList=!1,f.handleMilestoneListClose()},f.handleMilestoneListClose=function(){f.milestoneDestroyTimeout=Date.now(),setTimeout(function(){!f.hoverExtraMilestone&&!f.hoverMilestoneList&&200<=Date.now()-f.milestoneDestroyTimeout&&f.setState({milestoneList:{show:!1,x:0,y:0,milestonesList:[]}})},200)},f.openGanttBarContextMenu=function(e){var t=f.props,i=t.bitableStore,n=t.editable,o=t.tableId,a=t.haveCommentPermission,r=t.isCommentDataInit,l=t.contextMenuService,s=i.getPermissionStore(),d=Object(v.b)(i.bitableConfig)&&a&&r,c=f.getViewOperator(),u=i.isSyncTable(o),b=Object.assign({},e,{tableId:o,view:f.activeView,permission:s,editable:n,showComment:d,operator:c,isSyncTable:u});null==l||l.showContextMenu(m.b.GanttBarContextMenu,{getContextMenuConfig:function(){var e;return{x:f.props.contextMenuPositionX,y:f.props.contextMenuPositionY,hidden:null===(e=f.props.bitableStore.bitableConfig.ui)||void 0===e?void 0:e.disableContextMenu}},getContext:function(){return b}})},f.onAddComment=function(e){var t=f.props,i=t.smartableCommentManager,n=t.mountOption;e&&i&&(i.triggerCreateComment(e,y.YH.ContextMenu,n),y.cz.collectBitableEvent(y.Rw.CcmCommentView,{sub_view:"part_comment"}))},f.onDeleteRow=function(e){var t=f.props,i=t.bitableStore,n=t.renderer,o=i.getCommandManager(),a=f.activeTable.id;o.execute({cmd:y.Fy.DeleteRecords,tableId:a,viewId:f.activeView.id,recordIds:e}),n.activeBitableWidget.getGridViewWidget().setSelection(null)},f.handleAddNewFields=function(){var e=f.props,t=e.bitableStore,i=e.viewId,n=e.tableId,o=t.getCommandManager(),a=null,r=f.activeTable&&f.activeTable.getNewFieldDefaultName(y.ex.DateTime)||C("bitable.new_field_name");a={tableId:n,viewId:i,data:{type:y.og.DateTime,name:r,property:null,fieldUIType:y.ex.DateTime}};var l=o.execute(Object.assign({cmd:y.Fy.AddField},a));if(l&&l.result===y.Ey.Success)return l.data.fieldId},f.handleSetGanttBarRecord=function(e,t,i,n){var o=f.props,a=o.bitableStore,r=o.viewId,l=o.tableId;if(a.base.getTableById(l)){var s=a.getCommandManager();if(Object(h.k)(y.PK.DragTime,y.ex.DateTime,n),t||i){var d=t&&f.isChangeableField(t)&&Object(y.Ww)({},t,{type:y.og.DateTime,value:n?n.startTime:null}),c=i&&f.isChangeableField(i)&&Object(y.Ww)({},i,{type:y.og.DateTime,value:n?n.endTime:null});if(!d||!c){var u=!d;u&&!c?f.showReadonlyToastTwoWay(e,t,i):f.showReadonlyToastOneWay(e,t,i,n,u)}var b=Object(y.Ww)({},e,Object.assign({},d,{},c)),m=s.execute({cmd:y.Fy.SetRecords,tableId:l,viewId:r,data:b});null!==m&&m.result!==y.Ey.Fail||console.error("SET RECORD ERROR",m)}}},f.showReadonlyToastTwoWay=function(e,t,i){var n=f.props,o=n.bitableStore,a=n.tableId,r=o.base.getTableById(a);if(r&&t&&i){var l=C("Bitable_GanttView_UnableToCreateTimeline"),s=Object(y.pL)(r,e,t),d=Object(y.pL)(r,e,i);s&&d&&d<s&&(l=C("Bitable_GanttView_DateSettingError_ExpandRecord")),y.ob.Toast.show({type:"info",content:l,duration:3e3,closable:!1})}},f.showReadonlyToastOneWay=function(e,t,i,n,o){var a=f.props,r=a.bitableStore,l=a.tableId,s=r.base.getTableById(l);if(s&&t&&i&&n){var d="";if(o){var c=Object(y.pL)(s,e,t),u=new Date(n.endTime);if(c&&u<c){var b=c.getFullYear()+"/"+(c.getMonth()+1)+"/"+c.getDate();d=C("Bitable_GanttView_EndTimeCanNotEarlierThan",{firstDay:b})}}else{var m=Object(y.pL)(s,e,i),v=new Date(n.startTime);if(m&&m<v){var p=m.getFullYear()+"/"+(m.getMonth()+1)+"/"+m.getDate();d=C("Bitable_GanttView_StartTimeCanNotLaterThan",{lastDay:p})}}d&&y.ob.Toast.show({type:"info",content:d,duration:3e3,closable:!1})}},f.handleSetGanttConfigCommand=function(e){var t=f.props,i=t.bitableStore,n=t.viewId,o=t.tableId,a=i.getCommandManager().execute({cmd:y.Fy.SetGanttConfig,tableId:o,viewId:n,data:e});null!==a&&a.result!==y.Ey.Fail||console.error("SET GANTT COFING ERROR",a)},f.setGanttBarValue=function(e){var t,i=e.values,n=e.recordId,o=e.startTimeField,a=e.endTimeField,r=Object(y.Cx)(f).activeView,l=i&&i.startTime!==i.endTime,s=o?o.id:f.handleAddNewFields();if(o||a){if(o&&a){var d=o.id===a.id;if(l)if(d){var c=r.getSupportFieldIds(),u=c.indexOf(o.id);t=c[u+1]||f.handleAddNewFields(),f.handleSetGanttConfigCommand({timeBarValue:{type:y.kE.Timing,timingValue:{startDateFieldId:s,endDateFieldId:t}}})}else t=a.id;else t=d?void 0:a.id}}else t=l?f.handleAddNewFields():void 0;f.handleSetGanttBarRecord(n,s,t,i)},f.moveGanttRow=function(e){var t=Object(y.Cx)(f),i=t.activeTable,n=t.activeView,o=e.records,a=e.index,r=e.groupCellValues,l=e.setRecordData;f.props.bitableStore.getCommandManager().execute({cmd:y.Fy.MoveRecords,tableId:i.id,viewId:n.id,records:o,target:a,groupCellValues:r,setRecordData:l})},f.addRowWithBarValue=function(e){var t=e.groupCellValues,i=e.values,n=e.startTimeField,o=e.endTimeField,a=f.executeAddRecord(t,1);if(a&&a.result===y.Ey.Success){var r=a.data[0].recordId;if(n||o){var l=n&&f.isChangeableField(n.id),s=o&&f.isChangeableField(o.id);if(!l||!s)return}f.setGanttBarValue({recordId:r,values:i,startTimeField:n,endTimeField:o})}},f.getViewOperator=function(){return{onDeleteRow:f.onDeleteRow,onShowEditPopup:f.onShowEditPopup,onAddComment:f.onAddComment,onSetGanttBarValue:f.setGanttBarValue}},f.closeMilestoneList=function(e){var t=e&&e.target;t&&f.milestoneListRef&&f.milestoneListRef.contains(t)||f.hoverExtraMilestone||f.setState({milestoneList:{show:!1,x:0,y:0,milestonesList:[]}})},f.setMilestoneListRef=function(e){f.milestoneListRef=e},f.setRef=function(e){f.selfDom=e},f.hide=function(){f.setState({milestoneCard:Object.assign({},f.state.milestoneCard,{show:!1})}),f.props.renderer.activeBitableWidget.getGanttWidget().events.emit(y.qL.HideCreateMilestoneTips)},f.renderMilestoneEditCard=function(){var e=f.props,t=e.tableId,i=e.bitableStore,n=e.viewId,o=e.editable,a=f.state.milestoneCard,r=a.show,l=a.x,s=a.y,d=a.milestone,c=a.type;return r&&d?u.a.createElement(w,{x:l,y:s,milestone:d,type:c,bitableStore:i,activeTableId:t,hide:f.hide,viewId:n,anchor:f.selfDom,editable:o&&f.getViewEditable(),hoverExtraMilestone:function(){return f.hoverExtraMilestone}}):null},f.handleClick=function(e){if(e){var t=f.props.bitableStore.base.getTableById(f.props.tableId),i=t&&t.getMilestone(e);t&&i&&f.setState({milestoneCard:{show:!0,type:n.Set,milestone:Object.assign({},i,{id:e}),x:f.state.milestoneList.x,y:f.state.milestoneList.y},milestoneList:{show:!1,x:0,y:0,milestonesList:[]}})}},f.renderMilestoneTips=function(){var e=f.state.milestoneTips,t=e.x,i=e.y,n=e.milestone,o=e.show,a={top:i,left:t,width:M};return o&&f.selfDom&&Object(y.bE)(f.selfDom,a,{width:M,viewportRight:y.rL}),o&&n?u.a.createElement("div",{className:"milestone-tips-wrapper",style:a},u.a.createElement("div",{className:"milestone-flag-svg"},u.a.createElement(l.a,null)),u.a.createElement("div",{className:"milestone-flag-text"},n.description)):null},f.renderMilestonesList=function(){var e=f.state.milestoneList,t=e.x,i=e.y,n=e.milestonesList,o=e.show,a={top:i,left:t,width:M};return o&&f.selfDom&&Object(y.bE)(f.selfDom,a,{width:M,viewportRight:y.rL}),o&&n?u.a.createElement("div",{ref:f.setMilestoneListRef,className:"milestone-list-wrapper",style:a,onMouseEnter:f.mouseEnterMilestoneList,onMouseLeave:f.mouseLeaveMilestoneList,onClick:f.mouseLeaveMilestoneList},n.map(function(e){return u.a.createElement("div",{key:e.id,onClick:function(){return f.handleClick(e.id)}},u.a.createElement(l.a,null),u.a.createElement("span",null,e.description))})):null},f.state={tooltip:{show:!1,x:0,y:0,width:0,height:0,title:""},milestoneList:{show:!1,x:0,y:0,milestonesList:[]},milestoneCard:{type:n.Add,show:!1,x:0,y:0,milestone:null},milestoneTips:{show:!1,x:0,y:0,milestone:null}},f.initContextMenuService(),f}return Object(y.bu)(i,t),Object(y.Pw)(i,[{key:"componentDidMount",value:function(){window.addEventListener("mousedown",this.closeMilestoneList),this.updateActiveModel(this.props)&&(this.clearListener=this.bindFasterEvent())}},{key:"UNSAFE_componentWillReceiveProps",value:function(e){this.props.tableId===e.tableId&&this.props.viewId===e.viewId||(this.clearListener&&this.clearListener(),this.updateActiveModel(e)&&(this.clearListener=this.bindFasterEvent()));var t=e.view,i=this.props.view;this.props.tableId===e.tableId&&t&&i&&t.id===i.id&&t.publicLevel!==i.publicLevel&&t.publicLevel===y.fB.PERSONAL&&(this.closeContextMenu(),this.hide(),this.hideMilestoneTips(),this.closeMilestoneList(),this.setState({tooltip:Object.assign({},this.state.tooltip,{show:!1})}))}},{key:"componentWillUnmount",value:function(){this.clearListener&&this.clearListener(),window.removeEventListener("mousedown",this.closeMilestoneList)}},{key:"initContextMenuService",value:function(){var e;null===(e=this.props.contextMenuService)||void 0===e||e.setContextMenus(x)}},{key:"updateActiveModel",value:function(e){var t=e.bitableStore,i=e.tableId,n=e.viewId,o=t.base.getTableById(i),a=o&&o.getViewById(n);return!(!o||!a||(this.activeTable=o,this.activeView=a,0))}},{key:"bindFasterEvent",value:function(){var e,t,i=this.props.renderer.activeBitableWidget,n=i.getGanttWidget(),o=(Object(y.Ww)(e={},y.qL.OpenAddMilestoneCard,this.openAddMilestoneCard),Object(y.Ww)(e,y.qL.OpenSetMilestoneCard,this.openSetMilestoneCard),Object(y.Ww)(e,y.qL.ShowMilestoneContentTips,this.showAddMilestoneTips),Object(y.Ww)(e,y.qL.ShowMilestoneTips,this.showMilestoneTips),Object(y.Ww)(e,y.qL.HideMilestoneTips,this.hideMilestoneTips),Object(y.Ww)(e,y.qL.ShowMilestoneList,this.showCurColMilestoneList),Object(y.Ww)(e,y.qL.MouseLeaveMilestoneList,this.mouseLeaveCurColMilestoneList),Object(y.Ww)(e,y.qL.SetGanttBarValue,this.setGanttBarValue),Object(y.Ww)(e,y.qL.MoveGanttRow,this.moveGanttRow),Object(y.Ww)(e,y.qL.OpenCardModal,this.onShowEditPopup),Object(y.Ww)(e,y.qL.OpenGanttBarContextMenu,this.openGanttBarContextMenu),Object(y.Ww)(e,y.qL.AddRowWithBarValue,this.addRowWithBarValue),e),a=(Object(y.Ww)(t={},y.kC.ShowAttachPopover,function(e){h.a.open(e)}),Object(y.Ww)(t,y.kC.HideAttachPopover,function(){h.a.close()}),t);return n.events.addListeners(o),i.events.addListeners(a),function(){n.events.removeListeners(o),i.events.removeListeners(a)}}},{key:"getViewEditable",value:function(){var e=this.props,t=e.bitableStore,i=e.tableId,n=e.viewId;return!t.isSyncTable(i)&&t.hasPermission(y.qy.View,{tableId:i,viewId:n},y.ry.Editable)}},{key:"closeContextMenu",value:function(){var e;null===(e=this.props.contextMenuService)||void 0===e||e.closeContextMenu()}},{key:"isChangeableField",value:function(e){var t=this.props,i=t.bitableStore,n=t.tableId,o=i.base.getTableById(n);if(!o)return!1;var a=o.getField(e);return!!a&&!a.getIsReadonly()}},{key:"executeAddRecord",value:function(e,t,i,n){var o=this.activeTable,a=this.activeView,r=this.props,l=r.bitableStore,s=r.renderer,d=r.addRecordInCard,c=l.getCommandManager();if(null!=i&&(i=a.getAllRecordIndexById(a.getVisibleRecords()[i]),i=n===y.qC.Down?i+1:i),y.ob.config.cardSyncMode!==y.tx.OnDemand&&!d){var u=s.activeBitableWidget,b=u.getGridWidget(),m=c.execute({cmd:y.Fy.AddRecords,tableId:o.id,viewId:a.id,groupCellValues:e||void 0,index:i,count:t});if(m.result!==y.Ey.Success)return m;if(y.ob.collectBitableEvent(y.On.BitableRecordAdd,{table_id:this.activeTable.id,view_id:this.activeView.id,bitable_view_type:y.Cz[this.activeView.type],bitable_record_direction:n||"bottom",data_source:l.Options.module,action:y.UC.Click,record_number:t},!0),m.result!==y.Ey.Success)return m;var v=n===y.qC.Down?m.data.length-1:0,p=m.data[v].recordId;if(!a.viewFilter.checkConditions(p)){if(1<t)return y.ob.Toast.show({type:"info",content:C("bitable.grid_filter_added_record",t),duration:3e3,closable:!1}),m;if(0===a.getVisibleRecords().length||a.type===y.az.Gantt)return this.props.showCardModal(p,this.activeView&&this.activeView.getAllFields()[0]),y.ob.collectBitableEvent(y.On.BitableCardOpen,{table_id:this.activeTable.id,view_id:this.activeView.id,bitable_view_type:y.Cz[this.activeView.type],source:y.NK.AddRecord,data_source:l.Options.module}),y.cz.collectBitableEvent(y.Rw.CcmBitableCardView,{source:y.NK.AddRecord}),m;var f=u.getFloatGridWidget();s.toggleFloatLayerVisible(!0,p,y.RL.isMeetFilter,!0),b.rebuild();var h=new y.qK(0,0,1,1);f.setSelection(h)}var w=this.activeView&&this.activeView.table.getPrimaryField();return null==w||w.type,y.og.Formula,(null==w?void 0:w.type)===y.og.DateTime&&w.property.autoFill,m}this.props.onAddRecord&&this.props.onAddRecord(e,i,n)}},{key:"renderTooltips",value:function(){var e=this.state.tooltip;return u.a.createElement(y.vL,{container:this.props.tooltipOverlayRef,x:e.x,y:e.y,width:e.width,height:e.height,title:e.title,visible:e.show,direction:e.direction,className:"".concat(e.className),style:e.style,animate:e.animate,showArrow:e.showArrow})}},{key:"render",value:function(){return u.a.createElement(o.Fragment,null,u.a.createElement("div",{ref:this.setRef,className:"faster-overlay"},this.renderTooltips(),this.renderMilestoneEditCard(),this.renderMilestonesList(),this.renderMilestoneTips()))}}]),i}(u.a.PureComponent))||d,L=Object.freeze({__proto__:null,GanttViewLayer:S})}.call(this,O("vb163"))}}]);
//# sourceMappingURL=//slardar.bytedance.net/api_v2/browser/jserr/get_sourcemap?bid=docs_pc&js_filename=gantt-view-layer.583553cd61.chunk.js