(window.webpackJsonp=window.webpackJsonp||[]).push([["4be04b27ab7c"],{vb335:function(e,t,n){"use strict";n.d(t,"a",function(){return l}),n.d(t,"b",function(){return o});var i=n("vb103"),r=n("vb143"),a=n("vb114");function l(){var e=Object(i.useState)({}),t=Object(r.xz)(e,2)[1];return Object(i.useCallback)(function(){return t({})},[])}var c=function(){return function(){}};function o(t,e){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:c,r=Object(i.useRef)(void 0);Object(i.useMemo)(function(){r.current=t()},e);var o=l();return Object(i.useEffect)(function(){return n(function(){var e=t();Object(a.shallowEqual)(r.current,e)||(r.current=e,o())})},e),r.current}},vb356:function(e,r,o){"use strict";(function(d){o.d(r,"a",function(){return n}),o.d(r,"b",function(){return b});var e=o("vb152"),s=o.n(e),u=o("vb143");o("vb147"),o("vb103"),o("vb148");function b(e,t,n,r){var o=Object(u.uO)({table:e,view:t,record:n,field:r});return"".concat(location.origin).concat(location.pathname,"?").concat(o)}var t,n=(t=Object(u.uY)(s.a.mark(function e(t){var n,r,o,i,a,l,c;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.viewId,r=t.tableId,o=t.recordId,i=t.fieldId,a=t.onCopy,l=void 0===a?function(){return!0}:a,c=b(r,n,o,i),e.next=4,l(c);case 4:e.sent?u.ob.Toast.show({type:"info",content:d("Bitable_Record_CopyLinkSuccessfullyToast"),duration:3e3,closable:!1}):u.ob.Toast.show({type:"info",content:d("Bitable_Record_UnableToCopyLinkToast"),duration:3e3,closable:!1});case 6:case"end":return e.stop()}},e)})),function(e){return t.apply(this,arguments)})}).call(this,o("vb163"))},vb484:function(e,t,n){"use strict";var r=n("vb386"),o=0;function i(e){var t=++o;return Object(r.a)(e)+t}t.a=i},vb491:function(e,t,n){"use strict";n.d(t,"a",function(){return r}),n.d(t,"b",function(){return i}),n.d(t,"c",function(){return h}),n.d(t,"d",function(){return v}),n.d(t,"e",function(){return s});var r,i,o,a,l,c,d=n("vb143");n("vb147"),n("vb103"),n("vb148");function s(e){var t;return e===i.Detail?t=d.py.TabDetail:e===i.Comment&&(t=d.py.TabComment),{click:t}}(c=r||(r={}))[c.Detail=1]="Detail",c[c.Comment=2]="Comment",c[c.Blockit=100]="Blockit",c[c.Demo=999]="Demo",(l=i||(i={})).Detail="Detail",l.Comment="Comment";var u=(Object(d.Ww)(o={},d.AA.Drawer,"drawer"),Object(d.Ww)(o,d.AA.Dialog,"card"),o);function b(e){if(void 0!==e)return u[e]||e}var v=function(e){var t=e.click,n=e.target,r=void 0===n?d.oz:n,o=e.options,i=void 0===o?{}:o,a=e.cardType;d.cz.collectBitableEvent(d.Bc.CcmBitableCardClick,Object.assign({click:t,target:r,version:"v2",card_type:b(a)},i))},p=(Object(d.Ww)(a={},i.Comment,"comment"),Object(d.Ww)(a,i.Detail,"detail"),a),f="customized";function h(e){var t,n=e.tabId,r=e.cardOpenSource,o=e.cardType;t=n in i?p[n]||n:f,d.cz.collectBitableEvent(d.Rw.CcmBitableCardView,{source:r,tab_type:t,card_type:b(o),version:"v2"})}},vb591:function(e,xt,Mt){"use strict";Mt.r(xt),function(c){Mt.d(xt,"C",function(){return Se}),Mt.d(xt,"D",function(){return He}),Mt.d(xt,"I",function(){return Ye}),Mt.d(xt,"a",function(){return Xe}),Mt.d(xt,"b",function(){return N}),Mt.d(xt,"c",function(){return V}),Mt.d(xt,"d",function(){return H}),Mt.d(xt,"e",function(){return L}),Mt.d(xt,"f",function(){return U}),Mt.d(xt,"g",function(){return Ee}),Mt.d(xt,"h",function(){return ge}),Mt.d(xt,"i",function(){return Rt}),Mt.d(xt,"u",function(){return _});var I=Mt("vb143"),i=Mt("vb484"),e=Mt("vb196"),j=Mt("vb103"),E=Mt.n(j),t=(Mt("vb147"),Mt("vb148"),Mt("vb114")),n=Mt("vb152"),f=Mt.n(n),r=Mt("vb158"),o=(Mt("vb112"),Mt("vb164"),Mt("vb167"),Mt("vb113"),Mt("vb162")),a=(Mt("vb155"),Mt("vb116"),Mt("vb118"),Mt("vb120"),Mt("vb174"),Mt("vb119"),Mt("vb121"),Mt("vb117"),Mt("vb115"),Mt("vb123")),d=Mt("vb111"),l=Mt("vb159"),k=Mt.n(l),s=Mt("vb2158"),u=Mt("vb2184"),b=Mt("vb2173"),v=Mt("vb962"),p=Mt("vb2212"),h=Mt("vb1284"),m=Mt("vb356"),C=Mt("vb335"),y=Mt("vb412"),g=Mt("vb490"),w=Mt("vb491"),O=Mt("vb326"),S=Mt("vb590"),R=Mt("vb180"),x=(Mt("vb126"),Mt("vb125"),Mt("vb194")),M=Mt("vb489"),T=Mt("vb183"),D=Mt("vb110");function B(a,l,c){for(var n={},e=function(i){if("string"==typeof a[i])n[a[i]]=l;else{var e=function(o){n[o]=function(){for(var e,t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return(e=a[i])[o].apply(e,[c].concat(n))&&l()}};for(var t in a[i])e(t)}},t=0;t<a.length;t++)e(t);return n}function _(){return(Object(j.useContext)(I.mA)||{}).base}function F(e){var t=_();return Object(j.useMemo)(function(){return null==t?void 0:t.getTable(e)},[t,e])}function P(e,t,n){var r=3<arguments.length&&void 0!==arguments[3]?arguments[3]:[],o=F(e);return Object(C.b)(function(){return o?t(o):void 0},[o].concat(Object(I.hI)(n)),function(e){return null==o?void 0:o.batchBind(B(r,e,o))})}function W(){return Object(j.useContext)(I.mA).operate}function z(){return W().tableOperate}var V="bitable-card-header-dropdown-menu",N="".concat(V,"-icon"),L="".concat(V,"-item"),H="".concat(V,"-divider"),U="".concat(V,"-disabled"),K=["visible"],q=function(o){function i(){var n;Object(I.ov)(this,i);for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return(n=o.call.apply(o,[this].concat(t))||this).handleCopyLink=function(){var e=n.props.onCopy;e&&e()},n.handleDeleteRecord=function(){var e,t;n.props.disableDeleteRecord||null===(e=(t=n.props).onDeleteRecord)||void 0===e||e.call(t)},n}return Object(I.bu)(i,o),Object(I.Pw)(i,[{key:"getMenuConfig",value:function(){var e=[{icon:E.a.createElement(s.a,{className:k()(N,Object(I.Ww)({},"".concat(N,"-disabled"),this.props.disableCopyLink))}),text:c("Bitable_Record_CopyRecordLink_Dropdown"),onClick:this.handleCopyLink,visible:!this.props.disableCopyLink},{icon:E.a.createElement(u.a,{className:k()(N,Object(I.Ww)({},"".concat(N,"-disabled"),this.props.disableDeleteRecord))}),text:c("Bitable_Record_DeleteRecord_Dropdown"),onClick:this.handleDeleteRecord,disabled:this.props.disableDeleteRecord,visible:!0}],r=[];return e.forEach(function(e){var t=e.visible,n=Object(I.nA)(e,K);t&&r.push(n)}),r}},{key:"render",value:function(){var e=this.getMenuConfig(),t=E.a.createElement(d.Menu,{className:V},e.map(function(e,t){return E.a.createElement(E.a.Fragment,null,0!==t&&E.a.createElement(d.Menu.Divider,{className:H}),E.a.createElement(d.Menu.Item,{className:k()(L,"bitable-noselect"),key:e.text,icon:e.icon,onClick:e.onClick,disabled:e.disabled},e.text))}));return E.a.createElement(d.Dropdown,{overlay:t,placement:"bottomRight",trigger:"click"},this.props.children)}}]),i}(E.a.PureComponent),J=E.a.createContext({onCollectCardClickEvent:o.a});function X(){return Object(j.useContext)(J)}function Y(e){var t=P(e,function(e){var t;return{primaryFieldId:null===(t=e.getPrimaryField())||void 0===t?void 0:t.getId()}},[]);return(null==t?void 0:t.primaryFieldId)||""}var Q,Z,$,ee=function(e){var n=Object(I.jx)(),r=X().onCollectCardClickEvent,t=e.tableId,o=e.viewId,i=e.recordId,a=Y(t),l=e.fieldId||a;return n?E.a.createElement(q,Object(I.Kx)({},e,{onCopy:Object(I.uY)(f.a.mark(function e(){return f.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(m.a)({tableId:t,viewId:o,recordId:i,fieldId:l,onCopy:function(){var t=Object(I.uY)(f.a.mark(function e(t){return f.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r({click:I.py.CopyLink}),e.next=3,n.clipboardHelper.setClipboardValue(t);case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}},e)}));function e(e){return t.apply(this,arguments)}return e}()});case 2:case"end":return e.stop()}},e)}))})):null};($=Q||(Q={})).pre="pre",$.next="next";var te=I.rx.isMac,ne=te?"âŒ˜":"Ctrl",re=te?"Option":"Alt",oe="[",ie="]",ae=(Object(I.Ww)(Z={},I.rz.Warning,c("Bitable_Relation_NewRecordNotMeetCondition_Web")),Object(I.Ww)(Z,I.rz.Info,c("bitable.card_modal.filter_tip")),Z),le=function(o){function i(){var t;Object(I.ov)(this,i);for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return(t=o.call.apply(o,[this].concat(n))||this).closeCardModal=function(){var e=t.props.onCloseModal;null==e||e()},t}return Object(I.bu)(i,o),Object(I.Pw)(i,[{key:"renderJumpTable",value:function(){return this.props.jumpTableElement}},{key:"renderMoreMenuGroup",value:function(){var n=this,e=this.props,t=e.tableId,r=e.viewId,o=e.recordId,i=e.fieldId,a=e.disableMoreMenu,l=e.onDeleteRecord;return a?null:E.a.createElement(ee,{onDeleteRecord:l,tableId:t,viewId:r,recordId:o,fieldId:i,disableCopyLink:this.props.disableCopyLink,disableDeleteRecord:this.props.disableDeleteRecord},E.a.createElement(d.Button,{className:"bitable-card-modal-header-v2-btn",icon:E.a.createElement(b.a,null),onClick:function(){var e,t;return null===(e=(t=n.props).onMenuButtonClick)||void 0===e?void 0:e.call(t)}}))}},{key:"renderSwitchButtons",value:function(){var e=this.props,t=e.isNextBtnEnable,n=e.isPrevBtnEnable,r=e.isTableLoading,o=e.onSwitchRecord;if(e.disableSwitchBtn)return null;var i=E.a.createElement(d.Button,{className:k()("bitable-card-modal-header-v2-btn",{disabled:!n}),onClick:function(){return null==o?void 0:o(Q.pre)},icon:E.a.createElement(v.a,null)}),a=E.a.createElement(d.Button,{className:k()("bitable-card-modal-header-v2-btn",{disabled:!t}),onClick:function(){return null==o?void 0:o(Q.next)},icon:E.a.createElement(p.a,null)});return E.a.createElement(E.a.Fragment,null,E.a.createElement(d.Divider,{className:"bitable-card-modal-header-v2-btn-split-line",type:"vertical"}),t?E.a.createElement(d.Tooltip,{title:c("bitable.card_modal.next")+"( ".concat(ne,"+").concat(re,"+").concat(ie," )"),placement:"top"},a):r?E.a.createElement(d.Tooltip,{title:c("Bitable_Common_Table_Loading"),placement:"top"},a):a,n?E.a.createElement(d.Tooltip,{title:c("bitable.card_modal.pre")+"( ".concat(ne,"+").concat(re,"+").concat(oe," )"),placement:"top"},i):r?E.a.createElement(d.Tooltip,{title:c("Bitable_Common_Table_Loading"),placement:"top"},i):i,E.a.createElement(d.Divider,{className:"bitable-card-modal-header-v2-btn-split-line",type:"vertical"}))}},{key:"renderCloseBtn",value:function(){return E.a.createElement(d.Tooltip,{title:c("bitable.card_modal.close"),placement:"top"},E.a.createElement(d.Button,{className:"bitable-card-modal-header-v2-btn",onClick:this.closeCardModal,icon:E.a.createElement(h.a,{className:"bitable-card-modal-header-v2-magnify"})}))}},{key:"render",value:function(){var e=this.props,t=e.headerTitle,n=e.onSetHideFilterTip,r=e.shouldShowTip,o=e.noticeIconType,i=void 0===o?I.rz.Info:o;return E.a.createElement("div",{className:k()("bitable-card-modal-header-v2")},E.a.createElement("div",{className:"bitable-layout-row bitable-layout-cross-center"},E.a.createElement("div",{className:"bitable-flex bitable-card-modal-header-v2-title"},E.a.createElement(d.Tooltip,{title:t,placement:"bottom"},E.a.createElement("div",{className:"bitable-card-modal-header-v2-title-content"},t))),this.renderMoreMenuGroup(),this.renderSwitchButtons(),this.renderCloseBtn()),r?E.a.createElement("div",{className:"bitable-card-modal-filter-tip"},E.a.createElement(d.Notice,{showIcon:!0,closable:!0,align:"center",type:i,message:ae[i],onClose:function(){return null==n?void 0:n(!0)}})):null,this.renderJumpTable())}}]),i}(E.a.PureComponent),ce=function(o){function i(){var n;Object(I.ov)(this,i);for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return(n=o.call.apply(o,[this].concat(t))||this).onClickJumpTable=function(){var e,t;null===(e=(t=n.props).onClick)||void 0===e||e.call(t)},n}return Object(I.bu)(i,o),Object(I.Pw)(i,[{key:"render",value:function(){return this.props.source!==I.sz.Link||this.props.isEmbedded?null:E.a.createElement("div",{className:"bitable-card-modal-jump-wrapper"},E.a.createElement(I.ix,{name:c("Bitable_Relation_RecordFrom"),className:"bitable-layout-row bitable-layout-cross-center"},E.a.createElement(y.a,{renderer:this.props.renderer,bitableStore:this.props.bitableStore,tableId:this.props.tableId,onClick:this.onClickJumpTable,showJumpTableName:!0})))}}]),i}(E.a.PureComponent),de=function(e,t){var n=e.env,r=t.isBitableReady,o=t.onSwitchCard,i=t.cardOrderInfo,a=t.bitableMountSource,l=t.onClose,c=a!==I.Bz.History&&a!==I.Bz.Template,d=!!i.nextRecordId&&(r||!c),s=!!i.preRecordId&&(r||!c);return{isNextBtnEnable:d,isPrevBtnEnable:s,isTableLoading:!r&&c,disableCopyLink:n.getEmbeddedType()!==I.pA.Default,onCloseModal:function(){null==l||l()},onSwitchRecord:function(e){if(e===Q.pre){if(!s)return;null==o||o(Q.pre)}else{if(!d)return;null==o||o(Q.next)}},onClickJumpTable:function(){null==l||l()}}},se=Object(t.connect)(function(e){return{isBitableReady:Object(I.tz)(e)}}),ue=Object(e.a)([Object(I.oA)(de),se])(function(n){var e=Object(I.jy)();if(!e)return null;var t=Object(I.jx)();if(!t)return null;var r=X().onCollectCardClickEvent,o=E.a.createElement(ce,{renderer:t,bitableStore:e,isEmbedded:e.isEmbedded,source:n.source,tableId:n.tableId,onClick:function(){var e;null===(e=n.onClickJumpTable)||void 0===e||e.call(n),null==r||r({click:I.py.Relate,target:I.Rw.CcmBitableContentPageView})}});return E.a.createElement(le,Object(I.Kx)({},n,{jumpTableElement:o,onCloseModal:function(){var e;null===(e=n.onCloseModal)||void 0===e||e.call(n),null==r||r({click:I.py.CloseRecord})},onSwitchRecord:function(e){var t;null===(t=n.onSwitchRecord)||void 0===t||t.call(n,e),e===Q.pre?null==r||r({click:I.py.PreviousRecord}):null==r||r({click:I.py.NextRecord})},onMenuButtonClick:function(){var e;null===(e=n.onMenuButtonClick)||void 0===e||e.call(n),null==r||r({click:I.py.ToolbarMore})}}))}),be="bitable-card-modal-v2",ve="bitable-card-modal-content-v2",pe="bitable-card-modal-keyboard-manager",fe=function(){function e(){Object(I.ov)(this,e),I.rA.warn("CardKeyboardManager using EmptyHandler!!!")}return Object(I.Pw)(e,null,[{key:"getInstance",value:function(){return new e}}]),e}(),he=function(){function t(e){Object(I.ov)(this,t),this.getKeyboardContext=e}return Object(I.Pw)(t,[{key:"handleESC",value:function(e){var t=this.getKeyboardContext().onCloseModal;t&&t(e)}},{key:"handleSwitchPrevRecord",value:function(){var e=this.getKeyboardContext(),t=e.onSwitchRecord;e.isSwitchShortcutEnabled&&(t&&t(Q.pre),I.cz.collectClickEvent(I.Bc.CcmBitableShortcutClick,{click:"previous_record"}))}},{key:"handleSwitchNextRecord",value:function(){var e=this.getKeyboardContext(),t=e.onSwitchRecord;e.isSwitchShortcutEnabled&&(t&&t(Q.next),I.cz.collectClickEvent(I.Bc.CcmBitableShortcutClick,{click:"next_record"}))}}]),t}(),me=function(){function t(){var c=this,e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:window;Object(I.ov)(this,t),this._handlers=[],this.handleKeydown=function(e){if((!e.target||Object(I.qA)(e.target,pe))&&!e.ignoreKeybinding)if(e.keyCode!==I.sx.Esc){var t=e.altKey,n=e.keyCode,r=e.metaKey,o=e.ctrlKey;if(I.rx.mac||I.rx.isIPad){var i=[r,o];o=i[0],r=i[1]}var a=t&&o&&n===I.sx.BracketLeft,l=t&&o&&n===I.sx.BracketRight;a&&c.handleSwitchPrevRecord(),l&&c.handleSwitchNextRecord()}else c.handleESC(e)},this.container=e,this.start()}return Object(I.Pw)(t,[{key:"isValidContainer",value:function(e){return Boolean(e)}},{key:"addListeners",value:function(){this.isValidContainer(this.container)&&this.container.addEventListener("keydown",this.handleKeydown)}},{key:"removeListeners",value:function(){this.isValidContainer(this.container)&&this.container.removeEventListener("keydown",this.handleKeydown)}},{key:"handler",get:function(){var e=this._handlers.length;return e?this._handlers[e-1]:null}},{key:"handleESC",value:function(e){var t;null!==(t=this.handler)&&void 0!==t&&t.handleESC&&this.handler.handleESC(e)}},{key:"handleSwitchPrevRecord",value:function(){var e;null!==(e=this.handler)&&void 0!==e&&e.handleSwitchPrevRecord&&this.handler.handleSwitchPrevRecord()}},{key:"handleSwitchNextRecord",value:function(){var e;null!==(e=this.handler)&&void 0!==e&&e.handleSwitchNextRecord&&this.handler.handleSwitchNextRecord()}},{key:"start",value:function(){this.addListeners()}},{key:"destroy",value:function(){this.removeListeners(),t._instance=null,this.container=null}},{key:"pop",value:function(){this._handlers.pop(),0===this._handlers.length&&this.destroy()}},{key:"push",value:function(e){var t="function"==typeof e?new he(e):fe.getInstance();this._handlers.push(t)}}],[{key:"getInstance",value:function(){return this._instance||(this._instance=new t),this._instance}}]),t}();me._instance=null;var Ce=function(){function t(e){var d=this;Object(I.ov)(this,t),this.getCardOrderInfo=function(){var e=d.getRecordContext(),t=e.tableId,n=e.bitableStore,r=e.forSelfTable,o=e.viewId,i=e.recordId,a=e.switchRecords,l=e.field,c=e.isAddRecord;return Object(g.a)({tableId:t,bitableStore:n,forSelfTable:r,viewId:o,recordId:i,switchRecords:a,field:l,isAddRecord:void 0!==c&&c})},this.switchRecord=function(e){var t=d.getRecordContext().onSwitchRecord,n=d.getCardOrderInfo();e===Q.pre?n.preRecordId&&t&&t(n.preRecordId):n.nextRecordId&&t&&t(n.nextRecordId)},this.setRecord=function(e){var t=d.getRecordContext(),n=t.bitableStore,r=t.recordId,o=t.tableId,i=t.viewId;return n.getCommandManager().execute({cmd:I.Fy.SetRecord,recordId:r,tableId:o,viewId:i,data:e})},this.getRecordContext=e,this.start()}return Object(I.Pw)(t,[{key:"bindAxisSourceUpdate",value:function(){var t=this,e=this.getRecordContext(),n=e.tableId,r=e.viewId,o=e.recordId,i=e.bitableStore;this.destroyAxisSource(),this.axisSource=new I.Py({type:I.Qy.record,tableId:n,viewId:r,recordId:o},i);var a=this.axisSource.getSource();this.handleAxisSourceUpdate(a),this.axisSource.bindUpdate(function(e){t.handleAxisSourceUpdate(e)})}},{key:"unbindAxisSourceUpdate",value:function(){this.destroyAxisSource()}},{key:"destroyAxisSource",value:function(){this.axisSource&&this.axisSource.destroyed(),this.axisSource=null}},{key:"handleAxisSourceUpdate",value:function(e){var t=this.getRecordContext(),n=t.onDeleteRecordByRemote,r=t.isAddRecord;null!=e||r||"function"==typeof n&&n()}},{key:"start",value:function(){this.bindAxisSourceUpdate()}},{key:"destroy",value:function(){this.unbindAxisSourceUpdate()}}]),t}();function ye(e){var t=e.recordId,n=e.tableId,r=e.viewId,o=e.isCommentDataInit,i=Object(I.jy)(),a=Object(I.jx)(),l=X(),c=Object(I.sA)().smartableCommentManager,d=l.onCollectCardClickEvent,s=function(){return null==d?void 0:d({click:I.py.AddComment})},u=Object(j.useRef)(null),b=function(e){u.current=e},v=Object(O.b)(i.bitableConfig)&&o,p=c&&c.getCustomCommentCard(),f=Object(I.Ry)(i),h=i.isEmbeddedInDoc&&a.isFullScreen;return c&&v?E.a.createElement(j.Fragment,null,p?E.a.createElement(p,{bitableStore:i,smartableCommentManager:c,recordId:t,tableId:n,viewId:r,renderer:a,isFullScreen:h,mentionSource:f,getCommentRef:b,onCommentAdded:s}):E.a.createElement(S.a,{bitableStore:i,smartableCommentManager:c,recordId:t,tableId:n,viewId:r,renderer:a,isFullScreen:h,mentionSource:f,getCommentRef:b})):null}function ge(e){return{metaId:e.id,type:e.type,name:e.name}}function we(e){return Oe.apply(this,arguments)}function Oe(){return(Oe=Object(I.uY)(f.a.mark(function e(t){var n,r;return f.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.meta,(r=ge(n)).id=Object(I.Qx)(I.Rx.itemViewTab),e.abrupt("return",r);case 4:case"end":return e.stop()}},e)}))).apply(this,arguments)}var Ie={createInstance:we},je={canAdd:!1,canDelete:!1,canRename:!1,canMove:!1};function Ee(e){var t={component:e.component||null,hook:Object.assign({},Ie),permission:Object.assign({},je)};return e.hook&&(t.hook=Object.assign({},t.hook,{},e.hook)),e.permission&&(t.permission=Object.assign({},t.permission,{},e.permission)),t}var ke={id:"comment",name:c("bitable.record_comments"),type:w.a.Comment},Se={name:ke.name,id:w.b.Comment,type:w.a.Comment,metaId:ke.id},Re=Ee({component:Object(e.a)(Object(t.connect)(function(e){return{isCommentDataInit:Object(I.By)(e)}}))(ye)});function xe(e,t,n,r,i,o){var a=t.base.getTableById(e);if(!a)return{recordInfo:[],recordShowInfo:[],recordHideInfo:[]};var l=a.getViewById(r),c=[];n||0!==o.length?c=o:(!l&&a.views.length&&(l=a.getViewById(a.views[0].id)),c=l?l.getAllFieldsWithoutDenied():[]);var d=[],s=[],u=[],b=l&&l.getVisibleFields();return c.forEach(function(e,t){if(!a.isDeniedField(e)){var n=a.getCellValue(i,e),r=a.fields[e];if(r){var o={fieldId:e,type:r.type,cell:{recordId:i,fieldId:e,rect:null,field:r,value:n}};b&&!b.includes(e)?u.push(o):s.push(o),d.push(o)}}}),{recordInfo:d,recordShowInfo:s,recordHideInfo:u}}function Me(e,t,n,r,o){var i=n.base.getTableById(e),a={recordInfo:[],recordShowInfo:[],recordHideInfo:[]};if(!i||0===r.length)return a;var l=i.getViewById(t);if(!l)return a;var c={};if(l.type===I.az.Kanban){var d=l.getGroupField(),s=o&&o[0];d&&s&&((c=Object.assign({},i.getDefaultNewRecord(),l.getDefaultNewRecord()))[d.id]={value:Object(I.kA)(d,s,i)})}else c=Object.assign({},i.getDefaultNewRecord(),l.getDefaultNewRecord(o));var u,b=[],v=[],p=[],f=l.getVisibleFields(),h=Object(I.WB)(r);try{for(h.s();!(u=h.n()).done;){var m=u.value;if(!i.isDeniedField(m)){var C=i.getField(m);if(C){var y=null;if(C.type!==I.og.Formula&&n.hasPermission(I.qy.Field,{tableId:e,fieldId:m},I.ry.Submittable)){var g=Object(I.lA)(c,m);y=void 0!==g?g:null}var w={fieldId:m,type:C.type,cell:{recordId:"",fieldId:m,rect:null,field:C,value:y}};f&&!f.includes(m)?p.push(w):v.push(w),b.push(w)}}}}catch(e){h.e(e)}finally{h.f()}return{recordInfo:b,recordShowInfo:v,recordHideInfo:p}}var Te=function(e,t,n,r){var o=t.base.getTableById(e);if(!o)return{};for(var i=n.recordInfo.reduce(function(e,t){var n=t.cell.value;return null==n?e:Object.assign({},e,Object(I.Ww)({},t.fieldId,{value:n}))},{}),a=(null==r?void 0:r())||{},l=0,c=Object.keys(a);l<c.length;l++){var d=c[l];i[d]=a[d]}for(var s=0,u=Object.keys(i);s<u.length;s++){var b,v=u[s],p=o.getField(v),f=null===(b=i[v])||void 0===b?void 0:b.value;p&&null!=f&&p.validate(f)||delete i[v]}return i};function De(e){var t,n=e.tableId,r=e.viewId,o=e.recordId,i=e.fieldList,a=void 0===i?[]:i,l=e.forSelfTable,c=e.bitableStore,d=e.groupCellValues,s=e.getActionData,u=e.onRecordChange,b=Object(I.jx)();t=o?xe(n,c,l,r,o,a):Me(n,r,c,a,d);var v=function(){return Te(n,c,t,s)};return Object(j.useEffect)(function(){null==u||u(v)}),b?E.a.createElement(M.a,Object(I.Kx)({},e,{record:t,bitableStore:c,renderer:b,modalVisible:!0,getFormValue:v})):null}var Ae=["children","onClose"],Be=function(o){function i(){var n;Object(I.ov)(this,i);for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return(n=o.call.apply(o,[this].concat(t))||this).state={modalScrollTop:0,modalOffsetHeight:790,modalHiddenFieldOffset:0,disableAutoFocus:!0},n.modalBody=null,n.resizeObserver=null,n.handleModalScroll=Object(R.a)(function(){if(n.modalBody){var e=n.modalBody.scrollTop;if(e!==n.state.modalScrollTop){var t=n.modalBody.querySelector(".card_edit_hide_toggle");n.setState({modalScrollTop:e,modalHiddenFieldOffset:t?t.offsetTop+I.qx:0})}}},250),n.observeModalHeight=Object(R.a)(function(){if(n.modalBody){var e=n.modalBody.offsetHeight;if(e!==n.state.modalOffsetHeight){var t=n.modalBody.querySelector(".card_edit_hide_toggle");n.setState({modalOffsetHeight:e,modalHiddenFieldOffset:t?t.offsetTop+I.qx:0})}}},100),n.addOnScrollHandler=function(e){n.onScrollHandler=e},n.setModalBodyRef=function(e){n.modalBody=e,n.modalBody&&!n.resizeObserver&&(n.resizeObserver=new x.a(n.observeModalHeight),n.resizeObserver.observe(n.modalBody)),n.onScrollHandler&&n.onScrollHandler(e)},n}return Object(I.bu)(i,o),Object(I.Pw)(i,[{key:"componentDidMount",value:function(){this.setState({disableAutoFocus:Object(I.Dx)()&&this.props.isVCEnable})}},{key:"componentWillUnmount",value:function(){this.resizeObserver&&(this.modalBody&&this.resizeObserver.unobserve(this.modalBody),this.resizeObserver.disconnect(),this.resizeObserver=null)}},{key:"render",value:function(){var e=this.props,t=e.children,n=e.onClose,r=Object(I.nA)(e,Ae);return E.a.createElement("div",{className:"J-card-edit-modal-body bitable-hover-scrollbar b-ud-scrollbar-lg",ref:this.setModalBodyRef,onScroll:this.handleModalScroll},E.a.createElement(De,Object(I.Kx)({addOnScrollHandler:this.addOnScrollHandler,windowOffset:this.state.modalScrollTop,windowSize:this.state.modalOffsetHeight,hiddenFieldOffset:this.state.modalHiddenFieldOffset,cannotAutoFocus:this.state.disableAutoFocus,relativeClass:"J-card-edit-modal-body",closePopup:n},r)),t)}}]),i}(E.a.PureComponent);function _e(e){var t=e.cardSyncMode,n=e.recordEditable,r=e.onSubmit,o=e.onCancel;return t===I.tx.OnDemand&&n?E.a.createElement("div",{style:{margin:"0px 24px 24px 24px"}},E.a.createElement(I.hX,{onCancel:o,onSubmit:r})):null}var Fe=["children"];function Pe(e){return e.cmd===I.Fy.SetRecord}var We=function(r){function o(){var p;Object(I.ov)(this,o);for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return(p=r.call.apply(r,[this].concat(t))||this).actions=[],p.applyActions=Object(I.uY)(f.a.mark(function e(){var t,n,r,o,i,a,l,c,d,s,u,b,v;return f.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:t=p.props,n=t.tableId,r=t.viewId,o={},i=p.props.bitableStore.getCommandManager();case 3:if(a=Object(I.Cx)(p),l=a.actions,p.actions=[],l.length){e.next=7;break}return e.abrupt("break",13);case 7:c=Object(I.WB)(l);try{for(c.s();!(d=c.n()).done;){if(s=d.value,(u=s.getOptions()).tableId=n,u.viewId=r,b={result:I.Ey.None},Pe(u))for(v in u.data)o[v]=u.data[v];else b=i.execute(u);s.onResponse&&s.onResponse(b)}}catch(e){c.e(e)}finally{c.f()}return e.next=11,Object(I.Gy)();case 11:e.next=3;break;case 13:return e.abrupt("return",o);case 14:case"end":return e.stop()}},e)})),p.onOk=Object(I.uY)(f.a.mark(function e(){var t,n,r;return f.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=p.props,n=p._getFormValue?p._getFormValue:p.applyActions,e.next=4,n();case 4:if(r=e.sent,!t.onSubmit){e.next=11;break}return e.next=8,t.onSubmit(t.recordId,r);case 8:p.showTipIfFilteredOut(t),e.next=13;break;case 11:p.setRecord(r),t.onClose();case 13:case"end":return e.stop()}},e)})),p.getActionData=function(){var e,t={},n=Object(I.WB)(p.actions);try{for(n.s();!(e=n.n()).done;){var r=e.value.getOptions();if(Pe(r))for(var o=r.data,i=0,a=Object.keys(o);i<a.length;i++){var l=a[i],c=o[l];t[l]={value:c.value}}}}catch(e){n.e(e)}finally{n.f()}return t},p.onRecordChange=function(e){p._getFormValue=e},p.receiveAction=function(a){return p.props.cardSyncMode!==I.tx.OnDemand?p.props.bitableStore.executeCommandImmediately(a):new Promise(function(e){var t,n,r,o,i={getOptions:a};p.props.recordId?i.onResponse=e:e({result:I.Ey.None}),p.actions.push(i),null===(t=(n=p.props).onDataChange)||void 0===t||t.call(n,(null===(r=(o=p)._getFormValue)||void 0===r?void 0:r.call(o))||{})})},p}return Object(I.bu)(o,r),Object(I.Pw)(o,[{key:"componentWillUnmount",value:function(){var e,t=Object(I.WB)(this.actions);try{for(t.s();!(e=t.n()).done;){var n=e.value;n.onResponse&&n.onResponse({result:I.Ey.None})}}catch(e){t.e(e)}finally{t.f()}this.actions=[],this.props.cardSyncMode===I.tx.RealTime&&this.showTipIfFilteredOut(this.props)}},{key:"showTipIfFilteredOut",value:function(e){var t=e.tableId,n=e.viewId,r=e.recordId,o=e.bitableStore,i=e.fromMention,a=I.ob.config.ui&&I.ob.config.ui.useCardModalFilterTip;r&&!a&&Object(g.c)(o,t,n,r,i)}},{key:"setRecord",value:function(e){var t=this.props,n=t.bitableStore,r=t.recordId,o=t.tableId,i=t.viewId;n.getCommandManager().execute({cmd:I.Fy.SetRecord,recordId:r,tableId:o,viewId:i,data:e})}},{key:"render",value:function(){var e=this.props,t=e.children,n=Object(I.nA)(e,Fe);return E.a.createElement("div",{className:"bitable-card-detail",style:{display:"flex",flexDirection:"column",height:"100%"}},E.a.createElement(Be,Object(I.Kx)({},n,{receiveAction:this.receiveAction,getActionData:this.getActionData,onRecordChange:this.onRecordChange}),t),E.a.createElement(_e,Object(I.Kx)({},n,{onCancel:this.props.onClose,onSubmit:this.onOk})))}}]),o}(E.a.PureComponent),ze=E.a.createContext({isVCEnable:!1,forSelfTable:!1,onClose:o.a,onSubmit:o.a});function Ve(){return Object(j.useContext)(ze)}var Ne=Object(e.a)([Object(t.connect)(function(e,t){var n=t.tableId,r=Object(I.xy)(e),o=!Object(I.yy)(r);return{fieldList:Object(I.zy)(e,n),isReadyOrCanEdit:o}}),Object(I.Sy)(function(e,t){var n=t.tableId,r=t.recordId;return{fieldEditable:e.hasPermission(I.qy.Field,{tableId:n},I.ry.Editable),fieldAddable:e.hasPermission(I.qy.Field,{tableId:n},I.ry.Addable),recordEditable:e.hasPermission(I.qy.Record,{tableId:n,recordId:r},I.ry.Editable)}}),Object(I.oA)(function(e){var t=e.config,n=e.env;return{cardSyncMode:t.get("cardSyncMode")||I.tx.RealTime,isAnonymousAccess:n.isAnonymousAccess()}})])(function(e){var t,n,r=Object(I.jy)(),o=Ve(),i=X();return r&&o&&i?(e.cardSyncMode=e.recordId?e.cardSyncMode:I.tx.OnDemand,Object(g.b)(r.getMountSource())||(e.fieldList=(null===(t=r.base.getTableById(e.tableId))||void 0===t||null===(n=t.getViewById(e.viewId))||void 0===n?void 0:n.getAllFields())||[]),e.fieldEditable=e.fieldEditable&&e.isReadyOrCanEdit,e.fieldAddable=e.fieldAddable&&e.isReadyOrCanEdit,e.recordEditable=e.recordEditable&&e.isReadyOrCanEdit,E.a.createElement(We,Object(I.Kx)({},e,o,{bitableStore:r,onAttachUploadChange:function(e){var t;e===I.tA.ADD&&(null===(t=i.onCollectCardClickEvent)||void 0===t||t.call(i,{click:I.py.UploadImage}))},onCreateNewField:function(){var e;null===(e=i.onCollectCardClickEvent)||void 0===e||e.call(i,{click:I.py.NewField,target:I.Rw.CcmBitableFieldModifyView})},onToggleHiddenFields:function(e){var t;null===(t=i.onCollectCardClickEvent)||void 0===t||t.call(i,{click:I.py.HiddenFields,options:{status:e}})}}))):null}),Le={id:"detail",name:c("Bitable_Record_Detail_Tab"),type:w.a.Detail},He={name:c("Bitable_Record_Detail_Tab"),id:w.b.Detail,type:w.a.Detail,metaId:Le.id},Ue=Ee({component:Ne,permission:{canMove:!0}}),Ke=function(e){return E.a.createElement(E.a.Fragment,null,"id: ",e.id)},qe={id:"demo",name:"demo",description:"This is a demo.",type:w.a.Demo,icon:"https://s1-imfile.feishucdn.com/static-resource/v1/v2_ddb70511-05e7-416b-a0fc-2fb9842a00dg"},Je=Ee({component:Ke,permission:{canMove:!0,canAdd:!0,canDelete:!0,canRename:!0}}),Xe=function e(){var n=this;Object(I.ov)(this,e),this.register=function(t){-1===n._meta.findIndex(function(e){return e.id===t.id})&&t&&n._meta.push(t)},this.getMetas=function(e){if(!e||!Object(T.a)(e))return n._meta;var t=Object.entries(e);return t.length?t.reduce(function(e,t){return e.filter(function(e){return e[t[0]]===t[1]})},n._meta):n._meta},this.getMetaById=function(t){return n._meta.find(function(e){return e.id===t})},this._meta=[],Object(r.q)(this,{_meta:r.r})};Xe.instance=new Xe;var Ye=function(){function e(){var n=this;Object(I.ov)(this,e),this._configMap=new Map,this.getComponentByType=function(e){var t;return null===(t=n._getConfigByType(e))||void 0===t?void 0:t.component},this.getPermissionByType=function(e){var t;return null===(t=n._getConfigByType(e))||void 0===t?void 0:t.permission},this.getHookByType=function(e){var t;return null===(t=n._getConfigByType(e))||void 0===t?void 0:t.hook}}return Object(I.Pw)(e,[{key:"_getConfigByType",value:function(e){return this._configMap.get(e)}},{key:"register",value:function(e,t){this._configMap.set(e,t)}}]),e}();Ye.instance=new Ye;var Ge=[[w.a.Comment,Re,ke],[w.a.Detail,Ue,Le],[w.a.Demo,Je,qe]],Qe=!1;function Ze(){Qe||(Qe=!Qe,Ge.forEach(function(e){var t=Object(I.xz)(e,3),n=t[0],r=t[1],o=t[2];Xe.instance.register(o),Ye.instance.register(n,r)}))}var $e=["showPermissionTabs"],et=Object(I.Uy)(Object(I.uY)(f.a.mark(function e(){return f.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.all([Mt.e("e369853df766"),Mt.e("1c9ac0159c94")]).then(Mt.bind(null,"vb1947"));case 2:return e.abrupt("return",e.sent.WidgetTabs);case 3:case"end":return e.stop()}},e)}))),tt=Object(I.Uy)(Object(I.uY)(f.a.mark(function e(){return f.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.all([Mt.e("e369853df766"),Mt.e("b3e3e393c77e")]).then(Mt.bind(null,"vb1948"));case 2:return e.abrupt("return",e.sent.PermissionWidgetTabs);case 3:case"end":return e.stop()}},e)})));function nt(e){var t=e.showPermissionTabs,n=Object(I.nA)(e,$e);return Ze(),t?E.a.createElement(tt,n):E.a.createElement(et,n)}var rt,ot,it=function(t){function n(e){var a;return Object(I.ov)(this,n),(a=t.call(this,e)||this).state={hideFilterTip:!1},a.cardContent=null,a.bindCopyCutEvent=function(){var e=a.props.renderer;a.cardContent&&(a.cardContent.addEventListener("copy",e.clipboardHelper.handleCopyCut,!0),a.cardContent.addEventListener("cut",e.clipboardHelper.handleCopyCut,!0))},a.unbindCopyCutEvent=function(){var e=a.props.renderer;a.cardContent&&(a.cardContent.removeEventListener("copy",e.clipboardHelper.handleCopyCut,!0),a.cardContent.removeEventListener("cut",e.clipboardHelper.handleCopyCut,!0))},a.startRecordManager=function(){a.recordManager&&a.recordManager.destroy(),a.recordManager=new Ce(function(){return{bitableStore:a.props.bitableStore,tableId:a.props.tableId,viewId:a.props.viewId,recordId:a.props.recordId,forSelfTable:a.props.forSelfTable,switchRecords:a.props.switchRecords,field:a.props.field,isAddRecord:a.props.isAddRecord||!a.props.recordId,onDeleteRecordByRemote:function(){var e=a.props,t=e.onEmitRecordDeletedError,n=e.onClose;null==t||t(),null==n||n()},onSwitchRecord:function(e){var t=a.props,n=t.toggleEditorInCardEdit,r=t.tableId,o=t.source,i=t.onSwitchRecord;n&&n(r,!0,e,void 0,o),null==i||i(e)}}}),a.recordManager.start()},a.close=function(e){a.props.onClose(e)},a.onDataChange=function(e){var t,n;null===(t=a.props)||void 0===t||null===(n=t.onDataChange)||void 0===n||n.call(t,e)},a.switchCard=function(e){var t;a.props.onSwitchCard?a.props.onSwitchCard(e):null===(t=a.recordManager)||void 0===t||t.switchRecord(e),a.playSwitchAnimation()},a.setHideFilterTip=function(e){a.setState({hideFilterTip:e})},a.setCardContentRef=function(e){a.cardContent=e},a.isAddRecordInPermission=function(){return Boolean(!a.props.recordId&&a.props.cardSyncMode===I.tx.OnDemand)},a.startRecordManager(),a}return Object(I.bu)(n,t),Object(I.Pw)(n,[{key:"componentDidMount",value:function(){var e,t=this;this.firstCreateOnboardingCollectEvent(),Object(I.Hy)(),null===(e=me.getInstance())||void 0===e||e.push(function(){return{onSwitchRecord:t.switchCard,isSwitchShortcutEnabled:t.props.isSwitchShortcutEnabled,onCloseModal:t.close}}),this.props.cardSyncMode!==I.tx.OnDemand&&Object(I.Iy)(I.Jy.EXPEND_RECORD),this.bindCopyCutEvent()}},{key:"UNSAFE_componentWillReceiveProps",value:function(e){e.recordId!==this.props.recordId&&this.setHideFilterTip(!1)}},{key:"componentDidUpdate",value:function(e){e.recordId!==this.props.recordId&&this.startRecordManager()}},{key:"componentWillUnmount",value:function(){var e,t;null===(e=me.getInstance())||void 0===e||e.pop(),null===(t=this.recordManager)||void 0===t||t.destroy(),this.setHideFilterTip(!1),Object(I.Ky)(I.Jy.EXPEND_RECORD);var n=this.props.afterClose;"function"==typeof n&&setTimeout(function(){n()},0),this.unbindCopyCutEvent()}},{key:"firstCreateOnboardingCollectEvent",value:function(){var e=this.props,n=e.bitableStore,r=e.renderer;I.Ly.registeMethod(I.Jy.EXPEND_RECORD,{clickCallBack:function(){var e=n.base.blocks[0];if(e instanceof I.My&&e.views[0]instanceof I.Ny){var t=e.views[0].records[0];r.showCardModal({record:t})}}})}},{key:"playSwitchAnimation",value:function(){var e="bitable-record-card-switch-animation",t=this.cardContent;t&&(t.classList.contains(e)?(t.style.animation="none",requestAnimationFrame(function(){t.style.animation=""})):t.classList.add(e))}},{key:"renderHeader",value:function(){var e,t=this,n=this.props,r=n.tableId,o=n.bitableStore,i=n.viewId,a=n.recordId,l=n.noticeIconType,c=n.fieldId,d=n.recordEditable,s=n.isReadyOrCanEdit,u=n.recordDeletable,b=n.headerTitle,v=this.state.hideFilterTip,p=this.recordManager.getCardOrderInfo(),f=!(null===(e=I.ob.config.ui)||void 0===e||!e.useCardModalFilterTip||v||-1!==p.curFieldIdIndex||!1===this.props.showTip||!this.props.recordId),h=Object(g.b)(o.getMountSource()),m=this.isAddRecordInPermission(),C=m||!d||!h||!s,y=m;return E.a.createElement(ue,{headerTitle:null!=b?b:"",cardOrderInfo:p,shouldShowTip:f,source:this.props.source,tableId:r,viewId:i,recordId:a,fieldId:c,noticeIconType:l,bitableMountSource:o.getMountSource(),disableSwitchBtn:y,disableMoreMenu:C,onClose:this.close,disableDeleteRecord:!u,onSetHideFilterTip:this.setHideFilterTip,onSwitchCard:this.switchCard,onDeleteRecord:function(){t.recordManager.destroy(),t.props.onDeleteRecord()}})}},{key:"render",value:function(){var r=this,e=this.props,t=e.tableId,n=e.viewId,o=e.recordId,i=e.fieldId,a=e.forSelfTable,l=e.isVCEnable,c=e.onSubmit,d=e.enableExtension,s=e.bitableStore,u=e.groupCellValues,b=this.isAddRecordInPermission()||!Object(g.b)(s.getMountSource());return E.a.createElement("div",{className:k()("bitable-record-card-content","J-card-edit-modal",ve),ref:this.setCardContentRef,tabIndex:-1},E.a.createElement(J.Provider,{value:this.props},this.renderHeader(),E.a.createElement("div",{className:"card-modal-widget-tabs b-ud-scrollbar-lg"},E.a.createElement(ze.Provider,{value:{isVCEnable:Boolean(l),forSelfTable:a,groupCellValues:u,fromMention:this.props.fromMention,onDataChange:this.onDataChange,onSubmit:c,onClose:this.close,isAddRecordFromCard:this.isAddRecordInPermission()}},E.a.createElement(nt,{viewId:n,tableId:t,fieldId:i,recordId:o,enableExtension:d,showPermissionTabs:b,onTabClick:function(e){var t,n;null===(t=(n=r.props).onTabClick)||void 0===t||t.call(n,e)},onTabsMount:function(e){var t,n;null===(t=(n=r.props).onTabsMount)||void 0===t||t.call(n,e)},activeTab:this.props.activeTab})))))}}]),n}(E.a.PureComponent),at=Object(e.a)([Object(t.connect)(function(e,t){var n=Object(I.xy)(e),r=!Object(I.yy)(n);return{isBitableReady:Object(I.tz)(e),isReadyOrCanEdit:r}},function(i){return{toggleEditorInCardEdit:function(e,t,n,r,o){i(Object(I.Cy)(e,t,n,r,!1,o))}}}),Object(I.Sy)(function(e,t){var n=t.tableId,r=t.recordId,o=t.viewId;return{recordEditable:e.hasPermission(I.qy.Record,{tableId:n,recordId:r},I.ry.Editable),recordDeletable:e.hasPermission(I.qy.Record,{tableId:n,viewId:o,recordId:r},I.ry.Deletable)}})])(function(r){var e=Object(I.jy)();if(!e)return null;var t=Object(I.jx)();if(!t)return null;var n=z(),o=r.isBitableReady,i=r.tableId,a=r.viewId,l=r.recordId,c=r.onClose,d=r.onCollectCardClickEvent,s=Object(j.useCallback)(function(){n.delRecord({tableId:i,viewId:a,recordId:l}),null==d||d({click:I.py.DeleteRecord}),null==c||c()},[i,a,l,c,d]),u=P(i,function(e){var t=null==e?void 0:e.getPrimaryField();return{headerTitle:null==t?void 0:t.getStringCellValue(l)}},[a,l],[Object(I.Ww)({},I.uA.StringCellValueChange,function(e,t){function n(e,t){return!!t&&e.includes(t.getId())}var r=null==e?void 0:e.getPrimaryField();if(r){var o=void 0===t.recordId||l===t.recordId;if(n(t.fieldIds,r))return o;if(r.isType(I.og.Formula)&&n(t.fieldIds,r.getProxyField()))return o}return!1})]),b=e.getMountSource(),v=b===I.Bz.History||b===I.Bz.Template;return E.a.createElement(it,Object(I.Kx)({},r,{bitableStore:e,renderer:t,isSwitchShortcutEnabled:v||o,onEmitRecordDeletedError:function(){var e;r.shouldShowTipOnRecordDeleted&&(null==t||null===(e=t.eventManager)||void 0===e||e.emit(I.ay.Error,{type:I.vA.Warning,code:I.wA.RecordDeleted}))},onTabClick:function(e){var t,n=Object(w.e)(e);null===(t=r.onCollectCardClickEvent)||void 0===t||t.call(r,Object.assign({},n))},onTabsMount:function(e){var t;null===(t=r.onCollectCardViewEvent)||void 0===t||t.call(r,{tabId:e})},onDeleteRecord:s,headerTitle:null==u?void 0:u.headerTitle}))}),lt=function(r){function o(e){var t;Object(I.ov)(this,o),(t=r.call(this,e)||this).onWindowResize=Object(R.a)(function(){t.setState({width:Object(I.xA)()})},500),t.onClose=function(){t.props.onClose&&t.props.onClose()};var n=Object(I.xA)();return t.state={disableClick:!1,disableAutoFocus:!0,width:n},t}return Object(I.bu)(o,r),Object(I.Pw)(o,[{key:"componentDidMount",value:function(){window.addEventListener("resize",this.onWindowResize)}},{key:"componentWillUnmount",value:function(){window.removeEventListener("resize",this.onWindowResize)}},{key:"render",value:function(){var e=this.props,t=e.mask,n=e.marginLeft,r=e.editable,o=e.visible,i=e.inDocFullscreen,a=e.disableClick,l={marginLeft:n||0};return E.a.createElement(d.Dialog,{wrapClassName:k()({"bitable-click-disable":a},pe),className:k()("bitable-dialog-card-modal",be,{"bitable-card-readonly":!r,"in-doc-fullscreen":i}),header:null,footer:null,bodyStyle:{padding:0},style:l,maskStyle:{zIndex:100},zIndex:100,visible:o,width:this.state.width,mask:t,onCancel:this.onClose,closable:!1,keyboardClosable:!1,maskClosable:!0,enableRestoreFocus:this.props.enableRestoreFocus},this.props.children)}}]),o}(E.a.PureComponent),ct=Object(e.a)([Object(t.connect)(function(e){return{enableRestoreFocus:1<Object(I.yA)(e)}})])(lt),dt=function(e){return e&&"number"==typeof e.pageX},st=function(e){return e&&Array.isArray(e.touches)&&dt(e.touches[0])},ut=function(e){return dt(e)?e.pageX:st(e)?e.touches[0]&&e.touches[0].pageX:0},bt="bitable-movable-line-mask",vt=12,pt=function(e){var t=e.className,n=e.activeAreaWidth,r=e.positionStyle,o=void 0===r?{}:r,i=e.onMoveEnd,a=e.onMoving,l=e.onMoveStart,c=document.body,d=Object(j.useRef)(c.getBoundingClientRect().width),s=Object(j.useState)(0),u=Object(I.xz)(s,2),b=u[0],v=u[1],p=Object(j.useState)(!1),f=Object(I.xz)(p,2),h=f[0],m=f[1],C=Object(j.useRef)(null),y=function(){d.current=c.getBoundingClientRect().width,m(!0),null==l||l()},g=function(){m(!1),i(b,d.current)},w=function(){var e;y();var t=null===(e=C.current)||void 0===e?void 0:e.getBoundingClientRect().x;t&&v(t)};Object(j.useEffect)(function(){if(h){var e=document.createElement("div");return e.classList.add(bt),c.appendChild(e),function(){e&&c.removeChild(e)}}},[h]),Object(j.useEffect)(function(){if(h){var e=function(e){var t=ut(e),n=a(t,d.current);v(n)};return c.addEventListener("mousemove",e),c.addEventListener("touchmove",e),function(){c.removeEventListener("mousemove",e),c.removeEventListener("touchmove",e)}}},[h]),Object(j.useEffect)(function(){if(h){var e=function(){g()};return c.addEventListener("mouseup",e),c.addEventListener("touchend",e),function(){c.removeEventListener("mouseup",e),c.removeEventListener("touchend",e)}}},[h,b]);var O=n||vt;return E.a.createElement("div",{className:k()("bitable-movable-line",t),style:Object.assign({},o,{width:O,display:h?"none":"block"}),onMouseDown:w,onTouchStart:w,ref:C},Object(D.createPortal)(E.a.createElement("div",{className:k()("bitable-movable-line",t,{"bitable-movable-line-resizing":h}),style:{left:b,width:O,display:h?"block":"none"}}),c))},ft=["direction"];(ot=rt||(rt={})).Left="left",ot.Right="right";var ht,mt,Ct,yt=function(e){var t=e.width,n=e.activeAreaWidth,r=e.calculator,o=e.className,i=e.onResize,a=e.onMoveStart,l=e.onMoveEnd,c="number"==typeof e.maxWidth?e.maxWidth:document.body.clientWidth,d="number"==typeof e.minWidth?e.minWidth:0,s=function(e,t){var n=r.resizerXToPanelWidth(e,t);i(n),null==l||l()};return E.a.createElement(pt,{className:o,activeAreaWidth:n,positionStyle:{left:r.getResizerRelativePosition(t)},onMoveStart:function(){return null==a?void 0:a()},onMoveEnd:s,onMoving:function(e,t){return r.calculateResizerX(e,t,c,d)}})},gt=function e(){var i=this;Object(I.ov)(this,e),this.resizerXToPanelWidth=function(e,t){return e},this.calculateResizerX=function(e,t,n,r){var o=i.resizerXToPanelWidth(e,t);return n<o?n:o<r?r:e},this.getResizerRelativePosition=function(e){return e}},wt=function e(){var i=this;Object(I.ov)(this,e),this.resizerXToPanelWidth=function(e,t){return t-e},this.calculateResizerX=function(e,t,n,r){var o=i.resizerXToPanelWidth(e,t);return n<o?t-n:o<r?t-r:e},this.getResizerRelativePosition=function(){return 0}},Ot=function(e){var t=e.direction,n=Object(I.nA)(e,ft),r=Object(j.useMemo)(function(){return t===rt.Left?new gt:new wt},[t]);return E.a.createElement(yt,Object(I.Kx)({},n,{calculator:r}))},It=function(t){function n(e){var r;return Object(I.ov)(this,n),(r=t.call(this,e)||this).maskRef=null,r.state={disableUserSelect:!1},r.setMaskRef=function(e){var t,n;r.maskRef!==e&&(null===(t=r.maskRef)||void 0===t||t.removeEventListener("wheel",r.handleMaskWheel),r.maskRef=e,null===(n=r.maskRef)||void 0===n||n.addEventListener("wheel",r.handleMaskWheel,{passive:!1}))},r.handleMaskClick=function(){var e,t;null===(e=(t=r.props).onMaskClick)||void 0===e||e.call(t)},r.handleMaskWheel=function(e){var t,n;e.preventDefault(),null===(t=(n=r.props).onMaskMouseWheel)||void 0===t||t.call(n,e)},r.handleClose=function(){var e,t;null===(e=(t=r.props).onClose)||void 0===e||e.call(t)},r.handleResize=function(e){r.updateDrawerCardWidth(e)},r}return Object(I.bu)(n,t),Object(I.Pw)(n,[{key:"componentDidMount",value:function(){var n=this;this._mountedTimer=setTimeout(function(){var e,t;null===(e=(t=n.props).onCardMounted)||void 0===e||e.call(t)},500)}},{key:"componentWillUnmount",value:function(){var e;this._mountedTimer&&clearTimeout(this._mountedTimer),null===(e=this.maskRef)||void 0===e||e.removeEventListener("wheel",this.handleMaskWheel)}},{key:"updateDrawerCardWidth",value:function(e){"function"==typeof this.props.onUpdateWidth&&this.props.onUpdateWidth(e)}},{key:"render",value:function(){var e=this,t=this.props,n=t.editable,r=t.disableClick,o=this.state.disableUserSelect,i=document.body.clientWidth-this.props.width;return E.a.createElement(d.Drawer,{className:k()("bitable-drawer-card",be,pe,{"bitable-card-readonly":!n,"bitable-click-disable":r,"bitable-noselect":o}),placement:"right",visible:this.props.visible,width:this.props.width,mask:!1,bodyPaddingSize:0,zIndex:100,keyboard:!1,onClose:this.handleClose},E.a.createElement("div",{className:"bitable-drawer-card-wrapper"},Object(D.createPortal)(E.a.createElement("div",{className:"bitable-drawer-card-mask",style:{width:i},ref:this.setMaskRef,onClick:this.handleMaskClick}),document.body),E.a.createElement(Ot,{className:"bitable-drawer-card-resizer",width:this.props.width,maxWidth:this.props.maxWidth,minWidth:this.props.minWidth,direction:rt.Right,onResize:this.handleResize,onMoveStart:function(){return e.setState({disableUserSelect:!0})},onMoveEnd:function(){return e.setState({disableUserSelect:!1})}}),E.a.createElement("div",{className:"bitable-drawer-card-content",style:{width:this.props.width}},this.props.children)))}}]),n}(E.a.PureComponent),jt=Object(e.a)([Object(t.connect)(function(e){return{width:Object(I.BA)(e)}},function(t,n){return{onUpdateWidth:function(e){t(Object(I.CA)(e,n.tableId))}}})])(function(r){var o=Object(I.jx)();if(!o)return null;var e=Object(j.useState)(Object(I.zA)()),t=Object(I.xz)(e,2),n=t[0],i=t[1],a=function(e){var t,n;null===(t=r.onUpdateWidth)||void 0===t||t.call(r,e),null===(n=o.activeBitableWidget)||void 0===n||n.setDrawerCardWidth(e)};return Object(j.useEffect)(function(){var e=Object(R.a)(function(){i(Object(I.zA)())},500);return window.addEventListener("resize",e),function(){return window.removeEventListener("resize",e)}},[]),Object(j.useEffect)(function(){r.width>n.maxWidth?a(n.maxWidth):r.width<n.minWidth&&a(n.minWidth)},[n]),E.a.createElement(It,Object(I.Kx)({},r,{onUpdateWidth:function(e){a(e),Object(w.d)({cardType:I.AA.Drawer,click:I.py.DragSize})},maxWidth:n.maxWidth,minWidth:n.minWidth,onMaskMouseWheel:function(e){o.activeBitableWidget.handleMaskWheelEvent(e)},onMaskClick:function(){var e;null===(e=r.onClose)||void 0===e||e.call(r),Object(w.d)({cardType:I.AA.Drawer,click:I.py.CloseRecord})},onCardMounted:function(){var e;null===(e=o.activeBitableWidget)||void 0===e||e.setDrawerCardWidth(r.width)}}))}),Et=(ht=Object(a.Bind)(),(Ct=function(r){function o(){var l;Object(I.ov)(this,o);for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return(l=r.call.apply(r,[this].concat(t))||this).state={disableClick:!0},l.fromMention=!1,l._dataUnSaved=!1,l.getVCFollowId=function(){var e=l.props,t=e.tableId,n=e.bitableStore.isEmbeddedInDoc,r=e.isFullScreenMode;return n?t+(r?":fullscreen":""):""},l.openVCFollow=Object(I.uY)(f.a.mark(function e(){return f.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,l.props.renderer.getActiveBitableWidgetByPromise();case 2:Object(I.Fx)(I.Gx.BitableCardModel,l.replayVCFollowState,{instanceId:l.getVCFollowId()}),l.sendVCStateChange(l.getVCFollowState());case 4:case"end":return e.stop()}},e)})),l.closeVCFollow=function(){var e=l.props,t=e.tableId,n=e.viewId,r=e.recordId,o=e.isFullScreenMode;l.sendVCStateChange({openStatus:I.Dy.Close,tableId:t,recordId:r,viewId:n,isFullScreen:!!o}),Object(I.Hx)(I.Gx.BitableCardModel,l.replayVCFollowState,{instanceId:l.getVCFollowId()})},l.getVCFollowState=function(){var e=l.props,t=e.tableId,n=e.viewId,r=e.recordId,o=e.fieldId,i=e.modalVisible,a=e.isFullScreenMode;return{openStatus:i?I.Dy.Open:I.Dy.Close,tableId:t,viewId:n,recordId:r,fieldId:o,isFullScreen:!!a}},l.sendVCStateChange=function(e){var t=l.props,n=t.bitableStore;if(t.isVCEnable){var r=n.isEmbeddedInDoc;Object(I.Ix)(I.Gx.BitableCardModel,e,{config:{isUpdatePresenterPosition:!r},instanceId:l.getVCFollowId()})}},l.onDataChange=function(e){l._dataUnSaved=Boolean(0<Object.keys(e).length&&!l.props.recordId)},l.closeModal=function(e){var t;if(l._dataUnSaved)var n=Object(I.HU)({title:c("Bitable_AdvancedPermission_ConfirmToCloseRecordCard_Title"),content:c("Bitable_AdvancedPermission_ConfirmToCloseRecordCard_Description"),enableCancelButton:!0,cancelText:c("Bitable_AdvancedPermission_ConfirmToCloseRecordCard_KeepEditing_Button"),okText:c("Bitable_AdvancedPermission_ConfirmToCloseRecordCard_Close_Button"),okButtonProps:{onClick:function(){n(),l.props.onClose()}}});else l.props.onClose(),l.setState({disableClick:!0}),e&&(null===(t=e.preventDefault)||void 0===t||t.call(e),e.keyCode===I.sx.Esc&&e.stopPropagation())},l.collectCardClickEvent=function(e){return Object(w.d)(Object.assign({cardType:l.props.openType},e))},l.collectCardViewEvent=function(e){return Object(w.c)(Object.assign({},e,{cardType:l.props.openType,cardOpenSource:l.props.cardOpenSource}))},l}return Object(I.bu)(o,r),Object(I.Pw)(o,[{key:"componentDidMount",value:function(){var e,t;this.fromMention=this.props.fromMention,this.openVCFollow(),this.props.modalVisible&&this.setState({disableClick:!1});var n=this.props,r=n.source,o=n.tableId,i=n.recordId;this.cardModalCtx={source:r,tableId:o,recordId:i},null===(e=this.context)||void 0===e||null===(t=e.smartableCommentManager)||void 0===t||t.pushContext(this.cardModalCtx)}},{key:"UNSAFE_componentWillReceiveProps",value:function(e){!e.modalVisible&&this.props.modalVisible&&(this.fromMention=!1),e.modalVisible&&!this.props.modalVisible&&(this._dataUnSaved=!1,this.setState({disableClick:!1})),e.tableId!==this.props.tableId&&(this.cardModalCtx.tableId=e.tableId),e.recordId!==this.props.recordId&&(this.cardModalCtx.recordId=e.recordId)}},{key:"componentDidUpdate",value:function(e){e.recordId===this.props.recordId&&e.fieldId===this.props.fieldId&&e.modalVisible===this.props.modalVisible||this.sendVCStateChange(this.getVCFollowState())}},{key:"componentWillUnmount",value:function(){var e;this.closeVCFollow(),null===(e=this.context.smartableCommentManager)||void 0===e||e.popContext()}},{key:"replayVCFollowState",value:function(e){var t,n=this.props.bitableStore.isEmbeddedInDoc,r=e.data,o=r.tableId,i=r.openStatus,a=r.recordId,l=r.fieldId,c=this.props,d=c.toggleEditorInCardEdit,s=c.bitableStore,u=c.tableId;if((null===(t=e.data[I.Oy])||void 0===t?void 0:t.openStatus)!==I.Dy.Close){if(o!==u)return n?void 0:{status:I.dz.Fail,code:I.ez.SourceTargetIsDiff};if(!o||!s.hasPermission(I.qy.Record,{tableId:o,recordId:a},I.ry.Visible))return{status:I.dz.Ignore,code:o?I.ez.NotPermission:I.ez.NotExist};var b=s.base.getTableById(o),v=null==b?void 0:b.getRecordById(a);return i===I.Dy.Open&&a&&!v?{status:I.dz.Fail,code:I.ez.NotExist}:(d&&o&&d(o,i===I.Dy.Open,a||null,l),{status:I.dz.Success})}d&&u&&d(u,!1,null)}},{key:"renderCardContent",value:function(){var e=this.props.source!==I.sz.Link;return E.a.createElement(at,Object(I.Kx)({},this.props,{enableExtension:e,fromMention:this.fromMention,onClose:this.closeModal,onSwitchCard:this.props.switchCard,onDataChange:this.onDataChange,onCollectCardClickEvent:this.collectCardClickEvent,onCollectCardViewEvent:this.collectCardViewEvent}))}},{key:"renderDialogCard",value:function(){var e=this.props,t=e.bitableStore,n=e.modalVisible,r=e.mask,o=e.marginLeft,i=e.renderer,a=t.isEmbeddedInDoc&&i.isFullScreen;return E.a.createElement(ct,{inDocFullscreen:a,visible:n,mask:r,marginLeft:o,disableClick:this.state.disableClick,editable:this.props.recordEditable,onClose:this.closeModal},this.renderCardContent())}},{key:"renderDrawerCard",value:function(){return E.a.createElement(jt,{tableId:this.props.tableId,visible:this.props.modalVisible,editable:this.props.recordEditable,disableClick:this.state.disableClick,onClose:this.closeModal},this.renderCardContent())}},{key:"render",value:function(){var e=this.props,t=e.modalVisible,n=e.openType;return t?n===I.AA.Drawer?this.renderDrawerCard():this.renderDialogCard():null}}]),o}(E.a.PureComponent)).contextType=I.DA,Object(I.lz)((mt=Ct).prototype,"replayVCFollowState",[ht,I.mz],Object.getOwnPropertyDescriptor(mt.prototype,"replayVCFollowState"),mt.prototype),mt),kt=Object(I.Sy)(function(e,t){var n=t.tableId,r=t.recordId;return{recordEditable:e.hasPermission(I.qy.Record,{tableId:n,recordId:r},I.ry.Editable)}}),St=Object(e.a)([Object(t.connect)(function(e,t){var n=t.tableId,r=Object(I.wy)(e,n);return{fromMention:!!r&&r.fromMention}},function(i){return{toggleEditorInCardEdit:function(e,t,n,r,o){i(Object(I.Cy)(e,t,n,r,!1,o))},onCardInstanceChange:function(e,t){i(null===t?Object(I.GA)(e):Object(I.HA)(e,t))}}}),kt,Object(I.oA)(function(e){var t=e.env;return{embeddedType:t.getEmbeddedType(),moduleType:t.getModuleType()}})])(function(n){var e=Object(I.jy)();if(!e)return null;var r=Object(I.jx)();if(!r)return null;var t=n.openType||Object(I.EA)(n.embeddedType,n.moduleType,n.source),o=Object(j.useRef)(Object(i.a)()).current;return Object(j.useEffect)(function(){n.modalVisible?n.onCardInstanceChange(o,{cardType:t}):n.onCardInstanceChange(o,null)},[n.modalVisible,t]),Object(j.useEffect)(function(){return function(){return n.onCardInstanceChange(o,null)}},[]),Object(j.useEffect)(function(){r&&n.recordId&&t===I.AA.Drawer&&Object(I.FA)(function(){var e,t;return null===(e=(t=r).highLightRecord)||void 0===e?void 0:e.call(t,n.recordId)})},[n.recordId]),E.a.createElement(Et,Object(I.Kx)({},n,{openType:t,renderer:r,bitableStore:e}))}),Rt=Object.freeze({__proto__:null,CardModal:St})}.call(this,Mt("vb163"))},vb962:function(e,t,n){"use strict";var r=n("vb144"),o=n.n(r),i=n("vb103"),a=n("vb151");function l(e){return i.createElement("svg",o()({width:"1em",height:"1em",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},e),i.createElement("path",{d:"M21.707 16.293a1 1 0 0 1-1.414 0L12 8l-8.293 8.293a1 1 0 0 1-1.414-1.414l8.293-8.293a2 2 0 0 1 2.828 0l8.293 8.293a1 1 0 0 1 0 1.414Z",fill:"currentColor"}))}var c=i.forwardRef(function(e,t){return i.createElement(a.a,o()({icon:l},e,{ref:t,svgProps:{"data-icon":"UpOutlined"}}))});t.a=c}}]);
//# sourceMappingURL=//slardar.bytedance.net/api_v2/browser/jserr/get_sourcemap?bid=docs_pc&js_filename=vendors-card-modal-v2.395eba0d18.chunk.js