(window.webpackJsonp=window.webpackJsonp||[]).push([["d9d4f495e875"],{vb1285:function(e,t,n){"use strict";n.r(t),n.d(t,"CardEditModalFormula",function(){return i});var f=n("vb143"),r=n("vb103"),o=n.n(r),a=(n("vb147"),n("vb148"),n("vb152"),n("vb112"),n("vb164"),n("vb167"),n("vb113"),n("vb651")),l=(n("vb155"),n("vb116"),n("vb118"),n("vb120"),n("vb174"),n("vb119"),n("vb121"),n("vb117"),n("vb115"),n("vb129"),n("vb223"),n("vb214"),n("vb232"),n("vb187"),n("vb225"),n("vb224"),n("vb128"),n("vb122"),n("vb233"),n("vb234"),n("vb235"),n("vb123"),n("vb236"),n("vb193"),n("vb237"),n("vb238"),n("vb124"),n("vb239"),n("vb111"),n("vb104"),n("vb159"),n("vb240"),n("vb134"),n("vb131"),n("vb226"),n("vb241"),n("vb114"),n("vb110"),n("vb125"),n("vb242"),n("vb127"),n("vb132"),n("vb227"),n("vb135"),n("vb228"),n("vb229"),n("vb133"),n("vb126"),n("vb243"),n("vb262"),n("vb244"),n("vb245"),n("vb246"),n("vb247"),n("vb194"),n("vb248"),n("vb249"),n("vb201"),n("vb260"),n("vb267"),n("vb250"),n("vb136"),n("vb251"),n("vb130"),n("vb252"),32),b=4,v=1,i=function(t){function n(e){var a;return Object(f.ov)(this,n),(a=t.call(this,e)||this).onTableModelDirty=function(e){e===a.props.tableId&&a.resetValue()},a.resetValue=function(){Object(f.lK)(function(){var e=a.props.bitableStore.base.getTableById(a.props.tableId),t=e&&e.getCellValue(a.props.recordId,a.props.fieldId);a.setEditorValue(t)})},a.showFormulaEditor=function(){var e;if(a.props.editable&&!a.state.isEditing){var t=a.props.bitableStore.base.getTableById(a.props.tableId),n=t&&t.fields[a.props.fieldId];if(t&&n){var r=(null===(e=a.inputRef)||void 0===e?void 0:e.getBoundingClientRect())||{top:0,left:0},i=r.top,o=r.left;a.setState({isEditing:!0,offset:{top:i-b,left:o-v}})}}},a.endEdit=function(e){a.ref&&(a.ref.preventOnEndEdit||(e||a.resetValue(),a.setState({isEditing:!1})))},a.initEditorValue=function(){var e=a.props.bitableStore.base.getTableById(a.props.tableId),t=e&&e.fields[a.props.fieldId];if(e&&t&&a.ref){var n=t.property?t.property.formula:"";a.ref.onStartEdit(n,!0),setTimeout(function(){var e;return null===(e=a.ref)||void 0===e?void 0:e.focus()})}},a.setRef=function(e){a.ref=e,a.ref&&a.initEditorValue()},a.setInputRef=function(e){a.inputRef=e},a.hyperlinkClick=function(e){e.stopPropagation()},a.state={value:[],isEditing:!1,offset:{left:0,top:0}},a}return Object(f.bu)(n,t),Object(f.Pw)(n,[{key:"componentDidMount",value:function(){var e=this.props.bitableStore.base;null==e||e.eventEmitter.addListener(f.Yx.TableModelDirty,this.onTableModelDirty)}},{key:"componentWillUnmount",value:function(){var e=this.props.bitableStore.base;null==e||e.eventEmitter.removeListener(f.Yx.TableModelDirty,this.onTableModelDirty)}},{key:"focus",value:function(){}},{key:"onEndEdit",value:function(){this.endEdit(!1)}},{key:"setDefaultValue",value:function(){var e=this.props.value;e&&this.setEditorValue(e)}},{key:"onStartEdit",value:function(e,t){}},{key:"setEditorValue",value:function(e){var t=this.props,n=t.bitableStore,r=t.tableId,i=t.fieldId,o=n.base.getTableById(r),a=o&&o.fields[i];if(o&&a&&Object(f.nG)(a)&&!a.isEmptyFormula()){var l=a.cellValueToString(e)||"";if(l&&l.length>f.mK&&(l=l.slice(0,f.mK)+"..."),e){var b=[],v=e.val;if(v&&Array.isArray(v)&&Object(f.nK)(v))for(var s=v.length,u=0;u<s;u++)b.push(v[u]),u!==s-1&&b.push({type:f.Vy.Text,text:","});else b.push({type:f.Vy.Text,text:l});this.setState({value:b})}else this.setState({value:[]})}}},{key:"render",value:function(){var n=this,e=this.state,t=e.value,r=e.isEditing,i=t.map(function(e,t){return o.a.createElement("span",{key:t},"url"===e.type?o.a.createElement("a",{href:e.link,target:"_blank",className:"formula_editor_link",onClick:n.hyperlinkClick,rel:"noreferrer"},e.text):o.a.createElement("span",null,e.text))});return o.a.createElement("div",{className:"formula_eidtor_field b-ud-scrollbar-lg",onClick:this.showFormulaEditor,ref:this.setInputRef},i,r&&o.a.createElement("div",{className:"formula_detail_editor",style:this.state.offset},o.a.createElement(f.oK,Object(f.Kx)({ref:this.setRef,endEdit:this.endEdit,anchorRef:this.inputRef},this.props,{parentOffset:Object.assign({},this.state.offset,{height:-l-4,underCanvas:!1}),fieldSetSource:f.iz.Card,startMode:a.b.FULLSCREEN}))))}}]),n}(r.Component)},vb651:function(e,t,n){"use strict";n.d(t,"a",function(){return v}),n.d(t,"b",function(){return i}),n.d(t,"c",function(){return r}),n.d(t,"d",function(){return o}),n.d(t,"e",function(){return p}),n.d(t,"f",function(){return s}),n.d(t,"g",function(){return u}),n.d(t,"h",function(){return f}),n.d(t,"i",function(){return d});var r,i,o,a,l,b=n("vb143"),v=632,s=530,u=420,f=150;function d(e){return!(e instanceof b.wI)&&e.type===r.Property}function p(e){return!(e instanceof b.wI)&&e.type!==r.Property}(r||(r={})).Property="property",(l=i||(i={})).SIMPLE="simple",l.ADVANCE="advance",l.FULLSCREEN="fullScreen",(a=o||(o={})).Left="left",a.Right="right"}}]);
//# sourceMappingURL=//slardar.bytedance.net/api_v2/browser/jserr/get_sourcemap?bid=docs_pc&js_filename=d9d4f495e875.a311617cc7.chunk.js