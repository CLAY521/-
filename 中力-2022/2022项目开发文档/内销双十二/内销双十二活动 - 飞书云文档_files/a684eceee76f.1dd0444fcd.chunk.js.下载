(window.webpackJsonp=window.webpackJsonp||[]).push([["a684eceee76f"],{vb1278:function(e,c,d){"use strict";d.r(c),function(S){d.d(c,"KanbanLinkHeaderEditor",function(){return r});var k=d("vb143"),n=d("vb180"),w=d("vb161"),l=d("vb103"),m=d.n(l),o=(d("vb147"),d("vb148"),d("vb154")),e=(d("vb119"),d("vb152")),t=d.n(e),h=(d("vb121"),d("vb117"),d("vb115"),d("vb112"),d("vb164"),d("vb167"),d("vb113"),d("vb118"),d("vb116"),d("vb120"),d("vb174"),d("vb155"),d("vb772")),a=d("vb159"),I=d.n(a);d("vb129"),d("vb223"),d("vb214"),d("vb232"),d("vb187"),d("vb225"),d("vb224"),d("vb128"),d("vb122"),d("vb233"),d("vb234"),d("vb235"),d("vb123"),d("vb236"),d("vb193"),d("vb237"),d("vb238"),d("vb124"),d("vb239"),d("vb111"),d("vb104"),d("vb240"),d("vb134"),d("vb131"),d("vb226"),d("vb241"),d("vb114"),d("vb110"),d("vb125"),d("vb242"),d("vb127"),d("vb132"),d("vb227"),d("vb135"),d("vb228"),d("vb229"),d("vb133"),d("vb126"),d("vb243"),d("vb262"),d("vb244"),d("vb245"),d("vb246"),d("vb247"),d("vb194"),d("vb248"),d("vb249"),d("vb201"),d("vb260"),d("vb267"),d("vb250"),d("vb136"),d("vb251"),d("vb130"),d("vb252");Object(k.Uy)(Object(k.uY)(t.a.mark(function e(){return t.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,d.e("182be0c5cdcd").then(d.bind(null,"vb1272"));case 2:return e.abrupt("return",e.sent.LinkSelected);case 3:case"end":return e.stop()}},e)})));var s=Object(k.Uy)(Object(k.uY)(t.a.mark(function e(){return t.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,d.e("eb160de1de89").then(d.bind(null,"vb953"));case 2:return e.abrupt("return",e.sent.LinkSelectPop);case 3:case"end":return e.stop()}},e)})));function f(e){var t=e.iField,a=e.value,n=t.type,i=t.name;return k.sy.instance.get(n).getLinkCellRender(e)||{type:k.og.Text,name:i,isPrimary:!1,property:{text:t.cellValueToString(a)||""}}}var i,g=4,O=function(d,e){var t=2<arguments.length&&void 0!==arguments[2]?arguments[2]:[],a=3<arguments.length?arguments[3]:void 0,n=4<arguments.length?arguments[4]:void 0,u=d.fields,b=d.fieldMap,v=d.userMap,p=[];if(!d.table)return[];var h=Object(k.RN)(Object(k.hI)(t),e.getLinkTableRecords());return n=n||h,(a?n.slice(0,a):n).forEach(function(e){if(!(h.indexOf(e)<0)){for(var t=[],a=Math.min(g,u.length-1),n=0;n<=a;n++){var i,r,o=u[n],l=b[o],s=null===(i=d.table)||void 0===i?void 0:i.getCellValue(e,o,!1),c=f({iField:l,userMap:v,value:s,sourceTableTimeZone:null===(r=d.table)||void 0===r?void 0:r.getTimeZone(),sourceTable:d.table});c&&c.isPrimary?t.unshift(c):c&&t.push(c)}p.push({recordId:e,list:t})}}),p},y=function(t){function a(e){var r;return Object(k.ov)(this,a),(r=t.call(this,e)||this).refreshLoadedList=function(){var e=0<arguments.length&&void 0!==arguments[0]&&arguments[0],t=r.state,a=t.switchOnOff,n=t.searchText,i=r.getShowLinkList(a,n,e);r.setState({showList:i})},r.updateVisibleCount=function(){r.setState({scrollCount:r.state.scrollCount+1},function(){r.refreshLoadedList(!0)})},r.onSearch=function(e){var t=r.getShowLinkList(r.state.switchOnOff,e);r.setState({searchText:e,showList:t}),r.props.onSearch&&r.props.onSearch(e)},r.onSwitchSelected=function(e){var t=r.getShowLinkList(e,r.state.searchText);r.setState({switchOnOff:e,showList:t}),r.props.onSwitchRecord&&r.props.onSwitchRecord(e)},r.onChange=function(e,t,a){r.props.onChange({recordId:e,checked:t},a)},r.state={value:e.defaultValue,scrollCount:0,searchText:"",switchOnOff:!1,showList:[]},r}return Object(k.bu)(a,t),Object(k.Pw)(a,[{key:"componentDidMount",value:function(){var e=this.props,t=e.field,a=e.defaultValue;this.setState({showList:O(this.props.data.table,t,a,h.b*h.c)})}},{key:"componentDidUpdate",value:function(e){var t=e.data,a=e.defaultValue,n=this.props,i=n.data,r=n.defaultValue;t.table!==i.table?this.refreshLoadedList():Object(o.a)(a,r)||this.setState({value:r})}},{key:"getShowLinkList",value:function(e,t){var a=2<arguments.length&&void 0!==arguments[2]&&arguments[2],n=this.props,i=n.defaultValue,r=n.readonly,o=n.data,l=n.field,s=o.table,c=s.table,d=s.fields,u=h.b*(this.state.scrollCount+h.c),b=null==l?void 0:l.getLinkTableRecords(),v=Object(k.RN)(Object(k.hI)(i),b);if(r)return O(s,l,i,u,i);var p=[];return p=e?i:v,t&&(a?p=this.searchRecordsCache:(p=Object(k.SN)(c,p,d,t),this.searchRecordsCache=p)),O(s,l,i,u,p)}},{key:"render",value:function(){var e=this.props,t=e.data.tableName,a=e.field,n=e.defaultValue,i=e.bitableStore,r=this.state.showList,o=Object(k.TN)(a,i)?[]:r;return l.createElement(s,{classNames:e.classNames,values:n,list:o,readonly:e.readonly,multiple:e.multiple,isAdd:e.isAdd,onChange:this.onChange,onClose:this.props.onClose,onSearch:this.onSearch,onSwitchRecord:this.onSwitchSelected,onScroll:this.updateVisibleCount,tableName:t,maxHeight:this.props.maxHeight,maxcount:this.props.maxcount,onExpand:e.onExpand,setSearchInputRef:e.setSearchInputRef,setSelectPopRef:e.setSelectPopRef,onSearchAreaFocus:e.onSearchAreaFocus})}}]),a}(l.Component),r=Object(k.oA)(function(e,t){var a=e.operate,n=t.tableId,i=t.viewId,r=t.groupValue;return{onKanbanGroupEdit:function(e,t){return a.viewOperate.setKanbanGroupSync({tableId:n,viewId:i,fieldId:e,oldGroupValue:r,groupValue:t})}}})(i=function(t){function a(e){var m;return Object(k.ov)(this,a),(m=t.call(this,e)||this).updateSelectPopHeightOnResize=Object(n.a)(function(){m.updateSelectPopHeight()},200),m.updateLinkTable=function(){var e=m.props,t=e.bitableStore,a=e.renderer,n=e.view.getGroupField();if(n){var i=n.property,r=i.tableId,o=i.viewId;if(r){var l=t.base.getTableById(r);if(l&&!t.base.isDeniedTable(r)){var s=l.getValidViewForLinkField(o),c=s.view,d=s.viewIdValid;if(c){var u=l.getVirtualRecords(o),b=[],v=[];c.getAllFields().forEach(function(e){var t=l.fields[e];Object(k.vy)(t)?b.push(e):Object(k.qz)(t)&&v.push(e)});var p={};u.forEach(function(a){p[a]={};var n=l.records[a];n&&(Object.keys(n).forEach(function(t){if(-1<b.indexOf(t)){var e=l.getCellValue(a,t,!1);p[a][t]=(e||[]).map(function(e){return{id:e,text:l.fields[t].cellValueToString([e])}})}else p[a][t]=Object(w.a)(n[t])}),v.forEach(function(e){var t=l.getCellValue(a,e,!1);p[a][e]=Object(w.a)({value:t})}))});var h,f={table:l,fieldMap:l.fields,records:u.filter(function(e){return!l.isDeniedRecord(e)}),fields:c.getAllFields().filter(function(e){return!d||!c.getIsFieldHidden(e)}),userMap:Object.assign({},l.userMap,{},l.base.userMap)||{}};t.isEmbeddedInDoc&&(h=Object(k.Az)(a.reduxStore.getState()));var g=t.getValidTables(h).find(function(e){return e.id===r}),S=g?g.name:l.name;m.setState({tableName:S,table:f})}}}}},m.onCloseRecordCard=function(){m.props.toggleEnableMousedownToBlur(!1),m.setState({cardModalVisible:!1})},m.onLinkRecordExpand=function(e){m.props.toggleEnableMousedownToBlur(!0),m.setState({cardModalVisible:!0,linkRecordId:e})},m.onLinkRecordSelected=function(e){var t=e.recordId,a=m.props,n=a.bitableStore,i=a.groupValue,r=a.renameSource,o=a.tableId,l=a.viewId,s=a.view,c=a.renderer,d=s.getGroupField();if(t!==i&&d){var u,b=s.getGroups().map(function(e){return e.key}),v=n.getCommandManager();if(t&&b.includes(t))c.activeBitableWidget.getActiveWidget().revealList(t),k.ob.Toast.show({type:"info",content:S("bitable.kanban.duplicate_group_link"),duration:3e3}),m.props.exitEdit(!1);else{if(r===k.cK.NEW_GROUP)u=v.execute({cmd:k.Fy.KanbanAddGroup,tableId:o,viewId:l,fieldId:d.id,groupValue:t});else if(r===k.cK.RENAME){var p,h;u=null===(p=(h=m.props).onKanbanGroupEdit)||void 0===p?void 0:p.call(h,d.id,t)}u&&u.result===k.Ey.Success&&(m.props.submitRename(),m.props.exitEdit(!1))}}},m.setSearchInputRef=function(e){m.linkSearchInput=e},m.setRootRef=function(e){m.editorContainer=e},m.state={tableName:"",table:{table:null,fieldMap:{},fields:[],records:[],userMap:{}},cardModalVisible:!1,linkViewId:"",linkRecordId:"",selectPopMaxHeight:0},m.isSelectPopOnTop=!1,m}return Object(k.bu)(a,t),Object(k.Pw)(a,[{key:"componentDidMount",value:function(){this.updateLinkTable(),this.updateSelectPopHeight();var e=this.props,t=e.bitableStore,a=e.tableId;t.addEventListeners(a,Object(k.Ww)({},k.ay.ChangesetApplied,this.updateLinkTable)),window.addEventListener("resize",this.updateSelectPopHeightOnResize)}},{key:"componentWillUnmount",value:function(){var e=this.props,t=e.bitableStore,a=e.tableId;t.removeEventListeners(a,Object(k.Ww)({},k.ay.ChangesetApplied,this.updateLinkTable)),window.removeEventListener("resize",this.updateSelectPopHeightOnResize)}},{key:"setDefaultValue",value:function(){}},{key:"focus",value:function(){this.linkSearchInput&&this.linkSearchInput.focus()}},{key:"onStartEdit",value:function(){}},{key:"onEndEdit",value:function(){}},{key:"setEditorValue",value:function(){}},{key:"updateSelectPopHeight",value:function(){var e=this.props.bitableStore,t=this.editorContainer;if(t){var a=Object(k.sI)(t,0,e,{height:0},{paddingBottom:7}),n=a.isOnTop,i=a.maxHeight;this.isSelectPopOnTop=n,this.setState({selectPopMaxHeight:i})}}},{key:"render",value:function(){var e=this.props,t=e.groupValue,a=e.view,n=e.bitableStore,i=e.renderer,r=e.renameSource,o=this.state,l=o.table,s=o.tableName,c=o.cardModalVisible,d=o.linkViewId,u=o.linkRecordId,b=o.selectPopMaxHeight,v=a.getGroupField();if(!v)return null;var p=v.property.tableId,h=n.base.getTableById(p);if(!h)return k.rA.error("KanbanLinkHeaderEditor: linkTable is empty!",{linkTableId:p}),null;var f=d||v.getValidLinkTableView(h).viewId;f||k.rA.error("KanbanLinkHeaderEditor: viewId is empty!");var g=t&&v.cellValueToString([t]);return g&&(g=Object(k.iN)(g)),m.a.createElement(m.a.Fragment,null,m.a.createElement("div",{className:"bitable-kanban-link-header-editor-container",ref:this.setRootRef},r===k.cK.RENAME&&t&&m.a.createElement("div",{className:I()("bitable-kanban-link-header-record-content",{"bitable-kanban-link-header-record-content-placeholder":!g})},g||S("bitable.unnamed_record")),r===k.cK.NEW_GROUP&&m.a.createElement("div",{className:"bitable-kanban-link-header-new-group-placeholder"},S("smartable.kanban.add_group.link.placeholder"))),m.a.createElement(y,{multiple:!1,readonly:!1,maxcount:100,defaultValue:t?[t]:[],data:{table:l,tableName:s},onExpand:this.onLinkRecordExpand,onChange:this.onLinkRecordSelected,maxHeight:b,classNames:I()("bitable-kanban-link-header-select",{"bitable-kanban-link-header-select-on-top":this.isSelectPopOnTop,"bitable-kanban-link-header-select-on-bottom":!this.isSelectPopOnTop}),setSearchInputRef:this.setSearchInputRef,field:v,bitableStore:n}),c&&m.a.createElement(m.a.Fragment,null,m.a.createElement(k.cF,{cardSyncMode:k.ob.config.cardSyncMode,modalVisible:c,recordId:u,tableId:p,viewId:d,fieldId:v.id,bitableStore:n,onClose:this.onCloseRecordCard,renderer:i,mask:!0,forSelfTable:!1,source:k.sz.View,noticeIconType:k.rz.Info,field:v}),f&&m.a.createElement(k.xB,{cardSyncMode:k.ob.config.cardSyncMode,modalVisible:c,recordId:u,tableId:p,viewId:f,fieldId:v.id,onClose:this.onCloseRecordCard,mask:!0,forSelfTable:!1,source:k.sz.View,noticeIconType:k.rz.Info,field:v,shouldShowTipOnRecordDeleted:!0})))}}]),a}(m.a.Component))||i}.call(this,d("vb163"))},vb772:function(e,t,a){"use strict";a.d(t,"a",function(){return s}),a.d(t,"b",function(){return n}),a.d(t,"c",function(){return i}),a.d(t,"d",function(){return l}),a.d(t,"e",function(){return r}),a.d(t,"f",function(){return o});var n=5,i=3,r=64,o=200,l=500,s=96}}]);
//# sourceMappingURL=//slardar.bytedance.net/api_v2/browser/jserr/get_sourcemap?bid=docs_pc&js_filename=a684eceee76f.1dd0444fcd.chunk.js