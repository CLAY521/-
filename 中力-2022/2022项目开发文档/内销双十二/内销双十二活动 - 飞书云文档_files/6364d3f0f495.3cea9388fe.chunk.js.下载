(window.webpackJsonp=window.webpackJsonp||[]).push([["6364d3f0f495","5825aa00e46d"],{vb1289:function(e,C,k){"use strict";k.r(C),function(V){k.d(C,"LinkEditor",function(){return g}),k.d(C,"getDialogCount",function(){return z});var P=k("vb143"),e=k("vb152"),p=k.n(e),j=k("vb103"),N=k.n(j),c=(k("vb147"),k("vb148"),k("vb161")),T=(k("vb167"),k("vb113"),k("vb112"),k("vb155"),k("vb116"),k("vb118"),k("vb120"),k("vb164"),k("vb174"),k("vb119"),k("vb121"),k("vb117"),k("vb115"),k("vb111")),d=k("vb959"),t=k("vb159"),L=k.n(t),r=k("vb180"),o=k("vb2211"),u=k("vb2177"),l=k("vb412"),a=k("vb538"),E=k("vb960"),s=k("vb413"),i=k("vb114"),_=k("vb344"),b=(k("vb129"),k("vb223"),k("vb214"),k("vb232"),k("vb187"),k("vb225"),k("vb224"),k("vb128"),k("vb122"),k("vb233"),k("vb234"),k("vb235"),k("vb123"),k("vb236"),k("vb193"),k("vb237"),k("vb238"),k("vb124"),k("vb239"),k("vb104"),k("vb240"),k("vb134"),k("vb131"),k("vb226"),k("vb241"),k("vb110"),k("vb125"),k("vb242"),k("vb127"),k("vb132"),k("vb227"),k("vb135"),k("vb228"),k("vb229"),k("vb133"),k("vb126"),k("vb243"),k("vb262"),k("vb244"),k("vb245"),k("vb246"),k("vb247"),k("vb194"),k("vb248"),k("vb249"),k("vb201"),k("vb260"),k("vb267"),k("vb250"),k("vb136"),k("vb251"),k("vb130"),k("vb252"),k("vb539"),function(n){function r(){var s;Object(P.ov)(this,r);for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];return(s=n.call.apply(n,[this].concat(t))||this).onDropdownClick=function(){var e=s.props,t=e.disabled,i=e.onDropdownClick;t||i&&i()},s.onRemoveValue=function(e){var t,i,n=s.props,r=n.value,a=n.multiple,o=n.onChange,l=n.omRemove;a?-1!==(i=(t=Object(c.a)(r)).indexOf(e))&&t.splice(i,1):t=null,o&&o(t),l&&l(e)},s.onExpendValue=function(e){var t=s.props.onExpend;t&&t(e)},s}return Object(P.bu)(r,n),Object(P.Pw)(r,[{key:"render",value:function(){var e=this.props,t=e.value,i=e.options,n=e.disabled,r=e.placeholder,a=e.forceRenderValue,o=e.multiple,l=e.maxHeight,s=e.valueRender,c=e.className,d=e.style;return j.createElement("div",{className:L()("".concat("bitable-5a92a9","__link-selector-editor"),c),style:d},j.createElement(P.EP,{value:t,options:i,opened:!n,disabled:n,multiple:o,onRemoveValue:this.onRemoveValue,onExpendValue:this.onExpendValue,onClick:this.onDropdownClick,forceRenderValue:a,valueRender:s,maxHeight:l,placeholder:r}))}}]),r}(j.Component)),F=function(n){function r(){var o;Object(P.ov)(this,r);for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];return(o=n.call.apply(n,[this].concat(t))||this).valueRender=function(e,t,i,n,r){var a=o.props.editable;return j.createElement(P.FP,{text:e,bgColor:"var(--udtoken-tag-neutral-bg-normal)",textColor:"var(--text-title)",showClose:i&&a,onClose:n,onClick:r,style:{borderRadius:2,height:20,lineHeight:"20px"},textStyle:{fontWeight:500}})},o.onRemove=function(e){o.props.onDel&&o.props.onDel(e)},o.onExpend=function(e){o.props.onExpand&&o.props.onExpand(e)},o.onOpenEditor=function(){o.props.onOpenEditor&&o.props.onOpenEditor()},o}return Object(P.bu)(r,n),Object(P.Pw)(r,[{key:"options",get:function(){var e=this.props,t=e.value,i=e.table,n=e.primaryFieldId,r=i.fields[n];return r?t.map(function(e){var t=i.getCellValue(e,n);return{value:e,label:r.cellValueToString(t)||V("bitable.unnamed_record"),className:"bitable-link-selector-tag"}}):[]}},{key:"render",value:function(){var e=this.props,t=e.value,i=e.multiple,n=e.bitableStore,r=e.editable,a=e.tableId,o=n&&Object(P.wH)(n,a),l=null==n?void 0:n.base.isPro(),s=r?V("Bitable_Form_PleaseSelectRecord"):Object(P.xH)({isFieldEditablePermission:o,placeholder:V("Bitable_Form_PleaseSelectRecord"),isPro:l});return j.createElement(b,{className:"selector-cell link-selector",value:t,options:this.options,multiple:i,disabled:!r,maxHeight:150,forceRenderValue:!0,omRemove:this.onRemove,onExpend:this.onExpend,onDropdownClick:this.onOpenEditor,valueRender:this.valueRender,placeholder:s})}}]),r}(j.Component),v=function(r){function a(){var t;Object(P.ov)(this,a);for(var e=arguments.length,i=new Array(e),n=0;n<e;n++)i[n]=arguments[n];return(t=r.call.apply(r,[this].concat(i))||this).onClickJump=function(){t.close(!1),t.props.onClickJump&&t.props.onClickJump()},t.close=function(e){t.props.onClose&&t.props.onClose(e)},t}return Object(P.bu)(a,r),Object(P.Pw)(a,[{key:"render",value:function(){var e=this,t=this.props,i=t.linkTableId,n=t.renderer,r=t.bitableStore;return N.a.createElement("div",{className:"link-field-panel-header-wrapper"},N.a.createElement("div",{className:"bitable-layout-row link-field-panel-header"},N.a.createElement("div",{className:"link-field-panel-header-left"},N.a.createElement("span",{className:"link-field-panel-header-left-title ellipsis"},this.props.title)),N.a.createElement(T.Tooltip,{title:V("bitable.card_modal.close"),placement:"top"},N.a.createElement("div",{className:"link-field-panel-header-right"},N.a.createElement(o.a,{className:"link-field-panel-header-close",onClick:function(){return e.close(!0)}})))),N.a.createElement("div",{className:"bitable-layout-row link-field-panel-jump"},N.a.createElement(P.ix,{name:V("Bitable_Relation_HadLinkTable"),className:"bitable-layout-row bitable-layout-cross-center"},N.a.createElement(l.a,{renderer:n,bitableStore:r,tableId:i,onClick:this.onClickJump,showJumpTableName:!0}))))}}]),a}(N.a.PureComponent),h=664,f=100,m=240,x=24,B=84,M=48,D=66;function y(e){return 1<e.length?[e[0]]:e}var n,W,w,U=function(i){function n(e){var c;Object(P.ov)(this,n),(c=i.call(this,e)||this).gridPreviewer=null,c.searchInputRef=null,c.preventKeyUp=!1,c.storageKey="",c.onSearchInputChange=Object(r.a)(function(e){var t,i,n;c.preventKeyUp||(c.setState({searchText:e}),null===(t=(i=c.props).onSearch)||void 0===t||t.call(i,e),null===(n=c.gridPreviewer)||void 0===n||n.updateFilterKeyWord(e))},150),c.onResize=Object(r.a)(function(){c.doResize()},200),c.onCompositionStart=function(e){c.preventKeyUp=!0},c.onCompositionEnd=function(e){c.preventKeyUp=!1,c.onInputChange(e)},c.onInputChange=function(e){var t=e.target.value;c.setState({searchText:t}),c.onSearchInputChange(t)},c.setSearchRef=function(e){c.searchInputRef=e},c.getLinkTableView=function(){var e=c.props,t=e.linkTable,i=e.viewId,n=t.getValidViewForLinkField(i),r=n.view,a=n.viewIdValid;return{view:r||t.views[0],viewIdValid:a}},c.getLinkTableRecords=function(e){var t=[];if(t=e.getLinkTableRecords(),0<c.initSelectedRecords.length){var i=c.initSelectedRecords.filter(function(e){return!t.includes(e)});t=Object(P.RN)(i,t)}return 0<c.initSelectedRecords.length&&(t=Object(P.RN)(t,c.initSelectedRecords)),t},c.getSelectedRecords=function(){return c.state.selectedRecords},c.onSelectRecordsChange=function(e,t,i){var n=c.props.isMultiple,r=c.state.selectedRecords;e=t?n?Object(P.RN)(r,e):y(e):Object(P.GP)(r,e),c.setState({selectedRecords:e}),c.props.onSelectRecord&&c.props.onSelectRecord(!!i)},c.getUpdatedRecordsList=function(){var e=c.state,t=e.searchText,i=e.showSelected;return c.getShowRecordList(i,t)},c.onUpdatedRecordsChange=function(e){c.setState({isRecordEmpty:0===e.length})},c.getShowRecordList=function(e,t){var i=c.props,n=i.linkTable,r=i.field,a=c.getLinkTableRecords(r),o=[];return o=e?c.state.selectedRecords.filter(function(e){return n.records[e]}):a,t&&(o=Object(P.SN)(n,o,n.getVirtualFields(),t,!0)),o},c.onSwitchChange=function(e){var t,i,n;c.setState({showSelected:e}),null===(t=(i=c.props).onSwitchOff)||void 0===t||t.call(i,e),null===(n=c.gridPreviewer)||void 0===n||n.updateFilterSwitchStatus(e)},c.onAfterClose=function(){c.props.onAfterClose&&c.props.onAfterClose()},c.alertCancelCheck=function(e,t){c.props.onCancelCheck&&c.props.onCancelCheck(),T.Dialog.confirm({enableCancelButton:!0,title:V("Bitable_Relation_SettingsUnsavePopupTitle"),content:V("Bitable_Relation_SettingsUnsavePopupDesc"),okText:V("Bitable_Relation_SettingsUnsavePopupButtonSave"),cancelText:V("Bitable_Relation_SettingsUnsavePopupButtonClose"),maskClosable:!1,onOk:function(){t(),c.props.onCancelCheckSave&&c.props.onCancelCheckSave()},onCancel:function(){e(),c.props.onCancelCheckNotSave&&c.props.onCancelCheckNotSave()}})},c.onCancel=function(){var e=!(0<arguments.length&&void 0!==arguments[0])||arguments[0],t=c.props.getLinkRecords(),i=c.state.selectedRecords;c.props.readonly&&(e=!1);var n=!(t.length===i.length&&Object(P.GO)(t,i));e&&n?c.alertCancelCheck(function(){c.props.onCancel&&c.props.onCancel()},c.onConfirm):c.props.onCancel&&c.props.onCancel()},c.onConfirm=function(){var e=P.ob.config.duplexLinkMaxSizeLimit||P.HO;c.props.field.type===P.og.DuplexLink&&c.state.selectedRecords.length>e?P.ob.Toast.show({type:"error",content:V("Bitable_Relation_ReachLimitToast",e),duration:3e3,closable:!0}):c.props.onSubmit&&c.props.onSubmit(c.state.selectedRecords)},c.getStorageKey=function(){var e=c.props,t=e.field,i=e.viewId,n=e.linkTable,r=window.User?window.User.id:"";return"".concat(r,"_").concat(t.id,"_").concat(i,"_").concat(n.id)},c.setPropertyToLocalStorage=function(e){Object(P.IO)(c.storageKey,JSON.stringify(e))},c.onSetColumnWidth=function(e){var t=e.toJSON().property.colInfos;c.setPropertyToLocalStorage({colInfos:t})},c.getLocalProperty=function(){return Object(P.JO)(c.storageKey)},c.getCustomGridViewProperty=function(){return c.getLocalProperty()},c.onFasterReady=function(){c.doResize(function(){c.setState({isFasterReady:!0})})},c.onFasterRendered=function(){requestAnimationFrame(function(){c.setState({isFasterRendered:!0})})},c.hasAddRecordPermission=function(){var e=c.props,t=e.bitableStore,i=e.linkTable.id;if(!t||!t.getBasePermission(P.ry.Editable))return!0;if(t.isSyncTable(i))return!1;var n=t.getService(P.kx.PERMISSION);return!n||!n.enabled||n.getCalcService().getTablePermLevel(i)===P.Os.ADMIN},c.hasNewRecordEntryAvailable=function(){var e=c.props,t=e.bitableStore,i=e.linkTable.id;if(t.isSyncTable(i))return!1;var n=t.getService(P.kx.PERMISSION);if(!n||!n.enabled)return!0;var r=n.permission,a=t.getBasePermission(P.ry.Editable);return Object(s.g)({permission:r,tableId:i,editable:a})},c.canAddSearchText=function(){var e,t=c.props.linkTable.getPrimaryField();return(null==t?void 0:t.type)===P.og.Text&&!1!==(null===(e=t.allowedEditModes)||void 0===e?void 0:e.manual)},c.onOpenAddRecordEditPop=function(e){c.setState({cardEditRecordId:e}),c.props.onAddRecord&&c.props.onAddRecord(e),c.props.openCardModal&&c.props.openCardModal(e)},c.onClickAddRecordBtn=function(){var e={},t=c.state.searchText,i=c.props,n=i.linkTable,r=i.field,a=c.getLinkTableView().view,o=n.getPrimaryKey();if(t&&c.canAddSearchText()&&o){var l={value:[{type:P.Vy.Text,text:c.state.searchText}]};e[o]=l}var s=a.viewFilter.getDefaultNewRecord(void 0,r.property.filterInfo);Object.assign(e,n.getDefaultNewRecord(),s),c.executeCardAddRecord(e)},c.getDialogSize=function(){var e,t=window.innerWidth,i=window.innerHeight,n=t-2*m,r=i-2*f,a=null===(e=c.gridPreviewer)||void 0===e?void 0:e.getWidgetSize();return null!=a&&a.width&&(n=Math.max(Math.min(a.width,n),h)),{width:n,height:r}},c.doResize=function(t){var e=c.getDialogSize();c.setState({dialogWidth:e.width,dialogHeight:e.height},function(){var e;null===(e=c.gridPreviewer)||void 0===e||e.resizeWidget(),t&&t()})};var t=c.getDialogSize();return c.storageKey=c.getStorageKey(),c.state={isFasterReady:!1,isFasterRendered:!1,searchText:"",showSelected:!1,selectedRecords:e.getLinkRecords()||[],cardEditRecordId:null,dialogHeight:t.height,dialogWidth:t.width,isRecordEmpty:!1},c.initSelectedRecords=e.getLinkRecords()||[],c}return Object(P.bu)(n,i),Object(P.Pw)(n,[{key:"componentDidMount",value:function(){window.addEventListener("resize",this.onResize);var e=this.searchInputRef;e&&(e.addEventListener("compositionstart",this.onCompositionStart),e.addEventListener("compositionend",this.onCompositionEnd))}},{key:"componentDidUpdate",value:function(e){var t,i=this.props.tableLoaded;e.tableLoaded!==i&&i&&(null===(t=this.gridPreviewer)||void 0===t||t.loadTable()),e.isOpen!==this.props.isOpen&&!this.props.isOpen&&this.onAfterClose()}},{key:"componentWillUnmount",value:function(){window.removeEventListener("resize",this.onResize);var e=this.searchInputRef;e&&(e.removeEventListener("compositionstart",this.onCompositionStart),e.removeEventListener("compositionend",this.onCompositionEnd))}},{key:"executeCardAddRecord",value:function(e,t){var i=this.props,n=i.bitableStore,r=i.linkTable.id,a=this.getLinkTableView().view,o=a.id;if(a){var l=n.getCommandManager().execute({cmd:P.Fy.AddRecord,tableId:r,viewId:o,recordId:t,groupCellValues:void 0,groupValue:void 0,record:e,index:a.getAllRecords().length});if(l.result===P.Ey.Success){var s=l.data.recordId;this.onOpenAddRecordEditPop(s)}}}},{key:"renderHeader",value:function(){var t=this,e=this.props,i=e.bitableStore,n=e.renderer,r=e.linkTable,a=e.readonly,o=i.base.getTableById(this.props.tableId),l="",s=(null==o?void 0:o.getField(this.props.primaryFieldId||""))||(null==o?void 0:o.getPrimaryField());if(o&&s){var c=o.getCellValue(this.props.recordId,s.id,!1);l=null==c?V("bitable.unnamed_record"):s.cellValueToString(c)||""}else l=V("bitable.unnamed_record");var d={linkTableId:r.id,linkTableName:r.name,title:l,tableId:this.props.tableId,readonly:a,onClose:function(e){t.onCancel(e)},onClickJump:function(){t.props.onClickJumpTable&&t.props.onClickJumpTable()},bitableStore:i,renderer:n};return N.a.createElement(v,d)}},{key:"renderOperationBar",value:function(){if(this.props.readonly)return null;var e=[{value:!1,text:V("Bitable_Relation_ViewAllRecords")},{value:!0,text:V("Bitable_Relation_ViewSelectedRecord")}];return N.a.createElement("div",{className:"link-field-panel-operaiton bitable-layout-row"},N.a.createElement(a.a,{className:"bitable-link-field-search-input",placeholder:V("Bitable_Relation_SearchByKeyword"),undoWhenFocus:!1,onFocus:this.props.onSearchAreaFocus,onClick:this.props.onSearchAreaClick,onChange:this.onSearchInputChange,setSearchRef:this.setSearchRef}),N.a.createElement(P.Tw,{className:"link-field-panel-operaiton-switch",dropDownItemClassName:"link-field-panel-operation-switch-dropdown",selected:this.state.showSelected,onChange:this.onSwitchChange,options:e,showSelectedIcon:!1,hiddenCheckedIcon:!0}))}},{key:"renderAddBuuton",value:function(){var e=this.props,t=e.readonly,i=e.bitableStore,n=e.linkTable,r=this.state,a=r.searchText,o=r.isFasterRendered,l=i.isSyncTable(n.id),s=this.hasNewRecordEntryAvailable(),c=o&&(this.hasAddRecordPermission()||s),d=this.canAddSearchText();return N.a.createElement(T.Tooltip,{title:l?V("Bitable_DataReference_SyncFromOtherBase_ActionNotSupported_Tooltip"):P.jz.BitableAdvancedPermissionNotNewRecord,wrapDisabledChildren:!0,disabled:s},N.a.createElement(T.Button,{className:"link-field-panel-dialog-addbtn",style:{display:t?"none":"flex"},disabled:!c,onClick:this.onClickAddRecordBtn},N.a.createElement(u.a,{className:L()("add-record-text-icon",c?"":"add-record-text-icon-disabled")}),N.a.createElement("span",{className:L()({"add-record-text-add":d&&a})},V("bitable.field.link_add_record")),d&&a&&N.a.createElement(j.Fragment,null,N.a.createElement("span",{className:"add-record-text-content"},a))))}},{key:"renderFooter",value:function(){var e=this,t=this.props.readonly,i=this.state.selectedRecords;return N.a.createElement("div",{className:"link-field-panel-dialog-footer-btns"},N.a.createElement("div",{className:"link-field-panel-dialog-footer-selected-count"},V("Bitable_Relation_NumRecordSelected",{num:i.length},i.length)),!t&&N.a.createElement(P.hX,{btnContainerClassName:"bitable-link-field-panel-cancel-submit-button-group",onCancel:function(){return e.onCancel()},onSubmit:this.onConfirm,submitBtnText:V("common.confirm")}))}},{key:"render",value:function(){var t=this,e=this.props,i=e.isOpen,n=e.linkTable,r=e.getLinkRecords,a=e.isMultiple,o=e.bitableStore,l=e.field,s=this.state,c=s.isFasterReady,d=s.searchText,u=s.selectedRecords,b=s.dialogWidth,p=s.dialogHeight,v=s.isRecordEmpty,h=s.isFasterRendered,f=this.getLinkTableView().view,m=d&&v,y=0===u.length&&v,w=m?V("Bitable_Relation_NoRelatedRecord"):y?l.property.filterInfo?V("Bitable_Relation_NoRecordMeetCondition_Web"):V("Bitable_Relation_NoSelectedRecord"):"",g=this.renderHeader(),C=this.renderFooter(),k=this.renderOperationBar(),R=this.renderAddBuuton(),S=P.rx.isSafari,I=x,O=B+M+D;return N.a.createElement(T.Dialog,{className:"link-field-panel-editor",visible:i,style:{height:S?"auto":p,visibility:c?"visible":"hidden"},bodyStyle:{padding:"0 ".concat(I,"px")},width:b,closable:!1,maskClosable:!1,onCancel:function(e){t.onCancel(),e&&e.keyCode===P.sx.Esc&&e.stopPropagation()},zIndex:100,header:g,footer:null,enableAnimation:!1,wrapClassName:"link-field-panel-wrap"},k,N.a.createElement("div",{className:L()("bitable-grid-previewer-container",{emptyCenter:m||y})},N.a.createElement(E.a,{bitableStore:o,tableData:n,viewId:f.id,getDefaultSelectRowRecords:r,onSelectRecordsChange:this.onSelectRecordsChange,onFasterReady:this.onFasterReady,onFasterRendered:this.onFasterRendered,disableMultipleSelectRow:!a,maxWidth:b-2*I,maxHeight:p-O,setRef:function(e){return t.gridPreviewer=e},getSelectedRecords:this.getSelectedRecords,getUpdatedRecordsList:this.getUpdatedRecordsList,onUpdatedRecordsChange:this.onUpdatedRecordsChange,onSetColumnWidth:this.onSetColumnWidth,getCustomGridViewProperty:this.getCustomGridViewProperty,useSourceViewRankInfo:!0,readonly:this.props.readonly,className:"link-panel-previewer"}),N.a.createElement("div",{className:"bitable-grid-previewer-mask bitable-layout-column",style:{visibility:w?"visible":"hidden"}},N.a.createElement(P.Bh,null),N.a.createElement("div",{className:"bitable-grid-previewer-mask-text"},w)),c&&N.a.createElement("div",{className:"bitable-loading-wrapper",style:{visibility:h?"hidden":"visible"}},N.a.createElement(P.yB,null)),R),C)}}]),n}(N.a.Component);function z(){var e=document.querySelectorAll(".J-card-edit-modal"),t=e.length;if(0===t)return 0;var i=0;return e.forEach(function(e){"none"===e.parentElement.style.display&&i++}),t-i==0?0:t-i}(w=W||(W={})).Cell="cell",w.Card="card",w.AddRecord="addRecord";var g=Object(i.connect)(function(e,t){var i,n,r=null===(i=t.field)||void 0===i||null===(n=i.property)||void 0===n?void 0:n.tableId;return{tableLoaded:Object(P.oD)(e,r)||!1,activeTableId:Object(P.UB)(e)}},{},null,{forwardRef:!0})(n=function(l){function s(e){var b,t,i;Object(P.ov)(this,s),(b=l.call(this,e)||this).editorRef=null,b.documentWidth=document.body.clientWidth,b.isSearched=!1,b.switchOnOff=!1,b.zIndex=null,b.preventOpen=!1,b.cardModalShowRecordId=null,b.linkView=null,b.close=function(){return!b.state.cardModalVisible&&(b.setState({isOpen:!1},function(){b.isSearched=!1}),!0)},b.onSearch=function(e){e&&(b.isSearched=!0)},b.onClickJumpTable=function(){b.collectRelationRecordPanelClick(P.KO.Relate,P.Rw.CcmBitableContentPageView)},b.onSelectRecord=function(e){var t=e?P.KO.SelectAll:P.KO.Select;b.collectRelationRecordPanelClick(t)},b.onClickAddRecord=function(e){b.collectRelationRecordPanelClick(P.KO.Add,P.Rw.CcmBitableCardView)},b.onSwitchRecord=function(e){var t=(b.switchOnOff=e)?P.KO.OnlyViewSelectedRecord:P.KO.ViewAllRecords;b.collectRelationRecordPanelClick(t)},b.onSearchAreaFocus=function(){b.collectRelationRecordPanelClick(P.KO.Search)},b.onCancelCheck=function(){P.cz.collectBitableEvent(P.Rw.CcmBitableDuplexRelationNotSaveView,{fieldType:b.getTeaFieldType()})},b.onCancelCheckSave=function(){P.cz.collectClickEvent(P.Bc.CcmBitableDuplexRelationNotSaveClick,{field_type:b.getTeaFieldType(),click:P.LO.NotSave,target:P.Rw.None})},b.onCancelCheckNotSave=function(){P.cz.collectClickEvent(P.Bc.CcmBitableDuplexRelationNotSaveClick,{field_type:b.getTeaFieldType(),click:P.LO.NotSave,target:P.Rw.None})},b.onExpand=function(e,t,i){P.cz.collectClickEvent(P.Bc.CcmBitableRelationFieldModifyClick,{click:P.MO.Expand,target:P.Rw.CcmBitableCardView}),b.openCardModal(e,t,i)},b.collectBitableRelationOperationEvent=function(e){var t=b.props,i=t.tableId,n=t.viewId,r=t.bitableStore,a=t.isCardEdit,o=r.base.getTableById(i);if(o){var l=o.getViewById(n);l&&P.ob.collectBitableEvent(P.On.BitableRelationOperation,{table_id:i,view_id:n,bitable_editor_type:a?"card":"cell",bitable_view_type:P.Cz[l.type],action:e,data_source:r.Options.module},!0)}},b.collectRelationRecordPanelClick=function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:P.Rw.None,i=b.getTeaFieldType();P.cz.collectClickEvent(P.Bc.CcmBitableDuplexRelationRecordPanelClick,{click:e,target:t,field_type:i})},b.collectRelationRecordClick=function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:P.Rw.None,i=2<arguments.length?arguments[2]:void 0,n=b.getTeaFieldType();P.cz.collectClickEvent(P.Bc.CcmBitableDuplexRelationRecordClick,{click:e,target:t,field_type:n,location:i})},b.collectBitableCardOpen=function(e){var t=b.props,i=t.tableId,n=t.viewId,r=t.bitableStore.base.getTableById(i);if(r){var a=r.getViewById(n);a&&P.ob.collectBitableEvent(P.On.BitableCardOpen,{table_id:i,view_id:n,bitable_view_type:P.Cz[a.type],source:e,data_source:b.props.bitableStore.Options.module})}},b.collectBitableRecordEdit=function(e){var t=b.props,i=t.tableId,n=t.viewId,r=t.fieldId,a=t.bitableStore,o=t.recordId,l=t.renderer,s=t.isCardEdit,c=l.activeBitableWidget.isFloatLayerOpen,d=a.base.getTableById(i);if(d){var u=d.getViewById(n);u&&P.ob.collectBitableEvent(P.On.BitableRecordEdit,Object.assign({smartable_token:a.md5Token,row:u.getVisibleRecordIndexById(o),col:u.getFieldIndexById(r),table_id:i,view_id:n,bitable_editor_type:s?"card":"cell",bitable_view_type:P.Cz[u.type],bitable_field_type:P.lC[b.props.field.fieldUIType],bitable_edit_search:b.isSearched,bitable_feature_change:e,data_source:a.Options.module,is_record_floating:c},l.getRecordEditLogParams()),!0)}},b.toggleDeniedTipShow=function(e){b.setState({isShowDeniedTip:e})},b.onDelete=(i=Object(P.uY)(p.a.mark(function e(t,i){var n,r;return p.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=Object(P.hI)(b.state.recordIds),r=n.indexOf(t),n.splice(r,1),e.next=5,b.onChange(n);case 5:b.collectRelationRecordClick(P.NO.Delete,P.Rw.None,i),b.collectBitableRelationOperationEvent(P.PO.UnselectRecord),P.cz.collectClickEvent(P.Bc.CcmBitableRelationFieldModifyClick,{click:P.MO.Delete});case 8:case"end":return e.stop()}},e)})),function(e,t){return i.apply(this,arguments)}),b.onOpenPanel=function(){b.collectRelationRecordClick(P.NO.ClickRecord,P.Rw.CcmBitableDuplexRelationRecordView),b.isHasDeniedProperty()?b.toggleDeniedTipShow(!b.state.isShowDeniedTip):b.setState({aloneCardEdit:!0,isOpen:!0})},b.onAfterClose=function(){b.collectRelationRecordPanelClick(P.KO.Close,P.Rw.CcmBitableDuplexRelationNotSaveView)},b.onCancel=function(){b.props.endEdit&&b.props.endEdit(!0),b.collectRelationRecordPanelClick(P.KO.Cancel,P.Rw.CcmBitableDuplexRelationNotSaveView),b.close()},b.onSubmit=(t=Object(P.uY)(p.a.mark(function e(t){return p.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,b.onChange(t);case 2:b.collectRelationRecordPanelClick(P.KO.Confirm),b.close();case 4:case"end":return e.stop()}},e)})),function(e){return t.apply(this,arguments)}),b.getIsShowFilterToolTip=function(e,t){var i,n;return!(!b.linkView||null==e||null===(i=e.property)||void 0===i||!i.filterInfo||null!==(n=b.linkView)&&void 0!==n&&n.viewFilter.checkConditions(t,e.property.filterInfo))},b.onCloseEditPopup=function(e){b.setState({cardModalVisible:!1})},b.switchCard=function(e){var t=b.state,i=t.recordIds,n=t.cardModalRecordId,r=i.indexOf(n);if(!(r<0)){"pre"===e?r--:r++;var a=i[r];a&&b.setState({cardModalRecordId:a,cardModalVisible:!0})}},b.setEditorRef=function(e){b.editorRef=e};var n=e.values,r=e.cardSyncMode,a=e.executeAction,o=b.isDemandSyncMode(r);return b.state={recordIds:o&&n||[],isOpen:!1,cardModalVisible:!1,cardModalRecordId:"",showMask:!1,linkViewId:"",aloneCardEdit:!1,isShowFilterToolTip:!1,isAddRecord:!1,isShowDeniedTip:!1},b.linkCommand=new d.a(a),b}return Object(P.bu)(s,l),Object(P.Pw)(s,[{key:"componentDidMount",value:function(){var e;this.gridContext=null===(e=this.props.renderer.activeBitableWidget)||void 0===e?void 0:e.getGridWidget(),this.unbindContextEvent=this.bindContextEvent(),(this.props.isCardEdit||P.rx.isIPad)&&this.updateCellValue()}},{key:"UNSAFE_componentWillReceiveProps",value:function(e){(e.isCardEdit||this.state.isOpen)&&this.updateCellValue()}},{key:"componentDidUpdate",value:function(e){e.fieldId===this.props.fieldId&&e.recordId===this.props.recordId||this.close(),e.activeTableId!==this.props.activeTableId&&this.close()}},{key:"componentWillUnmount",value:function(){this.unbindContextEvent&&this.unbindContextEvent(),this.linkDataSource&&this.linkDataSource.destroyed(),this.setState({recordIds:[]})}},{key:"setDefaultValue",value:function(){}},{key:"setEditorValue",value:function(){var e,t;(null===(e=this.props.view)||void 0===e?void 0:e.type)===P.az.Form&&this.setState({recordIds:null!==(t=this.props.values)&&void 0!==t?t:[]}),this.updateCellValue()}},{key:"focus",value:function(){this.updateCellValue(),this.editorRef&&this.editorRef.focus()}},{key:"onEndEdit",value:function(e){return this.toggleDeniedTipShow(!1),Object(P.yH)(this.props.relativeClass,this.props.field.fieldUIType,this.state.recordIds),this.close()}},{key:"onStartEdit",value:function(){var e,t;this.isHistoryMode()||this.isConfigDisableLinkPanelDialog()||(this.isSearched=!1,this.state.isOpen||(this.isSearched=!1),this.setState({isOpen:!0,cardModalVisible:!1}),this.updateCellValue(),P.cz.collectBitableEvent(P.Rw.CcmBitableRelationFieldModifyView,{relation_count:null===(e=this.linkDataSource.getSource())||void 0===e?void 0:e.length}),P.cz.collectBitableEvent(P.Rw.CcmBitableDuplexRelationRecordView,{field_type:this.getTeaFieldType(),relation_count:null===(t=this.linkDataSource.getSource())||void 0===t?void 0:t.length}))}},{key:"bindContextEvent",value:function(){var e,t=this,i=(Object(P.Ww)(e={},P.pC.DeleteLinkCell,function(e){t.onDelete(e.id,W.Cell),Object(P.yH)(t.props.relativeClass,t.props.field.fieldUIType,t.state.recordIds)}),Object(P.Ww)(e,P.pC.ClickLinkCell,function(e){t.openCardModal(e.id,!0,W.Cell),t.collectRelationRecordClick(P.NO.ClickRelation,P.Rw.CcmBitableCardView,W.Cell),t.setState({isOpen:!1})}),Object(P.Ww)(e,P.pC.CoverMouseDown,function(){t.preventOpen=t.state.isOpen}),Object(P.Ww)(e,P.pC.CoverClick,function(e){t.preventOpen||e&&(t.state.isOpen||t.preventOpen?(t.props.editable?t.props.endEdit&&t.props.endEdit(!0):t.onEndEdit(!1),t.focus()):t.props.editable?(t.collectRelationRecordClick(P.NO.ClickRecord,P.Rw.CcmBitableDuplexRelationRecordView,W.Cell),t.props.startEdit&&t.props.startEdit(!1)):t.onStartEdit())}),e);return this.gridContext&&this.gridContext.addGridEventsBindListener(i),function(){t.gridContext&&t.gridContext.removeGridEventsBindListener(i)}}},{key:"updateCellValue",value:function(){var t=this,e=this.props,i=e.tableId,n=e.fieldId,r=e.viewId,a=e.recordId,o=e.bitableStore,l=e.values;if(this.linkDataSource&&this.linkDataSource.destroyed(),this.linkDataSource=new P.OO({type:P.Qy.cell,tableId:i,viewId:r,recordId:a,fieldId:n},o,l),this.getLinkTable(),this.props.cardSyncMode!==P.tx.OnDemand){var s=this.linkDataSource.getSource();this.updateLinkRecords(s),this.linkDataSource.bindUpdate(function(e){t.updateLinkRecords(e)})}}},{key:"getLinkTable",value:function(){var e=this.props,t=e.bitableStore,i=e.field,n=i.property.tableId;if(i&&n){var r=t.base.getTableById(n);if(r&&!t.base.isDeniedTable(n)){var a=i.getValidLinkTableView(r),o=a.view,l=a.viewId;o&&(this.linkView=o,this.setState({primaryField:r.getPrimaryKey(),linkViewId:l}))}}}},{key:"updateLinkRecords",value:function(e){var t=this.props,i=t.bitableStore,n=t.field.property.tableId;if(n){var r=i.base.getTableById(n);r&&!i.base.isDeniedTable(n)&&(null!=e&&0!==e.length?this.setState({recordIds:e.filter(function(e){return!r.isDeniedRecord(e)})}):this.props.editable?this.setState({recordIds:[]}):this.setState({isOpen:!1,recordIds:[]}))}}},{key:"onRef",value:function(e){this.rootEl=e}},{key:"isDemandSyncMode",value:function(e){return e===P.tx.OnDemand}},{key:"getTeaFieldType",value:function(){var e=P.ex.SingleLink,t=this.props.field.fieldUIType;return t&&(e=t),P.lC[e]}},{key:"getFieldType",value:function(){return this.props.field.type}},{key:"onChange",value:function(){var t=Object(P.uY)(p.a.mark(function e(t){var i,n,r,a,o,l,s,c,d,u,b;return p.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(i=this.props,n=i.tableId,r=i.fieldId,a=i.recordId,o=i.field.property.tableId,l=i.bitableStore,s=i.viewId,i.editable){e.next=3;break}return e.abrupt("return");case 3:if(c=l.base.getTableById(n),l.base.getTableById(o)&&c){e.next=7;break}return e.abrupt("return");case 7:if(c.getValidViewForLinkField(s).view){e.next=11;break}return e.abrupt("return");case 11:if(0!=(u=(d=t).length-this.state.recordIds.length)&&(u/=Math.abs(u)),this.setState({recordIds:d}),b=this.getFieldType()){e.next=18;break}return e.abrupt("return");case 18:return e.next=20,this.linkCommand.changeLinkRecord({type:b,value:d,tableId:n,viewId:s,fieldId:r,recordId:a});case 20:this.collectBitableRecordEdit(u);case 21:case"end":return e.stop()}},e,this)}));function e(e){return t.apply(this,arguments)}return e}()},{key:"onEnter",value:function(){}},{key:"openCardModal",value:function(e,t,i){var n=this;if(!this.isHistoryMode()&&!this.isTemplateMode())if(10<=z())P.ob.Toast.show({type:"info",content:V("bitable.field.link_card_limit"),duration:3e3,closable:!1});else{var r=this.props.field,a=this.getIsShowFilterToolTip(r,e);this.setState({cardModalRecordId:e,cardModalVisible:!0,showMask:t,isShowFilterToolTip:a,isAddRecord:"addRecord"===i},function(){var e=null;if("cell"===i){var t=n.switchOnOff;e=P.NK.RelationAllMenu,t&&(e=P.NK.RelationSelectedMenu)}else e=P.NK.RelationCell,n.props.isCardEdit&&(e=P.NK.RelationCard);n.collectBitableCardOpen(e),P.cz.collectBitableEvent(P.Rw.CcmBitableCardView,{source:e}),"card"===i&&n.collectBitableRelationOperationEvent(P.PO.ExpandRecord)})}}},{key:"afterClose",value:function(){}},{key:"isHistoryMode",value:function(){var e=this.props,t=e.bitableStore,i=e.tableId,n=e.field;return t&&t.Options.isHistoryMode&&n.property.tableId!==i}},{key:"isTemplateMode",value:function(){var e=this.props.bitableStore;return e&&e.Options.module===P.Bz.Template}},{key:"isConfigDisableLinkPanelDialog",value:function(){var e,t;return null===(e=this.props.bitableStore.bitableConfig)||void 0===e||null===(t=e.ui)||void 0===t?void 0:t.disableLinkPanelDialog}},{key:"preventOnEndEdit",get:function(){return!(!this.state.isOpen||this.isHasDeniedProperty())}},{key:"isHasDeniedProperty",value:function(){var e=this.props.field;return e instanceof P.QO&&e.isHasDeniedProperty()}},{key:"render",value:function(){var e,t=this,i=this.props,n=i.isCardEdit,r=i.bitableStore,a=i.recordId,o=i.field,l=i.renderer,s=i.editable,c=i.tableId,d=i.tableLoaded,u=i.view,b=i.isValid,p=void 0===b||b,v=this.state,h=v.isOpen,f=v.cardModalVisible,m=v.cardModalRecordId,y=v.linkViewId,w=v.recordIds,g=v.showMask,C=v.primaryField,k=v.aloneCardEdit,R=v.isShowFilterToolTip,S=v.isAddRecord,I=v.isShowDeniedTip,O=o.property,T=O.tableId,E=O.multiple,x=r.base.getTableById(T),B=this.isHasDeniedProperty();return x&&p?(f&&null===this.zIndex&&(this.zIndex=z()),N.a.createElement(j.Fragment,null,N.a.createElement("div",{className:L()("bitable-link-editor-container__overlayer")}),N.a.createElement("div",{className:L()("bitable-link-editor-container bitable-noselect",(e={collapse:!h&&!n},Object(P.Ww)(e,"".concat("bitable-5a92a9","__cardEdit"),n),Object(P.Ww)(e,"isCardEdit",n),e)),ref:function(e){return t.onRef(e)}},N.a.createElement("input",{readOnly:!0,className:"hidden-input",ref:this.setEditorRef}),n&&C&&N.a.createElement(F,{table:x,primaryFieldId:C,value:w,tableId:c,bitableStore:r,editable:s,multiple:E,onExpand:function(e){t.collectRelationRecordClick(P.NO.ClickRelation,P.Rw.CcmBitableCardView,W.Card),t.onExpand(e,!0,W.Card)},onDel:function(e){t.onDelete(e,W.Card)},onOpenEditor:this.onOpenPanel}),h&&!B&&(!n||k)&&N.a.createElement(U,{bitableStore:r,renderer:l,readonly:!s,field:o,tableId:c,viewId:y,recordId:a,primaryFieldId:this.state.primaryField,tableLoaded:!!d,isOpen:h,isMultiple:E,linkTable:x,getLinkRecords:function(){return t.state.recordIds.filter(function(e){return!x.isDeniedRecord(e)})},onClickJumpTable:this.onClickJumpTable,onSelectRecord:this.onSelectRecord,onAfterClose:this.onAfterClose,onCancel:this.onCancel,onSubmit:this.onSubmit,onSearch:this.onSearch,onSearchAreaFocus:this.onSearchAreaFocus,onSwitchOff:this.onSwitchRecord,onAddRecord:this.onClickAddRecord,openCardModal:function(e){return t.onExpand(e,!0,W.AddRecord)},onCancelCheck:this.onCancelCheck,onCancelCheckSave:this.onCancelCheckSave,onCancelCheckNotSave:this.onCancelCheckNotSave}),n&&B&&I&&N.a.createElement("div",{className:"bitable-link-editor-container_deniedtip"},V("Bitable_SingleOption_NoPermToAccessOptions"))),f&&N.a.createElement(N.a.Fragment,null,N.a.createElement(P.cF,{cardSyncMode:P.ob.config.cardSyncMode,modalVisible:f,recordId:m,switchRecords:w,tableId:T,viewId:y,source:P.sz.Link,bitableStore:r,switchCard:this.switchCard,onClose:function(){return t.onCloseEditPopup(T)},renderer:l,afterClose:this.afterClose,mask:g,forSelfTable:!1,showTip:R,marginLeft:10*(this.zIndex||0),field:o,isAddRecord:S,noticeIconType:P.rz.Warning}),N.a.createElement(P.xB,{cardSyncMode:P.ob.config.cardSyncMode,modalVisible:f,recordId:m,switchRecords:w,tableId:T,viewId:y,source:P.sz.Link,switchCard:this.switchCard,onClose:function(){return t.onCloseEditPopup(T)},afterClose:this.afterClose,mask:g,forSelfTable:!1,showTip:R,marginLeft:10*(this.zIndex||0),field:o,isAddRecord:S,noticeIconType:P.rz.Warning,shouldShowTipOnRecordDeleted:!0})))):n?(null==u?void 0:u.type)===P.az.Form?E?N.a.createElement(_.a,{className:"selector-cell multi-selector-editor",editable:s,style:{width:"100%"},getPinyin:function(){return Promise.resolve(null)},disableCreateOption:!0,disableEditOption:!0}):N.a.createElement(_.b,{className:"selector-cell single-selector-editor",editable:s,style:{width:"100%"},getPinyin:function(){return Promise.resolve(null)},disableCreateOption:!0,disableEditOption:!0}):N.a.createElement("div",{className:"bitable-link-invalid-editor-container"}):null}}]),s}(N.a.PureComponent))||n}.call(this,k("vb163"))},vb344:function(e,t,i){"use strict";i.d(t,"a",function(){return l}),i.d(t,"b",function(){return o}),i.d(t,"c",function(){return s});var n=i("vb152"),r=i.n(n),a=i("vb143"),o=Object(a.Uy)(Object(a.uY)(r.a.mark(function e(){return r.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,i.e("d645920e395f").then(i.bind(null,"vb485"));case 2:return e.abrupt("return",e.sent.SingleSelectorEditor);case 3:case"end":return e.stop()}},e)}))),l=Object(a.Uy)(Object(a.uY)(r.a.mark(function e(){return r.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,i.e("d67d8ab4f4c1").then(i.bind(null,"vb486"));case 2:return e.abrupt("return",e.sent.MultiSelectorEditor);case 3:case"end":return e.stop()}},e)}))),s=Object(a.Uy)(Object(a.uY)(r.a.mark(function e(){return r.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,i.e("3416a75f4cea").then(i.bind(null,"vb487"));case 2:return e.abrupt("return",e.sent.UserSelectorEditor);case 3:case"end":return e.stop()}},e)})))},vb412:function(e,u,b){"use strict";(function(n){b.d(u,"a",function(){return d});var e,c=b("vb143"),t=b("vb103"),r=b.n(t),a=b("vb773"),i=(b("vb147"),b("vb148"),b("vb159")),o=b.n(i),l=b("vb111"),s=b("vb114"),d=(b("vb152"),b("vb112"),b("vb164"),b("vb167"),b("vb113"),Object(s.connect)(function(e){return{mode:Object(c.Wy)(e)}})(e=function(t){function i(e){return Object(c.ov)(this,i),t.call(this,e)||this}return Object(c.bu)(i,t),Object(c.Pw)(i,[{key:"shouldShowJumpLinkIcon",value:function(){return this.isTableLoaded()&&!this.props.bitableStore.isEmbedded&&this.props.mode===c.ly.DEFAULT}},{key:"isTableLoaded",value:function(){var e=this.props.tableId,t=this.props.bitableStore.base.getTableById(e);return t&&!t.notTableLoad}},{key:"onClickJumpTable",value:function(){var e=this.props.tableId,t=this.props.bitableStore.base,i=this.props.renderer,n=t.getTableById(e);if(n&&!n.notTableLoad){this.props.onClick&&this.props.onClick(),i.switchTable(t,e);var r=this.props.viewId;if(r){var a=n.getViewById(r);a&&Object(c.zz)(a.viewPermission)&&i.switchView(t,e,r)}else{var o,l=Object(c.WB)(n.views);try{for(l.s();!(o=l.n()).done;){var s=o.value;if(Object(c.zz)(s.viewPermission)){i.switchView(t,e,s.id);break}}}catch(e){l.e(e)}finally{l.f()}}this.props.bitableStore.uiEventManager.emit(c.my.ToggleTableTabs,{tableId:e,visible:!0})}}},{key:"getViewIdMap",value:function(){var e,t=this.props.bitableStore,i=this.props.renderer;return t.isEmbeddedInDoc&&(e=Object(c.Az)(i.reduxStore.getState())),e}},{key:"getJumpTableName",value:function(){var e;return(null===(e=this.props.bitableStore.base.getValidTableById(this.props.tableId,this.getViewIdMap()))||void 0===e?void 0:e.name)||null}},{key:"render",value:function(){var e,t=this;return this.shouldShowJumpLinkIcon()?r.a.createElement(l.Tooltip,{placement:"top",title:null!==(e=this.props.tooltipText)&&void 0!==e?e:n("Bitable_Relation_MoveToLinkedTable")},r.a.createElement("span",{className:o()("link-jumpout",this.props.className),onClick:function(){return t.onClickJumpTable()}},this.props.showJumpTableName?r.a.createElement("span",{className:"link-jumpout-name"},this.getJumpTableName()):null,r.a.createElement(a.a,null))):null}}]),i}(r.a.PureComponent))||e)}).call(this,b("vb163"))},vb413:function(e,t,i){"use strict";i.d(t,"a",function(){return u}),i.d(t,"b",function(){return n}),i.d(t,"c",function(){return r}),i.d(t,"d",function(){return a}),i.d(t,"e",function(){return l}),i.d(t,"f",function(){return b}),i.d(t,"g",function(){return d}),i.d(t,"h",function(){return c}),i.d(t,"i",function(){return s});var o=i("vb143"),n=function(e){var t=e.permission,i=e.editable,n=e.tableId,r=e.recordId,a=e.viewId;return i&&t.hasPermission(o.qy.Record,{tableId:n,viewId:a,recordId:r},o.ry.Editable)},r=function(e){var t=e.fieldId,i=e.permission,n=e.tableId;return i.hasPermission(o.qy.Field,{tableId:n,fieldId:t},o.ry.Editable)},a=function(e){var t=e.permission,i=e.tableId;return t.hasPermission(o.qy.Field,{tableId:i},o.ry.Addable)},l=function(e){var t=e.permission,i=e.tableId,n=e.fieldId;return t.hasPermission(o.qy.Field,{tableId:i,fieldId:n},o.ry.Copyable)},s=function(e){var t=e.permission,i=e.view,n=e.tableId,r=e.fieldIndexes,a=i.getVisibleFields();return r.map(function(e){return a[e]}).every(function(e){return t.hasPermission(o.qy.Field,{tableId:n,viewId:i.id,fieldId:e},o.ry.Deletable)})},c=function(e){var t=e.permission,i=e.tableId;return t.hasPermission(o.qy.View,{tableId:i},o.ry.Addable)},d=function(e){var t=e.permission,i=e.editable,n=e.tableId;return i&&t.hasPermission(o.qy.Record,{tableId:n},o.ry.Addable)},u=function(e){var t=e.permission,i=e.editable,n=e.tableId,r=e.viewId,a=e.recordId;return i&&t.hasPermission(o.qy.Record,{tableId:n,viewId:r,recordId:a},o.ry.Deletable)},b=function(e){var t=e.permission,i=e.tableId,n=e.viewId;return e.editable&&t.hasPermission(o.qy.View,{tableId:i,viewId:n},o.ry.Editable)}},vb538:function(e,i,n){"use strict";(function(S){n.d(i,"a",function(){return t});var I=n("vb143"),O=n("vb103"),T=n.n(O),E=n("vb111"),e=(n("vb147"),n("vb148"),n("vb159")),x=n.n(e);function B(e){var n=Object(O.useRef)(e);n.current=Object(O.useMemo)(function(){return e},[e]);var t=Object(O.useRef)();return t.current||(t.current=function(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];return n.current.apply(this,t)}),t.current}var t=function(e){var t=e.searchValue,i=e.style,n=e.className,r=e.setSearchRef,a=e.onChange,o=e.onFocus,l=e.onClick,s=e.undoWhenFocus,c=void 0===s||s,d=e.placeholder,u=void 0===d?S("bitable.side_bar_search_placeholder"):d,b=Object(O.useState)(""),p=Object(I.xz)(b,2),v=p[0],h=p[1],f=Object(O.useRef)(!1),m=Object(O.useRef)(null),y=Object(O.useMemo)(function(){return void 0!==t?t:v},[v,t]),w=function(e){void 0===t&&h(e),a&&a(e)},g=function(e){c&&"historyUndo"===e.nativeEvent.inputType&&!f.current||w(e.target.value)},C=function(){f.current=!0,o&&o()},k=function(){f.current=!1},R=B(function(e){if(!c||f.current){var t=e.shiftKey,i=e.altKey,n=e.keyCode,r=e.metaKey,a=e.ctrlKey;if(I.rx.mac||I.rx.isIPad){var o=[r,a];a=o[0],r=o[1]}switch(n===I.sx.Z&&a&&!r&&!t&&!i&&w(""),n){case I.sx.Up:case I.sx.Down:case I.sx.Esc:m.current&&m.current.blur()}}});return Object(O.useEffect)(function(){r&&r(m.current)},[]),Object(O.useEffect)(function(){return document.addEventListener("keydown",R),function(){document.removeEventListener("keydown",R)}},[]),T.a.createElement(E.Input.Search,{shape:"square",allowClear:!0,placeholder:u,ref:m,style:i,className:x()("bitable-search-input",n),value:y,onChange:g,onFocus:C,onBlur:k,onClick:l})}}).call(this,n("vb163"))},vb539:function(e,t,i){"use strict";i.r(t),i.d(t,"PureBitable",function(){return c});var n=i("vb152"),o=i.n(n),u=i("vb143"),b=i("vb157"),r=i("vb103"),l=i.n(r),s=i("vb114"),a=i("vb159"),p=i.n(a),c=(i("vb147"),i("vb148"),i("vb112"),i("vb164"),i("vb167"),i("vb113"),i("vb155"),i("vb174"),i("vb124"),i("vb110"),i("vb111"),i("vb116"),i("vb118"),i("vb120"),i("vb119"),i("vb121"),i("vb117"),i("vb115"),i("vb129"),i("vb223"),i("vb214"),i("vb232"),i("vb187"),i("vb225"),i("vb224"),i("vb128"),i("vb122"),i("vb233"),i("vb234"),i("vb235"),i("vb123"),i("vb236"),i("vb193"),i("vb237"),i("vb238"),i("vb239"),i("vb104"),i("vb240"),i("vb134"),i("vb131"),i("vb226"),i("vb241"),i("vb125"),i("vb242"),i("vb127"),i("vb132"),i("vb227"),i("vb135"),i("vb228"),i("vb229"),i("vb133"),i("vb126"),i("vb243"),i("vb262"),i("vb244"),i("vb245"),i("vb246"),i("vb247"),i("vb194"),i("vb248"),i("vb249"),i("vb201"),i("vb260"),i("vb267"),i("vb250"),i("vb136"),i("vb251"),i("vb130"),i("vb252"),function(c){function d(e){var s;Object(u.ov)(this,d),(s=c.call(this,e)||this).bitableReduxStore=Object(u.kN)(),s.bindEvents=function(){s.bitableStore.getEventManager(s.props.tableId).addListeners(s.bitableStageListeners),s.bitableStore.uiEventManager.addListeners(s.listeners)},s.unbindEvents=function(){s.bitableStore.uiEventManager.removeListeners(s.listeners),s.bitableStore.getEventManager(s.props.tableId).removeListeners(s.bitableStageListeners)},s.onSwitchView=function(e){var t=s.props.shell;t&&t.onSwitchView&&t.onSwitchView(e)},s.onSwitchTable=function(){var e=s.props,t=e.tableId,i=e.viewId,n=e.editable,r=s.bitableStore.base;s.renderer.switchTable(r,t);var a=r.getTableById(t);if(a){var o=a.getViewById(i);if(o&&o.isValid()){var l=s.renderer.activeBitableWidget;l&&l.setView(o,{editable:n}),s.bitableStore.uiEventManager.emit(u.my.UpdateViewport),s.renderer.updateAllUI()}}},s.onOperationProduced=function(e){var t=s.renderer,i=s.bitableStore;if(Object(u.pO)(t,e),t.updateUIByActions(e.updateActions,!0),(e.executeType===u.qO.redo||e.executeType===u.qO.undo)&&e.updateActions.length){var n=e.updateActions[e.updateActions.length-1],r="data.moveView"===n.action,a="base.moveTable"===n.action;if(s.props.tableId===n.tableId||a||i.base.getTableById(n.tableId)&&t.switchTable(i.base,n.tableId),"viewId"in n&&s.props.tableId!==n.viewId&&!r){var o=i.base.getTableById(n.tableId);o&&o.getViewById(n.viewId)&&t.switchView(i.base,n.tableId,n.viewId)}}Object(b.a)(s.props.onOperationProduced)&&s.props.onOperationProduced(e)},s.bitableReduxStore.dispatch(Object(u.sO)(!0)),s.bitableReduxStore.dispatch(Object(u.tO)(e.editable)),s.bitableReduxStore.dispatch(Object(u.tN)(e.hasCommentPermission));var t=e.sync,i=e.bitableSync,n=e.permission,r=e.options,a=e.bitableConfig,o=e.customCommandHooks;r.containerType=u.UM.PureBitable,s.bitableStore=new u.Vz(s.bitableToken,u.Uz.getInstance(),u.pA.Default,r,i,void 0,void 0,{ignoreIOPermission:!0}),s.bitableStoreContainer=new u.Yz(s.bitableStore),o&&s.bitableStore.getCommandManager().setHooks(o),a&&s.bitableStore.setBitableConfig(a),t&&s.bitableStore.setPureBitableSync(t),s.storageManager=new u.Wz,s.storageManager.bindEvents();var l=new u.Xz(s.bitableStore,s.storageManager,{reduxStore:s.bitableReduxStore});return s.renderer=l,s.operate=new u.uN(s.bitableStore,{loadedTable:s.renderer.loadedTable,updateAllUI:s.renderer.updateAllUI}),n&&s.bitableStore.getPermissionStore().setBitablePermission(n),s.bindEvents(),s.state={isTableInit:!1},s}return Object(u.bu)(d,c),Object(u.Pw)(d,[{key:"componentDidMount",value:function(){this.props.setRef&&this.props.setRef(this),this.initTable()}},{key:"UNSAFE_componentWillReceiveProps",value:function(e){this.props.editable!==e.editable&&this.bitableReduxStore.dispatch(Object(u.tO)(e.editable))}},{key:"componentDidUpdate",value:function(e,t){e.hasCommentPermission!==this.props.hasCommentPermission&&this.bitableReduxStore.dispatch(Object(u.tN)(this.props.hasCommentPermission)),e.tableId!==this.props.tableId&&this.onSwitchTable(),e.viewId!==this.props.viewId&&this.renderer.switchView(this.bitableStore.base,this.props.tableId,this.props.viewId)}},{key:"componentWillUnmount",value:function(){this.reset(),this.unbindEvents()}},{key:"initTable",value:function(){var e=Object(u.uY)(o.a.mark(function e(){var t,i,n,r,a;return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this.props,i=t.sync,n=t.tableId,!i){e.next=14;break}if(!i.fetchAllTable){e.next=9;break}return e.next=5,i.fetchAllTable();case 5:r=e.sent,this.operate.baseOperate.initTable(r,{baseSubType:u.Xx.NORMAL}),e.next=14;break;case 9:if(!i.fetchTable){e.next=14;break}return e.next=12,i.fetchTable(n);case 12:a=e.sent,this.operate.baseOperate.initTable(Object(u.Ww)({},a.id,a),{baseSubType:u.Xx.NORMAL});case 14:this.renderer.updateAllUI(),this.renderer.setActiveTableId(n),this.setState({isTableInit:!0});case 17:case"end":return e.stop()}},e,this)}));function t(){return e.apply(this,arguments)}return t}()},{key:"reset",value:function(){var e=this.bitableStore,t=this.renderer;t.reset(),e.reset(),t.resetRedux()}},{key:"getTableById",value:function(e){return this.bitableStore.base.getTableById(e)}},{key:"getViewById",value:function(e){var t=this.props.tableId,i=this.bitableStore.base.getTableById(t);return i?i.getViewById(e):null}},{key:"getVirtualView",value:function(){var e=Object(u.uY)(o.a.mark(function e(){var t;return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.pureRenderer.getActiveBitableWidgetByPromise();case 2:return t=e.sent,e.abrupt("return",t.virtualView);case 4:case"end":return e.stop()}},e,this)}));function t(){return e.apply(this,arguments)}return t}()},{key:"listeners",get:function(){var e;return Object(u.Ww)(e={},u.ay.OperationProduced,this.onOperationProduced),Object(u.Ww)(e,u.my.SwitchView,this.onSwitchView),Object(u.Ww)(e,u.my.SwitchTable,this.onSwitchTable),e}},{key:"bitableStageListeners",get:function(){var e,t=this;return Object(u.Ww)(e={},u.ay.BitableIsReady,function(){var e=t.renderer.reduxStore;Object(u.tz)(e.getState())||(t.renderer.batchUpdateTableViewConfigAfterTTU(!0),requestAnimationFrame(function(){t.renderer.reduxStore.dispatch(Object(u.KG)(u.bH.READY))}))}),Object(u.Ww)(e,u.ay.FirstContentLoaded,function(){t.renderer.batchUpdateTableViewConfigAfterTTU(!0),t.renderer.reduxStore.dispatch(Object(u.KG)(u.bH.CAN_EDIT))}),e}},{key:"bitableToken",get:function(){return"mockBitableToken"+this.props.tableId}},{key:"pureRenderer",get:function(){return this.renderer}},{key:"render",value:function(){var e=this.props,t=e.tableId,i=e.viewId,n=e.className,r=void 0===n?"":n,a=this.bitableStoreContainer.Provider;return l.a.createElement(s.Provider,{store:this.bitableReduxStore},l.a.createElement(u.eA,{bitableStore:this.bitableStore},l.a.createElement(a,null,l.a.createElement(u.fF,{blockId:t},l.a.createElement("div",{className:p()("layout-column pure-bitable",r)},this.state.isTableInit&&t&&i&&l.a.createElement(u.dO,{bitableStore:this.bitableStore,renderer:this.renderer,tableId:t,viewId:i}))))))}}]),d}(l.a.PureComponent))},vb773:function(e,t,i){"use strict";var n=i("vb144"),r=i.n(n),a=i("vb103"),o=i("vb151");function l(e){return a.createElement("svg",r()({width:"1em",height:"1em",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},e),a.createElement("path",{d:"M22 3a1 1 0 0 0-1-1h-7a1 1 0 0 0 0 2h4.586l-6.293 6.293a1 1 0 0 0 1.414 1.414L20 5.414V10a1 1 0 1 0 2 0V3Z",fill:"currentColor"}),a.createElement("path",{d:"M4 5h6v2H4v13h16v-5.5h2V20a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V7a2 2 0 0 1 2-2Z",fill:"currentColor"}))}var s=a.forwardRef(function(e,t){return a.createElement(o.a,r()({icon:l},e,{ref:t,svgProps:{"data-icon":"WindowNewOutlined"}}))});t.a=s},vb959:function(e,t,i){"use strict";i.d(t,"a",function(){return r});var n=i("vb152"),c=i.n(n),d=i("vb143"),r=(i("vb147"),i("vb103"),i("vb148"),function(){function t(e){Object(d.ov)(this,t),this.executeAction=e}return Object(d.Pw)(t,[{key:"changeLinkRecord",value:function(){var t=Object(d.uY)(c.a.mark(function e(t){var i,n,r,a,o,l,s;return c.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return i=t.type,n=t.value,r=t.tableId,a=t.viewId,o=t.fieldId,l=t.recordId,e.next=3,this.executeAction(function(){return{cmd:d.Fy.SetRecord,tableId:r,recordId:l,viewId:a,data:Object(d.Ww)({},o,{type:i,value:n})}});case 3:return(s=e.sent).result!==d.Ey.Success&&console.log("error",s),e.abrupt("return");case 6:case"end":return e.stop()}},e,this)}));function e(e){return t.apply(this,arguments)}return e}()}]),t}())},vb960:function(e,t,i){"use strict";i.d(t,"a",function(){return v});var n=i("vb152"),r=i.n(n),a=i("vb143"),o=i("vb176"),l=i("vb103"),s=i.n(l),c=(i("vb147"),i("vb148"),i("vb539")),d=i("vb159"),u=i.n(d),b=(i("vb112"),i("vb164"),i("vb167"),i("vb113"),i("vb155"),i("vb116"),i("vb118"),i("vb120"),i("vb174"),i("vb119"),i("vb121"),i("vb117"),i("vb115"),function(){function n(e,t,i){Object(a.ov)(this,n),this.queue=null,this.addHeartbeat=function(e){},this.removeHeartbeat=function(e){},this.memberId=t,this.activeTableId=i,this._base=e}return Object(a.Pw)(n,[{key:"updateWorkdayConfig",value:function(e){return null}},{key:"fetchHoliday",value:function(e){return null}},{key:"setClientVarRunnerPriority",value:function(e,t){}},{key:"getSyncBase",value:function(){return null}},{key:"getSyncTable",value:function(e){return null}},{key:"setNeedWatch",value:function(e){}},{key:"watchTable",value:function(e){}},{key:"unwatchTable",value:function(e){}},{key:"addToWatchedTableIds",value:function(e){}},{key:"getMemberId",value:function(){return this.memberId}},{key:"initTableEventManager",value:function(e){}},{key:"getEventManager",value:function(e){return new a.RO}},{key:"getBaseEventManager",value:function(){return new a.RO}},{key:"addEventListeners",value:function(e,t){}},{key:"removeEventListeners",value:function(e,t){}},{key:"sendOperation",value:function(e){}},{key:"fetchClientVars",value:function(){}},{key:"getClientVars",value:function(){}},{key:"fetchToMaxVersion",value:function(e){}},{key:"fetchTableToMaxVersion",value:function(e,t){}},{key:"handleClientVars",value:function(e,t){}},{key:"switchTable",value:function(e){}},{key:"initSyncTables",value:function(e){}},{key:"isTableNotLoad",value:function(e){return!1}},{key:"isTableLoaded",value:function(e){return!0}},{key:"isTableLoading",value:function(e){return!1}},{key:"isTableClientVarLoaded",value:function(e){return!0}},{key:"isAllTableLoaded",value:function(){return!0}},{key:"getActiveTableId",value:function(){return this.activeTableId||""}},{key:"sendCursor",value:function(e,t){}},{key:"reset",value:function(){}},{key:"base",get:function(){return this._base}},{key:"getToken",value:function(){return this._base.token}}]),n}()),p={editable:!1,addable:!1,deletable:!1,movable:!1,copyable:!1,cuttable:!1,pastable:!1},v=function(t){function i(e){var o;return Object(a.ov)(this,i),(o=t.call(this,e)||this).pureBitableRef=null,o.view=null,o.virtualView=null,o.permission={base:{editable:!0},table:Object.assign({},p),view:Object.assign({},p),field:Object.assign({},p,{movable:!0}),record:Object.assign({},p)},o._batchUpdatePromise=null,o.updateRecordsList=function(e){var t,i,n,r,a=null===(t=(i=o.props).getUpdatedRecordsList)||void 0===t?void 0:t.call(i,e);return a&&(null===(n=(r=o.props).onUpdatedRecordsChange)||void 0===n||n.call(r,a)),a||e},o.onSetRowSelection=function(e,t,i){var n,r;null===(n=(r=o.props).onSelectRecordsChange)||void 0===n||n.call(r,e,t,i)},o.getSelectedRecords=function(){var e,t;return null===(e=(t=o.props).getSelectedRecords)||void 0===e?void 0:e.call(t)},o.getCustomGridViewProperty=function(){var e,t;return null===(e=(t=o.props).getCustomGridViewProperty)||void 0===e?void 0:e.call(t)},o.getMaxWidth=function(){return o.props.maxWidth},o.getMaxHeight=function(){return o.props.maxHeight},o.getDefaultSelectRowRecords=function(){var e,t;return(null===(e=(t=o.props).getDefaultSelectRowRecords)||void 0===e?void 0:e.call(t))||[]},o.setPureBitableRef=function(e){o.pureBitableRef=e},o.batchResizeWidget=function(){o._batchUpdatePromise||(o._batchUpdatePromise=Promise.resolve().then(function(){o.resizeWidget(),o._batchUpdatePromise=null}))},o.setColumnWidth=function(e,t,i){var n,r;null!==i&&(i=Math.floor(i),i=Math.max(i,a.SO)),e.setColumnWidth(t,i),o.refresh(),(null===(n=o.props)||void 0===n?void 0:n.onSetColumnWidth)&&(null===(r=o.props)||void 0===r||r.onSetColumnWidth(e))},o.bindVirtualViewFasterEvent=function(){var e,t=(null===(e=o.pureBitableRef)||void 0===e?void 0:e.pureRenderer.activeBitableWidget).getGridWidget(),n=o.view,i=Object(a.Ww)({},a.pC.ResizeColHeader,function(e){var t=e.width,i=e.col;o.setColumnWidth(n,n.getVisibleFields()[i],t)});return t.addGridEventsBindListener(i),function(){t.removeGridEventsBindListener(i)}},o.resizeWidget=function(){var e,t=null===(e=o.pureBitableRef)||void 0===e?void 0:e.pureRenderer.activeBitableWidget;null==t||t.resize()},o.getWidgetSize=function(){var e,t=null===(e=o.pureBitableRef)||void 0===e?void 0:e.pureRenderer.activeBitableWidget;return null==t?void 0:t.getFasterSize()},o.loadTable=function(){var e,t=o.table.id;null===(e=o.pureBitableRef)||void 0===e||e.pureRenderer.loadedTable(t)},o.table=e.tableData,o.initConfig(e),o.pureBitableSync=new b(o.table.base,e.bitableStore.getMemberId()),o}return Object(a.bu)(i,t),Object(a.Pw)(i,[{key:"componentDidMount",value:function(){this.props.setRef&&this.props.setRef(this)}},{key:"componentDidUpdate",value:function(){var t=Object(a.uY)(r.a.mark(function e(t){return r.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.view){e.next=6;break}return e.next=3,this.initView();case 3:this.setViewCustomProcessor(),this.clearListener&&this.clearListener(),this.clearListener=this.bindVirtualViewFasterEvent();case 6:this.batchResizeWidget();case 7:case"end":return e.stop()}},e,this)}));function e(e){return t.apply(this,arguments)}return e}()},{key:"componentWillUnmount",value:function(){this.resetViewCustomProcessor(),this.clearListener&&this.clearListener()}},{key:"updateFilterKeyWord",value:function(e){var t;null===(t=this.virtualView)||void 0===t||t.updateSearchKey(e),this.refresh()}},{key:"updateFilterSwitchStatus",value:function(e){this.refresh()}},{key:"refresh",value:function(){var e,t;null===(e=this.view)||void 0===e||e.markDirty(),null===(t=this.pureBitableRef)||void 0===t||t.pureRenderer.batchUpdateFaster()}},{key:"initView",value:function(){var e=Object(a.uY)(r.a.mark(function e(){return r.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.pureBitableRef){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,this.pureBitableRef.getVirtualView();case 4:if(this.view=e.sent,this.view){e.next=7;break}return e.abrupt("return");case 7:this.virtualView=Object(a.TO)(this.view);case 8:case"end":return e.stop()}},e,this)}));function t(){return e.apply(this,arguments)}return t}()},{key:"getView",value:function(){return this.view}},{key:"setViewCustomProcessor",value:function(){var t=this;this.view&&this.props.getUpdatedRecordsList&&this.view.setCustomRecordsFilterFn(function(e){return t.updateRecordsList(e)})}},{key:"resetViewCustomProcessor",value:function(){this.view&&this.view.setCustomRecordsFilterFn(null)}},{key:"getCustomConfig",value:function(){return null}},{key:"getCustomOptions",value:function(){return null}},{key:"initConfig",value:function(e){var t,i={bitableContentDidMount:e.onFasterReady,bitableContentLoaded:e.onFasterRendered,ui:{visibility:(t={},Object(a.Ww)(t,a.cC.Toolbar,!1),Object(a.Ww)(t,a.cC.Sidebar,!1),Object(a.Ww)(t,a.cC.ViewPanel,!1),Object(a.Ww)(t,a.cC.Tab,!1),Object(a.Ww)(t,a.cC.NewTableView,{sidebar_visible:!1,hide_toolbar:!0,sidebar_auto_display:!1}),t),disableContextMenu:!0,useMentionPopover:!1,useFileShortCut:!1,disableClickHyperlink:!0,disableAttachmentPreview:!0,hidePrimaryFieldTooltip:!0,disableRecordCardMode:!0,useSimpleFieldEdit:!0,disableCellEditor:!0,disableAttachmentTooltip:!0,useAtUserInText:!0,useNotifyLark:!0,useCardModalFilterTip:!0,useDateTimeFieldAutoFill:!0,useToolBarPanelHelpIcon:!1,disableErrorToast:!0,disableGridDataCounter:!0,tableMenus:function(e){return e},toolbarItems:function(e){return e},addViewTypes:function(e){return e},fieldOptions:function(e){return e},fieldOptionGroups:function(e){return e},bitableWidgetUIConfig:{hiddenCommentBubble:!0,keepDefaultGridView:!0,autoWidth:!0,autoHeight:!0,maxWidth:this.getMaxWidth,maxHeight:this.getMaxHeight,gridWidgetUIConfig:{disableStatList:!0,disableFixReadonlyBorder:!0,paddingLeft:0,onlySelectRow:!0,disableEditSelection:e.readonly,useContentBorder:!0,disableMultipleSelectRow:e.disableMultipleSelectRow,getDefaultSelectRow:this.getDefaultSelectRowRecords,onSelectRowChange:this.onSetRowSelection,getSelectedRecords:this.getSelectedRecords,useLocationModal:!0,customGridVirtualViewProperty:this.getCustomGridViewProperty,useSourceViewRankInfo:e.useSourceViewRankInfo,disableColHeaderBorderTop:!0}},disableLinkPanelDialog:!0}},n=this.getCustomConfig();this.config=Object(o.a)(i,n)}},{key:"render",value:function(){var e=this.props,t=e.viewId,i=e.className;return s.a.createElement(c.PureBitable,{editable:!0,setRef:this.setPureBitableRef,tableId:this.table.id,viewId:t,hasCommentPermission:!1,className:u()("bitable-base-grid-previewer-wrapper",i),bitableSync:this.pureBitableSync,permission:this.permission,bitableConfig:this.config,options:Object.assign({permissionSync:!1,needWatch:!1,isPreview:!0},this.getCustomOptions()),customCommandHooks:{field:{edit:{before:function(){return!1}}}}})}}]),i}(s.a.Component)}}]);
//# sourceMappingURL=//slardar.bytedance.net/api_v2/browser/jserr/get_sourcemap?bid=docs_pc&js_filename=6364d3f0f495.3cea9388fe.chunk.js