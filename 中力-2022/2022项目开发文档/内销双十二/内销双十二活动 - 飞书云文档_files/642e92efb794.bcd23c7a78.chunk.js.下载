(window.webpackJsonp=window.webpackJsonp||[]).push([["642e92efb794"],{vb1301:function(e,v,p){"use strict";p.r(v),function(m){p.d(v,"KanbanNewCardEditor",function(){return d});var e,t,C=p("vb143"),i=p("vb146"),n=p("vb103"),s=p.n(n),r=p("vb159"),u=p.n(r),l=p("vb116"),a=p("vb194"),o=p("vb114"),c=(p("vb147"),p("vb148"),p("vb152"),p("vb112"),p("vb164"),p("vb167"),p("vb113"),p("vb155"),p("vb118"),p("vb120"),p("vb174"),p("vb394")),b=(p("vb129"),p("vb223"),p("vb214"),p("vb232"),p("vb187"),p("vb225"),p("vb224"),p("vb128"),p("vb122"),p("vb115"),p("vb119"),p("vb233"),p("vb234"),p("vb235"),p("vb123"),p("vb236"),p("vb193"),p("vb237"),p("vb238"),p("vb124"),p("vb239"),p("vb111"),p("vb104"),p("vb121"),p("vb117"),p("vb240"),p("vb134"),p("vb131"),p("vb226"),p("vb241"),p("vb110"),p("vb125"),p("vb242"),p("vb127"),p("vb132"),p("vb227"),p("vb135"),p("vb228"),p("vb229"),p("vb133"),p("vb126"),p("vb243"),p("vb262"),p("vb244"),p("vb245"),p("vb246"),p("vb247"),p("vb248"),p("vb249"),p("vb201"),p("vb260"),p("vb267"),p("vb250"),p("vb136"),p("vb251"),p("vb130"),p("vb252"),C.eK+24),d=Object(C.oA)(function(e,t){var i=e.operate,n=t.tableId,r=t.viewId,a=t.groupValue;return{onKanbanGroupEdit:function(e,t){return i.viewOperate.setKanbanGroupSync(Object.assign({tableId:n,viewId:r,fieldId:e,oldGroupValue:a},t))}}})(e=Object(o.connect)(function(e,t){return{fieldMap:Object(C.Iz)(e,t.tableId)}})(((t=function(o){function d(e){var y;Object(C.ov)(this,d),(y=o.call(this,e)||this).containerRef=null,y.editorRef=null,y.editorHasChanged=!1,y.editorPosX=0,y.editorPosY=0,y.needSetEditorValue=!1,y.startEdit=function(){var e=y.props,t=e.tableId,i=e.recordId,n=e.EditContainerType;y.editorRef&&(y.editorRef.focus(),y.props.renderer.startEdit(t,i,y.primaryField.id),n!==C.YJ.NEW_CARD&&y.editorRef.onStartEdit(null,!1))},y.bindDataSource=function(){var e=y.props,t=e.tableId,i=e.recordId,n=e.bitableStore,r=e.EditContainerType,a=y.view.getGroupField();r===C.YJ.NEW_CARD&&a&&(y.dataSource=new C.ZJ(t,a.id,i,n),y.dataSource.bindUpdate(function(e){y.setState({groupValue:e===C.wz?null:e},function(){var e,t;y.kanban.revealRecord(i),y.primaryField.type===C.og.DateTime&&(null===(e=y.editorRef)||void 0===e||null===(t=e.resetPopupPosition)||void 0===t||t.call(e))})}))},y.setContainerRef=function(e){y.containerRef=e},y.setEditorRef=function(e){if(y.editorRef=e,y.editorRef&&y.table&&y.needSetEditorValue){var t=y.table.getCellValue(y.props.recordId,y.primaryField.id);y.editorRef.setEditorValue(t),y.needSetEditorValue=!1}},y.getListeners=function(){var e;return Object(C.Ww)(e={},C.my.ExitEditing,y.cancelEdit),Object(C.Ww)(e,C.my.CompleteEditing,y.exitEdit),e},y.cancelEdit=function(){y.exitEdit(!0)},y.handleUndo=function(e){var t=e.keyCode,i=e.metaKey,n=e.ctrlKey;if(C.rx.mac){var r=[i,n];n=r[0],i=r[1]}if(n&&t===C.sx.Z&&!y.editorHasChanged){var a=y.props.needUndo;y.exitEdit(!0),a||e.stopPropagation()}},y.handleEditorChange=function(){y.editorHasChanged=!0},y.bindEvents=function(){var e=y.props,t=e.bitableStore,i=e.tableId;document.addEventListener("mousedown",y.autoFocus,!0),y.containerRef.addEventListener("keydown",y.handleUndo),y.kanban.addListener(l.FEventType.AfterFlush,y.updateEditorPosition),y.kanban.board.contentDoc.addListener(l.FEventType.AfterFlush,y.updateEditorPosition),y.kanban.events.addListener(C.rC.CardListAfterFlush,y.onCardListFlush),y.kanban.events.addListener(C.rC.BoardScroll,y.updateEditorPosition),y.kanban.events.addListener(C.rC.BeforeAddRecordByFooterBtn,y.exitEdit),t.addEventListeners(i,y.getListeners())},y.unbindEvents=function(){var e=y.props,t=e.bitableStore,i=e.tableId;document.removeEventListener("mousedown",y.autoFocus,!0),y.containerRef.removeEventListener("keydown",y.handleUndo),y.kanban.removeListener(l.FEventType.AfterFlush,y.updateEditorPosition),y.kanban.board.contentDoc.removeListener(l.FEventType.AfterFlush,y.updateEditorPosition),y.kanban.events.removeListener(C.rC.CardListAfterFlush,y.onCardListFlush),y.kanban.events.removeListener(C.rC.BoardScroll,y.updateEditorPosition),y.kanban.events.removeListener(C.rC.BeforeAddRecordByFooterBtn,y.exitEdit),t.removeEventListeners(i,y.getListeners())},y.onCardListFlush=function(e){var t=e.cardListKey,i=y.state.groupValue;(t===i||t===C.wz&&null===i)&&y.updateEditorPosition()},y.updateEditorPosition=function(){var e,t,i,n=y.props,r=n.recordId,a=n.EditContainerType,o=n.isDocBlock,d=n.renameSource,l=y.state.groupValue;if(a===C.YJ.NEW_CARD?i=Object(C.aK)(y.kanban,l||"",r,y.containerRef,o):a===C.YJ.RENAME&&(i=Object(C.bK)(y.kanban,l||"",d)),null!=i&&null!==(e=y.props.bitableStore.bitableConfig.ui)&&void 0!==e&&e.kanbanNewRecordOverlay&&(i.y=Math.max(0,i.y-y.kanban.y)),!i||i.x===y.editorPosX&&i.y===y.editorPosY||(y.editorPosX=i.x,y.editorPosY=i.y,y.updateContainerStyle()),null!==(t=y.kanban.config)&&void 0!==t&&t.visibleRightBound){var s,u,c=null===(s=y.kanban.config)||void 0===s?void 0:s.visibleRightBound,b=(null===(u=y.containerRef)||void 0===u?void 0:u.offsetWidth)||0;y.editorPosX+b>c&&(y.editorPosX=c-b,y.updateContainerStyle())}return!1},y.autoFocus=function(e){if(!y.disableMouseDownBlur){for(var t=e.target;t;){var i,n;if(t===y.containerRef||y.exceptElement(t))return void(null===(i=y.editorRef)||void 0===i||null===(n=i.focus)||void 0===n||n.call(i));t=t.parentElement}y.checkIgnoreMousedown(e)||y.exitEdit()}},y.toggleEnableMousedownToBlur=function(e){y.disableMouseDownBlur=e},y.exitEdit=function(){var e=0<arguments.length&&void 0!==arguments[0]&&arguments[0],t=y.props,i=t.renderer,n=t.tableId,r=t.EditContainerType;i.eventManager.emit(C.ay.ExitKanbanCardTitleEdit),i.endEdit(n),y.editorRef&&y.editorRef.onEndEdit(e),r===C.YJ.NEW_CARD?(y.kanban.dataSource.endEditCard(),y.kanban.rebuild()):r===C.YJ.RENAME&&y.kanban.events.emit(C.rC.KanbanGroupEndEdit),y.props.onExitEdit()},y.updateFaster=function(){var e=y.props,t=e.recordId,i=e.EditContainerType,n=e.trigger,r=e.isDocBlock,a=y.containerRef.offsetHeight;i===C.YJ.NEW_CARD&&(y.kanban.dataSource.updateEditingCard(t,a,n),y.kanban.rebuild(),r||y.revealRecord())},y.updateContainerStyle=function(){var e=Object(C.Cx)(y),t=e.containerRef,i=e.editorPosX,n=e.editorPosY,r=y.props,a=r.editable,o=r.EditContainerType,d=r.groupFieldType,l=r.renameSource;if(t){var s=y.calcWidth(l,d,o);if(0===i&&0===n||!a)t.setAttribute("style","width:".concat(s,"px;visibility:hidden;"));else{var u="width:".concat(s,"px;visibility:visible;left:").concat(i,"px;top:").concat(n,"px;");t.setAttribute("style",u)}}},y.executeEditSingleSelectGroupCommand=function(e){y.executeRenameGroupCommand({groupValue:e.value,color:e.color})},y.executeRenameGroupCommand=function(e){var t=y.props,i=t.bitableStore,n=t.renameSource,r=t.tableId,a=t.viewId,o=i.getCommandManager(),d=i.base.getTableById(r),l=y.view.getGroupField();if(d&&l){var s,u=l.id,c=d.fields[u];if(!Object(C.fJ)(c)){if(n===C.cK.NEW_GROUP)s=o.execute(Object.assign({cmd:C.Fy.KanbanAddGroup,tableId:r,viewId:a,fieldId:c.id},e));else if(n===C.cK.RENAME){var b,v;s=null===(b=(v=y.props).onKanbanGroupEdit)||void 0===b?void 0:b.call(v,c.id,e)}return s&&s.result===C.Ey.Success&&(y.props.collectFieldUpdateOptionEvent(),console.log("success")),s}}},y.onMultiChange=function(e){var t=e.id,i=e.userData,n=y.props,r=n.bitableStore,a=n.renderer;if(y.view.getGroups().map(function(e){return e.key}).includes(t))a.activeBitableWidget.getActiveWidget().revealList(t),C.ob.Toast.show({type:"info",content:m("bitable.kanban.duplicate_group_user"),duration:3e3});else{var o=y.executeRenameGroupCommand({groupValue:i.userId,userData:i});o&&o.result===C.Ey.Success&&(y.props.collectFieldUpdateOptionEvent(),r.base.getUserItemById(t)||r.base.setUserItem(i,!0))}y.exitEdit(!1)},y.renderEditor=function(){var e=y.primaryField.type,t=y.state.groupValue,i=y.props,n=i.tableId,r=i.viewId,a=i.bitableStore,o=i.renderer,d=i.editable,l=i.recordId,s=i.EditContainerType,u=i.collectFieldUpdateOptionEvent,c=i.groupFieldType,b=i.renameSource,v=i.isFullScreenMode,p=y.view.getGroupField();if(!p)return null;var f={ref:y.setEditorRef,tableId:n,viewId:r,bitableStore:a,renderer:o,style:{},editable:d,placeholder:m("common.enter_placeholder"),onChange:y.handleEditorChange,executeAction:a.executeCommandImmediately,cardSyncMode:C.ob.config.cardSyncMode||C.tx.RealTime,copyable:o.isCopyable()},E={recordId:l,fieldId:y.primaryField.id,field:y.primaryField,value:null,rect:null},g={ref:y.setEditorRef,bitableStore:a,tableId:n,viewId:r,fieldId:p.id,groupValue:t||"",placeholder:m("bitable.placeholder_enter_title"),style:{fontSize:"14px",height:"24px"},editable:d,submitRename:u,onChange:y.handleEditorChange,executeAction:a.executeCommandImmediately,renameSource:b,exitEdit:y.exitEdit};if(s===C.YJ.NEW_CARD){var h=C.sy.instance.get(e);if(h.supportKanbanValueEditor)return h.renderValueEditor(Object.assign({},E,{},f,{editorContainerId:Object(C.VJ)(Boolean(v),n),isOpen:!0}))}else if(s===C.YJ.RENAME)return C.sy.instance.get(c).renderGroupHeaderEditor(Object.assign({},g,{viewType:C.az.Kanban,renderer:o,defaultInputValue:y.getGroupNameBySelectedField(),view:y.view,executeCommand:y.executeEditSingleSelectGroupCommand,onMultiChange:y.onMultiChange,toggleEnableMousedownToBlur:y.toggleEnableMousedownToBlur}));return null};var t=e.bitableStore,i=e.viewId,n=e.tableId,r=e.renderer,a=t.base;return y.table=a.getTableById(n),y.view=y.table&&y.table.getViewById(i),y.primaryField=y.view.table.getPrimaryField(),y.kanban=r.activeBitableWidget.getKanbanWidget(),y.state={fieldType:y.primaryField.type,groupValue:e.groupValue},y}return Object(C.bu)(d,o),Object(C.Pw)(d,[{key:"componentDidMount",value:function(){var e=this,t=this.props.EditContainerType;if(this.bindEvents(),this.updateFaster(),t===C.YJ.NEW_CARD&&this.revealRecord(),this.resizeObserver=new a.a(function(){e.updateFaster()}),this.resizeObserver.observe(this.containerRef),this.bindDataSource(),t===C.YJ.NEW_CARD)if(this.editorRef){var i=this.table.getCellValue(this.props.recordId,this.primaryField.id);this.editorRef.setEditorValue(i)}else this.needSetEditorValue=!0;this.updateEditorPosition(),setTimeout(function(){e.startEdit()},0)}},{key:"UNSAFE_componentWillReceiveProps",value:function(e){e.fieldMap!==this.props.fieldMap&&(this.primaryField=this.view.table.getPrimaryField())}},{key:"componentDidUpdate",value:function(){!1===this.props.editable?this.exitEdit(!0):this.editorRef&&this.editorRef.focus()}},{key:"componentWillUnmount",value:function(){this.unbindEvents(),this.resizeObserver.disconnect(),this.props.EditContainerType===C.YJ.NEW_CARD?this.dataSource.destroyed():this.kanban.events.emit(C.rC.KanbanGroupEndEdit),this.exitEdit(!0)}},{key:"getGroupNameBySelectedField",value:function(){var e=this.view.getGroupField();if(this.table&&e){var t=e.id,i=this.table.fields[t];if(i.type===C.og.SingleSelect||i.type===C.og.MultiSelect)return Object(C.dK)(this.state.groupValue||"",i)}return null}},{key:"exceptElement",value:function(e){var t=this.props.EditContainerType;return this.primaryField.type===C.og.DateTime&&e.className===c.a||!!(t===C.YJ.RENAME&&e.className.indexOf&&-1<e.className.indexOf("bitable-swatches"))||this.primaryField.type===C.og.Text&&(!(t!==C.YJ.NEW_CARD||!this.editorRef.isMentionBoxVisible())||!(!e||!Object(i.a)(e.className)||-1===e.className.indexOf("atuser-share-popover")))}},{key:"checkIgnoreMousedown",value:function(e){var t=this.kanban.getCardListMap();if(!t)return!1;var i,n=Object(C.WB)(t);try{for(n.s();!(i=n.n()).done;){var r=Object(C.xz)(i.value,2);if(r[0],r[1].isPointInFooterAddBtn(e.clientX,e.clientY))return!0}}catch(e){n.e(e)}finally{n.f()}return!1}},{key:"revealRecord",value:function(){this.kanban.revealRecord(this.props.recordId)}},{key:"calcWidth",value:function(e,t,i){return i===C.YJ.NEW_CARD?C.IE.cardWidth:e!==C.cK.RENAME||t!==C.og.MultiSelect&&t!==C.og.SingleSelect?C.eK:b}},{key:"render",value:function(){var e=this.props,t=e.EditContainerType,i=e.tableId,n=e.hiddenEditor,r=e.isFullScreenMode,a=this.view.getGroupField();if(!a)return null;var o=t===C.YJ.RENAME,d=t===C.YJ.NEW_CARD,l=a.type===C.og.SingleSelect||a.type===C.og.MultiSelect;return s.a.createElement("div",{id:Object(C.VJ)(Boolean(r),i),className:u()("kanban-new-card-editor",{"rename-group-editor":o,"rename-group-editor-text":o&&l,"kanban-new-card-highlight":d,"kanban-new-card-editor__type-text":d&&this.primaryField.type===C.og.Text,"rename-group-editor-link":o&&Object(C.vy)(a),hidden:n}),ref:this.setContainerRef},this.renderEditor())}}]),d}(s.a.Component)).defaultProps={fieldMap:{}},e=t))||e)||e}.call(this,p("vb163"))},vb394:function(e,t,i){"use strict";i.d(t,"a",function(){return r}),i.d(t,"b",function(){return n}),i.d(t,"c",function(){return o}),i.d(t,"d",function(){return d}),i.d(t,"e",function(){return a}),i.d(t,"f",function(){return l});var n="".concat("bitable-5a92a9","__date-time-editor"),r="".concat("bitable-5a92a9","__calendar"),a=252,o=500,d=230,l=5}}]);
//# sourceMappingURL=//slardar.bytedance.net/api_v2/browser/jserr/get_sourcemap?bid=docs_pc&js_filename=642e92efb794.bcd23c7a78.chunk.js