(window.webpackJsonp=window.webpackJsonp||[]).push([["e439cf6f857d"],{vb961:function(e,X,Y){"use strict";Y.r(X),function(I){Y.d(X,"C",function(){return f}),Y.d(X,"a",function(){return W}),Y.d(X,"c",function(){return U}),Y.d(X,"g",function(){return q});var e,T=Y("vb143"),t=Y("vb152"),m=Y.n(t),i=Y("vb180"),b=Y("vb103"),R=Y.n(b),a=Y("vb194"),k=Y("vb489"),x=(Y("vb147"),Y("vb148"),Y("vb112"),Y("vb164"),Y("vb167"),Y("vb113"),Y("vb155"),Y("vb119"),Y("vb116"),Y("vb118"),Y("vb120"),Y("vb174"),Y("vb121"),Y("vb117"),Y("vb111")),o=(Y("vb126"),Y("vb125"),Y("vb159")),M=Y.n(o),n=Y("vb114"),s=Y("vb412"),g=Y("vb2210"),C=Y("vb1284"),d=Y("vb2195"),w=Y("vb490"),c=Y("vb319"),h=Y("vb326"),p=Y("vb590"),r=Y("vb123"),l=T.rx.isMac,O=l?"âŒ˜":"Ctrl",E=l?"Option":"Alt",_="[",S="]",F=(Object(T.Ww)(e={},T.rz.Warning,I("Bitable_Relation_NewRecordNotMeetCondition_Web")),Object(T.Ww)(e,T.rz.Info,I("bitable.card_modal.filter_tip")),e),u=function(r){function i(){var e;Object(T.ov)(this,i);for(var t=arguments.length,o=new Array(t),n=0;n<t;n++)o[n]=arguments[n];return(e=r.call.apply(r,[this].concat(o))||this).collectCardClickEvent=function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},o=2<arguments.length&&void 0!==arguments[2]?arguments[2]:T.oz;T.cz.collectBitableEvent(T.Bc.CcmBitableCardClick,Object.assign({click:e,target:o},t))},e.onClickJumpTable=function(){e.collectCardClickEvent(T.py.Relate,{},T.Rw.CcmBitableContentPageView),e.props.onClose()},e}return Object(T.bu)(i,r),Object(T.Pw)(i,[{key:"renderJumpTable",value:function(){return this.props.source!==T.sz.Link||this.props.bitableStore.isEmbedded?null:R.a.createElement("div",{className:"card-modal-jump-wrapper"},R.a.createElement(T.ix,{name:I("Bitable_Relation_RecordFrom"),className:"bitable-layout-row bitable-layout-cross-center"},R.a.createElement(s.a,{renderer:this.props.renderer,bitableStore:this.props.bitableStore,tableId:this.props.tableId,onClick:this.onClickJumpTable,showJumpTableName:!0})))}},{key:"render",value:function(){var o=this,e=this.props,t=e.bitableStore,n=e.isBitableReady,r=e.headerTitle,i=e.switchCard,a=e.cardOrderInfo,s=e.setHideFilterTip,d=e.showTip,c=e.onClose,l=e.noticeIconType,u=void 0===l?T.rz.Info:l,b=t.getMountSource(),h=Object(w.b)(b),p=!!a.preRecordId&&(n||!h),m=!!a.nextRecordId&&(n||!h),f=function(t){return function(){if(o.collectCardClickEvent(t),t===T.py.PreviousRecord?p:m){var e=t===T.py.PreviousRecord?"pre":"next";i(e)}}},v=R.a.createElement("div",{className:"card-edit-modal-header-icon"},R.a.createElement(g.a,{onClick:f(T.py.PreviousRecord),className:M()("card-edit-modal-header-arrow",Object(T.Ww)({},"disabled",!p))})),y=R.a.createElement("div",{className:"card-edit-modal-header-icon"},R.a.createElement(g.a,{onClick:f(T.py.NextRecord),className:M()("card-edit-modal-header-arrow card-edit-modal-header-rightArrow",Object(T.Ww)({},"disabled",!m))}));return R.a.createElement("div",{className:"card-edit-modal-header"},R.a.createElement("div",{className:"bitable-layout-row bitable-layout-cross-center"},R.a.createElement("div",{className:"bitable-flex card-edit-modal-header-title"},r),m?R.a.createElement(x.Tooltip,{title:I("bitable.card_modal.next")+"( ".concat(O,"+").concat(E,"+").concat(S," )"),placement:"top"},y):!n&&h?R.a.createElement(x.Tooltip,{title:I("Bitable_Common_Table_Loading"),placement:"top"},y):y,p?R.a.createElement(x.Tooltip,{title:I("bitable.card_modal.pre")+"( ".concat(O,"+").concat(E,"+").concat(_," )"),placement:"top"},v):!n&&h?R.a.createElement(x.Tooltip,{title:I("Bitable_Common_Table_Loading"),placement:"top"},v):v,R.a.createElement(x.Tooltip,{title:I("bitable.card_modal.close"),placement:"top"},R.a.createElement("div",null,R.a.createElement(C.a,{className:"card-edit-modal-header-magnify",onClick:function(){o.collectCardClickEvent(T.py.CloseRecord),c()}})))),d?R.a.createElement("div",{className:"card-modal-filter-tip"},R.a.createElement(x.Notice,{showIcon:!0,closable:!0,align:"center",type:u,message:F[u],onClose:function(){return s(!0)}})):null,this.renderJumpTable())}}]),i}(R.a.PureComponent),f=Object(n.connect)(function(e){return{isBitableReady:Object(T.tz)(e)}})(u);!function(){if("object"===("undefined"==typeof window?"undefined":Object(T.uz)(window)))if("IntersectionObserver"in window&&"IntersectionObserverEntry"in window&&"intersectionRatio"in window.IntersectionObserverEntry.prototype)"isIntersecting"in window.IntersectionObserverEntry.prototype||Object.defineProperty(window.IntersectionObserverEntry.prototype,"isIntersecting",{get:function(){return 0<this.intersectionRatio}});else{var s=window.document;e.prototype.THROTTLE_TIMEOUT=100,e.prototype.POLL_INTERVAL=null,e.prototype.USE_MUTATION_OBSERVER=!0,e.prototype.observe=function(t){if(!this._observationTargets.some(function(e){return e.element==t})){if(!t||1!=t.nodeType)throw new Error("target must be an Element");this._registerInstance(),this._observationTargets.push({element:t,entry:null}),this._monitorIntersections(),this._checkForIntersections()}},e.prototype.unobserve=function(t){this._observationTargets=this._observationTargets.filter(function(e){return e.element!=t}),this._observationTargets.length||(this._unmonitorIntersections(),this._unregisterInstance())},e.prototype.disconnect=function(){this._observationTargets=[],this._unmonitorIntersections(),this._unregisterInstance()},e.prototype.takeRecords=function(){var e=this._queuedEntries.slice();return this._queuedEntries=[],e},e.prototype._initThresholds=function(e){var t=e||[0];return Array.isArray(t)||(t=[t]),t.sort().filter(function(e,t,o){if("number"!=typeof e||isNaN(e)||e<0||1<e)throw new Error("threshold must be a number between 0 and 1 inclusively");return e!==o[t-1]})},e.prototype._parseRootMargin=function(e){var t=(e||"0px").split(/\s+/).map(function(e){var t=/^(-?\d*\.?\d+)(px|%)$/.exec(e);if(!t)throw new Error("rootMargin must be specified in pixels or percent");return{value:parseFloat(t[1]),unit:t[2]}});return t[1]=t[1]||t[0],t[2]=t[2]||t[0],t[3]=t[3]||t[1],t},e.prototype._monitorIntersections=function(){this._monitoringIntersections||(this._monitoringIntersections=!0,this.POLL_INTERVAL?this._monitoringInterval=setInterval(this._checkForIntersections,this.POLL_INTERVAL):(t(window,"resize",this._checkForIntersections,!0),t(s,"scroll",this._checkForIntersections,!0),this.USE_MUTATION_OBSERVER&&"MutationObserver"in window&&(this._domObserver=new MutationObserver(this._checkForIntersections),this._domObserver.observe(s,{attributes:!0,childList:!0,characterData:!0,subtree:!0}))))},e.prototype._unmonitorIntersections=function(){this._monitoringIntersections&&(this._monitoringIntersections=!1,clearInterval(this._monitoringInterval),this._monitoringInterval=null,o(window,"resize",this._checkForIntersections,!0),o(s,"scroll",this._checkForIntersections,!0),this._domObserver&&(this._domObserver.disconnect(),this._domObserver=null))},e.prototype._checkForIntersections=function(){var s=this._rootIsInDom(),d=s?this._getRootRect():i();this._observationTargets.forEach(function(e){var t=e.element,o=u(t),n=this._rootContainsTarget(t),r=e.entry,i=s&&n&&this._computeTargetAndRootIntersection(t,d),a=e.entry=new c({time:l(),target:t,boundingClientRect:o,rootBounds:d,intersectionRect:i});r?s&&n?this._hasCrossedThreshold(r,a)&&this._queuedEntries.push(a):r&&r.isIntersecting&&this._queuedEntries.push(a):this._queuedEntries.push(a)},this),this._queuedEntries.length&&this._callback(this.takeRecords(),this)},e.prototype._computeTargetAndRootIntersection=function(e,t){if("none"!=window.getComputedStyle(e).display){for(var o=u(e),n=b(e),r=!1;!r;){var i=null,a=1==n.nodeType?window.getComputedStyle(n):{};if("none"==a.display)return;if(n==this.root||n==s?(r=!0,i=t):n!=s.body&&n!=s.documentElement&&"visible"!=a.overflow&&(i=u(n)),i&&!(o=d(i,o)))break;n=b(n)}return o}},e.prototype._getRootRect=function(){var e;if(this.root)e=u(this.root);else{var t=s.documentElement,o=s.body;e={top:0,left:0,right:t.clientWidth||o.clientWidth,width:t.clientWidth||o.clientWidth,bottom:t.clientHeight||o.clientHeight,height:t.clientHeight||o.clientHeight}}return this._expandRectByRootMargin(e)},e.prototype._expandRectByRootMargin=function(o){var e=this._rootMarginValues.map(function(e,t){return"px"==e.unit?e.value:e.value*(t%2?o.width:o.height)/100}),t={top:o.top-e[0],right:o.right+e[1],bottom:o.bottom+e[2],left:o.left-e[3]};return t.width=t.right-t.left,t.height=t.bottom-t.top,t},e.prototype._hasCrossedThreshold=function(e,t){var o=e&&e.isIntersecting?e.intersectionRatio||0:-1,n=t.isIntersecting?t.intersectionRatio||0:-1;if(o!==n)for(var r=0;r<this.thresholds.length;r++){var i=this.thresholds[r];if(i==o||i==n||i<o!=i<n)return!0}},e.prototype._rootIsInDom=function(){return!this.root||r(s,this.root)},e.prototype._rootContainsTarget=function(e){return r(this.root||s,e)},e.prototype._registerInstance=function(){},e.prototype._unregisterInstance=function(){},window.IntersectionObserver=e,window.IntersectionObserverEntry=c}function c(e){this.time=e.time,this.target=e.target,this.rootBounds=e.rootBounds,this.boundingClientRect=e.boundingClientRect,this.intersectionRect=e.intersectionRect||i(),this.isIntersecting=!!e.intersectionRect;var t=this.boundingClientRect,o=t.width*t.height,n=this.intersectionRect,r=n.width*n.height;this.intersectionRatio=o?Number((r/o).toFixed(4)):this.isIntersecting?1:0}function e(e,t){var o=t||{};if("function"!=typeof e)throw new Error("callback must be a function");if(o.root&&1!=o.root.nodeType)throw new Error("root must be an Element");this._checkForIntersections=n(this._checkForIntersections.bind(this),this.THROTTLE_TIMEOUT),this._callback=e,this._observationTargets=[],this._queuedEntries=[],this._rootMarginValues=this._parseRootMargin(o.rootMargin),this.thresholds=this._initThresholds(o.threshold),this.root=o.root||null,this.rootMargin=this._rootMarginValues.map(function(e){return e.value+e.unit}).join(" ")}function l(){return window.performance&&performance.now&&performance.now()}function n(e,t){var o=null;return function(){o||(o=setTimeout(function(){e(),o=null},t))}}function t(e,t,o,n){"function"==typeof e.addEventListener?e.addEventListener(t,o,n||!1):"function"==typeof e.attachEvent&&e.attachEvent("on"+t,o)}function o(e,t,o,n){"function"==typeof e.removeEventListener?e.removeEventListener(t,o,n||!1):"function"==typeof e.detatchEvent&&e.detatchEvent("on"+t,o)}function d(e,t){var o=Math.max(e.top,t.top),n=Math.min(e.bottom,t.bottom),r=Math.max(e.left,t.left),i=Math.min(e.right,t.right),a=i-r,s=n-o;return 0<=a&&0<=s&&{top:o,bottom:n,left:r,right:i,width:a,height:s}}function u(e){var t;try{t=e.getBoundingClientRect()}catch(e){}return t?(t.width&&t.height||(t={top:t.top,right:t.right,bottom:t.bottom,left:t.left,width:t.right-t.left,height:t.bottom-t.top}),t):i()}function i(){return{top:0,bottom:0,left:0,right:0,width:0,height:0}}function r(e,t){for(var o=t;o;){if(o==e)return!0;o=b(o)}return!1}function b(e){var t=e.parentNode;return t&&11===t.nodeType&&t.host?t.host:t&&t.assignedSlot?t.assignedSlot.parentNode:t}}();var v,y,B=".J-card-edit-modal-body",N=56;(y=v||(v={})).HIDE="HIDE",y.TO_COMMENT="TO_COMMENT",y.TO_TOP="TO_TOP";var j,V,z,H,D=function(n){function r(){var c;Object(T.ov)(this,r);for(var e=arguments.length,t=new Array(e),o=0;o<e;o++)t[o]=arguments[o];return(c=n.call.apply(n,[this].concat(t))||this).state={btnState:v.HIDE},c._io=null,c._mo=null,c._cardNode=null,c._isIntersecting=!1,c.bindEvents=function(){c._cardNode&&c.props.commentNode&&(c._io=new IntersectionObserver(c.handleIntersectionObserver,{root:c._cardNode,rootMargin:"0px 0px -10px 0px",threshold:0}),c._mo=new MutationObserver(c.handleMutationObserver),c._io.observe(c.props.commentNode),c._mo.observe(c._cardNode,{childList:!0,subtree:!0}))},c.unBindEvents=function(){c._io&&c._io.disconnect(),c._mo&&c._mo.disconnect()},c.handleIntersectionObserver=function(e){e.forEach(function(e){c.state.btnState!==v.HIDE&&(c.setState({btnState:e.isIntersecting?v.TO_TOP:v.TO_COMMENT}),c._isIntersecting=!0)})},c.handleMutationObserver=function(e){c._isIntersecting?c._isIntersecting=!1:c.checkBtnState()},c.checkBtnState=function(){if(c._cardNode&&c.props.commentNode){var e=c._cardNode.clientHeight,t=c._cardNode.scrollTop,o=c.props.commentNode.offsetTop;o-e<=0?c.setState({btnState:v.HIDE}):t+e<o?c.setState({btnState:v.TO_COMMENT}):c.setState({btnState:v.TO_TOP})}},c.handleClick=function(){var e=c.state.btnState,t=c.props,o=t.recordId,n=t.tableId;if(c.props.commentNode&&c._cardNode&&e!==v.HIDE){var r,i=e===v.TO_COMMENT,a=i?c.scrollToComment:c.scrollToTop,s=i?v.TO_TOP:v.TO_COMMENT;c.setState({btnState:s},a),T.ob.collectBitableEvent(T.On.BitableRecordComment,{mode:c.props.isFullScreen?"full_screen":"defalut",action:i?T.vz.JumpRecordComment:T.vz.ReturnRecordContent,record_id:o,table_id:n});var d=T.oz;e===v.TO_COMMENT?(r=T.py.ViewComments,d=T.Rw.CcmCommentView):r=T.py.Back,T.cz.collectBitableEvent(T.Bc.CcmBitableCardClick,{click:r,target:d})}},c.scrollToComment=function(){if(c.props.commentNode&&c._cardNode){var e={top:c.props.commentNode.offsetTop-N};c._cardNode.scrollTo(e),c._isIntersecting=!0}},c.scrollToTop=function(){if(c.props.commentNode&&c._cardNode){var e={top:0};c._cardNode.scrollTo(e),c._isIntersecting=!0}},c}return Object(T.bu)(r,n),Object(T.Pw)(r,[{key:"componentDidMount",value:function(){this._cardNode=Object(c.a)(document.querySelectorAll(B)),this.bindEvents()}},{key:"componentDidUpdate",value:function(e){e.commentNode!==this.props.commentNode&&(this.unBindEvents(),this.bindEvents(),this.checkBtnState())}},{key:"componentWillUnmount",value:function(){this.unBindEvents(),this._io=null,this._mo=null,this._cardNode=null}},{key:"showBtn",get:function(){return this.state.btnState!==v.HIDE}},{key:"render",value:function(){if(!this.showBtn)return null;var e=this.state.btnState,t=e===v.TO_COMMENT?R.a.createElement(d.a,null):R.a.createElement(g.a,{style:{transform:"rotate(90deg)"}}),o=e===v.TO_COMMENT?I("bitable.card_goto_comment"):I("bitable.card_goto_top");return R.a.createElement("div",{className:"card-modal__back-btn",onClick:this.handleClick},R.a.createElement(x.Tooltip,{title:o,placement:"left"},R.a.createElement("span",{className:"card-modal__icon-box"},t)))}}]),r}(b.Component);function P(e){return e.cmd===T.Fy.SetRecord}function L(e){var t=[];return e.children?e.children.forEach(function(e){t=[].concat(Object(T.hI)(t),Object(T.hI)(L(e)))}):t=e.records,t}function W(e,t,o,n,i,r){var a=t.base.getTableById(e);if(!a)return{recordInfo:[],recordShowInfo:[],recordHideInfo:[]};var s=a.getViewById(n),d=[];o||0!==r.length?d=r:(!s&&a.views.length&&(s=a.getViewById(a.views[0].id)),d=s?s.getAllFieldsWithoutDenied():[]);var c=[],l=[],u=[],b=s&&s.getVisibleFields();return d.forEach(function(e,t){if(!a.isDeniedField(e)){var o=a.getCellValue(i,e),n=a.fields[e];if(n){var r={fieldId:e,type:n.type,cell:{recordId:i,fieldId:e,rect:null,field:n,value:o}};b&&!b.includes(e)?u.push(r):l.push(r),c.push(r)}}}),{recordInfo:c,recordShowInfo:l,recordHideInfo:u}}function q(e){var t=e.tableId,o=e.bitableStore,n=e.viewId,r=e.recordId,i=e.switchRecords,a=void 0===i?[]:i,s=e.field,d=e.isAddRecord,c={preRecordId:null,nextRecordId:null,curFieldIdIndex:-1},l=o.base.getTableById(t),u=null==l?void 0:l.getViewById(n);if(!l||u&&!u.isValid())return c.curFieldIdIndex=0,c;var b=[];if(0<a.length&&!d)b=a;else if(s)b=s.getLinkTableRecords();else if(u&&u.type===T.az.Kanban)if(u.isValid()){var h,p=u.getGroupedRecords(),m=Object(T.WB)(p);try{for(m.s();!(h=m.n()).done;){var f=Object(T.xz)(h.value,2),v=f[0],y=f[1];b=v!==T.wz?b.concat(y):[].concat(Object(T.hI)(y),Object(T.hI)(b))}}catch(e){m.e(e)}finally{m.f()}}else b=u.getVisibleRecords();else!u||u.type!==T.az.Grid&&u.type!==T.az.Gantt?u&&u.type===T.az.Gallery&&(b=u.getVisibleRecords()):u.getGroupFields().length?u.getGroupRecords().forEach(function(e){b=b.concat(L(e))}):b=u.getVisibleRecords();var I=b.indexOf(r);return d?c.preRecordId=c.nextRecordId=null:(c.preRecordId=0===I||-1===I?null:b[I-1],c.nextRecordId=I===b.length-1||-1===I?null:b[I+1]),c.curFieldIdIndex=I,c}var J=(j=Object(n.connect)(function(e,t){var o=t.tableId,n=Object(T.wy)(e,o),r=Object(T.xy)(e),i=!Object(T.yy)(r);return{fieldList:Object(T.zy)(e,o),fromMention:!!n&&n.fromMention,isPureBitable:Object(T.Ay)(e),isCommentDataInit:Object(T.By)(e),isReadyOrCanEdit:i,isBitableReady:Object(T.tz)(e)}},function(i){return{toggleEditorInCardEdit:function(e,t,o,n,r){i(Object(T.Cy)(e,t,o,n,!1,r))}}}),V=Object(r.Bind)(),j((H=function(n){function r(){var p;Object(T.ov)(this,r);for(var e=arguments.length,t=new Array(e),o=0;o<e;o++)t[o]=arguments[o];return(p=n.call.apply(n,[this].concat(t))||this).state={height:window.document.documentElement.clientHeight*T.px,hideFilterTip:!1,disableClick:!0,disableAutoFocus:!0,modalScrollTop:0,modalOffsetHeight:790,modalHiddenFieldOffset:0},p.resizeObserver=null,p.modalBody=null,p.cardEdit=null,p.dialogDom=null,p.fromMention=!1,p.commentRef=null,p.actions=[],p.handleModalScroll=Object(i.a)(function(){if(p.modalBody){var e=p.modalBody.scrollTop;if(e!==p.state.modalScrollTop){var t=p.modalBody.querySelector(".card_edit_hide_toggle");p.setState({modalScrollTop:e,modalHiddenFieldOffset:t?t.offsetTop+T.qx:0})}}},250),p.onWindowResize=Object(i.a)(function(){p.setState({height:document.documentElement.clientHeight*T.px})},500),p.bindCopyCutEvent=function(){var e=p.props.renderer;p.modalBody&&(p.modalBody.addEventListener("copy",e.clipboardHelper.handleCopyCut,!0),p.modalBody.addEventListener("cut",e.clipboardHelper.handleCopyCut,!0))},p.unbindCopyCutEvent=function(){var e=p.props.renderer;p.modalBody&&(p.modalBody.removeEventListener("copy",e.clipboardHelper.handleCopyCut,!0),p.modalBody.removeEventListener("cut",e.clipboardHelper.handleCopyCut,!0))},p.getVCFollowId=function(){var e=p.props,t=e.tableId,o=e.bitableStore.isEmbeddedInDoc,n=e.isFullScreenMode;return o?t+(n?":fullscreen":""):""},p.openVCFollow=Object(T.uY)(m.a.mark(function e(){return m.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,p.props.renderer.getActiveBitableWidgetByPromise();case 2:Object(T.Fx)(T.Gx.BitableCardModel,p.replayVCFollowState,{instanceId:p.getVCFollowId()}),p.sendVCStateChange(p.getVCFollowState());case 4:case"end":return e.stop()}},e)})),p.closeVCFollow=function(){var e=p.props,t=e.tableId,o=e.viewId,n=e.recordId,r=e.isFullScreenMode;p.sendVCStateChange({openStatus:T.Dy.Close,tableId:t,recordId:n,viewId:o,isFullScreen:!!r}),Object(T.Hx)(T.Gx.BitableCardModel,p.replayVCFollowState,{instanceId:p.getVCFollowId()})},p.getVCFollowState=function(){var e=p.props,t=e.tableId,o=e.viewId,n=e.recordId,r=e.fieldId,i=e.modalVisible,a=e.isFullScreenMode;return{openStatus:i?T.Dy.Open:T.Dy.Close,tableId:t,viewId:o,recordId:n,fieldId:r,isFullScreen:!!a}},p.sendVCStateChange=function(e){var t=p.props,o=t.bitableStore;if(t.isVCEnable){var n=o.isEmbeddedInDoc;Object(T.Ix)(T.Gx.BitableCardModel,e,{config:{isUpdatePresenterPosition:!n},instanceId:p.getVCFollowId()})}},p.disconnectObserver=function(){p.resizeObserver&&(p.modalBody&&p.resizeObserver.unobserve(p.modalBody),p.resizeObserver.disconnect(),p.resizeObserver=null)},p.setModalBodyRef=function(e){p.modalBody=e,p.onScrollHandler&&p.onScrollHandler(e)},p.observeModalHeight=function(){if(p.modalBody){var e=p.modalBody.offsetHeight;if(e!==p.state.modalOffsetHeight){var t=p.modalBody.querySelector(".card_edit_hide_toggle");p.setState({modalOffsetHeight:e,modalHiddenFieldOffset:t?t.offsetTop+T.qx:0})}}},p.updateRecord=function(e){null==e&&p.props.modalVisible&&p.onCardModalClose()},p.onOk=Object(T.uY)(m.a.mark(function e(){var t,o;return m.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,p.applyActions();case 2:if(t=e.sent,!(o=p.props).onSubmit){e.next=10;break}return e.next=7,o.onSubmit(o.recordId,t);case 7:p.showTipIfFilteredOut(o),e.next=12;break;case 10:p.setRecord(t),p.onCardModalClose();case 12:case"end":return e.stop()}},e)})),p.afterShow=function(){p.props.modalVisible&&(Object(T.Dx)()&&p.props.isVCEnable?p.setState({disableAutoFocus:!0,disableClick:!1}):p.setState({disableAutoFocus:!1,disableClick:!1}),p.bindKeydown()),p.modalBody&&!p.resizeObserver&&(p.resizeObserver=new a.a(p.observeModalHeight),p.resizeObserver.observe(p.modalBody))},p.onCardModalClose=function(){var e=p.props,t=e.onClose,o=e.afterClose;t(),p.unbindKeydown(),"function"==typeof o&&setTimeout(o,0)},p.onCancel=function(e){var t,o=Object(T.WB)(p.actions);try{for(o.s();!(t=o.n()).done;){var n=t.value;n.onResponse&&n.onResponse({result:T.Ey.None})}}catch(e){o.e(e)}finally{o.f()}p.actions=[],p.onCardModalClose(),p.disconnectObserver(),p.setState({disableAutoFocus:!0,disableClick:!0}),null==e||e.preventDefault(),e&&e.keyCode===T.sx.Esc&&e.stopPropagation()},p.receiveAction=function(e){return new Promise(function(t){p.actions.push({getOptions:e,onResponse:function(e){return t(e)}})})},p.applyActions=Object(T.uY)(m.a.mark(function e(){var t,o,n,r,i,a,s,d,c,l,u,b,h;return m.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:t=p.props,o=t.tableId,n=t.viewId,r={},i=p.props.bitableStore.getCommandManager();case 3:if(a=Object(T.Cx)(p),s=a.actions,p.actions=[],s.length){e.next=7;break}return e.abrupt("break",13);case 7:d=Object(T.WB)(s);try{for(d.s();!(c=d.n()).done;){if(l=c.value,(u=l.getOptions()).tableId=o,u.viewId=n,b={result:T.Ey.None},P(u))for(h in u.data)r[h]=u.data[h];else b=i.execute(u);l.onResponse&&l.onResponse(b)}}catch(e){d.e(e)}finally{d.f()}return e.next=11,Object(T.Gy)();case 11:e.next=3;break;case 13:return e.abrupt("return",r);case 14:case"end":return e.stop()}},e)})),p.switchCard=function(e){var t=p.props,o=t.toggleEditorInCardEdit,n=t.tableId,r=p.cardOrderInfo;"pre"===e?r.preRecordId&&o&&o(n,!0,r.preRecordId,void 0,p.props.source):r.nextRecordId&&o&&o(n,!0,r.nextRecordId,void 0,p.props.source)},p.setHideFilterTip=function(e){p.setState({hideFilterTip:e})},p.getCommentRef=function(e){p.commentRef=e},p.addOnScrollHandler=function(e){p.onScrollHandler=e},p.setCardEditRef=function(e){p.cardEdit=e},p.setDialogRef=function(e){p.dialogDom=e},p.handleKeydown=function(e){var t;if(p.props.modalVisible&&!e.ignoreKeybinding&&(e.keyCode===T.sx.Esc&&(null===(t=p.cardEdit)||void 0===t||t.handleClose()),p.props.isBitableReady)){var o=e.altKey,n=e.keyCode,r=e.metaKey,i=e.ctrlKey,a=p.props.switchCard,s=void 0===a?p.switchCard:a;if(T.rx.mac||T.rx.isIPad){var d=[r,i];i=d[0],r=d[1]}var c=o&&i&&n===T.sx.BracketLeft,l=o&&i&&n===T.sx.BracketRight;c&&(s&&s("pre"),T.cz.collectClickEvent(T.Bc.CcmBitableShortcutClick,{click:"previous_record"})),l&&(s&&s("next"),T.cz.collectClickEvent(T.Bc.CcmBitableShortcutClick,{click:"next_record"}))}},p}return Object(T.bu)(r,n),Object(T.Pw)(r,[{key:"componentDidMount",value:function(){window.addEventListener("resize",this.onWindowResize),this.fromMention=this.props.fromMention,this.openVCFollow(),this.firstCreateOnboardingCollectEvent(),this.props.modalVisible&&Object(T.Hy)(),this.bindCopyCutEvent()}},{key:"UNSAFE_componentWillReceiveProps",value:function(e){e.modalVisible&&!this.props.modalVisible&&e.cardSyncMode!==T.tx.OnDemand&&(this.bindAxisSource(e),Object(T.Iy)(T.Jy.EXPEND_RECORD),Object(T.Hy)()),!e.modalVisible&&this.props.modalVisible?(this.props.cardSyncMode===T.tx.RealTime&&this.showTipIfFilteredOut(this.props),this.actions=[],this.fromMention=!1,this.setHideFilterTip(!1),Object(T.Ky)(T.Jy.EXPEND_RECORD)):e.recordId!==this.props.recordId&&this.setHideFilterTip(!1)}},{key:"componentDidUpdate",value:function(e){e.recordId===this.props.recordId&&e.fieldId===this.props.fieldId&&e.modalVisible===this.props.modalVisible||this.sendVCStateChange(this.getVCFollowState())}},{key:"componentWillUnmount",value:function(){this.unbindAxisSource(),window.removeEventListener("resize",this.onWindowResize),this.closeVCFollow(),this.disconnectObserver(),this.unbindCopyCutEvent()}},{key:"firstCreateOnboardingCollectEvent",value:function(){var e=this.props,o=e.bitableStore,n=e.renderer;T.Ly.registeMethod(T.Jy.EXPEND_RECORD,{clickCallBack:function(){var e=o.base.blocks[0];if(e instanceof T.My&&e.views[0]instanceof T.Ny){var t=e.views[0].records[0];n.showCardModal({record:t})}}})}},{key:"replayVCFollowState",value:function(e){var t,o=this.props.bitableStore.isEmbeddedInDoc,n=e.data,r=n.tableId,i=n.openStatus,a=n.recordId,s=n.fieldId,d=this.props,c=d.toggleEditorInCardEdit,l=d.bitableStore,u=d.tableId;if((null===(t=e.data[T.Oy])||void 0===t?void 0:t.openStatus)!==T.Dy.Close){if(r!==u)return o?void 0:{status:T.dz.Fail,code:T.ez.SourceTargetIsDiff};if(!r||!l.hasPermission(T.qy.Record,{tableId:r,recordId:a},T.ry.Visible))return{status:T.dz.Ignore,code:r?T.ez.NotPermission:T.ez.NotExist};var b=l.base.getTableById(r),h=null==b?void 0:b.getRecordById(a);return i===T.Dy.Open&&a&&!h?{status:T.dz.Fail,code:T.ez.NotExist}:(c&&r&&c(r,i===T.Dy.Open,a||null,s),{status:T.dz.Success})}c&&u&&c(u,!1,null)}},{key:"showTipIfFilteredOut",value:function(e){var t=e.tableId,o=e.viewId,n=e.recordId,r=e.bitableStore,i=T.ob.config.ui&&T.ob.config.ui.useCardModalFilterTip;n&&!i&&Object(w.c)(r,t,o,n,this.fromMention)}},{key:"bindAxisSource",value:function(e){var t=this,o=e.tableId,n=e.viewId,r=e.recordId,i=e.bitableStore;this.axisSource&&this.axisSource.destroyed(),this.axisSource=new T.Py({type:T.Qy.record,tableId:o,viewId:n,recordId:r},i);var a=this.axisSource.getSource();this.updateRecord(a),this.axisSource.bindUpdate(function(e){t.updateRecord(e)})}},{key:"unbindAxisSource",value:function(){this.axisSource&&this.axisSource.destroyed()}},{key:"setRecord",value:function(e){var t=this.props,o=t.bitableStore,n=t.recordId,r=t.tableId,i=t.viewId;o.getCommandManager().execute({cmd:T.Fy.SetRecord,recordId:n,tableId:r,viewId:i,data:e})}},{key:"renderFooter",value:function(){return R.a.createElement(T.hX,{onCancel:this.onCancel,onSubmit:this.onOk})}},{key:"bindKeydown",value:function(){var e;null===(e=this.dialogDom)||void 0===e||e.addEventListener("keydown",this.handleKeydown)}},{key:"unbindKeydown",value:function(){var e;null===(e=this.dialogDom)||void 0===e||e.removeEventListener("keydown",this.handleKeydown)}},{key:"renderCommentCard",value:function(){var e=this.props,t=e.bitableStore,o=e.smartableCommentManager,n=e.recordId,r=e.renderer,i=e.tableId,a=e.viewId,s=e.isCommentDataInit,d=Object(h.b)(t.bitableConfig)&&s,c=o&&o.getCustomCommentCard(),l=Object(T.Ry)(t),u=t.isEmbeddedInDoc&&r.isFullScreen;return o&&d?R.a.createElement(b.Fragment,null,c?R.a.createElement(c,{bitableStore:t,smartableCommentManager:o,recordId:n,tableId:i,viewId:a,renderer:r,isFullScreen:u,mentionSource:l,getCommentRef:this.getCommentRef,onCommentAdded:function(){return T.cz.collectClickEvent(T.Bc.CcmBitableCardClick,{card_type:"card",click:T.py.AddComment})}}):R.a.createElement(p.a,{bitableStore:t,smartableCommentManager:o,recordId:n,tableId:i,viewId:a,renderer:r,isFullScreen:u,mentionSource:l,getCommentRef:this.getCommentRef}),R.a.createElement(D,{tableId:i,recordId:n,renderer:r,isFullScreen:u,commentNode:this.commentRef})):null}},{key:"renderHeader",value:function(){var e,t=this.props,o=t.tableId,n=t.bitableStore,r=t.viewId,i=t.recordId,a=t.noticeIconType,s=n.base.getTableById(o),d="",c=null==s?void 0:s.getViewById(r),l=null==s?void 0:s.getPrimaryField();if(s&&c&&l){var u=s.getCellValue(i,l.id);d=l.cellValueToString(u)||""}var b=this.state.hideFilterTip,h=!(null===(e=T.ob.config.ui)||void 0===e||!e.useCardModalFilterTip||b||-1!==this.cardOrderInfo.curFieldIdIndex||!1===this.props.showTip),p={switchCard:this.props.switchCard||this.switchCard,headerTitle:d,cardOrderInfo:this.cardOrderInfo,showTip:h,setHideFilterTip:this.setHideFilterTip,onClose:this.onCancel,renderer:this.props.renderer,bitableStore:n,source:this.props.source,tableId:o,noticeIconType:a};return R.a.createElement(f,p)}},{key:"render",value:function(){var e=this.props,t=e.tableId,o=e.viewId,n=e.bitableStore,r=e.forSelfTable,i=e.modalVisible,a=e.recordId,s=e.mask,d=e.marginLeft,c=e.fieldList,l=e.fromMention,u=e.renderer,b=e.isAnonymousAccess,h=e.recordEditable,p=e.fieldEditable,m=e.fieldAddable,f=e.switchRecords,v=e.field,y=e.isAddRecord,I=void 0!==y&&y,g=e.isReadyOrCanEdit,C=n.isEmbeddedInDoc&&u.isFullScreen;if(!i||!c||0===c.length)return null;var w={maxHeight:this.state.height,marginLeft:d||0},O=this.props.cardSyncMode||T.tx.RealTime,E=O===T.tx.OnDemand?this.receiveAction:n.executeCommandImmediately,_=O===T.tx.OnDemand&&h?this.renderFooter():null;this.cardOrderInfo=q({tableId:t,bitableStore:n,forSelfTable:r,viewId:o,recordId:a,switchRecords:f,field:v,isAddRecord:I});var S=W(t,n,r,o,a,c);return R.a.createElement(x.Dialog,{header:this.renderHeader(),closable:!1,visible:i,footer:_,zIndex:100,width:T.ux,style:w,mask:s,wrapClassName:M()({"click-disable":this.state.disableClick}),className:M()({"J-card-edit-modal":!0,"cp-modal-centered":!0,"b-small-scrollbar":!0,"card-readonly":!h,"in-doc-fullscreen":C}),onCancel:this.onCancel,keyboardClosable:!0,onAfterOpen:this.afterShow,ref:this.setDialogRef},R.a.createElement("div",{className:"J-card-edit-modal-body b-ud-scrollbar-lg",ref:this.setModalBodyRef,onScroll:this.handleModalScroll},R.a.createElement(k.a,Object(T.Kx)({},this.props,{addOnScrollHandler:this.addOnScrollHandler,windowOffset:this.state.modalScrollTop,windowSize:this.state.modalOffsetHeight,hiddenFieldOffset:this.state.modalHiddenFieldOffset,cannotAutoFocus:this.state.disableAutoFocus,cardSyncMode:O,relativeClass:"J-card-edit-modal-body",closePopup:this.onCancel,receiveAction:E,record:S,fromMention:l,isAnonymousAccess:b,onRef:this.setCardEditRef,fieldEditable:g&&p,recordEditable:g&&h,fieldAddable:g&&m})),this.renderCommentCard()))}}]),r}(R.a.PureComponent),Object(T.lz)(H.prototype,"replayVCFollowState",[V,T.mz],Object.getOwnPropertyDescriptor(H.prototype,"replayVCFollowState"),H.prototype),z=H))||z),K=Object(T.Sy)(function(e,t){var o=t.tableId,n=t.recordId;return{fieldEditable:e.hasPermission(T.qy.Field,{tableId:o},T.ry.Editable),fieldAddable:e.hasPermission(T.qy.Field,{tableId:o},T.ry.Addable),recordEditable:e.hasPermission(T.qy.Record,{tableId:o,recordId:n},T.ry.Editable)}})(J),U=Object.freeze({__proto__:null,getCardRecordInfo:W,getCardOrderInfo:q,CardModalComponent:J,CardModal:K})}.call(this,Y("vb163"))}}]);
//# sourceMappingURL=//slardar.bytedance.net/api_v2/browser/jserr/get_sourcemap?bid=docs_pc&js_filename=vendors-card-modal-card-modal-readonly.7f2757e946.chunk.js