(window.webpackJsonp=window.webpackJsonp||[]).push([["da4109097059"],{vb1292:function(e,o,l){"use strict";l.r(o),function(a){l.d(o,"AddRecordCard",function(){return r}),l.d(o,"isSetRecord",function(){return y});var e,g=l("vb143"),t=l("vb152"),s=l.n(t),c=l("vb180"),i=l("vb103"),f=l.n(i),u=l("vb489"),b=l("vb194"),d=(l("vb147"),l("vb148"),l("vb112"),l("vb164"),l("vb167"),l("vb113"),l("vb159")),v=l.n(d),h=l("vb114"),p=l("vb111"),n=l("vb2229");l("vb129"),l("vb223"),l("vb214"),l("vb232"),l("vb187"),l("vb174"),l("vb225"),l("vb224"),l("vb128"),l("vb122"),l("vb115"),l("vb118"),l("vb119"),l("vb233"),l("vb234"),l("vb235"),l("vb123"),l("vb236"),l("vb193"),l("vb237"),l("vb155"),l("vb238"),l("vb124"),l("vb239"),l("vb104"),l("vb116"),l("vb120"),l("vb121"),l("vb117"),l("vb240"),l("vb134"),l("vb131"),l("vb226"),l("vb241"),l("vb110"),l("vb125"),l("vb242"),l("vb127"),l("vb132"),l("vb227"),l("vb135"),l("vb228"),l("vb229"),l("vb133"),l("vb126"),l("vb243"),l("vb262"),l("vb244"),l("vb245"),l("vb246"),l("vb247"),l("vb248"),l("vb249"),l("vb201"),l("vb260"),l("vb267"),l("vb250"),l("vb136"),l("vb251"),l("vb130"),l("vb252"),l("vb396"),l("vb334");function y(e){return e.cmd===g.Fy.SetRecord}function m(e,t,i,d,n){var r=i.base.getTableById(e),o={recordInfo:[],recordShowInfo:[],recordHideInfo:[]};if(!r||0===d.length)return o;var l=r.getViewById(t);if(!l)return o;var a={};if(l.type===g.az.Kanban){var s=l.getGroupField(),c=n&&n[0];s&&c&&((a=Object.assign({},r.getDefaultNewRecord(),l.getDefaultNewRecord()))[s.id]={value:Object(g.kA)(s,c,r)})}else a=Object.assign({},r.getDefaultNewRecord(),l.getDefaultNewRecord(n));var f,u=[],b=[],v=[],p=l.getVisibleFields(),h=Object(g.WB)(d);try{for(h.s();!(f=h.n()).done;){var m=f.value;if(!r.isDeniedField(m)){var F=r.getField(m);if(F){var y=null;if(F.type!==g.og.Formula&&i.hasPermission(g.qy.Field,{tableId:e,fieldId:m},g.ry.Submittable)){var C=Object(g.lA)(a,m);y=void 0!==C?C:null}var E={fieldId:m,type:F.type,cell:{recordId:"",fieldId:m,rect:null,field:F,value:y}};p&&!p.includes(m)?v.push(E):b.push(E),u.push(E)}}}}catch(e){h.e(e)}finally{h.f()}return{recordInfo:u,recordShowInfo:b,recordHideInfo:v}}var r=Object(h.connect)(function(e,t){var i=t.tableId;return{fieldList:Object(g.zy)(e,i),fieldMap:Object(g.Iz)(e,i)}})(e=function(o){function l(e){var F;Object(g.ov)(this,l),(F=o.call(this,e)||this).resizeObserver=null,F.modalBody=null,F.cardEditorRef=f.a.createRef(),F.actions=[],F.onWindowResize=Object(c.a)(function(){F.setState({height:document.documentElement.clientHeight*g.px})},500),F.handleModalScroll=Object(c.a)(function(){if(F.modalBody){var e=F.modalBody.scrollTop;if(e!==F.state.modalScrollTop){var t=F.modalBody.querySelector(".card_edit_hide_toggle");F.setState({modalScrollTop:e,modalHiddenFieldOffset:t?t.offsetTop+g.qx:0})}}},250),F.bindCopyCutEvent=function(){var e=F.props.renderer;F.modalBody&&(F.modalBody.addEventListener("copy",e.clipboardHelper.handleCopyCut,!0),F.modalBody.addEventListener("cut",e.clipboardHelper.handleCopyCut,!0))},F.unbindCopyCutEvent=function(){var e=F.props.renderer;F.modalBody&&(F.modalBody.removeEventListener("copy",e.clipboardHelper.handleCopyCut,!0),F.modalBody.removeEventListener("cut",e.clipboardHelper.handleCopyCut,!0))},F.setModalBodyRef=function(e){F.modalBody=e,F.onScrollHandler&&F.onScrollHandler(e)},F.observeModalHeight=function(){if(F.modalBody){var e=F.modalBody.offsetHeight;if(e!==F.state.modalOffsetHeight){var t=F.modalBody.querySelector(".card_edit_hide_toggle");F.setState({modalOffsetHeight:e,modalHiddenFieldOffset:t?t.offsetTop+g.qx:0})}}},F.onAddRecord=Object(g.uY)(s.a.mark(function e(){var t;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,null===(t=F.cardEditorRef.current)||void 0===t?void 0:t.blur();case 2:F.props.onAddRecord(F.getAddRecordData()),F.onCardModalClose(!0);case 4:case"end":return e.stop()}},e)})),F.getAddRecordData=function(){var e=F.props,t=e.tableId,i=e.bitableStore.base.getTableById(t);if(!i)return{};var d,n=F.state.recordInfos.recordInfo.reduce(function(e,t){var i=t.cell.value;return null==i?e:Object.assign({},e,Object(g.Ww)({},t.fieldId,{value:i}))},{}),r=Object(g.WB)(F.actions);try{for(r.s();!(d=r.n()).done;){var o=d.value.getOptions();if(y(o))for(var l=o.data,a=0,s=Object.keys(l);a<s.length;a++){var c=s[a],f=l[c];n[c]={value:f.value}}}}catch(e){r.e(e)}finally{r.f()}for(var u=0,b=Object.keys(n);u<b.length;u++){var v,p=b[u],h=i.getField(p),m=null===(v=n[p])||void 0===v?void 0:v.value;h&&null!=m&&h.validate(m)||delete n[p]}return n},F.isFormDirty=function(){var e=F.getAddRecordData();return 0!==Object.keys(e).length},F.afterShow=function(){F.props.modalVisible&&F.setState({cannotAutoFocus:!1}),F.modalBody&&!F.resizeObserver&&(F.resizeObserver=new b.a(F.observeModalHeight),F.resizeObserver.observe(F.modalBody))},F.onCardModalClose=function(e){var t=F.props,i=t.onClose,d=t.afterClose;!e&&i(),"function"==typeof d&&setTimeout(d,0)},F.disconnectObserver=function(){F.resizeObserver&&(F.modalBody&&F.resizeObserver.unobserve(F.modalBody),F.resizeObserver.disconnect(),F.resizeObserver=null)},F.onCancel=function(){F.disconnectObserver();var e=function(){F.actions=[],F.onCardModalClose(),F.setState({cannotAutoFocus:!0})};if(F.isFormDirty())var t=Object(g.HU)({title:a("Bitable_AdvancedPermission_ConfirmToCloseRecordCard_Title"),content:a("Bitable_AdvancedPermission_ConfirmToCloseRecordCard_Description"),enableCancelButton:!0,cancelText:a("Bitable_AdvancedPermission_ConfirmToCloseRecordCard_KeepEditing_Button"),okText:a("Bitable_AdvancedPermission_ConfirmToCloseRecordCard_Close_Button"),okButtonProps:{onClick:function(){t(),F.props.onClose()}}});else e()},F.receiveAction=function(t){return new Promise(function(e){F.actions.push({getOptions:t}),e({result:g.Ey.None})})},F.addOnScrollHandler=function(e){F.onScrollHandler=e};var t=e.tableId,i=e.viewId,d=e.bitableStore,n=e.fieldList,r=e.groupCellValues;return F.state={height:window.document.documentElement.clientHeight*g.px,cannotAutoFocus:!0,recordInfos:m(t,i,d,n||[],r),modalScrollTop:0,modalOffsetHeight:790,modalHiddenFieldOffset:0},F}return Object(g.bu)(l,o),Object(g.Pw)(l,[{key:"componentDidMount",value:function(){window.addEventListener("resize",this.onWindowResize),this.bindCopyCutEvent()}},{key:"UNSAFE_componentWillReceiveProps",value:function(e){var t=e.modalVisible,i=e.fieldList,d=e.tableId,n=e.viewId,r=e.bitableStore,o=e.groupCellValues,l=e.fieldMap,a=this.props,s=a.tableId,c=a.viewId,f=a.modalVisible,u=a.fieldList,b=a.bitableStore,v=a.groupCellValues,p=a.fieldMap;!t&&f&&(this.actions=[]),Object(h.shallowEqual)(u,i)&&p===l&&s===d&&c===n&&b===r&&v===o||this.setState({recordInfos:m(d,n,r,i||[],o)})}},{key:"componentWillUnmount",value:function(){window.removeEventListener("resize",this.onWindowResize),this.disconnectObserver(),this.unbindCopyCutEvent()}},{key:"renderHeader",value:function(){return f.a.createElement("div",{className:"card-edit-modal-header bitable-layout-row bitable-layout-cross-center",style:{justifyContent:"flex-end"}},f.a.createElement(p.Tooltip,{title:a("bitable.card_modal.close"),placement:"top"},f.a.createElement("div",null,f.a.createElement(n.a,{className:"card-edit-modal-header-magnify",onClick:this.onCancel}))))}},{key:"renderFooter",value:function(){return f.a.createElement(g.hX,{onCancel:this.onCancel,onSubmit:this.onAddRecord,submitBtnText:a("Bitable_AdvancedPermission_ButtonAddRecord")})}},{key:"render",value:function(){var e=this.props,t=e.bitableStore,i=e.modalVisible,d=e.marginLeft,n=e.fieldList,r=e.renderer,o=e.isAnonymousAccess,l=t.isEmbeddedInDoc&&r.isFullScreen;if(!i||!n||0===n.length)return null;var a={maxHeight:this.state.height,marginLeft:d||0};return f.a.createElement(p.Dialog,{visible:i,header:this.renderHeader(),closable:!1,maskClosable:!1,footer:this.renderFooter(),zIndex:100,width:g.ux,style:a,className:v()({"J-card-edit-modal":!0,"cp-modal-centered":!0,"b-small-scrollbar":!0,"in-doc-fullscreen":l}),onCancel:this.onCancel,keyboardClosable:!0,onAfterOpen:this.afterShow},f.a.createElement("div",{className:"J-card-edit-modal-body b-ud-scrollbar-lg",ref:this.setModalBodyRef,onScroll:this.handleModalScroll},f.a.createElement(u.a,Object(g.Kx)({},this.props,{ref:this.cardEditorRef,addOnScrollHandler:this.addOnScrollHandler,windowOffset:this.state.modalScrollTop,windowSize:this.state.modalOffsetHeight,hiddenFieldOffset:this.state.modalHiddenFieldOffset,recordId:"",forSelfTable:!0,cannotAutoFocus:this.state.cannotAutoFocus,cardSyncMode:g.tx.OnDemand,relativeClass:"J-card-edit-modal-body",closePopup:this.onCancel,receiveAction:this.receiveAction,record:this.state.recordInfos,isAnonymousAccess:o,fieldEditable:!1,recordEditable:!0,fieldAddable:!1,isAddRecordFromCard:!0,getFormValue:this.getAddRecordData}))))}}]),l}(f.a.PureComponent))||e}.call(this,l("vb163"))},vb2229:function(e,t,i){"use strict";var d=i("vb144"),n=i.n(d),r=i("vb103"),o=i("vb151");function l(e){return r.createElement("svg",n()({width:"1em",height:"1em",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},e),r.createElement("path",{d:"M21 10a1 1 0 1 0 0-2h-3.586l5.293-5.293a1 1 0 0 0-1.414-1.414L16 6.586V3a1 1 0 1 0-2 0v6a1 1 0 0 0 1 1h6ZM3 14a1 1 0 1 0 0 2h3.586l-5.293 5.293a1 1 0 1 0 1.414 1.414L8 17.414V21a1 1 0 1 0 2 0v-6a1 1 0 0 0-1-1H3Z",fill:"currentColor"}))}var a=r.forwardRef(function(e,t){return r.createElement(o.a,n()({icon:l},e,{ref:t,svgProps:{"data-icon":"MinifyOutlined"}}))});t.a=a},vb334:function(e,t,i){"use strict";i.d(t,"a",function(){return l}),i.d(t,"b",function(){return o});var d=i("vb152"),n=i.n(d),r=i("vb143");function o(e){var t=0,i=0;return e.forEach(function(e){switch(e.type){case r.Vy.Url:t+=1;break;case r.Vy.Mention:i+=1}}),{linkCount:t,fileCount:i}}var l=Object(r.Ty)(Object(r.Uy)(Object(r.uY)(n.a.mark(function e(){return n.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.all([i.e("45c48cce2e2d"),i.e("202cb962ac59")]).then(i.bind(null,"vb596"));case 2:return e.abrupt("return",e.sent.DescriptionEditor);case 3:case"end":return e.stop()}},e)}))))},vb396:function(e,t,i){"use strict";i.d(t,"a",function(){return c});var d=i("vb143"),n=i("vb103"),r=i.n(n),o=i("vb111"),l=i("vb159"),a=i.n(l),s=i("vb2170"),c=function(e){function t(){return Object(d.ov)(this,t),e.apply(this,arguments)||this}return Object(d.bu)(t,e),Object(d.Pw)(t,[{key:"render",value:function(){var e=this.props,t=e.tips,i=e.className;return r.a.createElement(o.Tooltip,{title:t,placement:"top",adjustOverflow:!1},r.a.createElement("i",{className:a()("b-warning-icon",i)},r.a.createElement(s.a,null)))}}]),t}(r.a.PureComponent)},vb489:function(e,S,P){"use strict";(function(x){P.d(S,"a",function(){return R});var e=P("vb152"),l=P.n(e),z=P("vb143"),d=P("vb162"),f=P("vb145"),n=P("vb156"),r=P("vb180"),V=P("vb103"),D=P.n(V),t=P("vb110"),h=P.n(t),U=P("vb2206"),M=P("vb2170"),W=P("vb2171"),m=P("vb2177"),i=(P("vb147"),P("vb148"),P("vb112"),P("vb164"),P("vb167"),P("vb113"),P("vb114")),Y=P("vb111"),o=P("vb159"),K=P.n(o),a=P("vb194"),q=(P("vb116"),P("vb118"),P("vb120"),P("vb174"),P("vb155"),P("vb396")),s=(P("vb119"),P("vb121"),P("vb117"),P("vb123")),X=P("vb334");function c(e){return D.a.createElement("div",{className:"loading-field_editor card-field-editor","data-field-id":e.fieldId},D.a.createElement("div",{className:"loading-field__title dynamic-gradient"}),D.a.createElement("div",{className:"loading-field__input dynamic-gradient"}))}var u,b,v,p,F,y,C=function(t){function d(e){var i;return Object(z.ov)(this,d),(i=t.call(this,e)||this).editorWrapRef=null,i.firstRendered=!1,i.notifyContentUpdated=Object(r.a)(function(){if(i.editorWrapRef&&i.editorWrapRef.children&&i.editorWrapRef.children[0]){var e=getComputedStyle(i.editorWrapRef.children[0]),t=parseInt(e.height)+parseInt(e.marginTop)+parseInt(e.marginBottom);t&&i.props.onContentUpdated(i.props.recordInfo.fieldId,t)}},16),i.setEditorWrapRef=function(e){i.editorWrapRef=e},i.state={isRender:!1},i}return Object(z.bu)(d,t),Object(z.Pw)(d,[{key:"componentDidMount",value:function(){this.editorWrapRef&&(this.resizeObserver=new a.a(this.notifyContentUpdated),this.resizeObserver.observe(this.editorWrapRef)),this.notifyContentUpdated()}},{key:"UNSAFE_componentWillReceiveProps",value:function(e){var t=e.shouldRender;t&&t!==this.state.isRender&&(this.setState({isRender:!0}),this.firstRendered=!0)}},{key:"componentDidUpdate",value:function(){this.firstRendered&&(this.props.onFieldEditorRendered(this.props.recordInfo.fieldId),this.firstRendered=!1)}},{key:"componentWillUnmount",value:function(){this.resizeObserver&&(this.editorWrapRef&&this.resizeObserver.unobserve(this.editorWrapRef),this.resizeObserver.disconnect())}},{key:"render",value:function(){var e=this.props,t=e.renderFunc,i=e.recordInfo,d=e.shouldRender;return D.a.createElement("div",{ref:this.setEditorWrapRef},d?t(i):D.a.createElement(c,{fieldId:i.fieldId}))}}]),d}(D.a.PureComponent),E=function(d){function n(e){var v;Object(z.ov)(this,n),(v=d.call(this,e)||this).firstRender=!0,v.fieldPosList={},v.editorWrapperRefs=[],v.forceUpdateField=null,v._debounceUpdate=Object(r.a)(v.forceUpdate,16),v.setEditorWrapperRef=function(e,t){v.editorWrapperRefs[t]=e},v.onFieldEditorRendered=function(e){v.forceUpdateField&&v.forceUpdateField===e&&(v.props.tryFocusField&&v.props.tryFocusField(e),v.forceUpdateField=null)},v.updateFieldEditorStatus=function(){for(var e=v.props,t=e.windowOffset,i=e.windowSize,d=e.recordInfos,n=e.firstRenderCount,r=t,o=t+i*z.xx,l=Object.keys(v.fieldPosList),a=0;a<l.length;++a){var s=v.fieldPosList[l[a]],c=s.start;s.end>=r&&c<=o&&(v.fieldPosList[l[a]].show=!0)}if(v.firstRender){for(var f=Math.min(d.length,n||z.vx),u=0;u<f;++u){var b=d[u].fieldId;v.fieldPosList[b]&&!v.fieldPosList[b].show&&(v.fieldPosList[b].show=!0)}v.firstRender=!1}},v.handleContentUpdate=function(e,t){if(v.fieldPosList[e]){var i=v.fieldPosList[e],d=t-(i.end-i.start);if(0!==d){for(var n=Object.keys(v.fieldPosList),r=0;r<n.length;++r)if(n[r]!==e){var o=v.fieldPosList[n[r]],l=o.start,a=o.end;l>=i.end&&(v.fieldPosList[n[r]].start=l+d,v.fieldPosList[n[r]].end=a+d)}v.fieldPosList[e].end+=d,v._debounceUpdate()}}},v.forceRenderFieldEditor=function(e){v.fieldPosList[e]&&!v.fieldPosList[e].show&&(v.fieldPosList[e].show=!0,v.forceUpdateField=e,v._debounceUpdate())};var t=e.recordInfos,i=e.startOffset||0;return t.map(function(e){v.fieldPosList[e.fieldId]={start:i,end:i+z.wx,show:!1},i+=z.wx}),v}return Object(z.bu)(n,d),Object(z.Pw)(n,[{key:"UNSAFE_componentWillReceiveProps",value:function(e){var t,i=e.recordInfos,d={},n=e.startOffset||0,r=Object(z.WB)(i);try{for(r.s();!(t=r.n()).done;){var o=t.value,l=this.fieldPosList[o.fieldId];if(l){var a=l.end-l.start;l.start=n,l.end=n+a}else l={start:n,end:n+z.wx,show:!1};n+=l.end-l.start,d[o.fieldId]=l}}catch(e){r.e(e)}finally{r.f()}this.fieldPosList=d}},{key:"render",value:function(){var i=this,e=this.props.recordInfos;return this.updateFieldEditorStatus(),D.a.createElement("div",null,e.map(function(t){return D.a.createElement(C,{ref:function(e){return i.setEditorWrapperRef(e,t.fieldId)},key:t.fieldId,shouldRender:i.fieldPosList[t.fieldId].show,recordInfo:t,renderFunc:i.props.fieldEditorRenderFunc,onContentUpdated:i.handleContentUpdate,onFieldEditorRendered:i.onFieldEditorRendered})}))}}]),n}(D.a.PureComponent),g="bitable_fields_card_edit_config",w="new_card_notice",J=100,O={offsetDown:32,paddingBottom:z.nz.FIELD_CARD_OFFSET_BOTTOM+z.nz.FILED_CARD_PADDING_BOTTOM,viewportTop:z.nz.FIELD_CARD_OFFSET_TOP+z.nz.FILED_CARD_HEAD_HEIGHT},Z="bitable-form-field";function I(t,i){var d=0,e=new MutationObserver(function(){var e=t.offsetHeight;e!==d&&(d=e,i())});return e.observe(t,{attributes:!0,childList:!0,characterData:!0,subtree:!0}),function(){e.disconnect()}}var R=(u=Object(i.connect)(function(e){return{isNotDefaultMode:Object(z.yx)(e)}},null,null,{forwardRef:!0}),b=Object(z.zx)(z.Ax.PinyinHelper),v=Object(s.Bind)(),u((F=function(t){function i(e){var L;return Object(z.ov)(this,i),(L=t.call(this,e)||this).editorRefs={},L.fieldNameRefs={},L.visibleFieldsRef=null,L.hiddenFieldsRef=null,L.fieldContentHeightDisposer=d.a,Object(z.Bx)(L,"pinyinHelper",y,Object(z.Cx)(L)),L.updateFieldAnchorPosOnResize=Object(r.a)(function(){L.updateFieldAnchorPos()},200),L.updateFieldAnchorPosOnScroll=Object(n.a)(function(){L.updateFieldAnchorPos()},16.7),L.updateCardTopFieldOnScroll=Object(r.a)(function(){L.updateCardTopField()},200),L.updateCardTopField=function(){if(Object(z.Dx)()){var e=L.cardContainer;if(e){for(var t=e.scrollTop,i=L.getFieldEditorDomList(),d=0,n=i[d],r=0;r<i.length-1;r++){var o=i[r+1];if(t>=L.getElementInCardBodyOffset(n)&&(d=r),t<L.getElementInCardBodyOffset(o))break;n=o}var l=L.props,a=l.tableId,s=l.recordId;L.sendVCStateChange({tableId:a,recordId:s,topFieldId:Object(f.a)(i[d],"dataset.fieldId"),scrollTop:t})}}},L.updateFieldAnchorPos=function(){var e,t,i=L.cardContainer,d=L.state,n=d.isEditFieldOpen,r=d.isNewFieldOpen,o=d.editFieldId;if((n||r)&&(r?(e=L.addFieldBtnRef,t=L.addFieldRef&&L.addFieldRef.fieldCard&&L.addFieldRef.fieldCard.popupElement):(e=L.fieldNameRefs[o],t=L.editFieldRef&&L.editFieldRef.popupElement),e&&t)){var l=e.getBoundingClientRect(),a=t.offsetHeight,s=parseFloat(t.style.top)<0,c=l.left-z.Ex,f=l.height+z.Ex,u=l.top;if(i){var b=i.getBoundingClientRect(),v=b.top,p=b.bottom,h=s?a:-f,m=s?0:a+f;u<v+h?u=v+h:p-m<u&&(u=p-m)}L.setState({editFieldPanelX:c,editFieldPanelY:u})}},L.openVCFollow=function(){var e=L.props,t=e.tableId,i=e.recordId;Object(z.Fx)(z.Gx.BitableCard,L.replayVCFollowState),L.sendVCStateChange({tableId:t,recordId:i,topFieldId:"",scrollTop:0,hideHiddenFields:L.state.hideHiddenFields})},L.closeVCFollow=function(){Object(z.Hx)(z.Gx.BitableCard,L.replayVCFollowState)},L.sendVCStateChange=function(e){Object(z.Ix)(z.Gx.BitableCard,Object.assign({},e,{isFullScreen:z.Jx.getIsFullScreen()}),{config:{isMergeState:!0}})},L.getIsHideHiddenFields=function(t){var e=L.props,i=e.fromMention,d=e.record.recordHideInfo,n=!1,r=z.Yw.getItem(L.getLocalstorageKey())||{},o="boolean"==typeof r.hideHiddenFields?!!r.hideHiddenFields:L.getDefaultHiddenFields();return t&&d&&0<d.length&&(n=!!d.find(function(e){return e.fieldId===t})),!(!0===i&&n)&&o},L.onScrollHandler=function(e){if(L.cardContainer=e){var t=new a.a(L.updateFieldAnchorPos);t.observe(e),L.cardResizeObserver=t,e.addEventListener("scroll",L.updateFieldAnchorPosOnScroll),e.addEventListener("scroll",L.updateCardTopFieldOnScroll)}},L.getContextListeners=function(){var e;return Object(z.Ww)(e={},z.my.SwitchCardEditor,L.onSwitchCardEditor),Object(z.Ww)(e,z.my.SwitchCardEditorReverse,L.onSwitchCardEditorReverse),e},L.collectCardClickEvent=function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:z.oz;Object(z.ny)(Object.assign({click:e,target:i},t))},L.onSwitchCardEditor=function(){var e=0<arguments.length&&void 0!==arguments[0]&&arguments[0],t=L.props.record.recordInfo;if(t){var i=t.findIndex(function(e){var t=L.editorRefs[e.fieldId];return!(!t||!t.state.focus||(t.blur(),0))})+(e?-1:1),d=t[i=L.checkAndUpdateSwitchIndex(t,i,e)].fieldId,n=L.editorRefs[d];n&&n.focus()}},L.onSwitchCardEditorReverse=function(){L.onSwitchCardEditor(!0)},L.tryFocusFieldEditor=function(e){var t=L.props.fromMention,i=L.editorRefs[e];i&&i.focus(!1,t)},L.setEditorContainerRef=function(e){L.editorContainerRef=e},L.getLocalstorageKey=function(){return g+"."+L.props.tableId},L.getLocalstorageCardKey=function(){return w},L.toggleHideFields=function(){var e=!L.state.hideHiddenFields;L.toggleHideFieldsCore(e)},L.toggleHideFieldsCore=function(e){var t,i;if(L.state.hideHiddenFields!==e){var d=L.props,n=d.tableId,r=d.recordId;L.setState({hideHiddenFields:e});var o=e?z.oy.Close:z.oy.Open;L.collectCardClickEvent(z.py.HiddenFields,{status:o}),null===(t=(i=L.props).onToggleHiddenFields)||void 0===t||t.call(i,o);var l={hideHiddenFields:e};z.Yw.setItemSafely(L.getLocalstorageKey(),l),L.sendVCStateChange({hideHiddenFields:e,tableId:n,recordId:r})}},L.injectAttachmentEditorProps=function(e){if(e){var t=function(e){var t,i;null===(t=(i=L.props).onAttachUploadChange)||void 0===t||t.call(i,e)};return e.onUploadChange=t,e}},L.renderEditors=function(e){var t,i,d=L.props,n=d.tableId,r=d.bitableStore,o=d.viewId,l=d.recordId,a=d.renderer,s=d.cardSyncMode,c=d.isNotDefaultMode,f=d.receiveAction,u=d.forSelfTable,b=d.isAnonymousAccess,v=d.fieldEditable,p=d.recordEditable,h=e.cell.field,m=e.cell.value,F=a.getActiveView(),y=e.fieldId,C=l?r.hasPermission(z.qy.Cell,{tableId:n,recordId:l,fieldId:y},z.ry.Editable):r.hasPermission(z.qy.Field,{tableId:n,fieldId:y},z.ry.Submittable),E=p&&C,g={ref:function(e){return L.editorRefs[y]=e},editorType:h.type,editorFieldUIType:h.fieldUIType,tableId:n,fieldId:y,recordId:e.cell.recordId,bitableStore:r,editable:E,renderer:a,cardSyncMode:s,forSelfTable:u},w={tableId:n,viewId:o,bitableStore:r,renderer:a,style:{},editable:E,executeAction:f,cardSyncMode:s,isCardEdit:!0,isAnonymousAccess:b,copyable:a.isCopyable()},O=L.state,I=O.isEditFieldOpen,R=O.editFieldId,S=Object(z.Uw)(h.fieldUIType),P=h.type===z.og.NotSupport,_=v&&!P,j=I&&R===h.id,H=z.sy.instance.get(h.type),T=Object.assign({},e.cell,{},w,{field:h,view:F,value:m,fieldId:y,recordId:l,fieldEditable:!Object(z.ty)(h)&&v,rect:null,relativeClass:L.props.relativeClass,disableLink:!!c,isEditing:j,fieldHeader:{setFieldNameRef:L.setFieldNameRef,openEditField:L.openEditField},getPinyin:L.pinyinHelper.getPinYin}),N=(i=r.base.getTableById(n).isDeniedField(h.id),[{conditions:Object(z.ty)(h)&&!!Object(z.pz)(h).length&&v&&!i,component:function(){return D.a.createElement(q.a,{tips:Object(z.pz)(h),className:"".concat(Z,"-title-warning-icon")})}},{conditions:!0,component:function(){return null}}].find(function(e){return e.conditions}));l||(T.getFormValue=function(){var e=L.props.getFormValue,t=e&&e(),i={};if(t)for(var d in t){var n;i[d]=null===(n=t[d])||void 0===n?void 0:n.value}return i}),h&&Object(z.uy)(h.type)&&L.injectAttachmentEditorProps(T);var k=H.renderCardValueEditor(T,g),B=(null===(t=h.description)||void 0===t?void 0:t.content)||[];return D.a.createElement("label",{className:K()("b-field-label card-field-editor",{"b-field-label-disabled":!E}),htmlFor:"",key:(l||"")+y,"data-field-id":y},!Object(z.vy)(h)&&D.a.createElement(V.Fragment,null,D.a.createElement("span",{ref:function(e){return L.setFieldNameRef(e,h.id)},className:"b-field-label__text",title:h.name},D.a.createElement("span",{style:{cursor:_?"pointer":"default"},className:K()("b-field-label__title bitable-layout-row",{"bitable-common-hover-press-background":_,"b-field-label__title_selected":j}),onClick:!_||Object(z.Xy)(h.fieldUIType)||Object(z.Yy)(h)?void 0:function(){return L.openEditField(h.id)}},D.a.createElement(z.Lx,{isSyncTable:r.isSyncTable(n),isCard:!0},D.a.createElement(S,{className:"icon"})),D.a.createElement("span",{className:"b-field-label__text-content"},h.name),null==N?void 0:N.component(),0<B.length&&D.a.createElement(Y.Popover,{overlayClassName:"bitable-popover-overlay",content:D.a.createElement(X.a,{bitableStore:L.props.bitableStore,initialValue:B,editable:!1,editorStyle:{maxHeight:Math.min((document.body.clientHeight-J)/2,z.Zy)}})},D.a.createElement(U.a,{className:"b-field-label-desc-icon"})),P&&D.a.createElement(Y.Tooltip,{title:x("bitable.not_support_tip"),placement:"bottom",adjustOverflow:!1},D.a.createElement("i",{className:"b-warning-icon"},D.a.createElement(M.a,null))),_&&D.a.createElement(W.a,{className:"card_edit_field_btn"})))),k)},L.setFieldNameRef=function(e,t){L.fieldNameRefs[t]=e},L.setVisibleFieldEditorsContainer=function(e){L.visibleFieldsRef=e},L.setHiddenFieldEditorsContainer=function(e){L.hiddenFieldsRef=e},L.setAddFieldBtnRef=function(e){L.addFieldBtnRef=e},L.setAddFieldPanelAnchorRef=function(e){L.addFieldPanelAnchor=e},L.getAddFieldPanelAnchorRef=function(){return L.addFieldPanelAnchor},L.setEditFieldPanelAnchorRef=function(e){L.editFieldPanelAnchor=e},L.getEditFieldPanelAnchorRef=function(){return L.editFieldPanelAnchor},L.getDefaultHiddenFields=function(){var e=L.activeView;return!(!e||e.type!==z.az.Grid)},L.setAddFieldRef=function(e){L.addFieldRef=e},L.setEditFieldRef=function(e){if(L.editFieldRef=e,L.state.isEditFieldOpen&&e&&L.setState({},function(){return L.updateFieldAnchorPos()}),L.editFieldRef){if(!L.editFieldRef.popupElement)return;L.fieldContentHeightDisposer=I(L.editFieldRef.popupElement,L.onFieldCardContentChanged)}else L.fieldContentHeightDisposer()},L.onFieldCardContentChanged=Object(n.a)(function(){L.state.isEditFieldOpen&&L.updateFieldAnchorPos()},20),L.openNewField=function(){var e,t;if(!L.state.isNewFieldOpen){var i=Object(z.Cx)(L).addFieldBtnRef;if(i){var d=i.getBoundingClientRect();L.collectCardClickEvent(z.py.NewField,{},z.Rw.CcmBitableFieldModifyView),null===(e=(t=L.props).onCreateNewField)||void 0===e||e.call(t),L.setState({isNewFieldOpen:!0,editFieldPanelX:d.left,editFieldPanelY:d.top})}}},L.openEditField=function(e){var t=Object(z.Cx)(L).fieldNameRefs[e];if(t){var i=L.props,d=i.bitableStore,n=i.tableId;if(d.base.getTableById(n)){var r=t.getBoundingClientRect();L.setState({isEditFieldOpen:!0,editFieldPanelX:r.left-z.Ex,editFieldPanelY:r.top,editFieldId:e})}}},L.hideNewField=function(){L.addFieldRef=null,L.addFieldPanelAnchor=null,L.setState({isNewFieldOpen:!1,showAddFieldPanel:!1})},L.hideEditField=function(){L.editFieldRef=null,L.editFieldPanelAnchor=null,L.setState({isEditFieldOpen:!1,showEditFieldPanel:!1,editFieldId:""})},L.onAddFieldSuccess=function(e){L.newFieldId=e.data.fieldId},L.state={hideHiddenFields:L.getIsHideHiddenFields(e.fieldId),isShowNotice:!Object(z.bz)(L.props.bitableStore,L.props.tableId),isNewFieldOpen:!1,isEditFieldOpen:!1,showAddFieldPanel:!1,showEditFieldPanel:!1,editFieldPanelX:0,editFieldPanelY:0,editFieldId:"",isListHoverTipVisible:!1},L.openVCFollow(),L.newCardKey=z.Yw.getItem(L.getLocalstorageCardKey()),null==L.newCardKey&&(z.Yw.setItemSafely(L.getLocalstorageCardKey(),L.props.tableId),z.cz.collectBitableEvent(z.Rw.CcmBitableCardLimitedTipsView)),L}return Object(z.bu)(i,t),Object(z.Pw)(i,[{key:"componentDidMount",value:function(){var e,t;this.editorRefs={},this.props.cannotAutoFocus||this.focusActiveField(),this.unbindContextEvent=this.bindContextEvent(),this.props.addOnScrollHandler(this.onScrollHandler),null===(e=(t=this.props).onRef)||void 0===e||e.call(t,this),window.addEventListener("resize",this.updateFieldAnchorPosOnResize)}},{key:"UNSAFE_componentWillReceiveProps",value:function(e){var t=e.fieldAddable,i=e.fieldEditable;!t&&this.props.fieldAddable&&this.hideNewField(),!i&&this.props.fieldEditable&&this.hideEditField()}},{key:"componentDidUpdate",value:function(e,t){var i;if(e.cannotAutoFocus===this.props.cannotAutoFocus||this.props.cannotAutoFocus||this.focusActiveField(),e.recordId!==this.props.recordId&&(this.props.cannotAutoFocus?null===(i=this.editorContainerRef)||void 0===i||i.focus():this.focusActiveField()),!t.isNewFieldOpen&&this.state.isNewFieldOpen&&this.setState({showAddFieldPanel:!0}),!t.isEditFieldOpen&&this.state.isEditFieldOpen&&this.setState({showEditFieldPanel:!0}),this.newFieldId){var d=this.newFieldId,n=this.editorRefs[d];n&&(this.newFieldId=null,n.focus())}if(!this.props.recordEditable&&e.recordEditable)for(var r=0,o=Object.keys(this.editorRefs);r<o.length;r++){var l,a=o[r],s=this.editorRefs[a];null==s||null===(l=s.blur)||void 0===l||l.call(s)}}},{key:"componentWillUnmount",value:function(){var e,t;this.editorRefs={},this.fieldNameRefs={},this.cardContainer&&(this.cardContainer.removeEventListener("scroll",this.updateFieldAnchorPosOnScroll),this.cardContainer.removeEventListener("scroll",this.updateCardTopFieldOnScroll)),this.cardContainer=null;var i=this.cardResizeObserver;i&&i.disconnect(),this.unbindContextEvent&&this.unbindContextEvent(),window.removeEventListener("resize",this.updateFieldAnchorPosOnResize),this.closeVCFollow(),null===(e=(t=this.props).onRef)||void 0===e||e.call(t,null)}},{key:"replayVCFollowState",value:function(e){var t,i,d=e.data,n=d.topFieldId,r=void 0===n?"":n,o=d.hideHiddenFields,l=d.scrollTop;if(d.tableId!==this.props.tableId)return{status:z.dz.Ignore,code:z.ez.SourceTargetIsDiff};var a=(null===(t=this.fieldNameRefs[r])||void 0===t?void 0:t.offsetTop)||l||0;if(r&&!this.fieldNameRefs[r]){var s=this.getFieldEditorDomList();if(s.length)for(var c=0;c<s.length;++c)if(Object(f.a)(s[c],"dataset.fieldId")===r){a=this.getElementInCardBodyOffset(s[c]);break}}return null===(i=this.cardContainer)||void 0===i||i.scrollTo(0,a),void 0!==o?this.toggleHideFieldsCore(o):this.toggleHideFieldsCore(!1),{status:z.dz.Success}}},{key:"handleClose",value:function(){var e=this.props,t=e.tableId,i=e.bitableStore.base.getTableById(t);if(i)for(var d in this.editorRefs){var n=this.editorRefs[d];if(n&&n.state.focus){var r=i.fields[d];z.sy.instance.get(r.type).handleCardEditEsc(n,this.props.closePopup)}}}},{key:"checkAndUpdateSwitchIndex",value:function(t,i,e){var d=function(){return e?0<i:i<t.length},n=function(){return e?i--:i++},r=function(){for(;d();){var e=t[i].cell.field;if(!Object(z.qz)(e))break;n()}};return r(),i>=t.length&&(i=0),i<0&&(i=t.length-1,r()),i}},{key:"blur",value:function(){var e=Object(z.uY)(l.a.mark(function e(){var t,i,d,n,r,o;return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:t=this.props.record,i=t.recordInfo||[],d=Object(z.WB)(i),e.prev=3,d.s();case 5:if((n=d.n()).done){e.next=13;break}if(r=n.value,!(o=this.editorRefs[r.fieldId])||!o.state.focus){e.next=11;break}return e.next=11,o.blur();case 11:e.next=5;break;case 13:e.next=18;break;case 15:e.prev=15,e.t0=e.catch(3),d.e(e.t0);case 18:return e.prev=18,d.f(),e.finish(18);case 21:case"end":return e.stop()}},e,this,[[3,15,18,21]])}));function t(){return e.apply(this,arguments)}return t}()},{key:"bindContextEvent",value:function(){var e=this.props,t=e.bitableStore,i=e.tableId,d=this.getContextListeners();return t.addEventListeners(i,d),function(){t.removeEventListeners(i,d)}}},{key:"focusActiveField",value:function(){var e=this.props,t=e.record,i=e.fromMention,d=e.modalVisible,n=this.props.fieldId;if(d){var r=n&&this.editorRefs[n];if(r)r.focus(!1,i,!1);else{if(void 0===n){var o=t.recordInfo;n=o&&o.length?o[0].fieldId:""}this.visibleFieldsRef&&this.visibleFieldsRef.forceRenderFieldEditor(n),this.hiddenFieldsRef&&this.hiddenFieldsRef.forceRenderFieldEditor(n)}}}},{key:"activeView",get:function(){var e=this.props,t=e.bitableStore,i=e.tableId,d=e.viewId,n=t.base.getTableById(i);return n&&n.getViewById(d)||null}},{key:"renderNewField",value:function(){var t=this,e=this.state,i=e.isNewFieldOpen,d=e.showAddFieldPanel,n=e.editFieldPanelX,r=e.editFieldPanelY,o=e.isListHoverTipVisible,l=this.props,a=l.bitableStore,s=l.tableId,c=l.renderer,f=this.activeView;if(!i||!f)return null;var u=a.base.getTableById(s);return u?D.a.createElement("div",{ref:this.setAddFieldPanelAnchorRef,className:"card_edit_field_panel",style:{left:n,top:r}},d&&D.a.createElement(z.fz,{fromType:z.gz.CardEditAdd,bitableStore:a,table:u,renderer:c,ref:this.setAddFieldRef,getAnchorRef:this.getAddFieldPanelAnchorRef,onClose:this.hideNewField,x:0,y:24,vLayoutInfo:O,view:f,onAddFieldSuccess:this.onAddFieldSuccess,isListHoverTipVisible:o,setFieldHoverTipVisible:function(e){return t.setFieldHoverTipVisible(e)}})):null}},{key:"renderEditField",value:function(){var t=this,e=this.state,i=e.isEditFieldOpen,d=e.editFieldId,n=e.showEditFieldPanel,r=e.editFieldPanelX,o=e.editFieldPanelY,l=e.isListHoverTipVisible,a=this.props,s=a.bitableStore,c=a.tableId,f=a.renderer,u=this.activeView;if(!i||!d||!u)return null;var b=s.base.getTableById(c);if(!b)return null;var v=b.fields[d];if(!v)return null;var p=b.views[0].getAllFields()[0]===v.id;return D.a.createElement("div",{ref:this.setEditFieldPanelAnchorRef,className:"card_edit_field_panel",style:{left:r,top:o}},n&&D.a.createElement(z.hz,{ref:this.setEditFieldRef,fromType:z.gz.CardEdit,bitableStore:s,table:b,field:Object.assign({},v.toJSON(),{fieldUIType:v.fieldUIType}),isFirstField:p,renderer:f,getAnchorRef:this.getEditFieldPanelAnchorRef,onClose:this.hideEditField,x:0,y:24,updateFieldAnchorPos:this.updateFieldAnchorPos,vLayoutInfo:O,view:u,source:z.iz.Card,isListHoverTipVisible:l,setFieldHoverTipVisible:function(e){return t.setFieldHoverTipVisible(e)}}))}},{key:"getFieldEditorDomList",value:function(){return this.cardContainer?this.cardContainer.querySelectorAll(".card-field-editor"):[]}},{key:"getElementInCardBodyOffset",value:function(e){var t;if(!this.cardContainer||!e)return 0;if(null!==(t=e.dataset.fieldId)&&void 0!==t&&t.startsWith("fld"))return e.offsetTop;for(var i=0;e&&e!==this.cardContainer;)i+=e.offsetTop,e=e.parentElement;return i}},{key:"setFieldHoverTipVisible",value:function(e){this.setState({isListHoverTipVisible:e})}},{key:"setShowNotice",value:function(){var e=0<arguments.length&&void 0!==arguments[0]&&arguments[0];this.setState({isShowNotice:e}),z.cz.collectBitableEvent(z.Bc.CcmBitableCardLimitedTipsClick,{click:"cancel"}),z.Yw.setItemSafely(this.getLocalstorageCardKey(),"")}},{key:"render",value:function(){var e=this,t=this.state,i=t.hideHiddenFields,d=t.isShowNotice,n=t.isNewFieldOpen,r=t.isEditFieldOpen,o=this.props,l=o.record,a=o.modalVisible,s=o.fieldEditable,c=o.fieldAddable,f=o.windowSize,u=o.windowOffset,b=o.hiddenFieldOffset,v=o.isAddRecordFromCard;if(!a)return null;if(!l||!l.recordInfo.length)return null;var p=l.recordHideInfo.length;return D.a.createElement(V.Fragment,null,D.a.createElement("div",{className:"card-modal-body-wrap mention-box-dialog"},D.a.createElement("div",{className:"b-field-form card-modal-form",ref:this.setEditorContainerRef,tabIndex:-1,style:{position:"relative"}},d&&this.newCardKey&&v?D.a.createElement("div",{className:"card-modal-notice"},D.a.createElement(Y.Notice,{showIcon:!0,closable:!0,type:"info",message:z.jz.BitableAdvancedPermissionLimitRecord,onClose:function(){return e.setShowNotice(!1)}})):null,D.a.createElement("div",null,D.a.createElement(E,{ref:this.setVisibleFieldEditorsContainer,windowOffset:u||0,windowSize:f||z.kz,recordInfos:l.recordShowInfo,firstRenderCount:20,fieldEditorRenderFunc:this.renderEditors,tryFocusField:this.tryFocusFieldEditor})),p?D.a.createElement("div",{className:"card_edit_hide"},D.a.createElement("div",{onClick:this.toggleHideFields,className:"card_edit_hide_toggle"},D.a.createElement(W.a,{className:K()("card_edit_hide_icon",{"arrow-right":i})}),x(1<p?"bitable.card_edit.fields.hidden_count":"bitable.card_edit.field.hidden_count",p)),D.a.createElement("div",{className:i?"card_edit_hide_fields":""},D.a.createElement(E,{ref:this.setHiddenFieldEditorsContainer,startOffset:b||0,windowOffset:u||0,windowSize:f||z.kz,recordInfos:l.recordHideInfo,fieldEditorRenderFunc:this.renderEditors,tryFocusField:this.tryFocusFieldEditor}))):null,c&&D.a.createElement("div",{ref:this.setAddFieldBtnRef,className:"card_edit_add_field bitable-layout-row"},D.a.createElement(Y.Button,{onClick:this.openNewField,icon:D.a.createElement(m.a,null),className:K()("card_edit_add_field_content",{card_edit_add_field_content_activated:n})},x("bitable.create_field"))))),c&&n&&h.a.createPortal(this.renderNewField(),document.body),s&&r&&h.a.createPortal(this.renderEditField(),document.body))}}]),i}(D.a.PureComponent),y=Object(z.lz)(F.prototype,"pinyinHelper",[b],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Object(z.lz)(F.prototype,"replayVCFollowState",[v,z.mz],Object.getOwnPropertyDescriptor(F.prototype,"replayVCFollowState"),F.prototype),p=F))||p)}).call(this,P("vb163"))}}]);
//# sourceMappingURL=//slardar.bytedance.net/api_v2/browser/jserr/get_sourcemap?bid=docs_pc&js_filename=vendors-add-record-card.9903b0a16f.chunk.js