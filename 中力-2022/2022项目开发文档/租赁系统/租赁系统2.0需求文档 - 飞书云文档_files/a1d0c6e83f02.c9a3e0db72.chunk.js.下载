(window.webpackJsonp=window.webpackJsonp||[]).push([["a1d0c6e83f02"],{vb1275:function(e,a,s){"use strict";s.r(a),function(v){s.d(a,"MultiSelectorEditor",function(){return o});var e,t,d,C=s("vb143"),i=s("vb152"),I=s.n(i),c=s("vb161"),n=s("vb103"),p=s.n(n),f=(s("vb147"),s("vb148"),s("vb112"),s("vb164"),s("vb167"),s("vb113"),s("vb155"),s("vb116"),s("vb118"),s("vb120"),s("vb174"),s("vb119"),s("vb121"),s("vb117"),s("vb115"),s("vb111")),h=s("vb344"),r=s("vb395"),o=(s("vb129"),s("vb223"),s("vb214"),s("vb232"),s("vb187"),s("vb225"),s("vb224"),s("vb128"),s("vb122"),s("vb233"),s("vb234"),s("vb235"),s("vb123"),s("vb236"),s("vb193"),s("vb237"),s("vb238"),s("vb124"),s("vb239"),s("vb104"),s("vb159"),s("vb240"),s("vb134"),s("vb131"),s("vb226"),s("vb241"),s("vb114"),s("vb110"),s("vb125"),s("vb242"),s("vb127"),s("vb132"),s("vb227"),s("vb135"),s("vb228"),s("vb229"),s("vb133"),s("vb126"),s("vb243"),s("vb262"),s("vb244"),s("vb245"),s("vb246"),s("vb247"),s("vb194"),s("vb248"),s("vb249"),s("vb201"),s("vb260"),s("vb267"),s("vb250"),s("vb136"),s("vb251"),s("vb130"),s("vb252"),e=Object(C.zx)(C.Ax.PinyinHelper),t=function(a){function s(){var m,t,n,i;Object(C.ov)(this,s);for(var e=arguments.length,r=new Array(e),o=0;o<e;o++)r[o]=arguments[o];return(m=a.call.apply(a,[this].concat(r))||this).editorRef=null,Object(C.Bx)(m,"pinyinHelper",d,Object(C.Cx)(m)),m.focusAfterSetRef=!1,m.state={values:[],position:{x:0,y:0},options:[],menuHeight:35,loading:!1},m.setEditorRef=function(e){m.editorRef=e,m.editorRef&&(m.focusAfterSetRef&&m.editorRef.focus(),m.focusAfterSetRef=!1)},m.onOpenSelectList=function(){m.props.renderer.setGlobalContext(C.aJ.CellSelectOpened,!0)},m.onEndedEdit=function(){m.props.renderer.setGlobalContext(C.aJ.CellSelectOpened,!1)},m.onCreateOption=(i=Object(C.uY)(I.a.mark(function e(t){var i,n,r,o,a,s,d,c,l,u,b,p;return I.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!(i=m.addOption(t))){e.next=19;break}if(n=m.props,r=n.tableId,o=n.viewId,a=n.fieldId,s=n.executeAction,!Object(C.fJ)(i)){e.next=5;break}return e.abrupt("return");case 5:return e.prev=5,e.next=8,s(function(){return{cmd:C.Fy.SetFieldAttr,tableId:r,viewId:o,fieldId:a,data:i.toJSON()}});case 8:d=m.state.values,(c=i.findOptionByName(t))&&-1===m.state.values.indexOf(c.id)&&(d=m.state.values.concat(c.id)),m.onChange(d),e.next=19;break;case 14:e.prev=14,e.t0=e.catch(5),f.toast.error(v("common.create_failed")),console.error("error create",e.t0),C.hy.ravenCatch(e.t0,{key:C.iy.ErrorEvent});case 19:l=m.props,u=l.tableId,b=l.viewId,p=l.view,Object(C.eJ)(u,b,p,!0);case 21:case"end":return e.stop()}},e,null,[[5,14]])})),function(e){return i.apply(this,arguments)}),m.onUpdateOption=(n=Object(C.uY)(I.a.mark(function e(t,i,n){var r,o,a,s,d,c,l,u,b,p,v,f,h,y,O,g,S;return I.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=m.props,o=r.tableId,a=r.viewId,s=r.fieldId,d=r.executeAction,c=r.bitableStore,l=r.view,u=c.base.getTableById(o).fields[s],c&&o&&i&&(b=c.base.getTableById(o),p=a?b.getViewById(a):void 0,C.ob.collectBitableEvent(C.On.BitableColorSet,{action:"choose_color",from_color:n,to_color:t.color,source:C.gJ.SelectPanel,table_id:o,view_id:a,bitable_view_type:p&&p.type?C.Cz[p.type]:void 0})),!u){e.next=12;break}if(v=u.id,f=u.name,h=u.type,y=u.property,O=u.fieldUIType,g=y.options.map(function(e){return e.id===t.id?t:e}),S={id:v,name:f,type:h,property:{options:g}},!Object(C.fJ)(u)){e.next=9;break}return e.abrupt("return");case 9:return e.next=11,d(function(){return{cmd:C.Fy.SetFieldAttr,tableId:o,viewId:a,fieldId:s,data:S}});case 11:l&&C.ob.collectBitableEvent(C.On.BitableSelectUpdateOption,{table_id:o,view_id:a,bitable_view_type:C.Cz[l.type],data_source:c.Options.module,bitable_field_type:C.lC[O],source:C.gJ.SelectPanel},!0);case 12:case"end":return e.stop()}},e)})),function(e,t,i){return n.apply(this,arguments)}),m.onChange=(t=Object(C.uY)(I.a.mark(function e(t){var i,n,r,o,a,s,d,c,l,u,b,p,v;return I.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(i=m.isSearched,n=m.props,r=n.tableId,o=n.viewId,a=n.recordId,s=n.fieldId,d=n.view,c=n.isCardEdit,l=n.executeAction,u=n.cardSyncMode,b=n.bitableStore,p=n.renderer,n.editable){e.next=4;break}return e.abrupt("return");case 4:return v=p.activeBitableWidget.isFloatLayerOpen,u!==C.tx.OnDemand&&u!==C.tx.Custom||m.setState({values:t}),e.next=8,l(function(){return{cmd:C.Fy.SetRecord,tableId:r,viewId:o,recordId:a,data:Object(C.Ww)({},s,{value:0===t.length?null:t,type:C.og.MultiSelect})}});case 8:d&&C.ob.collectBitableEvent(C.On.BitableRecordEdit,Object.assign({smartable_token:b.md5Token,row:d.getVisibleRecordIndexById(a),col:d.getFieldIndexById(s),table_id:r,view_id:o,bitable_editor_type:c?"card":"cell",bitable_view_type:C.Cz[d.type],bitable_field_type:C.lC[C.ex.MultiSelect],bitable_edit_search:i,data_source:b.Options.module,is_record_floating:v},p.getRecordEditLogParams()),!0),m.editorRef&&!m.editorRef.isOpened()&&m.focus();case 10:case"end":return e.stop()}},e)})),function(e){return t.apply(this,arguments)}),m.onOptionClick=function(e,t){var i=m.props,n=i.tableId,r=i.viewId,o=i.view;!t&&Object(C.bJ)(n,r,o)},m.getField=function(){var e=m.props,t=e.tableId,i=e.fieldId;return e.bitableStore.base.getTableById(t).fields[i]},m.getDynamicOptions=function(){var e=m.props.getFormValue,t=m.state.values,i=m.getField(),n=[];t.forEach(function(e){i.hasOption(e)&&n.push(e)}),m.setState({loading:!0,values:n});var r=m.props.recordId;return r&&!Object(C.XI)(r)||!e||(r=Object(C.YI)(i,e())),Object(C.ZI)(i,r).then(function(e){return e}).catch(function(e){return Promise.reject(e)}).finally(function(){m.setState({loading:!1})})},m.onSearch=function(e){var t=m.props,i=t.tableId,n=t.viewId,r=t.view;Object(C.cJ)(i,n,r,!0)},m}return Object(C.bu)(s,a),Object(C.Pw)(s,[{key:"componentDidMount",value:function(){this.gridContext=this.props.renderer.activeBitableWidget.getGridWidget(),this.unbindContextEvent=this.bindContextEvent(),this.bindDataSource(this.props)}},{key:"componentDidUpdate",value:function(e){e.tableId===this.props.tableId&&e.fieldId===this.props.fieldId&&e.recordId===this.props.recordId||this.bindDataSource(this.props)}},{key:"componentWillUnmount",value:function(){this.dataSource&&this.dataSource.destroyed(),this.unbindContextEvent&&this.unbindContextEvent()}},{key:"focus",value:function(){this.editorRef?(this.editorRef.focus(),this.updatePosition()):this.focusAfterSetRef=!0}},{key:"onEndEdit",value:function(e){Object(C.yH)(this.props.relativeClass,C.ex.MultiSelect,this.state.values),this.editorRef&&this.editorRef.onEndEdit()}},{key:"onStartEdit",value:function(){this.editorRef&&this.editorRef.onStartEdit(),C.cz.collectClickEvent(C.Bc.CcmBitableSearchClick,{click:"search_option"})}},{key:"setDefaultValue",value:function(){this.setEditorValue(this.props.value||[])}},{key:"setEditorValue",value:function(e){this.setState({values:e||[]})}},{key:"bindDataSource",value:function(e){var t=this;if(this.dataSource&&this.dataSource.destroyed(),!this.props.disableDataSource){var i,n=e.tableId,r=e.fieldId,o=e.recordId,a=e.bitableStore;this.props.cardSyncMode===C.tx.OnDemand&&(i=e.value),this.dataSource=new C.hJ(n,r,o,a,i);var s=this.dataSource.getSource();this.updateList(s),this.props.cardSyncMode!==C.tx.OnDemand&&this.dataSource.bindUpdate(function(e){t.updateList(e)})}}},{key:"bindContextEvent",value:function(){var e,r=this,t=(Object(C.Ww)(e={},C.pC.DeleteMultiSelectCell,function(e){var t=e.id,i=e.values,n=i.indexOf(t);i.splice(n,1),r.onChange(i),Object(C.yH)(r.props.relativeClass,C.ex.MultiSelect,i)}),Object(C.Ww)(e,C.pC.CoverMouseDown,function(e){r.editorRef&&r.editorRef.isOpened()?r.preventOpen=!0:r.preventOpen=!1}),Object(C.Ww)(e,C.pC.CoverClick,function(e){r.preventOpen||(r.editorRef&&!r.editorRef.isOpened()&&e?(r.setState({menuHeight:e.height}),r.props.startEdit&&r.props.startEdit(!1),r.updatePosition()):r.props.endEdit&&r.props.endEdit(!0))}),e);return this.gridContext&&this.gridContext.addGridEventsBindListener(t),function(){r.gridContext&&r.gridContext.removeGridEventsBindListener(t)}}},{key:"updateList",value:function(e,t){var i=this;if(e){var n=this.getField().isDynamic,r=e.options.map(function(e){return{id:e.id,name:e.name,color:e.color}}),o=Object.assign({},this.state);this.props.cardSyncMode!==C.tx.Custom&&n?(o.values=e.values,o.options=[]):this.props.cardSyncMode!==C.tx.Custom||n?this.props.cardSyncMode===C.tx.Custom||n||(o.values=e.values,o.options=r):o.options=r,this.setState(o,function(){i.updatePosition(),t&&t()})}}},{key:"updatePosition",value:function(){if(!this.props.staticPosition){var e=this.props.renderer.activeBitableWidget.getGridWidget();if(e&&this.editorRef){var t=e.getCoverRect(),i=e.getSelection();if(i&&t&&1===i.rowCount&&1===i.colCount){var n,r,o,a,s=e.getCellRect({col:i.col,row:i.row}),d=t.y+t.height-(s.y+s.height);null!==(n=this.editorRef)&&void 0!==n&&null!==(r=n.isListReversed)&&void 0!==r&&r.call(n)&&(null===(o=this.editorRef)||void 0===o||null===(a=o.updatePosition)||void 0===a||a.call(o,t.height));var c=this.props.bitableStore.base.getTableById(this.props.tableId);c&&c.getViewById(this.props.viewId)&&this.setState({position:{y:d,x:0}})}}}}},{key:"addOption",value:function(t){var e=this.state,i=e.options,n=e.values,r=this.props.bitableStore.base.getTableById(this.props.tableId);if(r&&!i.find(function(e){return e.name===t})){var o=Object(c.a)(r.fields[this.props.fieldId]);i.forEach(function(e){o.findOptionById(e.id)||o.addOption(e.name,null,e.id)});var a=o.addOption(t);return this.props.cardSyncMode===C.tx.OnDemand&&(this.setState({options:[].concat(Object(C.hI)(i),[{id:a,name:t,color:i.length}])}),this.setState({values:[].concat(Object(C.hI)(null!=n?n:[]),[a])})),o}return null}},{key:"isSearched",get:function(){return!(!this.editorRef||!this.editorRef.isSearched)}},{key:"getSelectorCellPosition",value:function(){if(this.props.staticPosition)return{};var e=this.props,t=e.anchorRef,i=e.width,n={left:0,top:this.state.position.y,width:i||"100%"};return t&&Object(C.bE)(t,n,{width:i||r.a}),n}},{key:"render",value:function(){var e=this,t=this.state,i=t.values,n=t.options,r=t.loading,o=this.props,a=this.getField().isDynamic,s={isDynamic:a,emptyListPlaceholder:o.emptyListPlaceholder};a&&(s.getDynamicOptions=this.getDynamicOptions,s.getTargetFieldOptions=function(){return e.getField().getOptions()},s.emptyListPlaceholder=v("Bitable_SingleOption_NoAvailableOption_Web"));var d=o.bitableStore,c=o.tableId,l=null==d?void 0:d.base.isPro(),u=d&&Object(C.wH)(d,c),b=Object(C.xH)({isFieldEditablePermission:u,placeholder:v("Bitable_Form_PleaseSelect"),isPro:l});return p.a.createElement(h.a,Object(C.Kx)({},s,{className:"selector-cell multi-selector-cell",ref:this.setEditorRef,menuHeight:this.state.menuHeight,options:n,style:this.getSelectorCellPosition(),onOpenSelectList:this.onOpenSelectList,onEndedEdit:this.onEndedEdit,placeholder:b,values:i,onUpdateOption:this.onUpdateOption,editable:o.editable,maxListHeight:o.maxListHeight,relativeClass:o.relativeClass,anchorHeight:o.rect?o.rect.height:0,offY:o.isCardEdit?1:0,onChange:this.onChange,onSearch:this.onSearch,onCreateOption:this.onCreateOption,onOptionClick:this.onOptionClick,getPinyin:this.pinyinHelper.getPinYin,disableCreateOption:!o.fieldEditable,disableEditOption:!o.fieldEditable,disableAutoFocus:C.rx.isIPad,loading:r,hideSearch:o.hideSearch}))}}]),s}(p.a.PureComponent),d=Object(C.lz)(t.prototype,"pinyinHelper",[e],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),t)}.call(this,s("vb163"))},vb344:function(e,t,i){"use strict";i.d(t,"a",function(){return s}),i.d(t,"b",function(){return a}),i.d(t,"c",function(){return d});var n=i("vb152"),r=i.n(n),o=i("vb143"),a=Object(o.Uy)(Object(o.uY)(r.a.mark(function e(){return r.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,i.e("d645920e395f").then(i.bind(null,"vb485"));case 2:return e.abrupt("return",e.sent.SingleSelectorEditor);case 3:case"end":return e.stop()}},e)}))),s=Object(o.Uy)(Object(o.uY)(r.a.mark(function e(){return r.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,i.e("d67d8ab4f4c1").then(i.bind(null,"vb486"));case 2:return e.abrupt("return",e.sent.MultiSelectorEditor);case 3:case"end":return e.stop()}},e)}))),d=Object(o.Uy)(Object(o.uY)(r.a.mark(function e(){return r.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,i.e("3416a75f4cea").then(i.bind(null,"vb487"));case 2:return e.abrupt("return",e.sent.UserSelectorEditor);case 3:case"end":return e.stop()}},e)})))},vb395:function(e,t,i){"use strict";i.d(t,"a",function(){return n}),i.d(t,"b",function(){return r}),i.d(t,"c",function(){return a}),i.d(t,"d",function(){return s}),i.d(t,"e",function(){return o});var n=183,r=280,o=35,a=215,s=325}}]);
//# sourceMappingURL=//slardar.bytedance.net/api_v2/browser/jserr/get_sourcemap?bid=docs_pc&js_filename=a1d0c6e83f02.c9a3e0db72.chunk.js