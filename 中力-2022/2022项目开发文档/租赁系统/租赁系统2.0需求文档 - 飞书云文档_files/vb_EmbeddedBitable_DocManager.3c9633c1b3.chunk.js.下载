(window.webpackJsonp=window.webpackJsonp||[]).push([["3c4462be8a3d","de20b5688127","55f14c389d78"],{vb1250:function(e,t,r){"use strict";function n(e,t){if("function"==typeof e&&"function"==typeof t)return e===t;if(!e||!t)return e===t;if("function"==typeof e)return(n=e)===(r=t).saga&&!r.argument;if("function"==typeof t){var r=t;return(n=e).saga===r&&!n.argument}var n;r=t;return(n=e).saga===r.saga&&n.argument===r.argument}t.__esModule=!0,t.sagaEquals=n},vb163:function(e,t,r){var n=r("vb503"),o=r("vb362"),i=n.t;e.exports=function(){var e=i.apply(null,arguments);return o(e)}},vb1788:function(e,r,t){"use strict";function n(e){for(var t in e)r.hasOwnProperty(t)||(r[t]=e[t])}r.__esModule=!0,n(t("vb1789"))},vb1789:function(e,t,r){"use strict";t.__esModule=!0;var i=r("vb132"),a=r("vb697"),c=r("vb1790"),s=r("vb1250");function n(t,e){var r=void 0;var n=i.default({context:t,sagaMonitor:r,onError:e}),o=a.getRefCountedManager(c.getSagaManager(n),s.sagaEquals);return{middleware:[n],onModuleManagerCreated:function(e){t&&(t.moduleManager=e)},onModuleAdded:function(e){e.sagas&&o.add(e.sagas)},onModuleRemoved:function(e){e.sagas&&o.remove(e.sagas)},dispose:function(){o.dispose()}}}t.getSagaExtension=n},vb1790:function(e,t,r){"use strict";var n=this&&this.__spreadArrays||function(){for(var e=0,t=0,r=arguments.length;t<r;t++)e+=arguments[t].length;var n=Array(e),o=0;for(t=0;t<r;t++)for(var i=arguments[t],a=0,c=i.length;a<c;a++,o++)n[o]=i[a];return n};t.__esModule=!0;var o=r("vb1250"),i=r("vb697");function a(t){var r=i.getMap(o.sagaEquals);return{getItems:function(){return n(r.keys)},add:function(e){e&&e.forEach(function(e){e&&!r.get(e)&&r.add(e,c(t,e))})},remove:function(e){e&&e.forEach(function(e){r.get(e)&&r.remove(e).cancel()})},dispose:function(){r.keys.forEach(function(e){return r.get(e).cancel()})}}}function c(e,t){if("function"==typeof t){var r=t;return e.run(r)}var n=t.saga,o=t.argument;return e.run(n,o)}t.getSagaManager=a},vb1791:function(e,t,r){"use strict";t.__esModule=!0;var n=r("vb227");function o(){return{middleware:[n.default]}}t.getThunkExtension=o},vb1792:function(e,u,h){"use strict";(function(c){h.d(u,"a",function(){return l});var e=h("vb106"),T=h.n(e),t=h("vb339"),d=h.n(t),r=h("vb107"),o=h.n(r),n=h("vb285"),i=h.n(n),a=h("vb286"),s=h.n(a);function x(){x=function(){return a};var a={},e=Object.prototype,u=e.hasOwnProperty,d=Object.defineProperty||function(e,t,r){e[t]=r.value},t="function"==typeof Symbol?Symbol:{},o=t.iterator||"@@iterator",r=t.asyncIterator||"@@asyncIterator",n=t.toStringTag||"@@toStringTag";function i(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{i({},"")}catch(e){i=function(e,t,r){return e[t]=r}}function c(e,t,r,n){var o=t&&t.prototype instanceof s?t:s,i=Object.create(o.prototype),a=new O(n||[]);return d(i,"_invoke",{value:S(e,r,a)}),i}function h(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}a.wrap=c;var l={};function s(){}function f(){}function p(){}var v={};i(v,o,function(){return this});var b=Object.getPrototypeOf,y=b&&b(b(I([])));y&&y!==e&&u.call(y,o)&&(v=y);var g=p.prototype=s.prototype=Object.create(v);function m(e){["next","throw","return"].forEach(function(t){i(e,t,function(e){return this._invoke(t,e)})})}function w(c,s){function l(e,t,r,n){var o=h(c[e],c,t);if("throw"!==o.type){var i=o.arg,a=i.value;return a&&"object"==T()(a)&&u.call(a,"__await")?s.resolve(a.__await).then(function(e){l("next",e,r,n)},function(e){l("throw",e,r,n)}):s.resolve(a).then(function(e){i.value=e,r(i)},function(e){return l("throw",e,r,n)})}n(o.arg)}var t;d(this,"_invoke",{value:function(r,n){function e(){return new s(function(e,t){l(r,n,e,t)})}return t=t?t.then(e,e):e()}})}function S(i,a,c){var s="suspendedStart";return function(e,t){if("executing"===s)throw new Error("Generator is already running");if("completed"===s){if("throw"===e)throw t;return L()}for(c.method=e,c.arg=t;;){var r=c.delegate;if(r){var n=E(r,c);if(n){if(n===l)continue;return n}}if("next"===c.method)c.sent=c._sent=c.arg;else if("throw"===c.method){if("suspendedStart"===s)throw s="completed",c.arg;c.dispatchException(c.arg)}else"return"===c.method&&c.abrupt("return",c.arg);s="executing";var o=h(i,a,c);if("normal"===o.type){if(s=c.done?"completed":"suspendedYield",o.arg===l)continue;return{value:o.arg,done:c.done}}"throw"===o.type&&(s="completed",c.method="throw",c.arg=o.arg)}}}function E(e,t){var r=t.method,n=e.iterator[r];if(void 0===n)return t.delegate=null,"throw"===r&&e.iterator.return&&(t.method="return",t.arg=void 0,E(e,t),"throw"===t.method)||"return"!==r&&(t.method="throw",t.arg=new TypeError("The iterator does not provide a '"+r+"' method")),l;var o=h(n,e.iterator,t.arg);if("throw"===o.type)return t.method="throw",t.arg=o.arg,t.delegate=null,l;var i=o.arg;return i?i.done?(t[e.resultName]=i.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,l):i:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,l)}function C(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function k(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function O(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(C,this),this.reset(!0)}function I(t){if(t){var e=t[o];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var r=-1,n=function e(){for(;++r<t.length;)if(u.call(t,r))return e.value=t[r],e.done=!1,e;return e.value=void 0,e.done=!0,e};return n.next=n}}return{next:L}}function L(){return{value:void 0,done:!0}}return f.prototype=p,d(g,"constructor",{value:p,configurable:!0}),d(p,"constructor",{value:f,configurable:!0}),f.displayName=i(p,n,"GeneratorFunction"),a.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===f||"GeneratorFunction"===(t.displayName||t.name))},a.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,p):(e.__proto__=p,i(e,n,"GeneratorFunction")),e.prototype=Object.create(g),e},a.awrap=function(e){return{__await:e}},m(w.prototype),i(w.prototype,r,function(){return this}),a.AsyncIterator=w,a.async=function(e,t,r,n,o){void 0===o&&(o=Promise);var i=new w(c(e,t,r,n),o);return a.isGeneratorFunction(t)?i:i.next().then(function(e){return e.done?e.value:i.next()})},m(g),i(g,n,"Generator"),i(g,o,function(){return this}),i(g,"toString",function(){return"[object Generator]"}),a.keys=function(e){var r=Object(e),n=[];for(var t in r)n.push(t);return n.reverse(),function e(){for(;n.length;){var t=n.pop();if(t in r)return e.value=t,e.done=!1,e}return e.done=!0,e}},a.values=I,O.prototype={constructor:O,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(k),!e)for(var t in this)"t"===t.charAt(0)&&u.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(r){if(this.done)throw r;var n=this;function e(e,t){return i.type="throw",i.arg=r,n.next=e,t&&(n.method="next",n.arg=void 0),!!t}for(var t=this.tryEntries.length-1;0<=t;--t){var o=this.tryEntries[t],i=o.completion;if("root"===o.tryLoc)return e("end");if(o.tryLoc<=this.prev){var a=u.call(o,"catchLoc"),c=u.call(o,"finallyLoc");if(a&&c){if(this.prev<o.catchLoc)return e(o.catchLoc,!0);if(this.prev<o.finallyLoc)return e(o.finallyLoc)}else if(a){if(this.prev<o.catchLoc)return e(o.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return e(o.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;0<=r;--r){var n=this.tryEntries[r];if(n.tryLoc<=this.prev&&u.call(n,"finallyLoc")&&this.prev<n.finallyLoc){var o=n;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var i=o?o.completion:{};return i.type=e,i.arg=t,o?(this.method="next",this.next=o.finallyLoc,l):this.complete(i)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),l},finish:function(e){for(var t=this.tryEntries.length-1;0<=t;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),k(r),l}},catch:function(e){for(var t=this.tryEntries.length-1;0<=t;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var o=n.arg;k(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,r){return this.delegate={iterator:I(e),resultName:t,nextLoc:r},"next"===this.method&&(this.arg=void 0),l}},a}var l=function(){function n(e,t,r){var a=this;i()(this,n),this.components=e,this.contentManager=t,this.displayMultiple=r,this.notifyCommentLoadedMap=new Map,this.notifyCommentBatchUpdateMap=new Map,this.comments=null,this.getComments=function(e){var t=a.getComponents(e);return t?t.getComments(e):a.getDefaultComments(e)},this.setOnCommentBatchUpdate=function(e,t,r){var n=a.getComponents(e);n?n.setCommentBatchUpdate(e,t,r):a.setNotifyCommentBatchUpdateFn(e,t)},this.setCommentData=function(e,t){a.comments=t.comments;var r=a.getComponents(e);if(!r){var n=a.getDefaultComments(e),o=a.getNotifyCommentBatchUpdateFn(e);return o&&o(n),Promise.resolve()}return r.setCommentData(e,t)},this.startNewComment=function(e,t,r){var n=a.getComponents(e);if(n)return n.startNewComment(e,t,r)},this.getResolvedComments=function(e){var t=a.getComponents(e);return t?t.getResolvedComments(e):[]},this.setResolvedCommentIds=function(e,t){var r=a.getComponents(e);if(r)return r.setResolvedCommentIds(e,t)},this.addHoverHighlight=function(e,t){var r=a.getComponents(e);if(r)return r.addHoverHighlight(e,t)},this.removeHoverHighlight=function(e,t){var r=a.getComponents(e);if(r)return r.removeHoverHighlight(e,t)},this.resolveComment=function(){var r=o()(x().mark(function e(t,r){var n;return x().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=a.getComponents(t)){e.next=3;break}return e.abrupt("return");case 3:return e.abrupt("return",n.resolveComment(t,r));case 4:case"end":return e.stop()}},e)}));return function(e,t){return r.apply(this,arguments)}}(),this.activateComment=function(e,t){var r=a.getComponents(e);if(r)return r.activateComment(e,t)},this.deactivateComment=function(e,t){var r=a.getComponents(e);if(r)return r.deactivateComment(e,t)},this.reopenComment=function(){var r=o()(x().mark(function e(t,r){var n;return x().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=a.getComponents(t)){e.next=3;break}return e.abrupt("return");case 3:return e.abrupt("return",n.reopenComment(t,r));case 4:case"end":return e.stop()}},e)}));return function(e,t){return r.apply(this,arguments)}}(),this.findComment=function(){var r=o()(x().mark(function e(t,r){var n,o,i;return x().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=a.getComponents(t)){e.next=5;break}return o=a.getDefaultComments(t),i=o.find(function(e){return e.commentId===r}),e.abrupt("return",i);case 5:return e.abrupt("return",n.findComment(t,r));case 6:case"end":return e.stop()}},e)}));return function(e,t){return r.apply(this,arguments)}}(),this.getTeaParams=function(e,t){var r=a.getComponents(e);if(r)return r.getTeaParams(e,t)},this.getSmartableCommentManager=function(e){var t=a.getComponents(e);if(t)return t.getSmartableCommentManager(e)},this.getCommentPositions=function(e){var t=a.getComponents(e);if(t)return t.getCommentPositions(e)},this.showCommentInNcc=function(e,t){var r=a.getComponents(e);if(r&&r.showCommentInNcc)return r.showCommentInNcc(t)}}return s()(n,[{key:"setNotifyCommentLoadedFn",value:function(e,t){this.notifyCommentLoadedMap.set(e,t)}},{key:"getNotifyCommentLoadedFn",value:function(e){return this.notifyCommentLoadedMap.get(e)}},{key:"setNotifyCommentBatchUpdateFn",value:function(e,t){this.notifyCommentBatchUpdateMap.set(e,t)}},{key:"getNotifyCommentBatchUpdateFn",value:function(e){return this.notifyCommentBatchUpdateMap.get(e)}},{key:"getDefaultComments",value:function(e){var t=[],r=this.contentManager.dataSource.getSource().base.getTableById(e);if(!r)return t;var n=this.contentManager.dataSource.getShowingViewId(r.id),o=n?r.getViewById(n):r.views[0];if(!o)return t;var i=o.getVisibleRecords(),a=this.generateTableCommentMap(r),c=Object.keys(a);if(i)for(var s=0;s<c.length;s++){var l=c[s];if(i.includes(l)){var u=(a[l]||[]).filter(function(e){return!e.isResolved});t.push.apply(t,d()(u))}}return t}},{key:"generateTableCommentMap",value:function(e){var t=this.comments,a={};if(t&&e&&0<t.length)for(var r=e.commentMap||{},n=Object.keys(r),o=function(e){var o=n[e],i=r[o];if(i&&i.length<0)return"continue";t.forEach(function(e){var t=e.commentId,r=e.finish;if(i&&i.includes(t)){var n={recordId:o,commentId:t,quote:c("bitable.comment_title",""),isResolved:!!r,offsetTop:0,offsetHeight:0};a[o]?a[o]=a[o].concat(n):a[o]=[n]}})},i=0;i<n.length;i++)o(i);return a}},{key:"getComponents",value:function(e){var t=this.components.get(e);return this.displayMultiple||(t=this.components.values().next().value),t}},{key:"getActiveComments",value:function(e){var t=this.getComponents(e);return t?t.getActiveComments(e):[]}},{key:"saveComment",value:function(){var n=o()(x().mark(function e(t,r,n){var o;return x().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(o=this.getComponents(t)){e.next=3;break}return e.abrupt("return");case 3:return e.abrupt("return",o.saveComment(t,r,n));case 4:case"end":return e.stop()}},e,this)}));function e(e,t,r){return n.apply(this,arguments)}return e}()},{key:"removeComment",value:function(){var r=o()(x().mark(function e(t,r){var n;return x().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=this.getComponents(t)){e.next=3;break}return e.abrupt("return");case 3:return e.abrupt("return",n.removeComment(t,r));case 4:case"end":return e.stop()}},e,this)}));function e(e,t){return r.apply(this,arguments)}return e}()},{key:"removeTempComment",value:function(){var r=o()(x().mark(function e(t,r){var n;return x().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=this.getComponents(t)){e.next=3;break}return e.abrupt("return");case 3:return e.abrupt("return",n.removeTempComment(t,r));case 4:case"end":return e.stop()}},e,this)}));function e(e,t){return r.apply(this,arguments)}return e}()}]),n}()}).call(this,h("vb163"))},vb1793:function(e,h,f){"use strict";(function(r){f.d(h,"a",function(){return d});var e=f("vb106"),T=f.n(e),t=f("vb285"),n=f.n(t),o=f("vb286"),i=f.n(o),a=f("vb107"),c=f.n(a),s=f("vb102");function x(){x=function(){return a};var a={},e=Object.prototype,u=e.hasOwnProperty,d=Object.defineProperty||function(e,t,r){e[t]=r.value},t="function"==typeof Symbol?Symbol:{},o=t.iterator||"@@iterator",r=t.asyncIterator||"@@asyncIterator",n=t.toStringTag||"@@toStringTag";function i(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{i({},"")}catch(e){i=function(e,t,r){return e[t]=r}}function c(e,t,r,n){var o=t&&t.prototype instanceof s?t:s,i=Object.create(o.prototype),a=new O(n||[]);return d(i,"_invoke",{value:S(e,r,a)}),i}function h(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}a.wrap=c;var l={};function s(){}function f(){}function p(){}var v={};i(v,o,function(){return this});var b=Object.getPrototypeOf,y=b&&b(b(I([])));y&&y!==e&&u.call(y,o)&&(v=y);var g=p.prototype=s.prototype=Object.create(v);function m(e){["next","throw","return"].forEach(function(t){i(e,t,function(e){return this._invoke(t,e)})})}function w(c,s){function l(e,t,r,n){var o=h(c[e],c,t);if("throw"!==o.type){var i=o.arg,a=i.value;return a&&"object"==T()(a)&&u.call(a,"__await")?s.resolve(a.__await).then(function(e){l("next",e,r,n)},function(e){l("throw",e,r,n)}):s.resolve(a).then(function(e){i.value=e,r(i)},function(e){return l("throw",e,r,n)})}n(o.arg)}var t;d(this,"_invoke",{value:function(r,n){function e(){return new s(function(e,t){l(r,n,e,t)})}return t=t?t.then(e,e):e()}})}function S(i,a,c){var s="suspendedStart";return function(e,t){if("executing"===s)throw new Error("Generator is already running");if("completed"===s){if("throw"===e)throw t;return L()}for(c.method=e,c.arg=t;;){var r=c.delegate;if(r){var n=E(r,c);if(n){if(n===l)continue;return n}}if("next"===c.method)c.sent=c._sent=c.arg;else if("throw"===c.method){if("suspendedStart"===s)throw s="completed",c.arg;c.dispatchException(c.arg)}else"return"===c.method&&c.abrupt("return",c.arg);s="executing";var o=h(i,a,c);if("normal"===o.type){if(s=c.done?"completed":"suspendedYield",o.arg===l)continue;return{value:o.arg,done:c.done}}"throw"===o.type&&(s="completed",c.method="throw",c.arg=o.arg)}}}function E(e,t){var r=t.method,n=e.iterator[r];if(void 0===n)return t.delegate=null,"throw"===r&&e.iterator.return&&(t.method="return",t.arg=void 0,E(e,t),"throw"===t.method)||"return"!==r&&(t.method="throw",t.arg=new TypeError("The iterator does not provide a '"+r+"' method")),l;var o=h(n,e.iterator,t.arg);if("throw"===o.type)return t.method="throw",t.arg=o.arg,t.delegate=null,l;var i=o.arg;return i?i.done?(t[e.resultName]=i.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,l):i:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,l)}function C(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function k(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function O(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(C,this),this.reset(!0)}function I(t){if(t){var e=t[o];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var r=-1,n=function e(){for(;++r<t.length;)if(u.call(t,r))return e.value=t[r],e.done=!1,e;return e.value=void 0,e.done=!0,e};return n.next=n}}return{next:L}}function L(){return{value:void 0,done:!0}}return f.prototype=p,d(g,"constructor",{value:p,configurable:!0}),d(p,"constructor",{value:f,configurable:!0}),f.displayName=i(p,n,"GeneratorFunction"),a.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===f||"GeneratorFunction"===(t.displayName||t.name))},a.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,p):(e.__proto__=p,i(e,n,"GeneratorFunction")),e.prototype=Object.create(g),e},a.awrap=function(e){return{__await:e}},m(w.prototype),i(w.prototype,r,function(){return this}),a.AsyncIterator=w,a.async=function(e,t,r,n,o){void 0===o&&(o=Promise);var i=new w(c(e,t,r,n),o);return a.isGeneratorFunction(t)?i:i.next().then(function(e){return e.done?e.value:i.next()})},m(g),i(g,n,"Generator"),i(g,o,function(){return this}),i(g,"toString",function(){return"[object Generator]"}),a.keys=function(e){var r=Object(e),n=[];for(var t in r)n.push(t);return n.reverse(),function e(){for(;n.length;){var t=n.pop();if(t in r)return e.value=t,e.done=!1,e}return e.done=!0,e}},a.values=I,O.prototype={constructor:O,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(k),!e)for(var t in this)"t"===t.charAt(0)&&u.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(r){if(this.done)throw r;var n=this;function e(e,t){return i.type="throw",i.arg=r,n.next=e,t&&(n.method="next",n.arg=void 0),!!t}for(var t=this.tryEntries.length-1;0<=t;--t){var o=this.tryEntries[t],i=o.completion;if("root"===o.tryLoc)return e("end");if(o.tryLoc<=this.prev){var a=u.call(o,"catchLoc"),c=u.call(o,"finallyLoc");if(a&&c){if(this.prev<o.catchLoc)return e(o.catchLoc,!0);if(this.prev<o.finallyLoc)return e(o.finallyLoc)}else if(a){if(this.prev<o.catchLoc)return e(o.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return e(o.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;0<=r;--r){var n=this.tryEntries[r];if(n.tryLoc<=this.prev&&u.call(n,"finallyLoc")&&this.prev<n.finallyLoc){var o=n;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var i=o?o.completion:{};return i.type=e,i.arg=t,o?(this.method="next",this.next=o.finallyLoc,l):this.complete(i)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),l},finish:function(e){for(var t=this.tryEntries.length-1;0<=t;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),k(r),l}},catch:function(e){for(var t=this.tryEntries.length-1;0<=t;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var o=n.arg;k(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,r){return this.delegate={iterator:I(e),resultName:t,nextLoc:r},"next"===this.method&&(this.arg=void 0),l}},a}function l(e,t,r,n){return u.apply(this,arguments)}function u(){return(u=c()(x().mark(function e(t,r,n,o){var i;return x().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return(i=new FormData).set("token",n),i.set("tableId",o),i.set("srcToken",t),i.set("srcTableId",r),i.set("rev","0"),e.abrupt("return",s.request.post(Object(s.prependAPI)("/api/bitable/applytemplate/"),i,{headers:{"Content-Type":"multipart/form-data"}}));case 7:case"end":return e.stop()}},e)}))).apply(this,arguments)}var d=function(){function t(e){var a=this;n()(this,t),this.useTemplate=function(){var t=c()(x().mark(function e(t){var r,n,o,i;return x().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.templateToken,n=t.tableId,e.prev=1,o=a.dataSource.getToken(),e.next=5,l(r,"",o,n);case 5:return i=e.sent,a.dataSource.fetchTableToMaxVersion(n,1),e.abrupt("return",i);case 10:return e.prev=10,e.t0=e.catch(1),a.showError(e.t0),e.abrupt("return",!1);case 14:case"end":return e.stop()}},e,null,[[1,10]])}));return function(e){return t.apply(this,arguments)}}(),this.dataSource=e}return i()(t,[{key:"showError",value:function(e){console.error(e),s.Toast.show({type:"error",closable:!0,content:r("common.apply_template_fail")})}}]),t}()}).call(this,f("vb163"))},vb1795:function(e,f,p){"use strict";(function(n){p.d(f,"a",function(){return h});var e=p("vb285"),o=p.n(e),t=p("vb286"),i=p.n(t),r=p("vb296"),a=p.n(r),c=p("vb103"),s=p.n(c),l=p("vb1796"),u=(p("vb1797"),p("vb284")),d="bitable-block-error-view",h=function(t){function r(){var e;return o()(this,r),(e=t.apply(this,arguments)||this).blockInfo=function(e){var t=n("bitable.bitable");return e===u.EErrorCodeType.copyError?n("CreationDoc_DocX_duplicate_block_failed_content",t):t+n("CreationDoc_Docs_Diagram.LoadingFailed.Desc")},e}return a()(r,t),i()(r,[{key:"componentDidMount",value:function(){var e=this.props.errorCodeType,t=void 0===e?u.EErrorCodeType.dataError:e;u.BitableDep.collectBitableEvent("client_bitable_in_doc_error_block",{block_type:t})}},{key:"render",value:function(){var e=this.props,t=e.errorCodeType,r=void 0===t?u.EErrorCodeType.dataError:t,n=e.offsetX;return s.a.createElement("div",{className:"".concat(d),style:{marginLeft:n}},s.a.createElement("div",{className:"".concat(d,"-img")},s.a.createElement(l.a,null)),s.a.createElement("div",{className:"".concat(d,"-text")},this.blockInfo(r)))}}]),r}(s.a.Component)}).call(this,p("vb163"))},vb1796:function(e,t,r){"use strict";var n=r("vb608"),o=r.n(n),i=r("vb103"),a=r.n(i);function c(e,t){var r={};for(var n in e)0<=t.indexOf(n)||Object.prototype.hasOwnProperty.call(e,n)&&(r[n]=e[n]);return r}t.a=function(e){e.styles;var t=c(e,["styles"]);return a.a.createElement("svg",o()({width:"88",height:"88",viewBox:"0 0 88 88",fill:"none",xmlns:"http://www.w3.org/2000/svg"},t),a.a.createElement("g",{clipPath:"url(#6dd800fc94d8ef6d718de2ecabdae5e2-a)"},a.a.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M37.62 32.08l-1.5 6.01-22.78 7.52s-1.2-5.41 9.89-12.03c4.22-2.52 1.73-3.84.9-4.81-1.8-2.1.6-3.6 4.2-5.11 3.58-1.5 0-3.01-.6-5.87-.6-2.85 4.8-9.77 11.39-11.28 6.59-1.5 16.66-.81 15.28 10.23-.3 2.4-.6 4.21-.6 4.21s-.6-2.1-3-1.2c-1.94.73-.9 2.1-3.6 0-2.39-1.2-5.39-3.91-5.09-7.52-1.8 2.7-3.3 5.41-6.9 6.61-.9 10.83 2.4 13.24 2.4 13.24z",fill:"#18263C"}),a.a.createElement("path",{d:"M48.7 24.86s5.1-.3 4.8-3.6c-.3-3.32-4.2-.31-4.2-.31M35.22 18.54s-1.3 14.25 5.1 14.44",stroke:"#18263C",strokeLinecap:"round",strokeLinejoin:"round"}),a.a.createElement("path",{d:"M13.64 45.31l22.48-7.22 1.5-5.71M26.12 44.06s4.03 14.03 17.06 10.22c13.04-3.8 10.67-19.5 10.67-19.5M42.11 11.93c-.6.3-1.5 5.11-8.69 7.52M49 20.95s-5.69-2.7-6.29-6.32",stroke:"#18263C",strokeLinecap:"round",strokeLinejoin:"round"}),a.a.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M38.88 23.12c-.43.43-1.12.43-1.54 0a1.1 1.1 0 0 1 0-1.55 1.09 1.09 0 0 1 1.54 0 1.1 1.1 0 0 1 0 1.55zM45.52 22.86a1.1 1.1 0 1 1-2.19 0 1.1 1.1 0 0 1 2.19 0z",fill:"#18263C"}),a.a.createElement("path",{d:"M40.91 28.47l-1.8.3 1.5-6.62",stroke:"#18263C",strokeLinecap:"round",strokeLinejoin:"round"}),a.a.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M53.2 22.75l-1.5 9.63-5.7 2.1v-3.9s2.4-4.22 2.7-5.42c0 0 1.61-.42 2.1-.6.65-.24 2.4-1.8 2.4-1.8z",fill:"#18263C"}),a.a.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M9.32 74.01h61.4V30.1H9.31V74z",fill:"#D6DAE1"}),a.a.createElement("path",{d:"M39.54 29.57l-2.83 22.22h5.67l-3.3 22.22",stroke:"#fff"}),a.a.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M62.73 30h7.9v-3.95h-7.9V30z",fill:"#FFC200"}),a.a.createElement("path",{d:"M.53 42.48l4.93-.41c4.98-.42 11.21-8.34 14.12-7.92 2.9.41-4.15 6.25-1.66 9.17 2.78 3.25 16.2-.84 15.78 2.91-.41 3.75-15.36 5-15.78 2.92-.41-2.08 17.86 0 17.86 3.75s-17.86 3.34-18.27 1.67c-.42-1.67 15.78.42 15.78 3.75s-16.62 3.33-17.03 1.67c-.42-1.67 14.56 1.13 14.12 3.33-.83 4.17-30.26 2.5-30.26 2.5M79.4 42.48l-4.92-.41c-4.99-.42-11.22-8.34-14.12-7.92-2.91.41 4.15 6.25 1.66 9.17-2.78 3.25-16.2-.84-15.78 2.91.41 3.75 15.36 5 15.78 2.92.41-2.08-17.86 0-17.86 3.75s17.86 3.34 18.27 1.67c.42-1.67-15.78.42-15.78 3.75s16.61 3.33 17.03 1.67c.42-1.67-14.56 1.13-14.12 3.33.83 4.17 30.26 2.5 30.26 2.5",stroke:"#18263C",strokeLinecap:"round",strokeLinejoin:"round"})),a.a.createElement("defs",null,a.a.createElement("clipPath",{id:"6dd800fc94d8ef6d718de2ecabdae5e2-a"},a.a.createElement("path",{fill:"#fff",d:"M0 0h88v88H0z"}))))}},vb1797:function(e,t,r){},vb1798:function(O,I,L){(function(e){var k,t,r;t="undefined"!=typeof self?self:"undefined"!=typeof window?window:void 0!==e?e:this,r=function(t){"use strict";var r,n=t.Base64,e="2.4.3";if(O.exports)try{r=L("vb193").Buffer}catch(e){}var o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",i=function(e){for(var t={},r=0,n=e.length;r<n;r++)t[e.charAt(r)]=r;return t}(o),a=String.fromCharCode,c=function(e){if(e.length<2)return(t=e.charCodeAt(0))<128?e:t<2048?a(192|t>>>6)+a(128|63&t):a(224|t>>>12&15)+a(128|t>>>6&63)+a(128|63&t);var t=65536+1024*(e.charCodeAt(0)-55296)+(e.charCodeAt(1)-56320);return a(240|t>>>18&7)+a(128|t>>>12&63)+a(128|t>>>6&63)+a(128|63&t)},s=/[\uD800-\uDBFF][\uDC00-\uDFFFF]|[^\x00-\x7F]/g,l=function(e){return e.replace(s,c)},u=function(e){var t=[0,2,1][e.length%3],r=e.charCodeAt(0)<<16|(1<e.length?e.charCodeAt(1):0)<<8|(2<e.length?e.charCodeAt(2):0);return[o.charAt(r>>>18),o.charAt(r>>>12&63),2<=t?"=":o.charAt(r>>>6&63),1<=t?"=":o.charAt(63&r)].join("")},d=t.btoa?function(e){return t.btoa(e)}:function(e){return e.replace(/[\s\S]{1,3}/g,u)},h=r?r.from&&r.from!==Uint8Array.from?function(e){return(e.constructor===r.constructor?e:r.from(e)).toString("base64")}:function(e){return(e.constructor===r.constructor?e:new r(e)).toString("base64")}:function(e){return d(l(e))},f=function(e,t){return t?h(String(e)).replace(/[+\/]/g,function(e){return"+"==e?"-":"_"}).replace(/=/g,""):h(String(e))},p=function(e){return f(e,!0)},v=new RegExp(["[À-ß][-¿]","[à-ï][-¿]{2}","[ð-÷][-¿]{3}"].join("|"),"g"),b=function(e){switch(e.length){case 4:var t=((7&e.charCodeAt(0))<<18|(63&e.charCodeAt(1))<<12|(63&e.charCodeAt(2))<<6|63&e.charCodeAt(3))-65536;return a(55296+(t>>>10))+a(56320+(1023&t));case 3:return a((15&e.charCodeAt(0))<<12|(63&e.charCodeAt(1))<<6|63&e.charCodeAt(2));default:return a((31&e.charCodeAt(0))<<6|63&e.charCodeAt(1))}},y=function(e){return e.replace(v,b)},g=function(e){var t=e.length,r=t%4,n=(0<t?i[e.charAt(0)]<<18:0)|(1<t?i[e.charAt(1)]<<12:0)|(2<t?i[e.charAt(2)]<<6:0)|(3<t?i[e.charAt(3)]:0),o=[a(n>>>16),a(n>>>8&255),a(255&n)];return o.length-=[0,0,2,1][r],o.join("")},m=t.atob?function(e){return t.atob(e)}:function(e){return e.replace(/[\s\S]{1,4}/g,g)},w=r?r.from&&r.from!==Uint8Array.from?function(e){return(e.constructor===r.constructor?e:r.from(e,"base64")).toString()}:function(e){return(e.constructor===r.constructor?e:new r(e,"base64")).toString()}:function(e){return y(m(e))},S=function(e){return w(String(e).replace(/[-_]/g,function(e){return"-"==e?"+":"/"}).replace(/[^A-Za-z0-9\+\/]/g,""))},E=function(){var e=t.Base64;return t.Base64=n,e};if(t.Base64={VERSION:e,atob:m,btoa:d,fromBase64:S,toBase64:f,utob:l,encode:f,encodeURI:p,btou:y,decode:S,noConflict:E},"function"==typeof Object.defineProperty){var C=function(e){return{value:e,enumerable:!1,writable:!0,configurable:!0}};t.Base64.extendString=function(){Object.defineProperty(String.prototype,"fromBase64",C(function(){return S(this)})),Object.defineProperty(String.prototype,"toBase64",C(function(e){return f(this,e)})),Object.defineProperty(String.prototype,"toBase64URI",C(function(){return f(this,!0)}))}}return t.Meteor&&(Base64=t.Base64),O.exports?O.exports.Base64=t.Base64:void 0===(k=function(){return t.Base64}.apply(I,[]))||(O.exports=k),{Base64:t.Base64}},O.exports=r(t)}).call(this,L("vb301"))},vb2309:function(e,t,r){"use strict";r.r(t);var n=r("vb285"),h=r.n(n),o=r("vb286"),d=r.n(o),i=r("vb360"),b=r.n(i),a=r("vb378"),w=r.n(a),c=r("vb328"),S=r.n(c),s=r("vb296"),f=r.n(s),l=r("vb106"),T=r.n(l),u=r("vb162"),p=r("vb107"),y=r.n(p),v=r("vb105"),g=r.n(v),m=r("vb110"),O=r.n(m),E=function(){function e(){h()(this,e)}return d()(e,null,[{key:"createForFullScreen",value:function(){var e=0<arguments.length&&void 0!==arguments[0]&&arguments[0],t=document.createElement("div"),r=document.getElementById("mainContainer")||document.body;return e&&(r=document.querySelector(".create-by-template__container")||r),Object.assign(t.style,{position:"absolute",top:"0",left:"0",right:"0",bottom:"0",zIndex:"100",backgroundColor:"var(--bg-body)"}),t.className="layout-column flex",r.appendChild(t),t}},{key:"createForHistory",value:function(){var e=document.createElement("div"),t=document.getElementById("mainContainer");return Object.assign(e.style,{position:"fixed",top:"0",left:"0",right:"0",bottom:"0",zIndex:"88",backgroundColor:"var(--bg-body)"}),t.appendChild(e),e}},{key:"remove",value:function(e){e&&e.parentElement&&e.parentElement.removeChild(e)}}]),e}(),C=function(e){return window.requestAnimationFrame?window.requestAnimationFrame(e):window.setTimeout(e,16)},k=r("vb103"),I=r.n(k),L=r("vb114"),x=r("vb161"),M=r("vb567"),B=r("vb284"),_=r("vb102"),j=r("vb1788"),P=r("vb1791");function D(e){return e&&(e=Object(x.a)(e)),Object(M.createStore)({initialState:e,enhancers:[],extensions:[Object(j.getSagaExtension)(),Object(P.getThunkExtension)()]},Object(_.getAppStateModule)(),Object(_.getEntitiesModule)(),Object(B.getBitableModule)())}var R=r("vb517"),F=B.EmbeddedBitableHistoryForDoc,N=function(r){function n(e){var t;return h()(this,n),(t=r.call(this,e)||this).state={height:Math.round(.85*window.innerHeight)},t}return f()(n,r),d()(n,[{key:"componentDidMount",value:function(){var e=this;this._resizeHandler=function(){e.setState({height:Math.round(.85*window.innerHeight)})},window.addEventListener("resize",this._resizeHandler)}},{key:"componentWillUnmount",value:function(){window.removeEventListener("resize",this._resizeHandler)}},{key:"render",value:function(){return I.a.createElement("div",{className:"bitable-in-doc-history-mode bitable-in-doc",style:{height:this.state.height}},I.a.createElement(F,Object.assign({},this.props,{embeddedType:R.a.EmbeddedInDoc,hideTab:!0})))}}]),n}(I.a.Component);function U(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),r.push.apply(r,n)}return r}function V(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?U(Object(r),!0).forEach(function(e){g()(t,e,r[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):U(Object(r)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))})}return t}function H(){H=function(){return a};var a={},e=Object.prototype,u=e.hasOwnProperty,d=Object.defineProperty||function(e,t,r){e[t]=r.value},t="function"==typeof Symbol?Symbol:{},o=t.iterator||"@@iterator",r=t.asyncIterator||"@@asyncIterator",n=t.toStringTag||"@@toStringTag";function i(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{i({},"")}catch(e){i=function(e,t,r){return e[t]=r}}function c(e,t,r,n){var o=t&&t.prototype instanceof s?t:s,i=Object.create(o.prototype),a=new O(n||[]);return d(i,"_invoke",{value:S(e,r,a)}),i}function h(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}a.wrap=c;var l={};function s(){}function f(){}function p(){}var v={};i(v,o,function(){return this});var b=Object.getPrototypeOf,y=b&&b(b(I([])));y&&y!==e&&u.call(y,o)&&(v=y);var g=p.prototype=s.prototype=Object.create(v);function m(e){["next","throw","return"].forEach(function(t){i(e,t,function(e){return this._invoke(t,e)})})}function w(c,s){function l(e,t,r,n){var o=h(c[e],c,t);if("throw"!==o.type){var i=o.arg,a=i.value;return a&&"object"==T()(a)&&u.call(a,"__await")?s.resolve(a.__await).then(function(e){l("next",e,r,n)},function(e){l("throw",e,r,n)}):s.resolve(a).then(function(e){i.value=e,r(i)},function(e){return l("throw",e,r,n)})}n(o.arg)}var t;d(this,"_invoke",{value:function(r,n){function e(){return new s(function(e,t){l(r,n,e,t)})}return t=t?t.then(e,e):e()}})}function S(i,a,c){var s="suspendedStart";return function(e,t){if("executing"===s)throw new Error("Generator is already running");if("completed"===s){if("throw"===e)throw t;return L()}for(c.method=e,c.arg=t;;){var r=c.delegate;if(r){var n=E(r,c);if(n){if(n===l)continue;return n}}if("next"===c.method)c.sent=c._sent=c.arg;else if("throw"===c.method){if("suspendedStart"===s)throw s="completed",c.arg;c.dispatchException(c.arg)}else"return"===c.method&&c.abrupt("return",c.arg);s="executing";var o=h(i,a,c);if("normal"===o.type){if(s=c.done?"completed":"suspendedYield",o.arg===l)continue;return{value:o.arg,done:c.done}}"throw"===o.type&&(s="completed",c.method="throw",c.arg=o.arg)}}}function E(e,t){var r=t.method,n=e.iterator[r];if(void 0===n)return t.delegate=null,"throw"===r&&e.iterator.return&&(t.method="return",t.arg=void 0,E(e,t),"throw"===t.method)||"return"!==r&&(t.method="throw",t.arg=new TypeError("The iterator does not provide a '"+r+"' method")),l;var o=h(n,e.iterator,t.arg);if("throw"===o.type)return t.method="throw",t.arg=o.arg,t.delegate=null,l;var i=o.arg;return i?i.done?(t[e.resultName]=i.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,l):i:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,l)}function C(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function k(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function O(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(C,this),this.reset(!0)}function I(t){if(t){var e=t[o];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var r=-1,n=function e(){for(;++r<t.length;)if(u.call(t,r))return e.value=t[r],e.done=!1,e;return e.value=void 0,e.done=!0,e};return n.next=n}}return{next:L}}function L(){return{value:void 0,done:!0}}return f.prototype=p,d(g,"constructor",{value:p,configurable:!0}),d(p,"constructor",{value:f,configurable:!0}),f.displayName=i(p,n,"GeneratorFunction"),a.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===f||"GeneratorFunction"===(t.displayName||t.name))},a.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,p):(e.__proto__=p,i(e,n,"GeneratorFunction")),e.prototype=Object.create(g),e},a.awrap=function(e){return{__await:e}},m(w.prototype),i(w.prototype,r,function(){return this}),a.AsyncIterator=w,a.async=function(e,t,r,n,o){void 0===o&&(o=Promise);var i=new w(c(e,t,r,n),o);return a.isGeneratorFunction(t)?i:i.next().then(function(e){return e.done?e.value:i.next()})},m(g),i(g,n,"Generator"),i(g,o,function(){return this}),i(g,"toString",function(){return"[object Generator]"}),a.keys=function(e){var r=Object(e),n=[];for(var t in r)n.push(t);return n.reverse(),function e(){for(;n.length;){var t=n.pop();if(t in r)return e.value=t,e.done=!1,e}return e.done=!0,e}},a.values=I,O.prototype={constructor:O,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(k),!e)for(var t in this)"t"===t.charAt(0)&&u.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(r){if(this.done)throw r;var n=this;function e(e,t){return i.type="throw",i.arg=r,n.next=e,t&&(n.method="next",n.arg=void 0),!!t}for(var t=this.tryEntries.length-1;0<=t;--t){var o=this.tryEntries[t],i=o.completion;if("root"===o.tryLoc)return e("end");if(o.tryLoc<=this.prev){var a=u.call(o,"catchLoc"),c=u.call(o,"finallyLoc");if(a&&c){if(this.prev<o.catchLoc)return e(o.catchLoc,!0);if(this.prev<o.finallyLoc)return e(o.finallyLoc)}else if(a){if(this.prev<o.catchLoc)return e(o.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return e(o.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;0<=r;--r){var n=this.tryEntries[r];if(n.tryLoc<=this.prev&&u.call(n,"finallyLoc")&&this.prev<n.finallyLoc){var o=n;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var i=o?o.completion:{};return i.type=e,i.arg=t,o?(this.method="next",this.next=o.finallyLoc,l):this.complete(i)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),l},finish:function(e){for(var t=this.tryEntries.length-1;0<=t;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),k(r),l}},catch:function(e){for(var t=this.tryEntries.length-1;0<=t;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var o=n.arg;k(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,r){return this.delegate={iterator:I(e),resultName:t,nextLoc:r},"next"===this.method&&(this.arg=void 0),l}},a}var W,z,K,Y,Q=240,X={width:Q,offsetX:0},J=function(){function t(e){var i=this;h()(this,t),this.components=e,this.containerSize={},this.maxWidth=Q,this.docWidth=2*Q,this.actionTypeMap=new Map,this.zoom=1,this.updateOverlayRafId=null,this.openHistoryPanel=function(e){i.historyOverlay=E.createForHistory();var t=D(_.store.getState());C(function(){O.a.render(I.a.createElement(L.Provider,{store:t},I.a.createElement(N,Object.assign({},e,{io:_.IO.getInstance(),store:t,hideHistory:i.closeHistoryPanel}))),i.historyOverlay)})},this.closeHistoryPanel=function(){var e=i.historyOverlay;e&&(O.a.unmountComponentAtNode(e),E.remove(e),i.historyOverlay=null)},this.getRecordRectByCommentId=function(e,t){var r=i.components.get(e);if(!r)return null;var n=r.getSmartableCommentManager(e).findCommentRecordId(e,t);return n&&r.getRecordRectByRecordId?r.getRecordRectByRecordId(n):null},this.locateMention=function(){var n=y()(H().mark(function e(t,r,n){var o;return H().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(o=i.components.get(t)){e.next=3;break}return e.abrupt("return",!1);case 3:return e.next=5,o.locateMention(t,r,n);case 5:return e.abrupt("return",e.sent);case 6:case"end":return e.stop()}},e)}));return function(e,t,r){return n.apply(this,arguments)}}(),this.registerScrollContainerRef=function(e,t){var r=i.components.get(e);if(r)return r.registerScrollContainerRef&&r.registerScrollContainerRef(e,t)},this.updateErrorCodeType=function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:B.EErrorCodeType.none,r=i.components.get(e);if(r)return r.updateErrorCodeType&&r.updateErrorCodeType(t)}}return d()(t,[{key:"setWidth",value:function(e,t,r){this.containerSize[e]||(this.containerSize[e]=V({},X)),this.containerSize[e].width=t,null!=r&&(this.containerSize[e].offsetX=r);var n=this.components.get(e);n&&(n.setMaxWidth(t),null!=r&&n.setOffsetX(r))}},{key:"setDocWidth",value:function(t,e){if(this.docWidth=t,e){var r=this.components.get(e);r&&r.setDocWidth(t)}else this.components.forEach(function(e){return e.setDocWidth(t)})}},{key:"getContainerSize",value:function(){return this.containerSize}},{key:"getWidth",value:function(){return this.maxWidth}},{key:"getDocWidth",value:function(){return this.docWidth}},{key:"getActionTypeMap",value:function(){return this.actionTypeMap}},{key:"setMaxWidth",value:function(e){var t=this;this.maxWidth=e,this.components.forEach(function(e){return e.setMaxWidth(t.maxWidth)})}},{key:"setHeight",value:function(t){this.height=t,this.components.forEach(function(e){return e.setHeight(t)})}},{key:"getHeight",value:function(){return this.height}},{key:"setSize",value:function(t,r){this.components.forEach(function(e){return e.setSize(t,r)})}},{key:"setZoom",value:function(t){this.zoom=t,this.components.forEach(function(e){return e.setZoom(t)})}},{key:"getZoom",value:function(){return this.zoom}},{key:"syncVirtualScroll",value:function(e){var r=this;e&&e.length?e.forEach(function(e){var t=r.components.get(e);t&&t.syncVirtualScroll()}):this.components.forEach(function(e){return e.syncVirtualScroll()})}},{key:"onBlockPositionChange",value:function(){var e=this;null!==this.updateOverlayRafId&&(cancelAnimationFrame(this.updateOverlayRafId),this.updateOverlayRafId=null),this.updateOverlayRafId=requestAnimationFrame(function(){e.updateOverlayRafId=null,e.components.forEach(function(e){return e.updateOverlayerPosition()})})}},{key:"currentScreenShot",value:function(e){var t=this.components.get(e);if(t)return t.currentScreenShot()}},{key:"takeScreenShot",value:function(){var n=y()(H().mark(function e(t,r,n){var o;return H().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!(o=this.components.get(t))||!o.takeScreenShot){e.next=3;break}return e.abrupt("return",o.takeScreenShot(r,n));case 3:case"end":return e.stop()}},e,this)}));function e(e,t,r){return n.apply(this,arguments)}return e}()},{key:"getBitableViewScrollInfo",value:function(e){var t=this.components.get(e);return t&&t.getBitableViewScrollInfo?t.getBitableViewScrollInfo():{scrollPosX:0,contentWidth:0}}},{key:"setBitableViewScrollPosition",value:function(e,t,r){var n=this.components.get(e);if(n&&n.setBitableViewScrollPosition)return n.setBitableViewScrollPosition(t,r)}},{key:"updateSelectionState",value:function(e,t,r){var n=this.components.get(e);n&&n.updateSelect?n.updateSelect(t,r):console.warn("component not found, unable to update")}},{key:"updateHighlight",value:function(e,t){var r=this.components.get(e);r?r.updateHighlight(t):this.actionTypeMap.set(e,t)}},{key:"updateBitableContent",value:function(e){var t=this.components.get(e);t&&t.updateBitableContent()}},{key:"collapseLineChange",value:function(e,t){var r=this.components.get(e);r&&r.collapseLineChange(t)}},{key:"getSearchResult",value:function(e,t){var r=this.components.get(e);return r&&r.getSearchResult?r.getSearchResult(e,t):[]}},{key:"getSearchItemPos",value:function(e,t){var r=this.components.get(e);return r&&r.getSearchItemPos?r.getSearchItemPos(e,t):{x:0,y:0,width:0,height:0}}},{key:"highlightSearchItem",value:function(e,t,r){var n=this.components.get(e);n&&n.highlightSearchItem&&n.highlightSearchItem(e,t,r)}},{key:"clearHighlight",value:function(e,t){var r=this.components.get(e);r&&r.clearHighlight&&r.clearHighlight(e,t)}}]),t}();(z=W||(W={})).INSIDE_PAGE="insidePage",z.PASTE="paste",z.USER_INSERT="userInsert",(Y=K||(K={}))[Y.Add=0]="Add",Y[Y.Paste=1]="Paste",Y[Y.Del=2]="Del";var q=r("vb1792"),Z=function(){function r(e,t){h()(this,r),this.components=e,this.displayMultiple=t}return d()(r,[{key:"getComponents",value:function(e){var t=this.components.get(e);return this.displayMultiple||(t=this.components.values().next().value),t}},{key:"setOnMentionBatchUpdate",value:function(e,t,r){var n=this.getComponents(e);n&&n.setMentionBatchUpdate(e,t,r)}},{key:"getMentions",value:function(e){var t=this.getComponents(e);return t?t.getMentions(e):[]}},{key:"supplementMentionIdByTableId",value:function(e){var t=this.getComponents(e);return t?t.supplementMentionIdByTableId(e):Promise.resolve(!1)}}]),r}();function $(){$=function(){return a};var a={},e=Object.prototype,u=e.hasOwnProperty,d=Object.defineProperty||function(e,t,r){e[t]=r.value},t="function"==typeof Symbol?Symbol:{},o=t.iterator||"@@iterator",r=t.asyncIterator||"@@asyncIterator",n=t.toStringTag||"@@toStringTag";function i(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{i({},"")}catch(e){i=function(e,t,r){return e[t]=r}}function c(e,t,r,n){var o=t&&t.prototype instanceof s?t:s,i=Object.create(o.prototype),a=new O(n||[]);return d(i,"_invoke",{value:S(e,r,a)}),i}function h(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}a.wrap=c;var l={};function s(){}function f(){}function p(){}var v={};i(v,o,function(){return this});var b=Object.getPrototypeOf,y=b&&b(b(I([])));y&&y!==e&&u.call(y,o)&&(v=y);var g=p.prototype=s.prototype=Object.create(v);function m(e){["next","throw","return"].forEach(function(t){i(e,t,function(e){return this._invoke(t,e)})})}function w(c,s){function l(e,t,r,n){var o=h(c[e],c,t);if("throw"!==o.type){var i=o.arg,a=i.value;return a&&"object"==T()(a)&&u.call(a,"__await")?s.resolve(a.__await).then(function(e){l("next",e,r,n)},function(e){l("throw",e,r,n)}):s.resolve(a).then(function(e){i.value=e,r(i)},function(e){return l("throw",e,r,n)})}n(o.arg)}var t;d(this,"_invoke",{value:function(r,n){function e(){return new s(function(e,t){l(r,n,e,t)})}return t=t?t.then(e,e):e()}})}function S(i,a,c){var s="suspendedStart";return function(e,t){if("executing"===s)throw new Error("Generator is already running");if("completed"===s){if("throw"===e)throw t;return L()}for(c.method=e,c.arg=t;;){var r=c.delegate;if(r){var n=E(r,c);if(n){if(n===l)continue;return n}}if("next"===c.method)c.sent=c._sent=c.arg;else if("throw"===c.method){if("suspendedStart"===s)throw s="completed",c.arg;c.dispatchException(c.arg)}else"return"===c.method&&c.abrupt("return",c.arg);s="executing";var o=h(i,a,c);if("normal"===o.type){if(s=c.done?"completed":"suspendedYield",o.arg===l)continue;return{value:o.arg,done:c.done}}"throw"===o.type&&(s="completed",c.method="throw",c.arg=o.arg)}}}function E(e,t){var r=t.method,n=e.iterator[r];if(void 0===n)return t.delegate=null,"throw"===r&&e.iterator.return&&(t.method="return",t.arg=void 0,E(e,t),"throw"===t.method)||"return"!==r&&(t.method="throw",t.arg=new TypeError("The iterator does not provide a '"+r+"' method")),l;var o=h(n,e.iterator,t.arg);if("throw"===o.type)return t.method="throw",t.arg=o.arg,t.delegate=null,l;var i=o.arg;return i?i.done?(t[e.resultName]=i.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,l):i:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,l)}function C(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function k(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function O(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(C,this),this.reset(!0)}function I(t){if(t){var e=t[o];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var r=-1,n=function e(){for(;++r<t.length;)if(u.call(t,r))return e.value=t[r],e.done=!1,e;return e.value=void 0,e.done=!0,e};return n.next=n}}return{next:L}}function L(){return{value:void 0,done:!0}}return f.prototype=p,d(g,"constructor",{value:p,configurable:!0}),d(p,"constructor",{value:f,configurable:!0}),f.displayName=i(p,n,"GeneratorFunction"),a.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===f||"GeneratorFunction"===(t.displayName||t.name))},a.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,p):(e.__proto__=p,i(e,n,"GeneratorFunction")),e.prototype=Object.create(g),e},a.awrap=function(e){return{__await:e}},m(w.prototype),i(w.prototype,r,function(){return this}),a.AsyncIterator=w,a.async=function(e,t,r,n,o){void 0===o&&(o=Promise);var i=new w(c(e,t,r,n),o);return a.isGeneratorFunction(t)?i:i.next().then(function(e){return e.done?e.value:i.next()})},m(g),i(g,n,"Generator"),i(g,o,function(){return this}),i(g,"toString",function(){return"[object Generator]"}),a.keys=function(e){var r=Object(e),n=[];for(var t in r)n.push(t);return n.reverse(),function e(){for(;n.length;){var t=n.pop();if(t in r)return e.value=t,e.done=!1,e}return e.done=!0,e}},a.values=I,O.prototype={constructor:O,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(k),!e)for(var t in this)"t"===t.charAt(0)&&u.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(r){if(this.done)throw r;var n=this;function e(e,t){return i.type="throw",i.arg=r,n.next=e,t&&(n.method="next",n.arg=void 0),!!t}for(var t=this.tryEntries.length-1;0<=t;--t){var o=this.tryEntries[t],i=o.completion;if("root"===o.tryLoc)return e("end");if(o.tryLoc<=this.prev){var a=u.call(o,"catchLoc"),c=u.call(o,"finallyLoc");if(a&&c){if(this.prev<o.catchLoc)return e(o.catchLoc,!0);if(this.prev<o.finallyLoc)return e(o.finallyLoc)}else if(a){if(this.prev<o.catchLoc)return e(o.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return e(o.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;0<=r;--r){var n=this.tryEntries[r];if(n.tryLoc<=this.prev&&u.call(n,"finallyLoc")&&this.prev<n.finallyLoc){var o=n;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var i=o?o.completion:{};return i.type=e,i.arg=t,o?(this.method="next",this.next=o.finallyLoc,l):this.complete(i)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),l},finish:function(e){for(var t=this.tryEntries.length-1;0<=t;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),k(r),l}},catch:function(e){for(var t=this.tryEntries.length-1;0<=t;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var o=n.arg;k(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,r){return this.delegate={iterator:I(e),resultName:t,nextLoc:r},"next"===this.method&&(this.arg=void 0),l}},a}function ee(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),r.push.apply(r,n)}return r}function te(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?ee(Object(r),!0).forEach(function(e){g()(t,e,r[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):ee(Object(r)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))})}return t}var re=!0,ne=function(){function a(e,t,r,n,o,i){var s=this;h()(this,a),this.token=e,this.displayMultiple=t,this.getOrders=r,this.hostType=n,this.blockExtraFunctions=o,this.reduxStore=i,this.mountQueue=[],this.mountEventQueue=new Map,this.hosts={},this.containers={},this.isRender=!1,this.mountOptions={},this.historyStoreMap=new Map,this.mountingInfo=null,this.autoSwitchActiveId=!1,this.selectionState=[],this.updateSelectionStateCoreTimer=0,this.previewHistoryOptions={isHighlight:!1,users:{}},this.blockMountResolver=new Map,this.isBlockMount=new Map,this.mountNext=function(){var e=s.mountQueue.shift();if(s.mountingInfo=null,e){var t=e.id,r=e.option;if(t){var n=r.createdSource===B.BitableDep.ExternalConst.CreatedSource.USER_INSERT,o=r.createdSource===B.BitableDep.ExternalConst.CreatedSource.PASTE;if(!n&&!o){var i=t+"_"+B.BitableBlockLoadedStage.BlockLoaded+"_"+B.BitableBlockLoadedStage.Done;B.TrackerInstance.start(B.BitableBlockLoadedStage.BlockLoaded,{},{eventKey:i})}var a=t+"_"+B.BitableBlockLoadedStage.BlockLoaded+"_"+B.BitableBlockLoadedStage.InitSmartable;if(B.TrackerInstance.start(B.BitableBlockLoadedStage.BlockLoaded,{},{eventKey:a}),s.mountOptions[t]=r,s.mountingInfo=e,!s.displayMultiple&&s.isRender)return s.mountingInfo.resolve(),s.mountingInfo=null,s.active(t),void(0<s.mountQueue.length&&setTimeout(function(){s.mountingInfo=null,s.mountNext()}));if(s.contentManager){var c=s.hosts[t];c?(B.BitableDep.collectBitableEvent("client_bitable_block_mount",{stage:"mount_queue_next",table_id:t}),s.isRender=!0,O.a.render(s.getEmbeddedComponent(t),c),setTimeout(function(){s.mountingInfo=null,s.mountNext()},200)):s.collectMountError("contentManager host undefined",t)}else s.collectMountError("contentManager undefined",t)}}},this.updateBlockMountStatus=function(e){var t=s.blockMountResolver.get(e);t&&t.forEach(function(e){e&&e()})},this.onComponentContentLoaded=function(e,t){e&&e.resolve();var r=t.base.getTableById(e.id),n={};r&&(n={fields_num:Object.keys(r.fields).length,records_num:Object.keys(r.records).length}),n.createdSource=e.option.createdSource,B.BitableDep.injectBitableDepAsync&&B.BitableDep.injectBitableDepAsync();var o=e.id+"_"+B.BitableBlockLoadedStage.BlockLoaded+"_"+B.BitableBlockLoadedStage.DomRender;B.TrackerInstance.send(B.BitableBlockLoadedStage.BlockLoaded,te({stage:B.BitableBlockLoadedStage.DomRender},n),{eventKey:o}),o=e.id+"_"+B.BitableBlockLoadedStage.BlockLoaded+"_"+B.BitableBlockLoadedStage.Done,B.TrackerInstance.send(B.BitableBlockLoadedStage.BlockLoaded,te({stage:B.BitableBlockLoadedStage.Done},n),{eventKey:o}),B.BitableDep.collectBitableEvent("client_bitable_block_mount",{stage:"mount_queue_render_done",table_id:e.id})},this.onClientVarLoaded=function(){var t=y()($().mark(function e(t){var r,n,o,i;return $().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=s.contentManager.getTableById(t)){e.next=3;break}return e.abrupt("return");case 3:return e.next=5,r.waitTableLoaded();case 5:if(!(n=s.contentPersenters.get(t))){e.next=9;break}return e.next=9,n.handleBitableIfPaste();case 9:o=s.commentManager.getNotifyCommentLoadedFn(t),i=s.commentManager.getComments(t),o&&o(i),s.uiManager.updateErrorCodeType(t);case 13:case"end":return e.stop()}},e)}));return function(e){return t.apply(this,arguments)}}(),this.onClientVarError=function(e,t){var r=s.mountEventQueue.get(e);r&&r(),s.mountOptions[e]&&(s.mountOptions[e].errorCodeType=Object(B.getErrorCodeType)(t)),s.uiManager.updateErrorCodeType(e,Object(B.getErrorCodeType)(t))},this.onTableChangedInUndo=function(e){if(s.mountOptions[e]){var t=s.mountOptions[e].operator.activeTab;t&&t(e)}},this.onDataChanged=function(e){if(s.mountOptions[e]){var t=s.mountOptions[e].operator.onChanged;t&&t(e)}},this.internalSizeChanged=function(e,t,r,n,o,i){if(s.mountOptions[e]){var a=s.mountOptions[e].operator.internalSizeChange;a&&a(r,t,n,o,i)}},this.editbarPinChanged=function(e,t){if(s.mountOptions[e]){var r=s.mountOptions[e].operator.editbarPinChange;r&&r(t)}},this.updateSelectionState=function(r,e,n){var t=function(){1===s.selectionState.length?s.selectionState.forEach(function(e){var t=s.contentPersenters.get(r);t&&(t.getSelection()?s.uiManager.updateSelectionState(e,!1,n):s.uiManager.updateSelectionState(e,!0,n))}):s.selectionState.forEach(function(e){s.uiManager.updateSelectionState(e,!0,n)})};window.clearTimeout(s.updateSelectionStateCoreTimer),e?(s.selectionState.push(r),s.updateSelectionStateCoreTimer=window.setTimeout(t,10)):(s.selectionState=s.selectionState.filter(function(e){return e!==r}),s.uiManager.updateSelectionState(r,!1))},this.findNextActiveId=function(t){if(!s.contentManager)return"";var e=s.contentManager.dataSource.getActivedId();if(e!==t)return e;var r=s.mountedIds.findIndex(function(e){return e===t}),n=0<r?r-1:1;return s.mountedIds[n]},this.activeNext=function(e){if(s.contentManager&&s.contentManager.dataSource&&0<s.mountedIds.length){var t=s.contentManager.dataSource;(t.getIndexFromId(e)||0)!==t.getIndexFromId(t.getActivedId())&&t.active(t.getIndexFromId(e)||0)}},this.addContentPresenter=function(){var e=s.getAction(K.Add,null);s.contentManager&&s.contentManager.executeLocalActions(e)},this.pasteContentPresenter=function(e){var t=s.getAction(K.Paste,e);s.contentManager&&s.contentManager.executeLocalActions(t)},this.delContentPresenter=function(e){var t=s.getAction(K.Paste,e);s.contentManager&&s.contentManager.executeLocalActions(t)},this.contentPersenters=new Map,this.contentManager=this.createContentManager(),this.uiManager=new J(this.contentPersenters),this.commentManager=new q.a(this.contentPersenters,this.contentManager,t),this.mentionManager=new Z(this.contentPersenters,t),this.mountedIds=[],r&&r().forEach(function(e){s.mountedIds.push("object"===T()(e)?e.tableId:e)})}return d()(a,[{key:"mountContentPresenter",value:function(e){var t=e.id,r=e.host;try{if(re){var n,o=window.scmbitable.tracker;B.TrackerInstance.send(B.BitableBlockLoadedStage.BlockLoaded,{stage:B.BitableBlockLoadedStage.CommonjsLoad,cost_time:o.common_cost_time},{eventKey:B.BitableBlockLoadedStage.CommonjsLoad}),B.TrackerInstance.send(B.BitableBlockLoadedStage.BlockLoaded,{stage:B.BitableBlockLoadedStage.SmartablejsLoad,cost_time:o.initBitable_const_time},{eventKey:B.BitableBlockLoadedStage.SmartablejsLoad}),B.BitableDep.collectBitableEvent("bitable_scm",{bitableVersion:window.scmbitable.scmInfo.version,bitableSdkVersion:window.scmbitable.pkgInfo.sdk_version,bearwebVersion:window.scm.version,stage:null===(n=window.scmbitable)||void 0===n?void 0:n.stage})}re=!1}catch(e){console.log(e)}var i=e.createdSource===B.BitableDep.ExternalConst.CreatedSource.USER_INSERT,a=e.createdSource===B.BitableDep.ExternalConst.CreatedSource.PASTE;if(i||a){var c=t+"_"+B.BitableBlockLoadedStage.BlockLoaded+"_"+B.BitableBlockLoadedStage.GetToken;B.TrackerInstance.send(B.BitableBlockLoadedStage.BlockLoaded,{stage:B.BitableBlockLoadedStage.GetToken},{eventKey:c})}if(!r){var s="Container Cannot Be Null";throw this.collectMountError(s,t),new Error(s)}if(0<this.mountQueue.filter(function(e){return e.id===t}).length){var l="MountQueue Repeat";throw this.collectMountError(l,t),new Error(l)}return this.contentManager.initUndoManager(e.undoDispatcher),this.currentActiveId=e.id,this.mountOptions[t]=e,this.addHost(t,r),B.BitableDep.collectBitableEvent("client_bitable_block_mount",{stage:"mount_queue_add",table_id:t}),this.mountPromise(t,e)}},{key:"addHost",value:function(e,t){if(this.containers[e]=this.containers[e]||t,this.displayMultiple||!(0<Object.keys(this.hosts).length)){var r=this.hosts[e]||document.createElement("div");this.displayMultiple||(r.className="bitable-in-sheet__component-wrapper"),t.innerHTML="",t.appendChild(r),this.hosts[e]=r}}},{key:"mountPromise",value:function(r,n){var o=this;return new Promise(function(e,t){o.mountQueue.push({id:r,option:n,resolve:e,reject:t}),o.mountEventQueue.set(r,e),o.mountingInfo||o.mountNext()})}},{key:"getEmbeddedComponent",value:function(t){var r=this;return this.createEmbeddedComponent(t,function(e){return r.onComponentDidMount(t,e,r.mountingInfo)},this.onComponentContentLoaded,this.mountingInfo)}},{key:"notify",value:function(r,n){var o=n.targetIds;this.contentPersenters.forEach(function(e,t){t!==r&&(!o||-1<o.indexOf(t))&&e.receive(n.name)})}},{key:"getIsBlockMount",value:function(e){return!!this.isBlockMount.get(e)}},{key:"waitBlockMount",value:function(r){var n=this;return new Promise(function(e){if(n.getIsBlockMount(r))e();else{var t=n.blockMountResolver.get(r)||[];t.push(e),n.blockMountResolver.set(r,t)}})}},{key:"onComponentDidMount",value:function(t,r,e){var n=this;if(!this.isDestroyed){r.setNotifier(function(e){return n.notify(t,e)}),this.contentPersenters.set(t,r);var o={onClientVarLoaded:function(){var e=y()($().mark(function e(){return $().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r.handleBitableIfPaste();case 2:r.onLoadedTable();case 3:case"end":return e.stop()}},e)}));function t(){return e.apply(this,arguments)}return t}(),addNewTable:function(){},switchTable:function(){},onClientVarError:this.onClientVarError};if(e&&e.option&&e.option.historyInfo){var i=e.option.historyInfo;r.previewHistory(i,te({activeTableId:t},this.previewHistoryOptions))}else{var a=this.mountOptions[t],c=a.isHistoryMode,s=a.isTranslateMode;this.contentManager.initContents([t],t,o,c||s,2),this.contentManager.translateMode&&this.contentManager.dataSource.freeze()}this.updateBlockMountStatus(t),this.isBlockMount.set(t,!0)}}},{key:"activeBitable",value:function(e){this.setActiveBitableId(e),this.active(e)}},{key:"setActiveBitableId",value:function(e){this.currentActiveId=e}},{key:"enterHistoryMode",value:function(e,t,r){}},{key:"active",value:function(e){if(this.currentActiveId===e){var t=this.contentPersenters.values().next().value;if(!this.displayMultiple&&t){var r=Object.values(this.hosts)[0],n={switchTable:function(){t.switchTable(e)},onClientVarLoaded:function(){t.loadedTable(e)},addNewTable:function(){t.addNewTable(e)},onClientVarError:this.onClientVarError};r.parentElement&&r.parentElement.removeChild(r),this.containers[e].appendChild(r);var o=this.mountOptions[e],i=o.isHistoryMode,a=o.isTranslateMode;this.contentManager.initContents([e],e,n,i||a)}}}},{key:"unmountContentPresenter",value:function(t){var r=this,e=1<arguments.length&&void 0!==arguments[1]&&arguments[1],n=this.hosts[t];if(this.contentManager&&(n||!this.displayMultiple)){var o=this.contentPersenters.get(t);if(delete this.uiManager.getContainerSize()[t],o&&(o.cancelPaste(),o.destroy()),delete this.containers[t],this.selectionState=this.selectionState.filter(function(e){return e!==t}),e){var i=this.commentManager.getSmartableCommentManager(t);i&&i.showNewCommentFailTip(t)}if(this.displayMultiple){this.contentPersenters.delete(t),delete this.hosts[t],delete this.mountOptions[t],this.historyStoreMap.delete(t);var a=this.autoSwitchActiveId?this.findNextActiveId(t):null;this.mountQueue=this.mountQueue.filter(function(e){return e.id!==t});try{O.a.unmountComponentAtNode(n),this.autoSwitchActiveId&&(a&&0<a.length&&this.activeNext(a),this.mountedIds=[],this.getOrders&&this.getOrders().forEach(function(e){r.mountedIds.push("object"===T()(e)?e.tableId:e)}),this.contentManager&&this.contentManager.reorder())}catch(e){}}else if(0===Object.keys(this.containers).length){var c=Object.values(this.hosts)[0];c&&O.a.unmountComponentAtNode(c),this.contentPersenters.clear(),this.hosts={},this.mountOptions={},this.isRender=!1}}}},{key:"fetchClientVars",value:function(e,t){this.contentManager.initContents(e,t,{onClientVarLoaded:this.onClientVarLoaded,onClientVarError:this.onClientVarError})}},{key:"freeze",value:function(){this.contentManager&&this.contentManager.dataSource&&this.contentManager.dataSource.freeze()}},{key:"unfreeze",value:function(){this.contentManager&&this.contentManager.dataSource&&this.contentManager.dataSource.unfreeze()}},{key:"suspend",value:function(e){this.contentManager&&this.contentManager.dataSource&&this.contentManager.dataSource.suspend(e)}},{key:"resume",value:function(e){this.contentManager&&this.contentManager.dataSource&&this.contentManager.dataSource.resume(e)}},{key:"enableEdit",value:function(){this.contentManager&&this.contentManager.dataSource&&this.contentManager.dataSource.enableEdit()}},{key:"disableEdit",value:function(){this.contentManager&&this.contentManager.dataSource&&this.contentManager.dataSource.disableEdit()}},{key:"previewHistory",value:function(t,e){var r=this;if(e&&e.users&&(this.previewHistoryOptions.isHighlight=Boolean(e.isHighlight),Object.assign(this.previewHistoryOptions.users,e.users)),null!=e&&e.activeTableId){var n=this.contentPersenters.get(e.activeTableId);null==n||n.previewHistory(t,this.previewHistoryOptions)}else this.contentPersenters.forEach(function(e){e.previewHistory(t,r.previewHistoryOptions)});var o=t.revInfo,i=[];for(var a in o){var c=o[a];c.firstRev!==c.lastRev&&i.push(a)}return i}},{key:"locateHistory",value:function(e,t){var r=this.contentPersenters.get(e);r&&"locate"in r&&r.locate(t)}},{key:"highlightHistory",value:function(t){this.contentPersenters.forEach(function(e){e.highlightHistory(t)})}},{key:"showAllHistoryLabels",value:function(e){var t=this.contentPersenters.get(e);t&&t.showAllHistoryLabels()}},{key:"clearHistoryLabel",value:function(e){var t=this.contentPersenters.get(e);t&&t.clearHistoryLabel()}},{key:"setRecoverTransactionId",value:function(t){this.contentPersenters.forEach(function(e){e.setRecoverTransactionId(t)})}},{key:"exitHistoryMode",value:function(){this.contentPersenters.forEach(function(e){e.exitHistory()})}},{key:"collectMountError",value:function(e,t){B.BitableDep.collectBitableEvent("client_bitable_block_mount",{stage:"mount_failed",table_id:t,errorMessage:e})}},{key:"destroy",value:function(){var r=this;try{this.isDestroyed=!0,this.mountQueue=[],this.mountingInfo=null,this.contentPersenters.forEach(function(e,t){return r.unmountContentPresenter(t)}),this.contentPersenters.clear(),this.contentManager&&this.contentManager.destroy(),this.hosts={},this.mountOptions={},this.historyStoreMap.clear()}catch(e){throw e}}}]),a}(),oe=r("vb516"),ie=r.n(oe),ae=r("vb145"),ce=r("vb872"),se=r("vb518"),le=r("vb1793"),ue=r("vb174"),de=r.n(ue);function he(){he=function(){return a};var a={},e=Object.prototype,u=e.hasOwnProperty,d=Object.defineProperty||function(e,t,r){e[t]=r.value},t="function"==typeof Symbol?Symbol:{},o=t.iterator||"@@iterator",r=t.asyncIterator||"@@asyncIterator",n=t.toStringTag||"@@toStringTag";function i(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{i({},"")}catch(e){i=function(e,t,r){return e[t]=r}}function c(e,t,r,n){var o=t&&t.prototype instanceof s?t:s,i=Object.create(o.prototype),a=new O(n||[]);return d(i,"_invoke",{value:S(e,r,a)}),i}function h(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}a.wrap=c;var l={};function s(){}function f(){}function p(){}var v={};i(v,o,function(){return this});var b=Object.getPrototypeOf,y=b&&b(b(I([])));y&&y!==e&&u.call(y,o)&&(v=y);var g=p.prototype=s.prototype=Object.create(v);function m(e){["next","throw","return"].forEach(function(t){i(e,t,function(e){return this._invoke(t,e)})})}function w(c,s){function l(e,t,r,n){var o=h(c[e],c,t);if("throw"!==o.type){var i=o.arg,a=i.value;return a&&"object"==T()(a)&&u.call(a,"__await")?s.resolve(a.__await).then(function(e){l("next",e,r,n)},function(e){l("throw",e,r,n)}):s.resolve(a).then(function(e){i.value=e,r(i)},function(e){return l("throw",e,r,n)})}n(o.arg)}var t;d(this,"_invoke",{value:function(r,n){function e(){return new s(function(e,t){l(r,n,e,t)})}return t=t?t.then(e,e):e()}})}function S(i,a,c){var s="suspendedStart";return function(e,t){if("executing"===s)throw new Error("Generator is already running");if("completed"===s){if("throw"===e)throw t;return L()}for(c.method=e,c.arg=t;;){var r=c.delegate;if(r){var n=E(r,c);if(n){if(n===l)continue;return n}}if("next"===c.method)c.sent=c._sent=c.arg;else if("throw"===c.method){if("suspendedStart"===s)throw s="completed",c.arg;c.dispatchException(c.arg)}else"return"===c.method&&c.abrupt("return",c.arg);s="executing";var o=h(i,a,c);if("normal"===o.type){if(s=c.done?"completed":"suspendedYield",o.arg===l)continue;return{value:o.arg,done:c.done}}"throw"===o.type&&(s="completed",c.method="throw",c.arg=o.arg)}}}function E(e,t){var r=t.method,n=e.iterator[r];if(void 0===n)return t.delegate=null,"throw"===r&&e.iterator.return&&(t.method="return",t.arg=void 0,E(e,t),"throw"===t.method)||"return"!==r&&(t.method="throw",t.arg=new TypeError("The iterator does not provide a '"+r+"' method")),l;var o=h(n,e.iterator,t.arg);if("throw"===o.type)return t.method="throw",t.arg=o.arg,t.delegate=null,l;var i=o.arg;return i?i.done?(t[e.resultName]=i.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,l):i:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,l)}function C(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function k(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function O(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(C,this),this.reset(!0)}function I(t){if(t){var e=t[o];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var r=-1,n=function e(){for(;++r<t.length;)if(u.call(t,r))return e.value=t[r],e.done=!1,e;return e.value=void 0,e.done=!0,e};return n.next=n}}return{next:L}}function L(){return{value:void 0,done:!0}}return f.prototype=p,d(g,"constructor",{value:p,configurable:!0}),d(p,"constructor",{value:f,configurable:!0}),f.displayName=i(p,n,"GeneratorFunction"),a.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===f||"GeneratorFunction"===(t.displayName||t.name))},a.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,p):(e.__proto__=p,i(e,n,"GeneratorFunction")),e.prototype=Object.create(g),e},a.awrap=function(e){return{__await:e}},m(w.prototype),i(w.prototype,r,function(){return this}),a.AsyncIterator=w,a.async=function(e,t,r,n,o){void 0===o&&(o=Promise);var i=new w(c(e,t,r,n),o);return a.isGeneratorFunction(t)?i:i.next().then(function(e){return e.done?e.value:i.next()})},m(g),i(g,n,"Generator"),i(g,o,function(){return this}),i(g,"toString",function(){return"[object Generator]"}),a.keys=function(e){var r=Object(e),n=[];for(var t in r)n.push(t);return n.reverse(),function e(){for(;n.length;){var t=n.pop();if(t in r)return e.value=t,e.done=!1,e}return e.done=!0,e}},a.values=I,O.prototype={constructor:O,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(k),!e)for(var t in this)"t"===t.charAt(0)&&u.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(r){if(this.done)throw r;var n=this;function e(e,t){return i.type="throw",i.arg=r,n.next=e,t&&(n.method="next",n.arg=void 0),!!t}for(var t=this.tryEntries.length-1;0<=t;--t){var o=this.tryEntries[t],i=o.completion;if("root"===o.tryLoc)return e("end");if(o.tryLoc<=this.prev){var a=u.call(o,"catchLoc"),c=u.call(o,"finallyLoc");if(a&&c){if(this.prev<o.catchLoc)return e(o.catchLoc,!0);if(this.prev<o.finallyLoc)return e(o.finallyLoc)}else if(a){if(this.prev<o.catchLoc)return e(o.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return e(o.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;0<=r;--r){var n=this.tryEntries[r];if(n.tryLoc<=this.prev&&u.call(n,"finallyLoc")&&this.prev<n.finallyLoc){var o=n;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var i=o?o.completion:{};return i.type=e,i.arg=t,o?(this.method="next",this.next=o.finallyLoc,l):this.complete(i)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),l},finish:function(e){for(var t=this.tryEntries.length-1;0<=t;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),k(r),l}},catch:function(e){for(var t=this.tryEntries.length-1;0<=t;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var o=n.arg;k(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,r){return this.delegate={iterator:I(e),resultName:t,nextLoc:r},"next"===this.method&&(this.arg=void 0),l}},a}var fe,pe,ve=function(){function c(e,t,r,n,o,i){var a=this;h()(this,c),this.undoManager=t,this.getOrders=n,this.isCreateAction=o,this.displayMultiple=i,this.actionAfterLoaded=[],this.loaded=!1,this.clientVarsReady=!1,this.translateMode=!1,this._updateTime=0,this.initContents=function(e,t,r,n,o){var i=a.displayMultiple?e:[t];a.dataSource.prefetchClientVars(i,t,r,n,o),a.dataSource.setUndoManger(a.undoManager),a.bindEvents()},this.getAllMention=function(){return a.dataSource.getAllMention()},this.getTableDataForServerCopy=function(e){return a.dataSource.getTableDataForServerCopy(e)},this.removeLocalConflictRecord=function(e){return a.dataSource.removeLocalConflictRecord(e)},this.isLoaded=function(){return a.loaded||(a.loaded=a.dataSource.isAllLoaded()),a.loaded},this.isClientVarsReady=function(){return a.clientVarsReady},this.bindEvents=function(){},this.unbindEvents=function(){},this.applyBitableTemplate=function(){var t=y()(he().mark(function e(t){return he().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,a.templateManager.useTemplate(t);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e)}));return function(e){return t.apply(this,arguments)}}(),this.dataSource=r(e),this.templateManager=new le.a(this.dataSource)}return d()(c,[{key:"initUndoManager",value:function(e){this.undoManager.register(e)}},{key:"getUpdatedTime",value:function(){return this._updateTime}},{key:"updateTime",value:function(){this._updateTime=Date.now()}},{key:"getTranslateManager",value:function(){}},{key:"enterTranslateMode",value:function(){B.RendererManager.enterSandbox(),this.translateMode=!0}},{key:"exitTranslateMode",value:function(){B.RendererManager.quitSandboxNextTick(),this.translateMode=!1,this.dataSource.unfreeze()}},{key:"reorder",value:function(){var o=this;this.getOrders().filter(function(e){return"object"===T()(e)?o.dataSource.exists(e.tableId):o.dataSource.exists(e)}).forEach(function(e,t){var r="object"===T()(e)?e.tableId:e,n=o.dataSource.getIndexFromId(r);null!==n&&-1!==n&&-1!==t&&n!==t&&t<o.dataSource.getLength()&&o.dataSource.move(n,t)})}},{key:"onLoaded",value:function(e){this.dataSource.isAllLoaded()&&(this.reorder(),this.actionAfterLoaded.length&&(this.applyActions(this.actionAfterLoaded,!1),this.actionAfterLoaded=[]),this.actionAfterLoaded.length&&(this.applyActions(this.actionAfterLoaded,!0),this.actionAfterLoaded=[]),this.dataSource.unfreeze())}},{key:"handleCSV",value:function(e){return this.dataSource.handleCSV(e)}},{key:"handleCopy",value:function(e){return this.dataSource.copy(e)||""}},{key:"handlePaste",value:function(e,t,r,n,o){return Me.paste(e,t,this.displayMultiple,r,n,o)}},{key:"handlePasteBlock",value:function(){var o=y()(he().mark(function e(t,r,n,o){var i,a,c,s,l,u,d,h,f,p,v,b,y,g,m,w,S,E,C;return he().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:i=Object(B.getNewId)(B.IDPrefix.table,[]),e.prev=1,a=JSON.parse(t),e.next=9;break;case 5:return e.prev=5,e.t0=e.catch(1),console.error(e.t0),e.abrupt("return",null);case 9:if(c=Me.genPasteBitaleSnapshot(t,a,i)){e.next=12;break}return e.abrupt("return",null);case 12:if(s=c.snapshot,l=c.contentCreation,u=this.dataSource.getSource(),d=u.base.token,h=a.baseId,f=a.tableId,de()(d)===h){e.next=25;break}return e.prev=18,e.next=21,Object(B.deepCopyBitableDriveTokenFromSnapshot)(s,d);case 21:e.next=25;break;case 23:e.prev=23,e.t1=e.catch(18);case 25:return p=s.recordMeta||{},v=n?s.commentMap:{},b=s.viewMap,y=s.recordMap,g=s.fieldMap,m=s.userMap,w=s.resourceMap,S=s.reminderMap,E=s.milestoneMap,C={tableId:i,viewMap:b,recordMap:y,fieldMap:g,userMap:m,reminderMap:S,resourceMap:w,memberId:r,contentCreation:l,recordMeta:p,resetRecordMeta:o,commentMap:v,milestoneMap:void 0===E?{}:E,sourceTableId:f},e.abrupt("return",Object(se.generateAddTableCs)(C));case 30:case"end":return e.stop()}},e,this,[[1,5],[18,23]])}));function e(e,t,r,n){return o.apply(this,arguments)}return e}()},{key:"getInitBitableCs",value:function(e,t,r){return se.DefaultActions.addTable(e,t,r)}},{key:"getActiveViewIdMap",value:function(){return Me.getActiveViewIdMap()}},{key:"getDeleteConfirmModal",value:function(e,t){}},{key:"checkUIIfChanged",value:function(e,t){}},{key:"executeLocalActions",value:function(e){this.isLoaded()?this.applyActions([e],!0):this.actionAfterLoaded.push(e)}},{key:"applyActions",value:function(e){var t=this,r=1<arguments.length&&void 0!==arguments[1]&&arguments[1];e=e.filter(function(e){return!t.isCreateAction(e)||!t.dataSource.exists(e.id)}),this.dataSource.applyActions(e,r)}},{key:"destroy",value:function(){try{this.unbindEvents(),this.dataSource.destroy(),this.loaded=!1}catch(e){throw e}}},{key:"recoverTableHistory",value:function(e){}},{key:"getTableRevision",value:function(){var t=y()(he().mark(function e(t){var r,n;return he().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=this.dataSource.getSource(),n=r.base.getTableById(t),e.abrupt("return",n?n.rev:r.remoteDataProvider.fetchRemoteVersion(!1,t));case 3:case"end":return e.stop()}},e,this)}));function e(e){return t.apply(this,arguments)}return e}()},{key:"getTableById",value:function(e){return this.dataSource.getSource().base.getTableById(e)}}]),c}();(pe=fe||(fe={}))[pe.execute=0]="execute",pe[pe.undo=1]="undo",pe[pe.redo=2]="redo";var be=65535,ye="BITABLE",ge=function(e){function t(){var n;return h()(this,t),(n=e.call(this,ye)||this).execCmd=function(e,t){var r=b()(n).commandManager;return e&&r&&r.hasCommand(e.cmd)?r._executeActions(e.cmd,{result:B.ExecuteResult.Success,data:{},actions:e.actions},t):null},n}return f()(t,e),d()(t,[{key:"setCommandManager",value:function(e){this.commandManager=e}}]),t}(function(){function t(e){h()(this,t),this.blockId=e,this.undoStack=[],this.redoStack=[]}return d()(t,[{key:"_addCommand",value:function(e,t){e&&e.cmd&&t===fe.execute&&this.do(e)}},{key:"id",get:function(){return this.blockId}},{key:"register",value:function(e){!this.undoDispatcher&&e&&e.register(this),this.undoDispatcher=e}},{key:"do",value:function(e){var t=this.undoStack.length;be<=t&&(this.undoStack=this.undoStack.slice(t-be)),this.undoStack.push(e),this.redoStack=[],this.undoDispatcher&&this.undoDispatcher.do(this.blockId)}},{key:"undo",value:function(){this.undoDispatcher&&this.undoDispatcher.undo()}},{key:"redo",value:function(){this.undoDispatcher&&this.undoDispatcher.redo()}},{key:"clear",value:function(){this.undoStack=[],this.redoStack=[],this.undoDispatcher=null}},{key:"clearAll",value:function(){this.undoStack=[],this.redoStack=[],this.undoDispatcher&&this.undoDispatcher.remove(this)}},{key:"onUndo",value:function(){var e=this.undoStack.pop();e&&(this.redoStack.push(e),this.execCmd(e,fe.undo))}},{key:"onRedo",value:function(){var e=this.redoStack.pop();e&&(this.undoStack.push(e),this.execCmd(e,fe.redo))}},{key:"onDo",value:function(){this.redoStack=[]}},{key:"clearStack",value:function(){this.undoStack=[],this.redoStack=[]}},{key:"canRedo",value:function(){return!0}},{key:"canUndo",value:function(){return!0}}]),t}()),me={LOADED_BITABLE_BLOCK:"LOADED_BITABLE_BLOCK",BITABLE_ENTER_DOC_FULLSCREEN:"BitableEnterDocFullScreen",BITABLE_EXIT_DOC_FULLSCREEN:"BitableExitDocFullScreen",BITABLE_OVERLAYER_POSITION_UPDATING:"BitableOverlayerPositionUpdating"};function we(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),r.push.apply(r,n)}return r}function Se(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?we(Object(r),!0).forEach(function(e){g()(t,e,r[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):we(Object(r)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))})}return t}function Ee(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=Ce(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,o=function(){};return{s:o,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,c=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return a=e.done,e},e:function(e){c=!0,i=e},f:function(){try{a||null==r.return||r.return()}finally{if(c)throw i}}}}function Ce(e,t){if(e){if("string"==typeof e)return ke(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?ke(e,t):void 0}}function ke(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function Oe(){Oe=function(){return a};var a={},e=Object.prototype,u=e.hasOwnProperty,d=Object.defineProperty||function(e,t,r){e[t]=r.value},t="function"==typeof Symbol?Symbol:{},o=t.iterator||"@@iterator",r=t.asyncIterator||"@@asyncIterator",n=t.toStringTag||"@@toStringTag";function i(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{i({},"")}catch(e){i=function(e,t,r){return e[t]=r}}function c(e,t,r,n){var o=t&&t.prototype instanceof s?t:s,i=Object.create(o.prototype),a=new O(n||[]);return d(i,"_invoke",{value:S(e,r,a)}),i}function h(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}a.wrap=c;var l={};function s(){}function f(){}function p(){}var v={};i(v,o,function(){return this});var b=Object.getPrototypeOf,y=b&&b(b(I([])));y&&y!==e&&u.call(y,o)&&(v=y);var g=p.prototype=s.prototype=Object.create(v);function m(e){["next","throw","return"].forEach(function(t){i(e,t,function(e){return this._invoke(t,e)})})}function w(c,s){function l(e,t,r,n){var o=h(c[e],c,t);if("throw"!==o.type){var i=o.arg,a=i.value;return a&&"object"==T()(a)&&u.call(a,"__await")?s.resolve(a.__await).then(function(e){l("next",e,r,n)},function(e){l("throw",e,r,n)}):s.resolve(a).then(function(e){i.value=e,r(i)},function(e){return l("throw",e,r,n)})}n(o.arg)}var t;d(this,"_invoke",{value:function(r,n){function e(){return new s(function(e,t){l(r,n,e,t)})}return t=t?t.then(e,e):e()}})}function S(i,a,c){var s="suspendedStart";return function(e,t){if("executing"===s)throw new Error("Generator is already running");if("completed"===s){if("throw"===e)throw t;return L()}for(c.method=e,c.arg=t;;){var r=c.delegate;if(r){var n=E(r,c);if(n){if(n===l)continue;return n}}if("next"===c.method)c.sent=c._sent=c.arg;else if("throw"===c.method){if("suspendedStart"===s)throw s="completed",c.arg;c.dispatchException(c.arg)}else"return"===c.method&&c.abrupt("return",c.arg);s="executing";var o=h(i,a,c);if("normal"===o.type){if(s=c.done?"completed":"suspendedYield",o.arg===l)continue;return{value:o.arg,done:c.done}}"throw"===o.type&&(s="completed",c.method="throw",c.arg=o.arg)}}}function E(e,t){var r=t.method,n=e.iterator[r];if(void 0===n)return t.delegate=null,"throw"===r&&e.iterator.return&&(t.method="return",t.arg=void 0,E(e,t),"throw"===t.method)||"return"!==r&&(t.method="throw",t.arg=new TypeError("The iterator does not provide a '"+r+"' method")),l;var o=h(n,e.iterator,t.arg);if("throw"===o.type)return t.method="throw",t.arg=o.arg,t.delegate=null,l;var i=o.arg;return i?i.done?(t[e.resultName]=i.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,l):i:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,l)}function C(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function k(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function O(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(C,this),this.reset(!0)}function I(t){if(t){var e=t[o];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var r=-1,n=function e(){for(;++r<t.length;)if(u.call(t,r))return e.value=t[r],e.done=!1,e;return e.value=void 0,e.done=!0,e};return n.next=n}}return{next:L}}function L(){return{value:void 0,done:!0}}return f.prototype=p,d(g,"constructor",{value:p,configurable:!0}),d(p,"constructor",{value:f,configurable:!0}),f.displayName=i(p,n,"GeneratorFunction"),a.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===f||"GeneratorFunction"===(t.displayName||t.name))},a.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,p):(e.__proto__=p,i(e,n,"GeneratorFunction")),e.prototype=Object.create(g),e},a.awrap=function(e){return{__await:e}},m(w.prototype),i(w.prototype,r,function(){return this}),a.AsyncIterator=w,a.async=function(e,t,r,n,o){void 0===o&&(o=Promise);var i=new w(c(e,t,r,n),o);return a.isGeneratorFunction(t)?i:i.next().then(function(e){return e.done?e.value:i.next()})},m(g),i(g,n,"Generator"),i(g,o,function(){return this}),i(g,"toString",function(){return"[object Generator]"}),a.keys=function(e){var r=Object(e),n=[];for(var t in r)n.push(t);return n.reverse(),function e(){for(;n.length;){var t=n.pop();if(t in r)return e.value=t,e.done=!1,e}return e.done=!0,e}},a.values=I,O.prototype={constructor:O,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(k),!e)for(var t in this)"t"===t.charAt(0)&&u.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(r){if(this.done)throw r;var n=this;function e(e,t){return i.type="throw",i.arg=r,n.next=e,t&&(n.method="next",n.arg=void 0),!!t}for(var t=this.tryEntries.length-1;0<=t;--t){var o=this.tryEntries[t],i=o.completion;if("root"===o.tryLoc)return e("end");if(o.tryLoc<=this.prev){var a=u.call(o,"catchLoc"),c=u.call(o,"finallyLoc");if(a&&c){if(this.prev<o.catchLoc)return e(o.catchLoc,!0);if(this.prev<o.finallyLoc)return e(o.finallyLoc)}else if(a){if(this.prev<o.catchLoc)return e(o.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return e(o.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;0<=r;--r){var n=this.tryEntries[r];if(n.tryLoc<=this.prev&&u.call(n,"finallyLoc")&&this.prev<n.finallyLoc){var o=n;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var i=o?o.completion:{};return i.type=e,i.arg=t,o?(this.method="next",this.next=o.finallyLoc,l):this.complete(i)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),l},finish:function(e){for(var t=this.tryEntries.length-1;0<=t;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),k(r),l}},catch:function(e){for(var t=this.tryEntries.length-1;0<=t;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var o=n.arg;k(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,r){return this.delegate={iterator:I(e),resultName:t,nextLoc:r},"next"===this.method&&(this.arg=void 0),l}},a}function Ie(e){for(var t=e.recordMap,r=0,n=Object.keys(t);r<n.length;r++){t[n[r]]={}}return e.reminderMap={},e}function Le(e,t,r){t&&(Mt.set(e,{stdValueTable:t,tableDataSet:null,status:wt.TO_PASTE,source:Et.BITABLE,pasteTableBaseId:""}),Ie(r))}function Te(e,t,r,n,o){t&&(Mt.set(e,{status:wt.TO_PASTE,source:Et.BLOCK,tableDataSet:t,pasteTableBaseId:n,stdValueTable:null,pasteComment:o}),Ie(r))}var xe=function(){function s(e,t,r,n,o,i,a){var c=this;h()(this,s),this.displayMultiple=t,this.reduxStore=i,this.getHistoryStore=a,this.currentFetchingTableId=null,this.isBitableEditable=!0,this.isDestroy=!1,this.fetchClientvarsQueue=new Map,this.fetchClientvarsResolve=new Map,this.bitableEditableRule=function(){return c.isBitableEditable},this.handleBeforeUnload=function(e){if(c.bitableStore.trySyncIfNeed()){var t="o/";return e.returnValue=t}},this.isBitableReadyAtDisplaySingle=function(e,t){return!c.displayMultiple&&1===e.length&&c.getTableClientVarsLoaded(t)&&!se.DefaultActions.stashedActions[t]},this.isCreateBitableAtDisplaySingle=function(e){return c.bitableStore.base&&c.bitableStore.base.tables&&0<c.bitableStore.base.tables.length&&se.DefaultActions.stashedActions[e]},this.trackBeforeFetchClientVars=function(e){var t=e[0]+"_"+B.BitableBlockLoadedStage.BlockLoaded+"_"+B.BitableBlockLoadedStage.InitSmartable;B.TrackerInstance.send(B.BitableBlockLoadedStage.BlockLoaded,{stage:B.BitableBlockLoadedStage.InitSmartable},{eventKey:t}),t=e[0]+"_"+B.BitableBlockLoadedStage.BlockLoaded+"_"+B.BitableBlockLoadedStage.FetchClientVar,B.TrackerInstance.start(B.BitableBlockLoadedStage.BlockLoaded,{},{eventKey:t})},this.trackAfterFetchClientVars=function(e,t){var r=e[0]+"_"+B.BitableBlockLoadedStage.BlockLoaded+"_"+B.BitableBlockLoadedStage.FetchClientVar;B.TrackerInstance.send(B.BitableBlockLoadedStage.BlockLoaded,{stage:B.BitableBlockLoadedStage.FetchClientVar,gzipSchemaLength:t.gzipSchema.length},{eventKey:r}),r=e[0]+"_"+B.BitableBlockLoadedStage.BlockLoaded+"_"+B.BitableBlockLoadedStage.DomRender,B.TrackerInstance.start(B.BitableBlockLoadedStage.BlockLoaded,{},{eventKey:r})},this.handleClientAlreadyLoaded=function(e,t){c.bitableStore.switchTable(e,!c.displayMultiple),t&&t.onClientVarLoaded&&t.onClientVarLoaded(e)},this.fetchBitableClientVars=function(){var o=y()(Oe().mark(function e(o,t,i,a){return Oe().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:o.forEach(function(){var t=y()(Oe().mark(function e(t){var r,n;return Oe().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!c.getTableClientVarsLoaded(t)){e.next=3;break}return c.handleClientAlreadyLoaded(t,i),e.abrupt("return");case 3:if(!c.fetchClientvarsQueue.get(t)){e.next=10;break}return a&&c.bitableStore.setClientVarRunnerPriority&&c.bitableStore.setClientVarRunnerPriority([t],a),e.next=7,c.waitTableClientVarLoaded(t);case 7:c.handleClientAlreadyLoaded(t,i),e.next=27;break;case 10:return e.prev=10,c.trackBeforeFetchClientVars(o),i&&i.switchTable&&i.switchTable(),e.next=15,c.fetchClientVarsCore(t);case 15:r=e.sent,c.handleFetchClientsSuccess(r,o,t,i),e.next=23;break;case 19:e.prev=19,e.t0=e.catch(10),n=Object(ae.a)(e.t0,"ex.code",0),i&&i.onClientVarError&&n!==B.STATUS_CODE.DOCUMENT_KEY_INVALID&&i.onClientVarError(t,n);case 23:return e.prev=23,c.resolveTableClientVarLoaded(t),c.fetchClientvarsQueue.set(t,!1),e.finish(23);case 27:case"end":return e.stop()}},e,null,[[10,19,23,27]])}));return function(e){return t.apply(this,arguments)}}());case 1:case"end":return e.stop()}},e)}));return function(e,t,r,n){return o.apply(this,arguments)}}(),this.handleFetchClientsSuccess=function(e,t,r,n){if(!c.isDestroy){var o=!(c.currentFetchingTableId!==r&&c.bitableStore.isEmbeddedInSheet);c.trackAfterFetchClientVars(t,e),c.bitableStore.handleClientVars(e),o&&c.bitableStore.switchTable(r,!c.displayMultiple),n&&n.onClientVarLoaded&&n.onClientVarLoaded(r),_.EventEmitter.emit(me.LOADED_BITABLE_BLOCK)}},this.fetchClientVarsCore=function(){var t=y()(Oe().mark(function e(t){var r,n,o,i;return Oe().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=c.getViewIdFromUrl()||c.storageManager.getShowingView(t)||void 0,n=c.getRecordIdFromUrl(t)||void 0,o={openType:1,tableId:t,viewId:r,recordId:n},!(i=c.getPreloadDataSync(o))){e.next=6;break}return e.abrupt("return",i);case 6:return e.next=8,c.getPreloadDataAsync(o);case 8:if(i=e.sent,c.fetchClientvarsQueue.set(t,!0),e.t0=i,e.t0){e.next=15;break}return e.next=14,c.bitableStore.getClientVars(o);case 14:e.t0=e.sent;case 15:return i=e.t0,e.abrupt("return",i);case 17:case"end":return e.stop()}},e)}));return function(e){return t.apply(this,arguments)}}(),this.getPreloadDataSync=function(e){var t,r=_.preloadHttp.getData(c.bitableStore.token+"_"+e.tableId);return r&&r.data&&(t=r.data.data),t},this.getPreloadDataAsync=function(){var t=y()(Oe().mark(function e(t){var r,n,o;return Oe().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!(r=_.preloadHttp.getData(c.bitableStore.token+"_"+t.tableId))||!r.promise){e.next=12;break}return e.prev=2,e.next=5,r.promise;case 5:o=e.sent,n=o.data,e.next=12;break;case 9:e.prev=9,e.t0=e.catch(2),console.error("preloadError",e.t0);case 12:return e.abrupt("return",n);case 13:case"end":return e.stop()}},e,null,[[2,9]])}));return function(e){return t.apply(this,arguments)}}(),this.enableEdit=function(){c.isBitableEditable=!0,c.bitableStore.getPermissionStore().emitPermissionChange()},this.disableEdit=function(){c.isBitableEditable=!1,c.bitableStore.getPermissionStore().emitPermissionChange()},this.getAllMention=function(){return c.bitableStore.getAllMention()},this.getTableDataForServerCopy=function(e){return c.bitableStore.getTableDataForServerCopy(e)},this.removeLocalConflictRecord=function(){var t=y()(Oe().mark(function e(t){var r;return Oe().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=c.bitableStore.getQueueStorage()){e.next=3;break}return e.abrupt("return");case 3:return e.next=5,r.clearBackup();case 5:return e.next=7,r.removeLocalRecord(t);case 7:case"end":return e.stop()}},e)}));return function(e){return t.apply(this,arguments)}}(),this.bitableStore=new B.BitableStore(e,_.IO.getInstance(),r,{resetHook:function(){return B.DriveCoverManger.reset()},permissionSync:!1,needWatch:!0,allowNoTable:r===R.a.EmbeddedInDoc||r===R.a.EmbeddedInSheet},void 0,n,o,{onlyWatchActiveTable:!0}),this.createStorageManager(),this.bitableStore.getPermissionStore().addBasePermissionRules([this.bitableEditableRule],B.OperationType.Editable),window.addEventListener("beforeunload",this.handleBeforeUnload)}return d()(s,[{key:"createStorageManager",value:function(){this.storageManager=this.displayMultiple?new B.DocBitableStorageManager:new B.StorageManager,this.storageManager.bindEvents()}},{key:"waitTableClientVarLoaded",value:function(r){var n=this;return new Promise(function(e){if(n.getTableClientVarsLoaded(r))e();else{var t=n.fetchClientvarsResolve.get(r)||[];t.push(e),n.fetchClientvarsResolve.set(r,t)}})}},{key:"resolveTableClientVarLoaded",value:function(e){var t=this.fetchClientvarsResolve.get(e);t&&t.forEach(function(e){e&&e()})}},{key:"getSource",value:function(){return this.bitableStore}},{key:"getActivedId",value:function(){return this.bitableStore.getActiveTableId()}},{key:"active",value:function(e){var t=this.getIdFromIndex(e);t&&this.bitableStore.switchTable(t)}},{key:"getLength",value:function(){return this.bitableStore.base.tables.length}},{key:"getIndexFromId",value:function(e){return this.bitableStore.base.getTableIndex(e)}},{key:"exists",value:function(e){return this.bitableStore.base.isTableExists(e)}},{key:"getToken",value:function(){return this.bitableStore.base.token}},{key:"getTableClientVarsLoaded",value:function(e){var t=this.bitableStore.base.getTableById(e);return!!t&&t.clientvarLoaded}},{key:"getViewIdFromUrl",value:function(){return Object(B.getAllUrlParams)(location.href).view||null}},{key:"getRecordIdFromUrl",value:function(e){var t=Object(B.getAllUrlParams)(location.href);return t.table===e&&t.record||null}},{key:"getShowingViewId",value:function(e){var t=this.storageManager.getShowingView(e),r=this.bitableStore.base.getTableById(e);if(r&&r.tableLoaded){var n=r.views;if(t){var o,i=Ee(t);try{for(i.s();!(o=i.n()).done;){var a=o.value;if(null!==r.getViewById(a))return a}}catch(e){i.e(e)}finally{i.f()}}return n[0]?n[0].id:void 0}}},{key:"prefetchClientVars",value:function(e,t,r,n,o){if(this.currentFetchingTableId=t,this.bitableStore.setNeedWatch(!n),n||(window.bitableStore=this.bitableStore),this.isBitableReadyAtDisplaySingle(e,t))return!n&&this.bitableStore.addToWatchedTableIds(t),void(r&&r.switchTable&&r.switchTable());this.bitableStore.base.getTrashBlockById(t)?r&&r.switchTable&&r.switchTable():(this.initFetchClientvars(e,t,r),this.fetchBitableClientVars(e,t,r,o))}},{key:"initFetchClientvars",value:function(e,t,r){var n=this;this.displayMultiple?e.forEach(function(e){return n.bitableStore.initTableEventManager(e)}):this.isCreateBitableAtDisplaySingle(t)&&(se.DefaultActions.stashedActions[t].operations.forEach(function(e){e.actions.forEach(function(e){Object(B.applyBaseAction)(n.bitableStore.base,e,!0)})}),delete se.DefaultActions.stashedActions[t],this.bitableStore.switchTable(t,!this.displayMultiple,!0),r&&r.addNewTable&&r.addNewTable(),this.bitableStore.fetchToMaxVersion(this.bitableStore.base.rev+1))}},{key:"isAllLoaded",value:function(){return this.bitableStore.isAllTableLoaded()}},{key:"isLoaded",value:function(e){return this.bitableStore.isTableLoaded(e)}},{key:"setUndoManger",value:function(e){this.bitableStore.getCommandManager().setUndoManager(e)}},{key:"move",value:function(e,t){var r=this.getIdFromIndex(e);r&&this.bitableStore.base.moveTable(r,t)}},{key:"getIdFromIndex",value:function(e){return this.bitableStore.base.tables.length<=e?null:this.bitableStore.base.tables[e].id}},{key:"copy",value:function(e){B.TrackerInstance.start(B.BITABLE_PERFORMANCE_STAGE);var t=this.bitableStore,r=t.base,n=t.downgradeManager,o=r.getTableById(e);if(!o||!o.tableLoaded)return"";if(n.checkBaseNotSupport())return"";var i=this.getHistoryStore(e),a=i||this.reduxStore,c=Object(B.tableActiveViewIdSelector)(a.getState(),e),s=o.views.findIndex(function(e){return e.id===c}),l={copyType:R.b.Table,tableId:e,snapshot:Object(se.addIndexToTableViewMap)(o.toJSON()),viewIndex:s,baseId:de()(r.token)},u=JSON.stringify(l);return B.TrackerInstance.send(B.BITABLE_PERFORMANCE_STAGE,{stage:B.BitablePerformanceStage.CopyParsing,fields_num:Object.keys(o.fields).length,records_num:Object.keys(o.records).length}),u}},{key:"handleCSV",value:function(e){var t=this.bitableStore.base.getTableById(e);if(!t)throw new Error("Not find table by id");var r=Object(B.tableActiveViewIdSelector)(this.reduxStore.getState(),e),n=t.views.filter(function(e){return e.id===r}),o=ie()(n,1)[0];if(!o)throw new Error("Not find view by viewId");var i=o.getAllFields(),a=o.getVisibleRecords(),c=o.getStdValueTableFromRange([{row:0,col:0,rowCount:a.length,colCount:i.length}]);return Object(B.exportCSVData)(c)}},{key:"applyActions",value:function(e,t){var n=this;e.forEach(function(e){var t=n.bitableStore.getSyncTable(e.id);if(t){var r=t.engine;r.applyChangeset(r.getModel(),e)}})}},{key:"freeze",value:function(){this.bitableStore.freeze()}},{key:"unfreeze",value:function(){this.bitableStore.unfreeze()}},{key:"suspend",value:function(e){this.bitableStore.stopQueue()}},{key:"resume",value:function(e){this.bitableStore.restartQueue()}},{key:"destroy",value:function(){this.isDestroy=!0,window.removeEventListener("beforeunload",this.handleBeforeUnload),se.DefaultActions.clearStashedActions(),this.bitableStore.getPermissionStore().removeBasePermissionRule(this.bitableEditableRule,B.OperationType.Editable),this.bitableStore.reset(),this.reduxStore.dispatch(Object(B.resetRedux)()),window.bitableStore=null}},{key:"fetchTableToMaxVersion",value:function(e,t){this.bitableStore.fetchTableToMaxVersion(e,t)}},{key:"getStorageManager",value:function(){return this.storageManager}}],[{key:"addTable",value:function(e){return se.DefaultActions.addTable(e,R.a.EmbeddedInDoc,B.ViewType.Grid)}},{key:"addKanban",value:function(e){return se.DefaultActions.addTable(e,R.a.EmbeddedInDoc,B.ViewType.Kanban)}},{key:"addGantt",value:function(e){return se.DefaultActions.addTable(e,R.a.EmbeddedInDoc,B.ViewType.Gantt)}},{key:"addGallery",value:function(e){return se.DefaultActions.addTable(e,R.a.EmbeddedInDoc,B.ViewType.Gallery)}},{key:"paste",value:function(e,t,r,n){var o=!(4<arguments.length&&void 0!==arguments[4])||arguments[4],i=5<arguments.length?arguments[5]:void 0;B.TrackerInstance.start(B.BitablePerformanceStage.PasteParsing);var a,c,s=Object(B.getNewId)(B.IDPrefix.table,[]),l=null;try{c=JSON.parse(e)}catch(e){return console.error(e),null}var u=!1;if(c.copyType===R.b.Table){var d=c,h=d.snapshot,f=d.viewIndex,p=d.baseId,v=[];l=c.tableId,h.views.forEach(function(e,t){var r=Object(B.getNewId)(B.IDPrefix.view,[]);h.viewMap[r]=h.viewMap[e],h.viewMap[r].id=r,delete h.viewMap[e],v.push(r)}),h.views=v;var b=h.views[f];h.viewMap[b]&&r&&Te(s,Object(x.a)(h),h,p,n),a=Se({},h,{id:s,name:Object(B.getCopyTableName)([],h.name),viewMap:Object(ce.a)(h.viewMap,function(e){return Se({},e,{owner:""})})}),Object(B.adjustSnapshotOnCopy)(a,h,r,i),u=0!==h.rev||!(!h.exInfo||!h.exInfo.contentCreation)}else{a=se.DefaultActions.jsonToCS(e),Le(s,B.Serializer.json.parseCore(e),a)}B.TrackerInstance.send(B.BITABLE_PERFORMANCE_STAGE,{stage:B.BitablePerformanceStage.PasteParsing,copyType:c.copyType,fields_num:Object.keys(a.fieldMap).length,records_num:Object.keys(a.recordMap).length});var y=s+"_"+B.BitableBlockLoadedStage.BlockLoaded+"_"+B.BitableBlockLoadedStage.Done;B.TrackerInstance.start(B.BitableBlockLoadedStage.BlockLoaded,{},{eventKey:y}),y=s+"_"+B.BitableBlockLoadedStage.BlockLoaded+"_"+B.BitableBlockLoadedStage.GetToken,B.TrackerInstance.start(B.BitableBlockLoadedStage.BlockLoaded,{},{eventKey:y});var g=a.recordMeta,m=a,w=m.viewMap,S=m.recordMap,E=m.fieldMap,C=m.userMap,k=m.resourceMap,O=m.reminderMap,I=m.milestoneMap,L=void 0===I?{}:I;k&&k[B.ResourceType.Attachments]&&r&&delete k[B.ResourceType.Attachments];var T={tableId:s,viewMap:w,recordMap:S,fieldMap:E,userMap:C,memberId:t,contentCreation:u,recordMeta:g,resetRecordMeta:o,reminderMap:O,resourceMap:k,milestoneMap:L,sourceTableId:l};return Object(se.generateAddTableCs)(T)}},{key:"genPasteBitaleSnapshot",value:function(e,t,r){var n,o=!1;if(t.copyType===R.b.Table){var i=t.snapshot;n=this.genCopyTypeSnapshot(t,r,!0),o=0!==i.rev||!(!i.exInfo||!i.exInfo.contentCreation)}else n=se.DefaultActions.jsonToCS(e);return{snapshot:n,contentCreation:o}}},{key:"genCopyTypeSnapshot",value:function(e,t){var r=2<arguments.length&&void 0!==arguments[2]&&arguments[2],n=e.snapshot,o=[];n.views.forEach(function(e,t){var r=Object(B.getNewId)(B.IDPrefix.view,[]);n.viewMap[r]=n.viewMap[e],n.viewMap[r].id=r,delete n.viewMap[e],o.push(r)}),n.views=o;var i=Se({},n,{id:t,name:Object(B.getCopyTableName)([],n.name),viewMap:Object(ce.a)(n.viewMap,function(e){return Se({},e,{owner:""})})});return Object(B.adjustSnapshotOnCopy)(i,n,r),i}}]),s}(),Me=function(l){function u(e,t,r,n,o,i,a){var s;h()(this,u);var c=function(e){return new xe(e,r,n,t,o,i,a)};return(s=l.call(this,e,new ge,c,t,function(e){return e.operations.some(function(e){return e.command===B.CollaCommands.AddTable})},r)||this).recoverTableHistory=function(r){if(!r)return Promise.reject("recoverTableHistory no snapshot");var o=s.dataSource.getSource(),i=r.id,a=o.getCommandManager(),c=o.base.getTableById(i);return new Promise(function(n,e){var t=function e(t){var r=c&&t.changesets[0].rev>=c.rev;t.token===i&&r&&(o.removeEventListeners(i,g()({},B.Events.ChangesetApplied,e)),o.fetchClientVars({tableId:i}),n())};o.addEventListeners(i,g()({},B.Events.ChangesetApplied,t)),a.execute({cmd:B.CollaCommands.RecoverTableHistory,tableId:i,data:{revision:r.rev,snapshot:r}}),setTimeout(e,5e3)})},s}return f()(u,l),d()(u,[{key:"key",get:function(){return""}}],[{key:"getActiveViewIdMap",value:function(){return Object(ae.a)(_.store.getState(),"bitable.Tables.activeViewIdMap",null)}},{key:"paste",value:function(e,t,r,n){var o=!(4<arguments.length&&void 0!==arguments[4])||arguments[4],i=5<arguments.length?arguments[5]:void 0;return xe.paste(e,t,r,n,o,i)}},{key:"genPasteBitaleSnapshot",value:function(e,t,r){return xe.genPasteBitaleSnapshot(e,t,r)}},{key:"addTable",value:function(e){return xe.addTable(e)}},{key:"addKanban",value:function(e){return xe.addKanban(e)}},{key:"addGantt",value:function(e){return xe.addGantt(e)}},{key:"addGallery",value:function(e){return xe.addGallery(e)}}]),u}(ve),Be=r("vb601");function _e(){_e=function(){return a};var a={},e=Object.prototype,u=e.hasOwnProperty,d=Object.defineProperty||function(e,t,r){e[t]=r.value},t="function"==typeof Symbol?Symbol:{},o=t.iterator||"@@iterator",r=t.asyncIterator||"@@asyncIterator",n=t.toStringTag||"@@toStringTag";function i(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{i({},"")}catch(e){i=function(e,t,r){return e[t]=r}}function c(e,t,r,n){var o=t&&t.prototype instanceof s?t:s,i=Object.create(o.prototype),a=new O(n||[]);return d(i,"_invoke",{value:S(e,r,a)}),i}function h(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}a.wrap=c;var l={};function s(){}function f(){}function p(){}var v={};i(v,o,function(){return this});var b=Object.getPrototypeOf,y=b&&b(b(I([])));y&&y!==e&&u.call(y,o)&&(v=y);var g=p.prototype=s.prototype=Object.create(v);function m(e){["next","throw","return"].forEach(function(t){i(e,t,function(e){return this._invoke(t,e)})})}function w(c,s){function l(e,t,r,n){var o=h(c[e],c,t);if("throw"!==o.type){var i=o.arg,a=i.value;return a&&"object"==T()(a)&&u.call(a,"__await")?s.resolve(a.__await).then(function(e){l("next",e,r,n)},function(e){l("throw",e,r,n)}):s.resolve(a).then(function(e){i.value=e,r(i)},function(e){return l("throw",e,r,n)})}n(o.arg)}var t;d(this,"_invoke",{value:function(r,n){function e(){return new s(function(e,t){l(r,n,e,t)})}return t=t?t.then(e,e):e()}})}function S(i,a,c){var s="suspendedStart";return function(e,t){if("executing"===s)throw new Error("Generator is already running");if("completed"===s){if("throw"===e)throw t;return L()}for(c.method=e,c.arg=t;;){var r=c.delegate;if(r){var n=E(r,c);if(n){if(n===l)continue;return n}}if("next"===c.method)c.sent=c._sent=c.arg;else if("throw"===c.method){if("suspendedStart"===s)throw s="completed",c.arg;c.dispatchException(c.arg)}else"return"===c.method&&c.abrupt("return",c.arg);s="executing";var o=h(i,a,c);if("normal"===o.type){if(s=c.done?"completed":"suspendedYield",o.arg===l)continue;return{value:o.arg,done:c.done}}"throw"===o.type&&(s="completed",c.method="throw",c.arg=o.arg)}}}function E(e,t){var r=t.method,n=e.iterator[r];if(void 0===n)return t.delegate=null,"throw"===r&&e.iterator.return&&(t.method="return",t.arg=void 0,E(e,t),"throw"===t.method)||"return"!==r&&(t.method="throw",t.arg=new TypeError("The iterator does not provide a '"+r+"' method")),l;var o=h(n,e.iterator,t.arg);if("throw"===o.type)return t.method="throw",t.arg=o.arg,t.delegate=null,l;var i=o.arg;return i?i.done?(t[e.resultName]=i.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,l):i:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,l)}function C(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function k(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function O(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(C,this),this.reset(!0)}function I(t){if(t){var e=t[o];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var r=-1,n=function e(){for(;++r<t.length;)if(u.call(t,r))return e.value=t[r],e.done=!1,e;return e.value=void 0,e.done=!0,e};return n.next=n}}return{next:L}}function L(){return{value:void 0,done:!0}}return f.prototype=p,d(g,"constructor",{value:p,configurable:!0}),d(p,"constructor",{value:f,configurable:!0}),f.displayName=i(p,n,"GeneratorFunction"),a.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===f||"GeneratorFunction"===(t.displayName||t.name))},a.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,p):(e.__proto__=p,i(e,n,"GeneratorFunction")),e.prototype=Object.create(g),e},a.awrap=function(e){return{__await:e}},m(w.prototype),i(w.prototype,r,function(){return this}),a.AsyncIterator=w,a.async=function(e,t,r,n,o){void 0===o&&(o=Promise);var i=new w(c(e,t,r,n),o);return a.isGeneratorFunction(t)?i:i.next().then(function(e){return e.done?e.value:i.next()})},m(g),i(g,n,"Generator"),i(g,o,function(){return this}),i(g,"toString",function(){return"[object Generator]"}),a.keys=function(e){var r=Object(e),n=[];for(var t in r)n.push(t);return n.reverse(),function e(){for(;n.length;){var t=n.pop();if(t in r)return e.value=t,e.done=!1,e}return e.done=!0,e}},a.values=I,O.prototype={constructor:O,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(k),!e)for(var t in this)"t"===t.charAt(0)&&u.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(r){if(this.done)throw r;var n=this;function e(e,t){return i.type="throw",i.arg=r,n.next=e,t&&(n.method="next",n.arg=void 0),!!t}for(var t=this.tryEntries.length-1;0<=t;--t){var o=this.tryEntries[t],i=o.completion;if("root"===o.tryLoc)return e("end");if(o.tryLoc<=this.prev){var a=u.call(o,"catchLoc"),c=u.call(o,"finallyLoc");if(a&&c){if(this.prev<o.catchLoc)return e(o.catchLoc,!0);if(this.prev<o.finallyLoc)return e(o.finallyLoc)}else if(a){if(this.prev<o.catchLoc)return e(o.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return e(o.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;0<=r;--r){var n=this.tryEntries[r];if(n.tryLoc<=this.prev&&u.call(n,"finallyLoc")&&this.prev<n.finallyLoc){var o=n;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var i=o?o.completion:{};return i.type=e,i.arg=t,o?(this.method="next",this.next=o.finallyLoc,l):this.complete(i)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),l},finish:function(e){for(var t=this.tryEntries.length-1;0<=t;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),k(r),l}},catch:function(e){for(var t=this.tryEntries.length-1;0<=t;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var o=n.arg;k(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,r){return this.delegate={iterator:I(e),resultName:t,nextLoc:r},"next"===this.method&&(this.arg=void 0),l}},a}Object(Be.default)(B.BitableGlobalConfig),Object(_.injectEmbedBitableDep)(B.BitableGlobalConfig);var je=function(c){function s(e){var n;h()(this,s),(n=c.call(this,e)||this).commonInit=null,n.isBitableComponentLoaded=!1,n._onMountFired=!1,n.getEventList=function(){var e;return e={},g()(e,B.Events.OperationProduced,n.onOperationProduced),g()(e,B.Events.ChangesetApplied,n.onChangesetApplied),e},n.toggleEvents=function(e){var t=n.getEventList();n.bitableStore&&(e?n.bitableStore.addEventListeners(n.state.tableId,t):n.bitableStore.removeEventListeners(n.state.tableId,t))},n.onOperationProduced=function(e){n.props.onChanged&&n.props.onChanged(e.token),n.handleTriggerTryEidt(e)},n.onChangesetApplied=function(e){n.props.onChanged&&n.props.onChanged(e.token)},n.onDocumentKeyInvalid=function(){n.forceUpdate()},n.setHistory=function(){},n.syncVirtualScroll=function(){},n.updateOverlayerPosition=function(){},n.updateHighlight=function(e){n.setState({commentActionType:e})},n.updateBitableSelectionState=function(e){},n.destroy=function(){},n.collapseLineChange=function(e){},n.updateBitableContent=function(){},n.cancelPaste=function(){n.renderer.isCancelPaste=!0},n.setWidth=function(e,t,r){t===n.state.width&&r===n.state.padding||n.setState({width:t,padding:r})},n.setDocWidth=function(e){e!==n.state.docWidth&&n.setState({docWidth:e})},n.setMaxWidth=function(e){e!==n.state.maxWidth&&n.setState({maxWidth:e,maxHeight:1/0})},n.setHeight=function(e){n.setState({height:e})},n.setSize=function(e,t){},n.setZoom=function(e){},n.loadedTable=function(e){},n.switchTable=function(e){},n.addNewTable=function(e){},n.addRecoverCallback=function(r){var e=n.props.tableId;n.recoverCb&&n.bitableStore.removeEventListeners(e,g()({},B.Events.FetchRecoverHistory,n.recoverCb)),n.recoverCb=function(e){var t="";Array.isArray(e.operations)&&(e.operations.some(function(e){return!!e.transactionId&&(t=e.transactionId)}),n.recoverTransaction&&t===n.recoverTransaction||r(t))},n.bitableStore.addEventListeners(e,g()({},B.Events.FetchRecoverHistory,n.recoverCb))},n.setMentionBatchUpdate=function(e,t,r){n.smartableMentionManager.setBatchMentionUpdater(e,t,r)},n.getMentions=function(e){return n.smartableMentionManager.getMentions(e)},n.setCommentData=function(e,t){return n.smartableCommentManager.setCommentData(e,t)},n.startNewComment=function(e,t,r){return n.smartableCommentManager.startNewComment(e,t,r)},n.getComments=function(e){return n.smartableCommentManager.getComments(e)},n.supplementMentionIdByTableId=function(){var t=y()(_e().mark(function e(t){return _e().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",n.smartableMentionManager.supplementMentionIdByTableId(t));case 1:case"end":return e.stop()}},e)}));return function(e){return t.apply(this,arguments)}}(),n.setCommentBatchUpdate=function(e,t,r){n.smartableCommentManager.setBatchCommentUpdater(e,t,r)},n.addHoverHighlight=function(e,t){return n.smartableCommentManager.addHoverHighlight(e,t)},n.removeHoverHighlight=function(e,t){return n.smartableCommentManager.removeHoverHighlight(e,t)},n.getActiveComments=function(e){return n.smartableCommentManager.getActiveComments(e)},n.getResolvedComments=function(e){return n.smartableCommentManager.getResolvedComments(e)},n.setResolvedCommentIds=function(e,t){return n.smartableCommentManager.setResolvedCommentIds(e,t)},n.saveComment=function(e,t,r){return n.smartableCommentManager.saveComment(e,t,r)},n.removeComment=function(e,t){return n.smartableCommentManager.removeComment(e,t)},n.removeTempComment=function(e,t){return n.smartableCommentManager.removeTempComment(e,t)},n.resolveComment=function(e,t){return n.smartableCommentManager.resolveComment(e,t)},n.activateComment=function(e,t){return n.smartableCommentManager.activateComment(e,t)},n.deactivateComment=function(e,t){return n.smartableCommentManager.deactivateComment(e,t)},n.reopenComment=function(e,t){return n.smartableCommentManager.reopenComment(e,t)},n.findComment=function(e,t){return n.smartableCommentManager.findComment(e,t)},n.getTeaParams=function(e,t){return n.smartableCommentManager.getTeaParams(e,t)},n.getSmartableCommentManager=function(){return n.smartableCommentManager},n.getSmartableMentionManager=function(){return n.smartableMentionManager},n.getCommentPositions=function(e){return[]};var t=e.bitableStore,r=e.editable,o=void 0!==r&&r,i=e.mountOption,a=e.isForceSetSecurity;return t.setBasePermission(o&&!a),n.state={tableId:e.tableId,suspend:!1,width:X.width,padding:X.offsetX,commentActionType:e.commentActionType,maxWidth:e.maxWidth,offsetX:e.offsetX,docWidth:e.docWidth,zoom:"number"==typeof e.zoom?e.zoom:1,isSelect:!1,height:e.height,delayLoading:!1,isHistoryMode:!1,collapsed:!1,errorCodeType:i.errorCodeType||B.EErrorCodeType.none},n.init(n._token),n}return f()(s,c),d()(s,[{key:"componentWillReceiveProps",value:function(e){var t=this.props,r=t.width,n=t.padding,o=t.height,i=t.maxWidth,a=t.offsetX,c=t.docWidth;e.width===r&&e.padding===n&&e.height===o&&e.maxWidth===i&&e.offsetX===a&&e.docWidth===c||this.setState({width:e.width,padding:e.padding,height:e.height,maxWidth:e.maxWidth,offsetX:e.offsetX,docWidth:e.docWidth})}},{key:"componentDidMount",value:function(){this.isBitableComponentLoaded=!0;var e=this.props.onMount;this.toggleEvents(!0),this.setHistory(),e&&e(this),this.renderer.storageManager.setToken(this._token),this.notifyEmbedBitableLoaded(),this.commonInit&&this.commonInit.init()}},{key:"componentDidUpdate",value:function(e){this.notifyEmbedBitableLoaded();var t=this.props,r=t.editable,n=void 0!==r&&r,o=t.bitableStore,i=t.isForceSetSecurity,a=e.editable||!1,c=e.isForceSetSecurity||!1;n===a&&i===c||o.setBasePermission(n&&!i)}},{key:"notifyEmbedBitableLoaded",value:function(){var e=this.props.onLoaded;if(!this._onMountFired&&e&&this.getIsBitableComponentLoaded()){var t=this.props,r=t.bitableStore,n=t.tableId;(r.isTableOrClientVarLoaded(n)||!1)&&(e(),this._onMountFired=!0)}}},{key:"getIsBitableComponentLoaded",value:function(){return this.isBitableComponentLoaded}},{key:"componentWillUnmount",value:function(){this.props.bitableStore.getBaseEventManager().removeListener(B.Events.DocumentKeyInvalid,this.onDocumentKeyInvalid),this.toggleEvents(!1),delete this.notify,this.commonInit&&this.commonInit.unbindEvents()}},{key:"_token",get:function(){return this.props.token}},{key:"init",value:function(e){var t=this.props,r=t.bitableStore,n=t.storageManager,o=t.isVCEnable,i=t.mountOption.isTemplateMode,a=new B.Renderer(r,n,{reduxStore:this.props.store,isVCEnable:o,isolateUrlLocation:i});this.bitableStore=r,this.renderer=a,this.initCommentManager(),this.setHistory(),a.storageManager.setToken(e),r.getBaseEventManager().addListener(B.Events.DocumentKeyInvalid,this.onDocumentKeyInvalid)}},{key:"initCommentManager",value:function(){}},{key:"handleTriggerTryEidt",value:function(e){e.operation.command!==B.CollaCommands.AddComment&&_.BearWebHelper&&_.BearWebHelper.triggerBitableTryEdit&&_.BearWebHelper.triggerBitableTryEdit()}},{key:"takeScreenShot",value:function(){var r=y()(_e().mark(function e(t,r){return _e().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return");case 1:case"end":return e.stop()}},e)}));function e(e,t){return r.apply(this,arguments)}return e}()},{key:"getBitableViewScrollInfo",value:function(){return{scrollPosX:0,contentWidth:0}}},{key:"setBitableViewScrollPosition",value:function(e,t){}},{key:"setOffsetX",value:function(e){-30===e&&(e=0),e!==this.state.offsetX&&this.setState({offsetX:e})}},{key:"getSelection",value:function(){var e=this.renderer.activeBitableWidget;return e?e.getGridWidget().getSelection():null}},{key:"clearSelection",value:function(){var e=this.renderer.activeBitableWidget;if(!e)return null;e.getGridWidget().setSelection(null)}},{key:"switch",value:function(e,t){}},{key:"locateMention",value:function(){var n=y()(_e().mark(function e(t,r,n){var o;return _e().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.renderer.showMentionInFeed(t,r,n);case 2:if(o=e.sent,"object"!==T()(o)){e.next=5;break}return e.abrupt("return",o);case 5:return e.abrupt("return",!1);case 6:case"end":return e.stop()}},e,this)}));function e(e,t,r){return n.apply(this,arguments)}return e}()},{key:"registerScrollContainerRef",value:function(e,t){}},{key:"getDocWidth",value:function(){return 0}},{key:"receive",value:function(e){switch(e){case B.notifyEvents.UpdateBitableById:this.renderer.updateFaster();break;default:return}}},{key:"setNotifier",value:function(e){this.notify=e}},{key:"suspend",value:function(){this.setState({suspend:!0})}},{key:"resume",value:function(){this.setState({suspend:!1})}},{key:"setRecoverTransactionId",value:function(t){var e=this,r="",n=Object.keys(t);n.some(function(e){return!!t[e].transaction_id&&(r=t[e].transaction_id,!0)}),this.bitableStore.base.getTables().forEach(function(t){n.some(function(e){return e===t.id})||e.bitableStore.resetSyncTableById(t.id)}),this.recoverTransaction=r}},{key:"previewHistory",value:function(e,t){this.setState({isHistoryMode:!0})}},{key:"exitHistory",value:function(){this.setState({isHistoryMode:!1})}},{key:"recover",value:function(){var t=y()(_e().mark(function e(t){return _e().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return");case 1:case"end":return e.stop()}},e)}));function e(e){return t.apply(this,arguments)}return e}()},{key:"handleBitableIfPaste",value:function(){}},{key:"getZoom",value:function(){return 1}},{key:"onLoadedTable",value:function(){}},{key:"currentScreenShot",value:function(){}},{key:"freeze",value:function(){this.props.bitableStore.freeze()}},{key:"unfreeze",value:function(){this.props.bitableStore.unfreeze()}},{key:"updateErrorCodeType",value:function(e){e&&e!==this.state.errorCodeType&&this.setState({errorCodeType:e})}}]),s}(I.a.PureComponent),Ae=r("vb747"),Pe=r("vb748"),De=r("vb749");function Re(){Re=function(){return a};var a={},e=Object.prototype,u=e.hasOwnProperty,d=Object.defineProperty||function(e,t,r){e[t]=r.value},t="function"==typeof Symbol?Symbol:{},o=t.iterator||"@@iterator",r=t.asyncIterator||"@@asyncIterator",n=t.toStringTag||"@@toStringTag";function i(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{i({},"")}catch(e){i=function(e,t,r){return e[t]=r}}function c(e,t,r,n){var o=t&&t.prototype instanceof s?t:s,i=Object.create(o.prototype),a=new O(n||[]);return d(i,"_invoke",{value:S(e,r,a)}),i}function h(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}a.wrap=c;var l={};function s(){}function f(){}function p(){}var v={};i(v,o,function(){return this});var b=Object.getPrototypeOf,y=b&&b(b(I([])));y&&y!==e&&u.call(y,o)&&(v=y);var g=p.prototype=s.prototype=Object.create(v);function m(e){["next","throw","return"].forEach(function(t){i(e,t,function(e){return this._invoke(t,e)})})}function w(c,s){function l(e,t,r,n){var o=h(c[e],c,t);if("throw"!==o.type){var i=o.arg,a=i.value;return a&&"object"==T()(a)&&u.call(a,"__await")?s.resolve(a.__await).then(function(e){l("next",e,r,n)},function(e){l("throw",e,r,n)}):s.resolve(a).then(function(e){i.value=e,r(i)},function(e){return l("throw",e,r,n)})}n(o.arg)}var t;d(this,"_invoke",{value:function(r,n){function e(){return new s(function(e,t){l(r,n,e,t)})}return t=t?t.then(e,e):e()}})}function S(i,a,c){var s="suspendedStart";return function(e,t){if("executing"===s)throw new Error("Generator is already running");if("completed"===s){if("throw"===e)throw t;return L()}for(c.method=e,c.arg=t;;){var r=c.delegate;if(r){var n=E(r,c);if(n){if(n===l)continue;return n}}if("next"===c.method)c.sent=c._sent=c.arg;else if("throw"===c.method){if("suspendedStart"===s)throw s="completed",c.arg;c.dispatchException(c.arg)}else"return"===c.method&&c.abrupt("return",c.arg);s="executing";var o=h(i,a,c);if("normal"===o.type){if(s=c.done?"completed":"suspendedYield",o.arg===l)continue;return{value:o.arg,done:c.done}}"throw"===o.type&&(s="completed",c.method="throw",c.arg=o.arg)}}}function E(e,t){var r=t.method,n=e.iterator[r];if(void 0===n)return t.delegate=null,"throw"===r&&e.iterator.return&&(t.method="return",t.arg=void 0,E(e,t),"throw"===t.method)||"return"!==r&&(t.method="throw",t.arg=new TypeError("The iterator does not provide a '"+r+"' method")),l;var o=h(n,e.iterator,t.arg);if("throw"===o.type)return t.method="throw",t.arg=o.arg,t.delegate=null,l;var i=o.arg;return i?i.done?(t[e.resultName]=i.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,l):i:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,l)}function C(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function k(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function O(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(C,this),this.reset(!0)}function I(t){if(t){var e=t[o];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var r=-1,n=function e(){for(;++r<t.length;)if(u.call(t,r))return e.value=t[r],e.done=!1,e;return e.value=void 0,e.done=!0,e};return n.next=n}}return{next:L}}function L(){return{value:void 0,done:!0}}return f.prototype=p,d(g,"constructor",{value:p,configurable:!0}),d(p,"constructor",{value:f,configurable:!0}),f.displayName=i(p,n,"GeneratorFunction"),a.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===f||"GeneratorFunction"===(t.displayName||t.name))},a.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,p):(e.__proto__=p,i(e,n,"GeneratorFunction")),e.prototype=Object.create(g),e},a.awrap=function(e){return{__await:e}},m(w.prototype),i(w.prototype,r,function(){return this}),a.AsyncIterator=w,a.async=function(e,t,r,n,o){void 0===o&&(o=Promise);var i=new w(c(e,t,r,n),o);return a.isGeneratorFunction(t)?i:i.next().then(function(e){return e.done?e.value:i.next()})},m(g),i(g,n,"Generator"),i(g,o,function(){return this}),i(g,"toString",function(){return"[object Generator]"}),a.keys=function(e){var r=Object(e),n=[];for(var t in r)n.push(t);return n.reverse(),function e(){for(;n.length;){var t=n.pop();if(t in r)return e.value=t,e.done=!1,e}return e.done=!0,e}},a.values=I,O.prototype={constructor:O,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(k),!e)for(var t in this)"t"===t.charAt(0)&&u.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(r){if(this.done)throw r;var n=this;function e(e,t){return i.type="throw",i.arg=r,n.next=e,t&&(n.method="next",n.arg=void 0),!!t}for(var t=this.tryEntries.length-1;0<=t;--t){var o=this.tryEntries[t],i=o.completion;if("root"===o.tryLoc)return e("end");if(o.tryLoc<=this.prev){var a=u.call(o,"catchLoc"),c=u.call(o,"finallyLoc");if(a&&c){if(this.prev<o.catchLoc)return e(o.catchLoc,!0);if(this.prev<o.finallyLoc)return e(o.finallyLoc)}else if(a){if(this.prev<o.catchLoc)return e(o.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return e(o.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;0<=r;--r){var n=this.tryEntries[r];if(n.tryLoc<=this.prev&&u.call(n,"finallyLoc")&&this.prev<n.finallyLoc){var o=n;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var i=o?o.completion:{};return i.type=e,i.arg=t,o?(this.method="next",this.next=o.finallyLoc,l):this.complete(i)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),l},finish:function(e){for(var t=this.tryEntries.length-1;0<=t;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),k(r),l}},catch:function(e){for(var t=this.tryEntries.length-1;0<=t;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var o=n.arg;k(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,r){return this.delegate={iterator:I(e),resultName:t,nextLoc:r},"next"===this.method&&(this.arg=void 0),l}},a}var Fe=function(){function o(e){var n=this;h()(this,o),this.commentSDK=null,this.handleCommentDataChange=function(e,t,r){r&&r.isInit&&n.updateIsCommentDataInit()},this.updateIsCommentDataInit=function(){_.store.dispatch(Object(B.toggleIsCommentDataInit)(!0)),n.base&&B.BaseToolbarStore.getInstanceByBase(n.base).toggleIsCommentDataInit(!0)};var t=e.suiteToken,r=e.suiteType;this.suiteToken=t,this.suiteType=r,this.base=e.base}return d()(o,[{key:"init",value:function(){var e=y()(Re().mark(function e(){var t,r,n;return Re().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,Object(_.loadableCommentDep)();case 3:if(t=e.sent,r=t.commentSDKManager,n=r.getOrCreate({serviceToken:this.suiteToken,serviceType:this.suiteType}),this.commentSDK=n){e.next=9;break}return e.abrupt("return");case 9:n&&n.hasInitCommentData&&this.updateIsCommentDataInit(),n.on("commentDataChange",this.handleCommentDataChange),e.next=16;break;case 13:e.prev=13,e.t0=e.catch(0),console.error("CommentInit error",e.t0);case 16:case"end":return e.stop()}},e,this,[[0,13]])}));function t(){return e.apply(this,arguments)}return t}()},{key:"unbindEvents",value:function(){this.commentSDK&&this.commentSDK.off("commentDataChange",this.handleCommentDataChange)}}]),o}(),Ne=r("vb750");function Ue(){Ue=function(){return a};var a={},e=Object.prototype,u=e.hasOwnProperty,d=Object.defineProperty||function(e,t,r){e[t]=r.value},t="function"==typeof Symbol?Symbol:{},o=t.iterator||"@@iterator",r=t.asyncIterator||"@@asyncIterator",n=t.toStringTag||"@@toStringTag";function i(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{i({},"")}catch(e){i=function(e,t,r){return e[t]=r}}function c(e,t,r,n){var o=t&&t.prototype instanceof s?t:s,i=Object.create(o.prototype),a=new O(n||[]);return d(i,"_invoke",{value:S(e,r,a)}),i}function h(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}a.wrap=c;var l={};function s(){}function f(){}function p(){}var v={};i(v,o,function(){return this});var b=Object.getPrototypeOf,y=b&&b(b(I([])));y&&y!==e&&u.call(y,o)&&(v=y);var g=p.prototype=s.prototype=Object.create(v);function m(e){["next","throw","return"].forEach(function(t){i(e,t,function(e){return this._invoke(t,e)})})}function w(c,s){function l(e,t,r,n){var o=h(c[e],c,t);if("throw"!==o.type){var i=o.arg,a=i.value;return a&&"object"==T()(a)&&u.call(a,"__await")?s.resolve(a.__await).then(function(e){l("next",e,r,n)},function(e){l("throw",e,r,n)}):s.resolve(a).then(function(e){i.value=e,r(i)},function(e){return l("throw",e,r,n)})}n(o.arg)}var t;d(this,"_invoke",{value:function(r,n){function e(){return new s(function(e,t){l(r,n,e,t)})}return t=t?t.then(e,e):e()}})}function S(i,a,c){var s="suspendedStart";return function(e,t){if("executing"===s)throw new Error("Generator is already running");if("completed"===s){if("throw"===e)throw t;return L()}for(c.method=e,c.arg=t;;){var r=c.delegate;if(r){var n=E(r,c);if(n){if(n===l)continue;return n}}if("next"===c.method)c.sent=c._sent=c.arg;else if("throw"===c.method){if("suspendedStart"===s)throw s="completed",c.arg;c.dispatchException(c.arg)}else"return"===c.method&&c.abrupt("return",c.arg);s="executing";var o=h(i,a,c);if("normal"===o.type){if(s=c.done?"completed":"suspendedYield",o.arg===l)continue;return{value:o.arg,done:c.done}}"throw"===o.type&&(s="completed",c.method="throw",c.arg=o.arg)}}}function E(e,t){var r=t.method,n=e.iterator[r];if(void 0===n)return t.delegate=null,"throw"===r&&e.iterator.return&&(t.method="return",t.arg=void 0,E(e,t),"throw"===t.method)||"return"!==r&&(t.method="throw",t.arg=new TypeError("The iterator does not provide a '"+r+"' method")),l;var o=h(n,e.iterator,t.arg);if("throw"===o.type)return t.method="throw",t.arg=o.arg,t.delegate=null,l;var i=o.arg;return i?i.done?(t[e.resultName]=i.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,l):i:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,l)}function C(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function k(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function O(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(C,this),this.reset(!0)}function I(t){if(t){var e=t[o];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var r=-1,n=function e(){for(;++r<t.length;)if(u.call(t,r))return e.value=t[r],e.done=!1,e;return e.value=void 0,e.done=!0,e};return n.next=n}}return{next:L}}function L(){return{value:void 0,done:!0}}return f.prototype=p,d(g,"constructor",{value:p,configurable:!0}),d(p,"constructor",{value:f,configurable:!0}),f.displayName=i(p,n,"GeneratorFunction"),a.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===f||"GeneratorFunction"===(t.displayName||t.name))},a.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,p):(e.__proto__=p,i(e,n,"GeneratorFunction")),e.prototype=Object.create(g),e},a.awrap=function(e){return{__await:e}},m(w.prototype),i(w.prototype,r,function(){return this}),a.AsyncIterator=w,a.async=function(e,t,r,n,o){void 0===o&&(o=Promise);var i=new w(c(e,t,r,n),o);return a.isGeneratorFunction(t)?i:i.next().then(function(e){return e.done?e.value:i.next()})},m(g),i(g,n,"Generator"),i(g,o,function(){return this}),i(g,"toString",function(){return"[object Generator]"}),a.keys=function(e){var r=Object(e),n=[];for(var t in r)n.push(t);return n.reverse(),function e(){for(;n.length;){var t=n.pop();if(t in r)return e.value=t,e.done=!1,e}return e.done=!0,e}},a.values=I,O.prototype={constructor:O,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(k),!e)for(var t in this)"t"===t.charAt(0)&&u.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(r){if(this.done)throw r;var n=this;function e(e,t){return i.type="throw",i.arg=r,n.next=e,t&&(n.method="next",n.arg=void 0),!!t}for(var t=this.tryEntries.length-1;0<=t;--t){var o=this.tryEntries[t],i=o.completion;if("root"===o.tryLoc)return e("end");if(o.tryLoc<=this.prev){var a=u.call(o,"catchLoc"),c=u.call(o,"finallyLoc");if(a&&c){if(this.prev<o.catchLoc)return e(o.catchLoc,!0);if(this.prev<o.finallyLoc)return e(o.finallyLoc)}else if(a){if(this.prev<o.catchLoc)return e(o.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return e(o.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;0<=r;--r){var n=this.tryEntries[r];if(n.tryLoc<=this.prev&&u.call(n,"finallyLoc")&&this.prev<n.finallyLoc){var o=n;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var i=o?o.completion:{};return i.type=e,i.arg=t,o?(this.method="next",this.next=o.finallyLoc,l):this.complete(i)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),l},finish:function(e){for(var t=this.tryEntries.length-1;0<=t;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),k(r),l}},catch:function(e){for(var t=this.tryEntries.length-1;0<=t;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var o=n.arg;k(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,r){return this.delegate={iterator:I(e),resultName:t,nextLoc:r},"next"===this.method&&(this.arg=void 0),l}},a}function Ve(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),r.push.apply(r,n)}return r}function He(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?Ve(Object(r),!0).forEach(function(e){g()(t,e,r[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):Ve(Object(r)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))})}return t}var We=!0,Ge=function(t){function a(e){var r;return h()(this,a),(r=t.call(this,He({},e,{isVCEnable:We}))||this).checkLoaded=function(){r.props.onLoaded&&!r._onMountFired&&(r._onMountFired=!0,r.props.onLoaded())},r.getCommentPositions=function(e){return r.smartableCommentManager.getCommentPositions(e)},r.showCommentInNcc=function(e){return r.smartableCommentManager.showCommentInNcc(e)},r.setHistory=function(){r.renderer.storageManager.setHistory(r.props.history)},r.loadedTable=function(e){r.renderer.loadedTable(e)},r.switchTable=function(e){r.renderer.switchTable(r.bitableStore.base,e)},r.addNewTable=function(e){var t=r.bitableStore.base;_.store.dispatch(Object(B.updateTables)(t)),r.renderer.addNewTable(t,e),r.setState({delayLoading:!0},function(){requestAnimationFrame(function(){return r.state.delayLoading&&r.setState({delayLoading:!1})})})},r.handleUploadError=function(e){var t=e&&e.errorType;if(_.BearWebHelper&&!_.BearWebHelper.isLark()&&_.Constant&&t===_.Constant.WEB_UPLOAD_ERROR_CODE.UPLOAD_CREATE_LIMIT)_.BearWebHelper.triggerStoragePicLimitDialog();else{if(_.BearWebHelper&&_.Constant&&t===_.Constant.WEB_UPLOAD_ERROR_CODE.UPLOAD_USER_STORAGE_LIMIT){var r={mountPoint:e.mountPoint,mountNodeToken:e.parentToken},n={meta:{}};return e.file.data.viewType===B.ViewType.Form&&(n.meta.reason="bitable_form_upload_file"),void _.BearWebHelper.triggerUserPicLimitDialog(r,n)}Object(Ne.a)(t)}},r}return f()(a,t),d()(a,[{key:"componentDidMount",value:function(){var e=y()(Ue().mark(function e(){var t,r,n,o;return Ue().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(w()(S()(a.prototype),"componentDidMount",this).call(this),t=this.props,r=t.tableId,n=t.mountOption,!(o=n.operator)){e.next=7;break}return e.next=6,this.bitableStore.waitTableClientVarLoaded(r);case 6:o.onTableLoaded&&o.onTableLoaded();case 7:case"end":return e.stop()}},e,this)}));function t(){return e.apply(this,arguments)}return t}()},{key:"componentDidUpdate",value:function(e){w()(S()(a.prototype),"componentDidUpdate",this).call(this,e);var t=this._token;if(e.token===t){if(!Object(B.isShortCut)())return;var r=this.props.query,n=e.query,o=r.get(B.QUERY_TABLE_KEY)||null,i=r.get(B.QUERY_VIEW_KEY)||null;(o!==n.get(B.QUERY_TABLE_KEY)||i!==n.get(B.QUERY_VIEW_KEY))&&o&&i&&this.renderer&&this.renderer.switchView(this.bitableStore.base,o,i)}this.checkLoaded(),this.props.onRecover&&this.addRecoverCallback(this.props.onRecover)}},{key:"componentWillReceiveProps",value:function(e){e.isEditMode!==this.props.isEditMode&&(!1===e.isEditMode?this.freeze():this.unfreeze())}},{key:"initCommentManager",value:function(){var e=this.bitableStore,t=this.renderer,r=this.props,n=r.mountOption,o=r.suiteToken,i=r.suiteType,a=n.operator,c={onTableLoaded:a.onTableLoaded,onBatchUpdateBlockComment:a.onBatchUpdateBlockComment,onStartNewComment:a.onStartNewComment},s=Object(B.getBusinessBase)(e.base);this.commonInit=new Fe({suiteToken:o,suiteType:i,base:s});var l=_.CommentHelper&&_.CommentHelper.sheetNewCommentEnable;this.smartableCommentManager=new B.AloneSmartableCommentManager({renderer:t,bitableStore:e,comment:c,customCommentCard:l?Object(Pe.c)():void 0,customCommentBar:l?Pe.a:void 0}),this.smartableMentionManager=new B.AloneSmartableMentionManager({renderer:t,bitableStore:e,customMentionBar:De.a})}},{key:"render",value:function(){var e=this.props,t=e.bitableStore,r=e.token,n=e.tableId,o=e.viewId,i=e.onTableChangedInUndo,a=e.mountOption,c=this.state,s=c.suspend,l=c.height,u=c.delayLoading,d=a.hideComment,h=a.isTemplateMode,f=!d;return s?null:I.a.createElement(B.SheetBitable,{token:r,bitableStore:t,renderer:this.renderer,smartableCommentManager:this.smartableCommentManager,smartableMentionManager:this.smartableMentionManager,tableId:n,viewId:o,onTableChangedInUndo:i,mountOption:a,onBaseNotSupport:this.checkLoaded,ready:!0,isTemplateMode:h,height:l,delayLoading:u,IOConfig:{IO:_.IO.getInstance()},bitableConfig:{attachmentUploadHooks:{uploadError:this.handleUploadError},mentionConfig:{mentionSource:_.SOURCE_ENUM.SHEET},ui:{showComment:f}},isVCEnable:We})}}]),a}(je),ze=Object(L.connect)(function(e,t){var r=!_.SuiteReduxSelector||!_.SuiteReduxSelector.selectIsInEditMode||_.SuiteReduxSelector.selectIsInEditMode(e);return{tableId:Object(B.activeTableIdSelector)(e)||t.tableId,viewId:Object(B.activeViewIdSelector)(e),query:Object(_.selectQuery)(e),isEditMode:r,editable:Object(Ae.a)(e),suiteType:_.SuiteReduxSelector.selectCurrentSuiteType(e),suiteToken:_.SuiteReduxSelector.selectCurrentSuiteToken(e),isForceSetSecurity:Object(B.selectIsForceSetSecurityLabel)(e)}})(Ge),Ke=function(t){function n(e){var r;return h()(this,n),(r=t.call(this,e)||this).setHistory=function(){},r.loadedTable=function(e){r.renderer.loadedTable(e)},r.switchTable=function(e){r.historyModeTableId=e,r.forceUpdate()},r.addNewTable=function(e){var t=r.bitableStore.base;_.store.dispatch(Object(B.updateTables)(t)),r.renderer.addNewTable(t,e),r.setState({delayLoading:!0},function(){requestAnimationFrame(function(){return r.state.delayLoading&&r.setState({delayLoading:!1})})})},r}return f()(n,t),d()(n,[{key:"componentDidMount",value:function(){w()(S()(n.prototype),"componentDidMount",this).call(this)}},{key:"componentDidUpdate",value:function(e){w()(S()(n.prototype),"componentDidUpdate",this).call(this,e),this.props.onLoaded&&!this._onMountFired&&(this._onMountFired=!0,this.props.onLoaded())}},{key:"previewHistory",value:function(e,t){var o=this,i=e.revInfo,r=e.changesets,n=t?t.activeTableId:void 0;this.revInfo=i,this.localChangesets=r,n&&i[n]||Object.keys(i).forEach(function(e){0===i[e].lastRev&&(n=e)}),n?this.historyModeTableId=n:Object.keys(i).forEach(function(e){var t=i[e],r=t.lastRev,n=t.firstRev;Number.isInteger(r)&&Number.isInteger(n)&&(o.historyModeTableId=e)}),this.forceUpdate()}},{key:"exitHistory",value:function(){w()(S()(n.prototype),"exitHistory",this).call(this)}},{key:"render",value:function(){var e=this.props,t=e.bitableStore,r=e.token,n=e.activeTableId,o=this.bitableStore.base.getOrderedInfos(),i=this.state,a=i.suspend,c=i.height;return a?null:I.a.createElement(B.EmbeddedBitableHistoryForSheet,{token:r,io:t.io,key:this.historyModeTableId||n,bitableBase:t.base.toJSON(),activeTableId:this.historyModeTableId||n,hideTab:!0,hideList:!0,hideHeader:!0,height:c,revInfo:this.revInfo,orderedInfos:o,store:this.props.store,localChangesets:this.localChangesets})}}]),n}(je),Ye=Object(L.connect)(function(e){return{tableId:Object(B.activeTableIdSelector)(e),viewId:Object(B.activeViewIdSelector)(e)}})(Ke),Qe=r("vb180"),Xe=r("vb159"),Je=r.n(Xe),qe=r("vb875"),Ze=r("vb1795"),$e=r("vb123"),et=410;function tt(e){var t;return!!e.docx&&(null===(t=e.docx.history)||void 0===t?void 0:t.isShow)}function rt(){rt=function(){return a};var a={},e=Object.prototype,u=e.hasOwnProperty,d=Object.defineProperty||function(e,t,r){e[t]=r.value},t="function"==typeof Symbol?Symbol:{},o=t.iterator||"@@iterator",r=t.asyncIterator||"@@asyncIterator",n=t.toStringTag||"@@toStringTag";function i(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{i({},"")}catch(e){i=function(e,t,r){return e[t]=r}}function c(e,t,r,n){var o=t&&t.prototype instanceof s?t:s,i=Object.create(o.prototype),a=new O(n||[]);return d(i,"_invoke",{value:S(e,r,a)}),i}function h(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}a.wrap=c;var l={};function s(){}function f(){}function p(){}var v={};i(v,o,function(){return this});var b=Object.getPrototypeOf,y=b&&b(b(I([])));y&&y!==e&&u.call(y,o)&&(v=y);var g=p.prototype=s.prototype=Object.create(v);function m(e){["next","throw","return"].forEach(function(t){i(e,t,function(e){return this._invoke(t,e)})})}function w(c,s){function l(e,t,r,n){var o=h(c[e],c,t);if("throw"!==o.type){var i=o.arg,a=i.value;return a&&"object"==T()(a)&&u.call(a,"__await")?s.resolve(a.__await).then(function(e){l("next",e,r,n)},function(e){l("throw",e,r,n)}):s.resolve(a).then(function(e){i.value=e,r(i)},function(e){return l("throw",e,r,n)})}n(o.arg)}var t;d(this,"_invoke",{value:function(r,n){function e(){return new s(function(e,t){l(r,n,e,t)})}return t=t?t.then(e,e):e()}})}function S(i,a,c){var s="suspendedStart";return function(e,t){if("executing"===s)throw new Error("Generator is already running");if("completed"===s){if("throw"===e)throw t;return L()}for(c.method=e,c.arg=t;;){var r=c.delegate;if(r){var n=E(r,c);if(n){if(n===l)continue;return n}}if("next"===c.method)c.sent=c._sent=c.arg;else if("throw"===c.method){if("suspendedStart"===s)throw s="completed",c.arg;c.dispatchException(c.arg)}else"return"===c.method&&c.abrupt("return",c.arg);s="executing";var o=h(i,a,c);if("normal"===o.type){if(s=c.done?"completed":"suspendedYield",o.arg===l)continue;return{value:o.arg,done:c.done}}"throw"===o.type&&(s="completed",c.method="throw",c.arg=o.arg)}}}function E(e,t){var r=t.method,n=e.iterator[r];if(void 0===n)return t.delegate=null,"throw"===r&&e.iterator.return&&(t.method="return",t.arg=void 0,E(e,t),"throw"===t.method)||"return"!==r&&(t.method="throw",t.arg=new TypeError("The iterator does not provide a '"+r+"' method")),l;var o=h(n,e.iterator,t.arg);if("throw"===o.type)return t.method="throw",t.arg=o.arg,t.delegate=null,l;var i=o.arg;return i?i.done?(t[e.resultName]=i.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,l):i:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,l)}function C(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function k(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function O(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(C,this),this.reset(!0)}function I(t){if(t){var e=t[o];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var r=-1,n=function e(){for(;++r<t.length;)if(u.call(t,r))return e.value=t[r],e.done=!1,e;return e.value=void 0,e.done=!0,e};return n.next=n}}return{next:L}}function L(){return{value:void 0,done:!0}}return f.prototype=p,d(g,"constructor",{value:p,configurable:!0}),d(p,"constructor",{value:f,configurable:!0}),f.displayName=i(p,n,"GeneratorFunction"),a.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===f||"GeneratorFunction"===(t.displayName||t.name))},a.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,p):(e.__proto__=p,i(e,n,"GeneratorFunction")),e.prototype=Object.create(g),e},a.awrap=function(e){return{__await:e}},m(w.prototype),i(w.prototype,r,function(){return this}),a.AsyncIterator=w,a.async=function(e,t,r,n,o){void 0===o&&(o=Promise);var i=new w(c(e,t,r,n),o);return a.isGeneratorFunction(t)?i:i.next().then(function(e){return e.done?e.value:i.next()})},m(g),i(g,n,"Generator"),i(g,o,function(){return this}),i(g,"toString",function(){return"[object Generator]"}),a.keys=function(e){var r=Object(e),n=[];for(var t in r)n.push(t);return n.reverse(),function e(){for(;n.length;){var t=n.pop();if(t in r)return e.value=t,e.done=!1,e}return e.done=!0,e}},a.values=I,O.prototype={constructor:O,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(k),!e)for(var t in this)"t"===t.charAt(0)&&u.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(r){if(this.done)throw r;var n=this;function e(e,t){return i.type="throw",i.arg=r,n.next=e,t&&(n.method="next",n.arg=void 0),!!t}for(var t=this.tryEntries.length-1;0<=t;--t){var o=this.tryEntries[t],i=o.completion;if("root"===o.tryLoc)return e("end");if(o.tryLoc<=this.prev){var a=u.call(o,"catchLoc"),c=u.call(o,"finallyLoc");if(a&&c){if(this.prev<o.catchLoc)return e(o.catchLoc,!0);if(this.prev<o.finallyLoc)return e(o.finallyLoc)}else if(a){if(this.prev<o.catchLoc)return e(o.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return e(o.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;0<=r;--r){var n=this.tryEntries[r];if(n.tryLoc<=this.prev&&u.call(n,"finallyLoc")&&this.prev<n.finallyLoc){var o=n;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var i=o?o.completion:{};return i.type=e,i.arg=t,o?(this.method="next",this.next=o.finallyLoc,l):this.complete(i)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),l},finish:function(e){for(var t=this.tryEntries.length-1;0<=t;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),k(r),l}},catch:function(e){for(var t=this.tryEntries.length-1;0<=t;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var o=n.arg;k(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,r){return this.delegate={iterator:I(e),resultName:t,nextLoc:r},"next"===this.method&&(this.arg=void 0),l}},a}function nt(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),r.push.apply(r,n)}return r}function ot(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?nt(Object(r),!0).forEach(function(e){g()(t,e,r[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):nt(Object(r)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))})}return t}var it=function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"===("undefined"==typeof Reflect?"undefined":T()(Reflect))&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var c=e.length-1;0<=c;c--)(o=e[c])&&(a=(i<3?o(a):3<i?o(t,r,a):o(t,r))||a);return 3<i&&a&&Object.defineProperty(t,r,a),a},at=!0,ct=function(o){function s(e){var t,v;h()(this,s),(v=o.call(this,e)||this).updateSheetSelectionStateCoreTimer=0,v.overlayerRef=null,v.floatToolbarRef=null,v.docContainer=null,v.updateOverlayRafId=null,v.bitableRef=null,v.shouldBindContainerEvent=!0,v.scrollContainer=null,v.lastOverlayerPosition=null,v.collapseLineChange=function(e){v.state.collapsed!==e&&v.setState({collapsed:e})},v.updateBitableContent=function(){v.renderer.batchUpdateFaster()},v.syncVirtualScroll=function(){v.scrollHandle&&v.scrollHandle(),v.updateOverlayerPosition()},v.getActiveViewFromState=function(){var e=v.props.tableId,t=v.context.store;return Object(B.tableViewSelector)(t.getState(),e,Object(B.tableActiveViewIdSelector)(t.getState(),e))},v.getVCfollowId=function(){return v.props.tableId},v.openVCFollow=function(){Object(B.enableModuleFollowState)(B.BitableFollowModule.BitableFullScreen,v.replayVCFollowState,{instanceId:v.getVCfollowId()}),v.sendVCStateChange(v.getVCFollowState())},v.closeVCFollow=function(){v.sendVCStateChange({fullscreen:""}),Object(B.closeModuleFollow)(B.BitableFollowModule.BitableFullScreen,v.replayVCFollowState,{instanceId:v.getVCfollowId()})},v.sendVCStateChange=function(e){Object(B.sendFollowState)(B.BitableFollowModule.BitableFullScreen,e,{instanceId:v.getVCfollowId()})},v.getVCFollowState=function(){return{fullscreen:v.props.fullScreenTableId||""}},v.onFullScreenClick=function(){var e=v.props,t=e.tableId,r=e.shell.onFullScreenMode,n=e.isFullScreenMode,o=e.setFullScreenTableId;if(!n&&r){r(t),o(t),B.BitableTea.collectBitableEvent(B.ClickEvent.CcmBitableToolbarClick,{click:B.ToolbarItemClickEventMap[B.ToolbarItemType.FULL_SCREEN],target:B.DEFAULT_TARGET}),v._setActiveBitable();var i=v.getActiveViewFromState();i&&B.BitableDep.collectBitableEvent("click_enter_full_screen",{source:"click_btn",block_type:"bitable",view_type:B.ViewTypeStringMap[i.type]}),v.sendVCStateChange({fullscreen:t})}},v.exitFullScreen=function(){var e=v.props,t=e.shell.exitFullScreenMode,r=e.setFullScreenTableId;if(t){t(),r(""),B.BitableTea.collectBitableEvent(B.ClickEvent.CcmBitableToolbarClick,{click:B.ToolbarItemClickEventMap[B.ToolbarItemType.FULL_SCREEN],target:B.DEFAULT_TARGET});var n=v.getActiveViewFromState();n&&B.BitableDep.collectBitableEvent("click_exit_full_screen",{source:"click_btn",block_type:"bitable",view_type:B.ViewTypeStringMap[n.type]}),v.sendVCStateChange({fullscreen:""})}},v.setSize=function(e,t){e!==v.state.maxWidth&&t!==v.state.maxHeight&&v.setState({maxWidth:e,maxHeight:t})},v.setZoom=function(e){e!==v.state.zoom&&v.setState({zoom:e})},v._doResizeInFullScreen=Object(Qe.a)(function(){v.setState({maxWidth:window.innerWidth})},100),v._setActiveBitable=function(){var e=v.props.tableId,t=b()(v).renderer;B.RendererManager.getActiveTableId()!==e&&B.RendererManager.setActiveRenderer(t)},v._handleFullScreenClick=function(){_.BearWebHelper&&_.BearWebHelper.triggerBitableFullScreenClick&&_.BearWebHelper.triggerBitableFullScreenClick()},v.setHistory=function(){v.props.storageManager.setHistory(v.props.history)},v.renderToolbar=function(e,t){var r,n,o=b()(v),i=o.props,a=o.state,c=i.bitableStore,s=i.tableId,l=i.isFullScreenMode,u=i.viewId,d=i.mountOption,h=i.isVCEnable,f=a.docWidth,p=a.offsetX;return l||(r=ot({position:"absolute",paddingLeft:e.paddingLeft||p,boxSizing:"content-box"},e),n=t),I.a.createElement("div",{className:Je()("bitable-toolbar-doc-wrapper layout-row layout-cross-center f-s-0",{"bitable-toolbar-doc-fullscreen-wrapper":l}),ref:function(e){return v.toolBarRef=e},onWheel:n,style:r},I.a.createElement(B.EmbeddedDocToolBar,{tableId:s,viewId:u,isFullScreen:l,bitableStore:c,renderer:v.renderer,smartableCommentManager:v.smartableCommentManager,smartableMentionManager:v.smartableMentionManager,docWidth:f,exitFullScreen:l?v.exitFullScreen:void 0,viewsExclude:d.viewsExclude,sideBarOverlay:v.getIsDocx()?v.overlayerRef:null,isVCEnable:h}),_.browser.safari&&I.a.createElement("div",{className:"j-safari-selection"}))},v.renderScreenShotToolbar=function(e,t){var r=ot({position:"static"},e);return v.renderToolbar(r,t)},v.handleDocxExitHistory=function(){v.smartableMentionManager.fetchUpdate(v.props.tableId,!0)},v.onShowFloatToolBar=function(){B.BitableTea.collectBitableEvent(B.ViewEvent.CcmBitableToolbarView,{trigger_type:B.ToolBarShowType.HoverWhole},!0,v.renderer)},v.setFloatToolbarRef=function(e){v.floatToolbarRef=e},v._updateOverlayPosition=function(){var e=v.props.mountOption;if(_.EventEmitter.emit(me.BITABLE_OVERLAYER_POSITION_UPDATING),v.overlayerRef){var t=null==e?void 0:e.operator.getBitablePosition(),r=t.left,n=t.top;if(v.lastOverlayerPosition&&v.lastOverlayerPosition.left===r&&v.lastOverlayerPosition.top===n)return;v.lastOverlayerPosition={top:n,left:r},v.overlayerRef.style.left=r+"px",v.overlayerRef.style.top=n+"px"}},v.updateOverlayerPosition=function(){v.props.isFullScreenMode||(v.getIsDocx()?v._updateOverlayPosition():(null!==v.updateOverlayRafId&&(cancelAnimationFrame(v.updateOverlayRafId),v.updateOverlayRafId=null),v.updateOverlayRafId=requestAnimationFrame(function(){v.updateOverlayRafId=null,v._updateOverlayPosition()})))},v.setOverLayerRef=function(e){v.overlayerRef=e},v.setOnScrollHandle=function(e){v.scrollHandle=e},v.setToolBarStyle=function(e,t){function r(e,t){return e.top===t.top&&e.bottom===t.bottom}e&&v.toolBarRef&&!r(v.toolBarRef.style,e)&&Object.assign(v.toolBarRef.style,e)},v.updateSelect=function(e,t){v.setState({isSelect:e,selectedStyle:t})},v.hoverBitable=function(){v.notify&&v.notify({name:"HoverDocBitable"}),v.setState({hoverBitable:!0})},v.receive=function(e){switch(w()((t=b()(v),S()(s.prototype)),"receive",t).call(t,e),e){case"HoverDocBitable":v.state.hoverBitable&&v.setState({hoverBitable:!1});break;default:return}},v.isMouseInOverlay=function(e){var t=v.props.mountOption.overlayContainer;return!!(t&&e&&t.contains(e))},v.leaveBitable=function(e){if(!1!==v.state.hoverBitable){var t=e.relatedTarget;if(!v.props.isFullScreenMode){var r=!1,n=!1;t instanceof Node&&(r=v.isMouseInOverlay(t),n=!(!v.bitableRef||!v.bitableRef.contains(t)));var o=!t||!t.classList||!t.classList.contains("J-bitable-container");r||n||!o||v.setState({hoverBitable:!1})}}},v.setBitableRef=function(e){v.embedBitableRef=e&&e.wrappedInstance?e.wrappedInstance:e,v.scrollContainer&&v.embedBitableRef&&v.embedBitableRef.registerScrollContainerRef&&v.embedBitableRef.registerScrollContainerRef(v.scrollContainer),e&&(v.notifyEmbedBitableLoaded(),v.openVCFollow())},v.getRecordRectByRecordId=function(e){var t=v.renderer.activeBitableWidget&&v.renderer.activeBitableWidget.getActiveWidget();return t&&t.getRecordRectByRecordId?t.getRecordRectByRecordId(e):null},v.getSearchBaseOpts=function(){var e=b()(v).renderer,t=v.props;return{bitableStore:t.bitableStore,renderer:e,tableId:t.tableId,viewId:t.viewId}},v.highlightSearchItem=function(e,t,r){return Object(B.highlightSearchResultInDoc)(t,v.getSearchBaseOpts(),r)},v.setBitableContainerRef=function(e){v.bitableRef&&e!==v.bitableRef&&v.unbindBitableContainerEvent(),v.bitableRef=e,v.props.isFullScreenMode||v.bindBitableContainerEvent()},v.handleUploadError=function(e){var t=e&&e.errorType;if(_.BearWebHelper&&!_.BearWebHelper.isLark()&&_.Constant&&t===_.Constant.WEB_UPLOAD_ERROR_CODE.UPLOAD_CREATE_LIMIT)_.BearWebHelper.triggerStoragePicLimitDialog();else if(_.BearWebHelper&&_.Constant&&t===_.Constant.WEB_UPLOAD_ERROR_CODE.UPLOAD_USER_STORAGE_LIMIT){var r={mountPoint:e.mountPoint,mountNodeToken:e.parentToken};_.BearWebHelper.triggerUserPicLimitDialog(r)}else Object(Ne.a)(t)},v.triggerBitableCommentLoaded=y()(rt().mark(function e(){var t,r,n,o,i;return rt().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t=v.props,r=t.tableId,n=t.mountOption,!(o=n.operator)){e.next=7;break}return e.next=5,v.bitableStore.waitTableClientVarLoaded(r);case 5:i=v.smartableCommentManager.getComments(r),o.onCommentLoaded&&o.onCommentLoaded(i);case 7:case"end":return e.stop()}},e)})),v.renderBlockError=function(e){var t=v.state.offsetX;return I.a.createElement(Ze.a,{errorCodeType:e,offsetX:v.getIsDocx()?0:t})};var r=e.bitableStore,n=e.tableId;return r.initTableEventManager(n),v}return f()(s,o),d()(s,[{key:"componentDidMount",value:function(){var e=y()(rt().mark(function e(){var t,r,n,o,i,a,c;return rt().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:w()(S()(s.prototype),"componentDidMount",this).call(this),t=this.props,r=t.bitableStore,n=t.tableId,o=t.isFullScreenMode,i=t.setFullScreenTableId,a=t.setFloatToolbarTable,(c=r.base.getTableById(n))&&c.tableLoaded&&this.renderer.loadedTable(n),o&&(window.addEventListener("resize",this._doResizeInFullScreen),window.addEventListener("click",this._handleFullScreenClick),i(n),a("",!1),_.EventEmitter.emit(me.BITABLE_ENTER_DOC_FULLSCREEN)),this.triggerBitableCommentLoaded();case 6:case"end":return e.stop()}},e,this)}));function t(){return e.apply(this,arguments)}return t}()},{key:"componentWillUnmount",value:function(){var e,t=this.renderer,r=this.props,n=r.isFullScreenMode,o=r.setFullScreenTableId;n?(window.removeEventListener("resize",this._doResizeInFullScreen),window.removeEventListener("click",this._handleFullScreenClick),o(""),_.EventEmitter.emit(me.BITABLE_EXIT_DOC_FULLSCREEN),this.smartableCommentManager.exitDocFullScreen(),null===(e=this.smartableMentionManager)||void 0===e||e.exitDocFullScreen()):(t.destroyAllLoadingAttaches(),t.cancelPaste&&t.cancelPaste(),t.cancelPaste=null,this.updateOverlayRafId&&cancelAnimationFrame(this.updateOverlayRafId),this.updateOverlayRafId=null,this.unbindBitableContainerEvent(),this.bitableRef=null,this.smartableMentionManager.destroy());this.scrollHandle=function(){return null},w()(S()(s.prototype),"componentWillUnmount",this).call(this),this.closeVCFollow()}},{key:"componentWillReceiveProps",value:function(e){""!==e.fullScreenTableId&&this.setState({hoverBitable:!1}),e.isEditMode!==this.props.isEditMode&&(!1===e.isEditMode?this.freeze():this.unfreeze()),this.props.isDocxHistoryShow&&e.isDocxHistoryShow!==this.props.isDocxHistoryShow&&this.handleDocxExitHistory()}},{key:"handleBitableIfPaste",value:function(){var e=y()(rt().mark(function e(){var t,r,n,o,i,a,c,s,l,u,d,h,f,p,v,b;return rt().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this.renderer,r=this.props,n=r.tableId,o=r.bitableStore,i=r.initViewIdIndex,a=void 0===i?0:i,(c=Mt.get(n))&&c.status===wt.TO_PASTE){e.next=5;break}return e.abrupt("return");case 5:if(s=o.base.getTableById(n)){e.next=8;break}return e.abrupt("return");case 8:if(l=s.views[a]){e.next=11;break}return e.abrupt("return");case 11:if(c.status=wt.PASTING,Mt.set(n,c),u=c.source,d=null,u===Et.BLOCK?(h=c.tableDataSet,f=c.pasteTableBaseId,p=c.pasteComment,(d=se.DefaultActions.csToJSON(h,l.id,o.base,p))&&(d.baseId=f)):u===Et.BITABLE&&(d=c.stdValueTable),d){e.next=18;break}return e.abrupt("return");case 18:return v=t.clipboardHelper,b=new B.Range(0,0,l.getAllRecords().length,l.getColumnCount()),e.next=22,v.pasteForDocBlock(d,l,[b]);case 22:this.setState({delayLoading:!1}),c.status=wt.PASTED,Mt.set(n,c);case 25:case"end":return e.stop()}},e,this)}));function t(){return e.apply(this,arguments)}return t}()},{key:"getFloatToolbarVisibility",value:function(){var e=this.state.hoverBitable,t=this.props,r=t.showFloatToolbar,n=t.isEditing,o=t.fullScreenTableId,i=t.tableId,a=t.bitableStore,c=""!==o,s=this.context.store,l=Object(B.getOtherFloatToolbarShowing)(s.getState(),i);if(this.checkDocWidthIsLessMinDocWidth()||c||l||a.Options.module===B.BitableStoreModuleType.Template)return!1;var u=!!(r||n||e);return u?this.floatToolbarRef&&this.floatToolbarRef.addEventListener("click",this._setActiveBitable,!0):this.floatToolbarRef&&this.floatToolbarRef.removeEventListener("click",this._setActiveBitable,!0),u}},{key:"checkDocWidthIsLessMinDocWidth",value:function(){var e=this.state.docWidth;return(void 0!==e?e:0)<et}},{key:"getDocContainer",value:function(){return this.docContainer||(this.getIsDocx()?this.docContainer=document.querySelector(".bear-web-x-container"):this.docContainer=document.querySelector(".history-editor-wrapper")||document.querySelector(".etherpad-container-wrapper")),this.docContainer}},{key:"init",value:function(e){var t=this.props,r=t.bitableStore,n=t.storageManager,o=t.tableId,i=t.initViewIdIndex,a=t.mountOption,c={tableId:o,initViewIdIndex:i,isFullScreen:!!t.isFullScreenMode,reduxStore:t.store,isVCEnable:at},s=new B.DocBitableRenderer(r,n,c);this.bitableStore=r,this.renderer=s,this.initCommentManager(),this.setHistory(),this.props.storageManager.setToken(e),a.operator.onRecover&&this.addRecoverCallback(a.operator.onRecover),r.getBaseEventManager().addListener(B.Events.DocumentKeyInvalid,this.onDocumentKeyInvalid)}},{key:"replayVCFollowState",value:function(e){var t=e.data.fullscreen;return this.getVCFollowState().fullscreen===t||(t?this.onFullScreenClick():this.exitFullScreen()),{status:B.ReplayStatus.Success}}},{key:"initCommentManager",value:function(){var e=this.props,t=e.bitableStore,r=e.tableId,n=e.mountOption,o=e.isFullScreenMode,i=e.smartableCommentManager,a=e.smartableMentionManager,c=e.suiteToken,s=e.suiteType,l=n.operator,u=l.onActiveCommentChange,d=l.onCommentBinded,h=this.renderer,f=Object(B.getBusinessBase)(t.base);this.commonInit=new Fe({suiteToken:c,suiteType:s,base:f});var p={onActiveCommentChange:u,onCommentBinded:d};if(o)this.smartableCommentManager=i,this.smartableCommentManager.enterDocFullScreen(h),this.smartableMentionManager=a;else{var v=_.CommentHelper&&_.CommentHelper.DocNewCommentEnable||this.getIsDocx();this.smartableCommentManager=new B.DocSmartableCommentManager({renderer:h,bitableStore:t,comment:p,customCommentCard:v?Object(Pe.d)():void 0,customCommentBar:v?Pe.b:void 0}),this.smartableMentionManager=new B.DocSmartableMentionManager({tableId:r,renderer:h,bitableStore:t,customMentionBar:De.b}),this.smartableMentionManager.fetchUpdate(r)}}},{key:"renderFloatToolbar",value:function(){var e=this.props,t=e.mountOption,r=e.tableId,n=e.viewId,o=e.bitableStore,i=e.fullScreenTableId,a=e.showFloatToolbar,c=e.isEditing,s=this.state,l=s.docWidth,u=s.offsetX;if(s.delayLoading)return null;var d={left:(void 0!==l?l:0)+u},h=""!==i,f=_.fsController.isInFullscreen();return I.a.createElement("div",{className:"bitable-float-toolbar-container",ref:this.setFloatToolbarRef,style:d},!h&&!f&&I.a.createElement(B.EmbeddedDocFloatToolBar,{tableId:r,viewId:n,renderer:this.renderer,smartableCommentManager:this.smartableCommentManager,onFullScreenClick:this.onFullScreenClick,bitableStore:o,mountOption:t,isShow:this.getFloatToolbarVisibility(),fixFloatToolbarShow:a||c||!1,onShow:this.onShowFloatToolBar}))}},{key:"currentScreenShot",value:function(){if(this.embedBitableRef)return this.embedBitableRef.currentScreenShot();console.warn("bitable block is empty!")}},{key:"takeScreenShot",value:function(){var r=y()(rt().mark(function e(t,r){return rt().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.embedBitableRef&&this.embedBitableRef.takeScreenShot&&this.embedBitableRef.takeScreenShot(t,r));case 1:case"end":return e.stop()}},e,this)}));function e(e,t){return r.apply(this,arguments)}return e}()},{key:"getBitableViewScrollInfo",value:function(){var e,t=this.renderer.activeBitableWidget,r=t&&this.renderer.activeBitableWidget.getActiveWidget();if(!r)return{scrollPosX:0,contentWidth:0};var n=r.getContentDocWidth?r.getContentDocWidth():0;return{scrollPosX:(r.getScrollPosition?r.getScrollPosition():{x:0}).x,contentWidth:n,viewType:(null===(e=t.getView())||void 0===e?void 0:e.type)||B.ViewType.NotSupport}}},{key:"setBitableViewScrollPosition",value:function(e,t){var r=this.renderer.activeBitableWidget&&this.renderer.activeBitableWidget.getActiveWidget();if(r){if(this.scrollContainer&&null!=t){var n,o,i=((null===(n=this.scrollContainer.current)||void 0===n?void 0:n.getBoundingClientRect().right)||0)-((null===(o=this.bitableRef)||void 0===o?void 0:o.getBoundingClientRect().left)||0);r.setWidgetConfig&&r.setWidgetConfig({visibleRightBound:i}),this.setOffsetX(t)}if(void 0===(null==e?void 0:e.viewType)||void 0===(null==e?void 0:e.ratio))null!=e&&r.setScrollPosition&&r.setScrollPosition(e);else{if(!this.renderer.activeBitableWidget)return;if(e.viewType!==B.ViewType.Grid&&e.viewType!==B.ViewType.Kanban)return;var a=e.viewType===B.ViewType.Grid?this.renderer.activeBitableWidget.getGridWidget():this.renderer.activeBitableWidget.getKanbanWidget(),c=a.getContentDocWidth?a.getContentDocWidth():0;a.setScrollPosition({x:e.ratio*c})}}}},{key:"renderOverlay",value:function(){var e=this.props.mountOption;if(!e.overlayContainer)return null;var t=e.operator.getBitablePosition(),r=t.left,n=t.top;return I.a.createElement("div",{ref:this.setOverLayerRef,className:Je()("bitable-doc-overlay","bitable-toolbar-docx",{"bitable-doc-overlay-hide":this.state.suspend}),style:{top:n,left:r}},this.renderFloatToolbar())}},{key:"getSearchResult",value:function(e,t){var r=this,n=Object(B.getSearchResultInDoc)(e,t,this.getSearchBaseOpts()),o=this.getDocContainer();return o?n.map(function(e){return ot({},e,{scrollFn:Object(B.getScrollFnInDoc)(e,r.getSearchBaseOpts(),o,r.bitableRef)})}):[]}},{key:"getSearchItemPos",value:function(e,t){return Object(B.getSearchItemRectInDoc)(t,this.getSearchBaseOpts())||{x:0,y:0,width:0,height:0}}},{key:"clearHighlight",value:function(e,t){return Object(B.clearHighlightInDoc)(this.getSearchBaseOpts())}},{key:"registerScrollContainerRef",value:function(e,t){this.scrollContainer=t,this.embedBitableRef&&this.embedBitableRef.registerScrollContainerRef&&this.embedBitableRef.registerScrollContainerRef(t)}},{key:"bindBitableContainerEvent",value:function(){this.bitableRef&&this.shouldBindContainerEvent&&(this.bitableRef.addEventListener("mouseenter",this.hoverBitable),this.bitableRef.addEventListener("mouseleave",this.leaveBitable),this.bitableRef.addEventListener("click",this._setActiveBitable,!0),this.shouldBindContainerEvent=!1)}},{key:"unbindBitableContainerEvent",value:function(){this.bitableRef&&(this.bitableRef.removeEventListener("mouseenter",this.hoverBitable),this.bitableRef.removeEventListener("mouseleave",this.leaveBitable),this.bitableRef.removeEventListener("click",this._setActiveBitable,!0),this.shouldBindContainerEvent=!0)}},{key:"getIsDocx",value:function(){return _.BearWebHelper.getIsDocx?_.BearWebHelper.getIsDocx():this.props.suiteType===_.NUM_FILE_TYPE.DOCX}},{key:"getIsBitableComponentLoaded",value:function(){return!!this.embedBitableRef}},{key:"getBitableContainerStyle",value:function(){var e=this.props.isFullScreenMode,t=this.state,r=t.offsetX,n=t.docWidth,o=void 0===n?0:n;if(!e){var i=this.getActiveViewFromState();if(i&&i.type===B.ViewType.Grid)return{minWidth:o+r}}}},{key:"renderDocBitable",value:function(){var e=this.props,t=e.bitableStore,r=e.token,n=e.tableId,o=e.viewId,i=e.isFullScreenMode,a=e.shell,c=e.editbarPinChanged,s=e.mountOption,l=e.suiteType,u=this.state,d=u.maxWidth,h=u.maxHeight,f=u.offsetX,p=u.commentActionType,v=u.isSelect,b=u.docWidth,y=u.delayLoading,g=u.collapsed,m=s.overlayContainer,w=s.isTemplateMode,S=l?_.SUITE_TO_MENTION_SOURCE[l]:_.SOURCE_ENUM.DOC,E={attachmentUploadHooks:{uploadError:this.handleUploadError},mentionConfig:{mentionSource:S},ui:{showComment:this.getIsShowComment(),disableKeepViewPosition:!0}};return I.a.createElement(B.DocBitable,{token:r,bitableStore:t,renderer:this.renderer,isTemplateMode:w,smartableCommentManager:this.smartableCommentManager,tableId:n,viewId:o,IOConfig:{IO:_.IO.getInstance()},bitableConfig:E},I.a.createElement("div",{className:Je()("layout-column f-g-1 bitable-in-doc",{"bitable-in-doc-fullscreen":i}),ref:this.setBitableContainerRef,style:this.getBitableContainerStyle()},!i&&m?O.a.createPortal(this.renderOverlay(),m):null,I.a.createElement(B.DocTableView,{bitableStore:t,renderer:this.renderer,smartableCommentManager:this.smartableCommentManager,smartableMentionManager:this.smartableMentionManager,tableId:n,viewId:o,shell:a,maxWidth:d,maxHeight:h,offsetX:i?20:f,docWidth:b,commentActionType:p,isSelect:v,editbarPinChanged:c,renderEmbededToolbar:this.renderToolbar,notify:this.notify,isFullScreenMode:i,mountOption:s,viewLayerOverlay:this.overlayerRef,setToolBarStyle:this.setToolBarStyle,setOnScrollHandle:this.setOnScrollHandle,updateOverlayerPosition:this.updateOverlayerPosition,zoom:this.state.zoom,ref:this.setBitableRef,delayLoading:y,collapsed:g,isVCEnable:at,isEmbeddedTemplateMode:w})))}},{key:"getIsShowComment",value:function(){var e;return!(Object(qe.a)()||Object(qe.d)()||Object(qe.c)()||Object(qe.b)()||null!==(e=this.props.mountOption)&&void 0!==e&&e.hideComment)}},{key:"renderDocxBitable",value:function(){var r=this,e=this.props,t=e.bitableStore,n=e.token,o=e.tableId,i=e.viewId,a=e.isFullScreenMode,c=e.shell,s=e.editbarPinChanged,l=e.mountOption,u=e.suiteType,d=this.state,h=d.maxWidth,f=d.maxHeight,p=d.commentActionType,v=d.isSelect,b=d.docWidth,y=d.delayLoading,g=d.collapsed,m=d.selectedStyle,w=l.overlayContainer,S=l.isTemplateMode,E=u?_.SUITE_TO_MENTION_SOURCE[u]:_.SOURCE_ENUM.DOC,C=function(e,t){return r.renderScreenShotToolbar(e,t)},k={ui:{bitableWidgetUIConfig:{disableHScroll:!a,ganttWidgetUIConfig:{marginRight:a?null:0},gridWidgetUIConfig:{marginRight:0},galleryWidgetUIConfig:{marginLeft:0},keepLastColumn:!1},showComment:this.getIsShowComment(),kanbanNewRecordOverlay:!0,disableKeepViewPosition:!0},attachmentUploadHooks:{uploadError:this.handleUploadError},mentionConfig:{mentionSource:E}};return I.a.createElement(B.DocBitable,{token:n,bitableStore:t,renderer:this.renderer,isTemplateMode:S,smartableCommentManager:this.smartableCommentManager,tableId:o,viewId:i,IOConfig:{IO:_.IO.getInstance()},bitableConfig:k},I.a.createElement("div",{className:Je()("layout-column f-g-1 bitable-in-doc",{"bitable-in-doc-fullscreen":a}),ref:this.setBitableContainerRef,style:this.getBitableContainerStyle()},!a&&w?O.a.createPortal(this.renderOverlay(),w):null,I.a.createElement(B.DocxTableView,{bitableStore:t,renderer:this.renderer,smartableCommentManager:this.smartableCommentManager,smartableMentionManager:this.smartableMentionManager,tableId:o,viewId:i,shell:c,maxWidth:h,maxHeight:f,offsetX:a?20:0,docWidth:b,commentActionType:p,isSelect:v,selectedStyle:m,editbarPinChanged:s,renderEmbededToolbar:this.renderToolbar,renderScreenShotToolbar:C,notify:this.notify,isFullScreenMode:a,mountOption:l,viewLayerOverlay:this.overlayerRef,setToolBarStyle:this.setToolBarStyle,setOnScrollHandle:this.setOnScrollHandle,updateOverlayerPosition:this.updateOverlayerPosition,zoom:this.state.zoom,ref:this.setBitableRef,delayLoading:y,collapsed:g,isVCEnable:at,isEmbeddedTemplateMode:S})))}},{key:"render",value:function(){var e=this.state.errorCodeType,t=this.getIsDocx()&&e===B.EErrorCodeType.dataError;return e===B.EErrorCodeType.none||t?this.getIsDocx()?this.renderDocxBitable():this.renderDocBitable():this.renderBlockError(e)}}]),s}(je);ct.contextType=L.ReactReduxContext,it([Object($e.Bind)(),B.VCFollowReplayDecorator],ct.prototype,"replayVCFollowState",null);var st=Object(L.connect)(function(e,t){var r=t.tableId,n=!_.SuiteReduxSelector||!_.SuiteReduxSelector.selectIsInEditMode||_.SuiteReduxSelector.selectIsInEditMode(e);return{tableId:r,viewId:Object(B.tableActiveViewIdSelector)(e,r),query:Object(_.selectQuery)(e),isEditing:Object(B.editingSelector)(e,r),fullScreenTableId:Object(B.getFullScreenTableId)(e),suiteType:_.SuiteReduxSelector.selectCurrentSuiteType(e),suiteToken:_.SuiteReduxSelector.selectCurrentSuiteToken(e),isEditMode:n,isDocxHistoryShow:tt(e),editable:Object(Ae.a)(e),isForceSetSecurity:Object(B.selectIsForceSetSecurityLabel)(e)}},{setFullScreenTableId:B.setFullScreenTableId,setFloatToolbarTable:B.setFloatToolbarTable})(Object(B.injectToolbarStore)(function(e){return{showFloatToolbar:e.showFloatToolbar}})(ct)),lt=r("vb561"),ut=(r("vb801"),r("vb876"),r("vb1798")),dt=r("vb141"),ht=r("vb339"),ft=r.n(ht),pt=r("vb153");function vt(){vt=function(){return a};var a={},e=Object.prototype,u=e.hasOwnProperty,d=Object.defineProperty||function(e,t,r){e[t]=r.value},t="function"==typeof Symbol?Symbol:{},o=t.iterator||"@@iterator",r=t.asyncIterator||"@@asyncIterator",n=t.toStringTag||"@@toStringTag";function i(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{i({},"")}catch(e){i=function(e,t,r){return e[t]=r}}function c(e,t,r,n){var o=t&&t.prototype instanceof s?t:s,i=Object.create(o.prototype),a=new O(n||[]);return d(i,"_invoke",{value:S(e,r,a)}),i}function h(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}a.wrap=c;var l={};function s(){}function f(){}function p(){}var v={};i(v,o,function(){return this});var b=Object.getPrototypeOf,y=b&&b(b(I([])));y&&y!==e&&u.call(y,o)&&(v=y);var g=p.prototype=s.prototype=Object.create(v);function m(e){["next","throw","return"].forEach(function(t){i(e,t,function(e){return this._invoke(t,e)})})}function w(c,s){function l(e,t,r,n){var o=h(c[e],c,t);if("throw"!==o.type){var i=o.arg,a=i.value;return a&&"object"==T()(a)&&u.call(a,"__await")?s.resolve(a.__await).then(function(e){l("next",e,r,n)},function(e){l("throw",e,r,n)}):s.resolve(a).then(function(e){i.value=e,r(i)},function(e){return l("throw",e,r,n)})}n(o.arg)}var t;d(this,"_invoke",{value:function(r,n){function e(){return new s(function(e,t){l(r,n,e,t)})}return t=t?t.then(e,e):e()}})}function S(i,a,c){var s="suspendedStart";return function(e,t){if("executing"===s)throw new Error("Generator is already running");if("completed"===s){if("throw"===e)throw t;return L()}for(c.method=e,c.arg=t;;){var r=c.delegate;if(r){var n=E(r,c);if(n){if(n===l)continue;return n}}if("next"===c.method)c.sent=c._sent=c.arg;else if("throw"===c.method){if("suspendedStart"===s)throw s="completed",c.arg;c.dispatchException(c.arg)}else"return"===c.method&&c.abrupt("return",c.arg);s="executing";var o=h(i,a,c);if("normal"===o.type){if(s=c.done?"completed":"suspendedYield",o.arg===l)continue;return{value:o.arg,done:c.done}}"throw"===o.type&&(s="completed",c.method="throw",c.arg=o.arg)}}}function E(e,t){var r=t.method,n=e.iterator[r];if(void 0===n)return t.delegate=null,"throw"===r&&e.iterator.return&&(t.method="return",t.arg=void 0,E(e,t),"throw"===t.method)||"return"!==r&&(t.method="throw",t.arg=new TypeError("The iterator does not provide a '"+r+"' method")),l;var o=h(n,e.iterator,t.arg);if("throw"===o.type)return t.method="throw",t.arg=o.arg,t.delegate=null,l;var i=o.arg;return i?i.done?(t[e.resultName]=i.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,l):i:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,l)}function C(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function k(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function O(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(C,this),this.reset(!0)}function I(t){if(t){var e=t[o];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var r=-1,n=function e(){for(;++r<t.length;)if(u.call(t,r))return e.value=t[r],e.done=!1,e;return e.value=void 0,e.done=!0,e};return n.next=n}}return{next:L}}function L(){return{value:void 0,done:!0}}return f.prototype=p,d(g,"constructor",{value:p,configurable:!0}),d(p,"constructor",{value:f,configurable:!0}),f.displayName=i(p,n,"GeneratorFunction"),a.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===f||"GeneratorFunction"===(t.displayName||t.name))},a.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,p):(e.__proto__=p,i(e,n,"GeneratorFunction")),e.prototype=Object.create(g),e},a.awrap=function(e){return{__await:e}},m(w.prototype),i(w.prototype,r,function(){return this}),a.AsyncIterator=w,a.async=function(e,t,r,n,o){void 0===o&&(o=Promise);var i=new w(c(e,t,r,n),o);return a.isGeneratorFunction(t)?i:i.next().then(function(e){return e.done?e.value:i.next()})},m(g),i(g,n,"Generator"),i(g,o,function(){return this}),i(g,"toString",function(){return"[object Generator]"}),a.keys=function(e){var r=Object(e),n=[];for(var t in r)n.push(t);return n.reverse(),function e(){for(;n.length;){var t=n.pop();if(t in r)return e.value=t,e.done=!1,e}return e.done=!0,e}},a.values=I,O.prototype={constructor:O,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(k),!e)for(var t in this)"t"===t.charAt(0)&&u.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(r){if(this.done)throw r;var n=this;function e(e,t){return i.type="throw",i.arg=r,n.next=e,t&&(n.method="next",n.arg=void 0),!!t}for(var t=this.tryEntries.length-1;0<=t;--t){var o=this.tryEntries[t],i=o.completion;if("root"===o.tryLoc)return e("end");if(o.tryLoc<=this.prev){var a=u.call(o,"catchLoc"),c=u.call(o,"finallyLoc");if(a&&c){if(this.prev<o.catchLoc)return e(o.catchLoc,!0);if(this.prev<o.finallyLoc)return e(o.finallyLoc)}else if(a){if(this.prev<o.catchLoc)return e(o.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return e(o.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;0<=r;--r){var n=this.tryEntries[r];if(n.tryLoc<=this.prev&&u.call(n,"finallyLoc")&&this.prev<n.finallyLoc){var o=n;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var i=o?o.completion:{};return i.type=e,i.arg=t,o?(this.method="next",this.next=o.finallyLoc,l):this.complete(i)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),l},finish:function(e){for(var t=this.tryEntries.length-1;0<=t;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),k(r),l}},catch:function(e){for(var t=this.tryEntries.length-1;0<=t;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var o=n.arg;k(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,r){return this.delegate={iterator:I(e),resultName:t,nextLoc:r},"next"===this.method&&(this.arg=void 0),l}},a}function bt(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),r.push.apply(r,n)}return r}function yt(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?bt(Object(r),!0).forEach(function(e){g()(t,e,r[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):bt(Object(r)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))})}return t}var gt=function(t){function m(e){var d;return h()(this,m),(d=t.call(this,e)||this).highlightInfos={},d.historyPreviewOption={isHighlight:!0,users:{}},d.highlightRangeMap={},d.isShowAllHistoryLabels=!1,d.shouldLocate=!1,d.blockOffsetTop=0,d.setOffsetXPromise=new Promise(function(e){return d.setOffsetXResolve=e}),d.onOffsetLeftChange=function(e){d.props.shell.onRectChange&&d.props.shell.onRectChange(e)},d.onHoverCellChange=function(s){if(d.historyPreviewOption.isHighlight&&!d.isShowAllHistoryLabels){var e=d.highlightInfos[s.tableId],t=e?e.cells:[],l=d.renderer.activeBitableWidget.getActiveWidget(),u=d.renderer.getActiveView();if(u)ft()(t).reverse().some(function(e){var t=e.recordId,r=e.fieldId,n=e.userId,o=t?u.getVisibleRecordIndexById(t):-1,i=r?u.getFieldIndexById(r):-1,a=n?d.historyPreviewOption.users[n]:void 0;if(r&&!t&&i===s.col||t&&!r&&o===s.row||o===s.row&&i===s.col){var c=Object(B.findTextRange)(d.highlightRangeMap[s.tableId],s.row,s.col);if(c&&a)return l.showHistoryLabels([{col:c.col,row:c.row,bgColor:a.labelColor,color:"static-white",text:Object(B.getUserName)(a),name:Object(B.getUserName)(a)}]),!0}return!1})||l.showHistoryLabels([])}},d.state=yt({},d.state,{isLoaded:!1}),d}return f()(m,t),d()(m,[{key:"getTable",value:function(){var e=this.props,t=e.bitableStore,r=e.tableId;return t.base.getTableById(r)}},{key:"setOffsetX",value:function(e){w()(S()(m.prototype),"setOffsetX",this).call(this,e),this.setOffsetXResolve()}},{key:"fetchTableData",value:function(){var r=y()(vt().mark(function e(t,r){var n,o,i,a,c,s,l;return vt().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(B.getHistoryPrivider)();case 2:return n=e.sent,o=r.lastRev,i=this.props.bitableStore,a=n.getInstance(i),c=r.lastRev?r.lastRev:r.firstRev||0,e.next=9,a.fetchHistoryMeta(t,c);case 9:if(s=e.sent,r===this.activeTableRevInfo){e.next=12;break}return e.abrupt("return",null);case 12:return e.next=14,a.fetchHistoryChangesets(t,s.rev,o);case 14:if(l=e.sent,r===this.activeTableRevInfo){e.next=17;break}return e.abrupt("return",null);case 17:return e.abrupt("return",{snapshot:s,changesets:l});case 18:case"end":return e.stop()}},e,this)}));function e(e,t){return r.apply(this,arguments)}return e}()},{key:"applyChangesets",value:function(t,e,r,n){var o,i=this.props.bitableStore;n&&r<=t.rev&&(o=t.toJSON());var a=[];e.forEach(function(e){Object(B.applyHistoryChangeset)(i.base,e,B.ActionTypes.Table,t.id),n&&(r===e.rev?o=t.toJSON():e.rev>r&&a.push(e))});var c=null,s=this.renderer.getShowingViewId(t.id)||"";return n&&0<a.length&&(c=Object(B.getHistoryHighlightInfo)(Object(B.combineChangesets)(a),o,s)),c}},{key:"highlight",value:function(e){var t=this.renderer.activeBitableWidget,r=t.getActiveWidget(),n=this.historyPreviewOption.users||{};if(t.events.removeListener(B.CommonEvents.CellHover,this.onHoverCellChange),r){Object(B.clearHistoryHighlight)(r);var o=this.renderer.getShowingViewId(this.props.tableId);if(!o)return;var i=this.getTable().getViewById(o);if(e&&e.cells&&e.cells.length&&(e.cells.forEach(function(e){var t=e.userId?n[e.userId]:void 0;t&&(e.textColor=t.textColor,e.labelColor=t.labelColor,e.color=t.bgColor,e.text=Object(B.getUserName)(t))}),t.events.addListener(B.CommonEvents.CellHover,this.onHoverCellChange)),e&&e.cells){var a=Object(B.updateHistoryHighlight)(r,e.cells,!1,!1);a&&i&&i.type===B.ViewType.Grid&&(this.highlightRangeMap[r.getTableId()]=a)}}}},{key:"onLoaded",value:function(){var e=this.props.onLoaded;!this._onMountFired&&e&&(this._onMountFired=!0,e())}},{key:"previewHistory",value:function(){var r=y()(vt().mark(function e(t,r){var n,o,i,a,c,s,l,u,d,h,f,p,v,b,y,g=this;return vt().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(w()(S()(m.prototype),"previewHistory",this).call(this,t,r),n=t.revInfo,o=(r||{}).isHighlight,i=void 0!==o&&o,a=this.props,c=a.bitableStore,s=a.tableId,l=a.updateTables,u=n[s]){e.next=7;break}return e.abrupt("return");case 7:return c.Options.module=B.BitableStoreModuleType.History,this.setState({isLoaded:!1}),this.activeTableRevInfo=u,d=this.getTable(),e.next=13,this.fetchTableData(s,u);case 13:if(h=e.sent){e.next=16;break}return e.abrupt("return");case 16:return f=h.snapshot,p=h.changesets,d.records={},d.status=B.TableLoadStatus.TableLoaded,d.fromJSON(f),v=this.applyChangesets(d,p,u.firstRev||0,!0),l(c.base),e.next=24,new Promise(function(e){return g.setState({isLoaded:!0},e)});case 24:return b=this.renderer.getShowingViewId(s)||"",this.embedBitableRef&&this.embedBitableRef.applyFasterView(s,b),this.onLoaded(),this.historyPreviewOption=r,e.next=30,this.setOffsetXPromise;case 30:v&&(this.highlightInfos[d.id]=v,i&&this.highlight(v)),this.props.mountOption.onHistoryResultReady&&Object(pt.a)(u.firstRev)&&(y=u.firstRev===u.lastRev?[]:[this.props.tableId],this.props.mountOption.onHistoryResultReady(y)),this.shouldLocate&&(this.locate(this.blockOffsetTop),this.shouldLocate=!1),this.renderer.activeBitableWidget.events.addListener(B.CommonEvents.EmbedOffsetLeftChanged,this.onOffsetLeftChange);case 34:case"end":return e.stop()}},e,this)}));function e(e,t){return r.apply(this,arguments)}return e}()},{key:"locate",value:function(e){var t=this.renderer.getShowingViewId(this.props.tableId);if(t){var r=this.getTable(),n=r.getViewById(t);if(n){var o;if(n.type===B.ViewType.Grid){var i=this.highlightRangeMap[r.id];if(!i)return this.shouldLocate=!0,void(this.blockOffsetTop=e);var a=i.keys().next().value;if(a){var c=a.split(","),s=ie()(c,2),l=s[0],u=s[1];o={area:B.SearchHighlightArea.GridBody,row:parseInt(l,10),col:parseInt(u,10)}}else o={area:B.SearchHighlightArea.GridBody,row:1,col:0}}else{var d=this.highlightInfos[r.id],h=d?d.cells.filter(function(e){return e.recordId})[0]:void 0;o={area:B.SearchHighlightArea.KanbanCard,recordId:h?h.recordId:n.getVisibleRecords()[0]}}var f=this.getDocContainer(),p=this.renderer.activeBitableWidget.getActiveWidget();f&&this.bitableRef&&p&&Object(B.scrollInDoc)(f,this.bitableRef,p,e,o),this.showAllHistoryLabels()}}}},{key:"highlightHistory",value:function(e){var t=this.getTable(),r=this.highlightInfos[t.id];this.highlight(null),this.historyPreviewOption=e,r&&e.isHighlight&&this.highlight(this.highlightInfos[t.id])}},{key:"showAllHistoryLabels",value:function(){var e=this.getTable(),t=this.renderer.activeBitableWidget.getActiveWidget(),r=this.highlightInfos[e.id];this.isShowAllHistoryLabels=!0,t&&Object(B.showAllHistoryLabels)(t,r,this.historyPreviewOption.users)}},{key:"clearHistoryLabel",value:function(){var e=this.renderer.activeBitableWidget;if(e){var t=e.getActiveWidget();this.isShowAllHistoryLabels=!1,t&&Object(B.clearHistoryLabel)(t)}else this.shouldLocate=!1}},{key:"componentWillUnmount",value:function(){var e=this.renderer.activeBitableWidget;e&&e.events.removeListener("EmbedOffsetLeftChanged",this.onOffsetLeftChange),w()(S()(m.prototype),"componentWillUnmount",this).call(this),this.renderer.reset(),this.bitableStore.reset()}},{key:"getMentionSource",value:function(e){return e?_.SUITE_TO_MENTION_SOURCE[e]:_.SOURCE_ENUM.DOC}},{key:"renderDocxHistoryBitable",value:function(){var t=this,e=this.props,r=e.bitableStore,n=e.table,o=e.view,i=e.views,a=e.tableId,c=e.viewId,s=e.isFullScreenMode,l=e.shell,u=e.editbarPinChanged,d=e.mountOption,h=this.state,f=h.maxWidth,p=h.maxHeight,v=h.isSelect,b=h.docWidth,y=h.delayLoading,g=h.collapsed,m=h.zoom,w=h.isLoaded,S=d.overlayContainer;return w?I.a.createElement("div",{className:Je()("layout-column f-g-1 bitable-in-doc",{"bitable-in-doc-fullscreen":s}),ref:function(e){return t.bitableRef=e}},!s&&S?O.a.createPortal(this.renderOverlay(),S):null,o&&I.a.createElement(B.LoadableDocTableView,{bitableStore:r,renderer:this.renderer,smartableCommentManager:null,tableId:a,viewId:c,table:n,view:o,views:i,shell:l,maxWidth:f,maxHeight:p,offsetX:s?20:0,docWidth:b,isSelect:v,editbarPinChanged:u,renderEmbededToolbar:this.renderToolbar,notify:this.notify,isFullScreenMode:s,mountOption:d,viewLayerOverlay:this.overlayerRef,setToolBarStyle:this.setToolBarStyle,setOnScrollHandle:this.setOnScrollHandle,updateOverlayerPosition:this.updateOverlayerPosition,zoom:m,ref:this.setBitableRef,delayLoading:y,collapsed:g})):null}},{key:"renderDocHistoryBitable",value:function(){var t=this,e=this.props,r=e.bitableStore,n=e.table,o=e.view,i=e.views,a=e.tableId,c=e.viewId,s=e.isFullScreenMode,l=e.shell,u=e.editbarPinChanged,d=e.mountOption,h=this.state,f=h.maxWidth,p=h.maxHeight,v=h.offsetX,b=h.isSelect,y=h.docWidth,g=h.delayLoading,m=h.collapsed,w=h.zoom,S=h.isLoaded,E=d.overlayContainer;return S?I.a.createElement("div",{className:Je()("layout-column f-g-1 bitable-in-doc",{"bitable-in-doc-fullscreen":s}),ref:function(e){return t.bitableRef=e}},!s&&E?O.a.createPortal(this.renderOverlay(),E):null,o&&I.a.createElement(B.TableView,{bitableStore:r,renderer:this.renderer,smartableCommentManager:null,tableId:a,viewId:c,table:n,view:o,views:i,shell:l,maxWidth:f,maxHeight:p,offsetX:s?20:v,docWidth:y,isSelect:b,editbarPinChanged:u,renderEmbededToolbar:this.renderToolbar,notify:this.notify,isFullScreenMode:s,mountOption:d,viewLayerOverlay:this.overlayerRef,setToolBarStyle:this.setToolBarStyle,setOnScrollHandle:this.setOnScrollHandle,updateOverlayerPosition:this.updateOverlayerPosition,zoom:w,ref:this.setBitableRef,delayLoading:g,collapsed:m})):null}},{key:"render",value:function(){var e=this.props,t=e.token,r=e.bitableStore,n=e.mountOption,o=e.tableId,i=e.viewId,a=n.isTemplateMode,c=this.getBitableConfig();return I.a.createElement(B.DocBitable,{token:t,bitableStore:r,renderer:this.renderer,isTemplateMode:a,tableId:o,viewId:i,IOConfig:{IO:_.IO.getInstance()},bitableConfig:c},this.getIsDocx()?this.renderDocxHistoryBitable():this.renderDocHistoryBitable())}},{key:"getBitableConfig",value:function(){var e=this.props,t=e.isFullScreenMode,r=e.suiteType;return{ui:{bitableWidgetUIConfig:{disableHScroll:!t,ganttWidgetUIConfig:{marginRight:t?null:0},gridWidgetUIConfig:{marginRight:0},galleryWidgetUIConfig:{marginLeft:0},keepLastColumn:!1},kanbanNewRecordOverlay:!0,disableKeepViewPosition:!0},mentionConfig:{mentionSource:this.getMentionSource(r)}}}}],[{key:"getDerivedStateFromProps",value:function(e){var t=e.bitableStore,r=e.tableId;if(!t.base.getTableById(r)){var n=new B.Table(r,"");n.setBase(t.base),t.base.tables.push(n)}return{}}}]),m}(ct),mt=Object(L.connect)(function(e,t){var r=t.tableId;return{tableId:r,table:Object(B.tableSelector)(e,r),view:Object(B.tableViewSelector)(e,r,Object(B.tableActiveViewIdSelector)(e,r)),views:Object(B.tableViewsSelector)(e,r),viewId:Object(B.tableActiveViewIdSelector)(e,r),showFloatToolbar:Object(B.floatToolbarVisibilitySelector)(e,r),isEditing:Object(B.editingSelector)(e,r),fullScreenTableId:Object(B.getFullScreenTableId)(e),suiteType:_.SuiteReduxSelector.selectCurrentSuiteType(e)}},{setFullScreenTableId:B.setFullScreenTableId,setFloatToolbarTable:B.setFloatToolbarTable,updateTables:B.updateTables})(gt);r.d(t,"BitableToPasteStatus",function(){return wt}),r.d(t,"BitablePasteSource",function(){return Et}),r.d(t,"bitableToPaste",function(){return Mt}),r.d(t,"EmbeddedBitableManager",function(){return _t}),r.d(t,"NEW_VIEW_RECORD_COUNT_IN_DOC",function(){return se.NEW_VIEW_RECORD_COUNT_IN_DOC}),r.d(t,"NEW_VIEW_FIELD_MAP_IN_DOC",function(){return se.NEW_VIEW_FIELD_MAP_IN_DOC}),r.d(t,"addIndexToTableViewMap",function(){return se.addIndexToTableViewMap}),r.d(t,"generateAddTableCs",function(){return se.generateAddTableCs}),r.d(t,"DefaultActions",function(){return se.DefaultActions});var wt,St,Et,Ct,kt=function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"===("undefined"==typeof Reflect?"undefined":T()(Reflect))&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var c=e.length-1;0<=c;c--)(o=e[c])&&(a=(i<3?o(a):3<i?o(t,r,a):o(t,r))||a);return 3<i&&a&&Object.defineProperty(t,r,a),a},Ot=Object(B.getBitableModule)(),It=Object(B.getAloneBitableModule)(),Lt=240,Tt=0;function xt(e){if(!e)return!1;try{return JSON.parse(e),!0}catch(e){return!1}}(St=wt||(wt={})).TO_PASTE="toPaste",St.PASTING="pasting",St.PASTED="pasted",(Ct=Et||(Et={})).BLOCK="BLOCK",Ct.BITABLE="BITABLE";var Mt=new Map,Bt=function(e){var t=e.bitableStore,r=e.children,n=e.tableId;return I.a.createElement(B.ConnectContextProvider,{bitableStore:t},I.a.createElement(B.ToolbarProvider,{blockId:n},r))},_t=function(i){function a(e,t,r,n){var l,o=4<arguments.length&&void 0!==arguments[4]?arguments[4]:_.store;return h()(this,a),(l=i.call(this,e,r===R.a.EmbeddedInDoc,t,r,n,o)||this).hostType=r,l.blockExtraFunctions=n,l.reduxStore=o,l.docFullScreenWrapper=null,l.fullScreenTableId=null,l.getHistoryStore=function(e){if(l.mountOptions[e].isHistoryMode)return l.historyStoreMap.get(e)},l.getHistoryStore=function(e){if(l.mountOptions[e].isHistoryMode)return l.historyStoreMap.get(e)},l.openVCFollow=function(){Object(B.enableModuleFollowState)(B.BitableFollowModule.BitableFullScreen,l.replayVCFollowState),l.sendVCStateChange(l.getVCFollowState())},l.closeVCFollow=function(){Object(B.closeModuleFollow)(B.BitableFollowModule.BitableFullScreen,l.replayVCFollowState)},l.sendVCStateChange=function(e){Object(B.sendFollowState)(B.BitableFollowModule.BitableFullScreen,e)},l.getVCFollowState=function(){return{fullscreen:l.fullScreenTableId}},l.enterDocFullScreen=function(i){l.docFullScreenWrapper&&l.exitDocFullScreen(),B.BitableDep.CommonUtil.closeDocFindReplaceBox(l.reduxStore),B.BitableDep.CommonUtil.banDocFindReplaceBox(!0);var e=E.createForFullScreen(!1);e.className+=" bitable-doc-fullscreen-wrapper",l.docFullScreenWrapper=e;var t=l.contentManager.dataSource.getSource(),r=l.contentManager.dataSource.getStorageManager(),n=l.mountOptions[i];l.fullScreenTableId=i;var o,a,c=Object(lt.a)(),s=l.contentPersenters.get(i);s&&(o=s.getSmartableCommentManager(i),a=s.getSmartableMentionManager(i)),l.sendVCStateChange(l.getVCFollowState()),O.a.render(I.a.createElement(L.Provider,{store:l.reduxStore},I.a.createElement(dt.Router,{history:c},I.a.createElement(Bt,{bitableStore:t,tableId:i},I.a.createElement(st,{history:Object(lt.a)(),isFullScreenMode:!0,token:l.token,store:l.reduxStore,bitableStore:t,storageManager:r,tableId:i,maxWidth:window.innerWidth,mountOption:n,smartableCommentManager:o,smartableMentionManager:a,offsetX:0,shell:{onDeleteSheet:function(){},onSizeAndScrollChange:function(e,t,r,n,o){l.internalSizeChanged(i,t,e,r,n,o)},onRenderError:function(){},onScreenShotReady:function(e){},onCutWholeSheet:function(e){},onContextMenuComment:function(){},exitFullScreenMode:l.exitDocFullScreen}})))),e)},l.exitDocFullScreen=function(){B.BitableDep.CommonUtil.banDocFindReplaceBox(!1);var e=b()(l).docFullScreenWrapper;l.fullScreenTableId=null,l.sendVCStateChange(l.getVCFollowState()),e&&(O.a.unmountComponentAtNode(e),E.remove(e),l.docFullScreenWrapper=null)},l.isManagerDestroyed=function(){return l.isDestroyed},B.BitableDep.store&&(l.oldBitableDepStore=B.BitableDep.store),B.BitableDep.store=o,l.openVCFollow(),B.Clipboard.bindCopyEvent(),l}return f()(a,i),d()(a,[{key:"replayVCFollowState",value:function(e){var t=e.data.fullscreen;if(e.data.pvn===B.PVN.Version1)return{status:B.ReplayStatus.Ignore,code:B.ReplayCode.NotSupport};if(this.fullScreenTableId===t)return{status:B.ReplayStatus.Success};if(t){if(!this.contentPersenters.get(t))return{status:B.ReplayStatus.Fail,code:B.ReplayCode.NotExist};this.enterDocFullScreen(t)}else this.exitDocFullScreen();return{status:B.ReplayStatus.Success}}},{key:"bitableDepRevert",value:function(){this.oldBitableDepStore&&(B.BitableDep.store=this.oldBitableDepStore,delete this.oldBitableDepStore)}},{key:"destroy",value:function(){w()(S()(a.prototype),"destroy",this).call(this),this.bitableDepRevert(),this.closeVCFollow(),B.Clipboard.unbindCopyEvent()}},{key:"createContentManager",value:function(){var t=this;return new Me(this.token,function(){return t.getOrders()},this.displayMultiple,this.hostType,this.blockExtraFunctions,this.reduxStore,function(e){return t.getHistoryStore(e)})}},{key:"getAction",value:function(e,t){var r=this.contentManager.dataSource.getSource();switch(e){case K.Add:case K.Paste:return se.DefaultActions.addTable(r.getMemberId(),R.a.EmbeddedInDoc);case K.Del:var n=t;return se.DefaultActions.delTable(n,this.contentManager.dataSource.getIndexFromId(n));default:throw new Error("Not support action type")}}},{key:"unmountContentPresenter",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]&&arguments[1];this.bitableDepRevert(),e===this.fullScreenTableId&&this.exitDocFullScreen(),w()(S()(a.prototype),"unmountContentPresenter",this).call(this,e,t)}},{key:"createSheetShell",value:function(){return{onScreenShotReady:u.a}}},{key:"createDocShell",value:function(i){var a=this,t=this.mountOptions[i];return{onDeleteSheet:u.a,onFullScreenMode:this.enterDocFullScreen,onSizeAndScrollChange:function(e,t,r,n,o){a.internalSizeChanged(i,t,e,r,n,o)},onRenderError:u.a,onScreenShotReady:u.a,onCutWholeSheet:u.a,onContextMenuComment:u.a,onHeightWillUpdate:function(){t.onHeightWillUpdate&&t.onHeightWillUpdate()},onHeightDidUpdate:function(){t.onHeightDidUpdate&&t.onHeightDidUpdate()},onRectChange:function(e){t.onRectChange&&t.onRectChange(e)}}}},{key:"onDocEnterBuffer",value:function(e){var t=this.contentPersenters.get(e);t&&t.resume()}},{key:"onDocLeaveBuffer",value:function(e){var t=this.contentPersenters.get(e);t&&t.suspend()}},{key:"createHistoryEmbeddedComponent",value:function(t,r,e,n){var o=this,i=D(this.reduxStore.getState());this.historyStoreMap.set(t,i);var a=this.contentManager.dataSource.getSource(),c=this.contentManager.dataSource.getStorageManager(),s=this.uiManager.getContainerSize(),l=this.uiManager.getWidth(),u=this.uiManager.getDocWidth(),d=this.mountOptions[t];return I.a.createElement(L.Provider,{store:i},I.a.createElement(Bt,{bitableStore:a,tableId:t},I.a.createElement("div",{className:a.isEmbeddedInSheet?"bitable-in-sheet__component-wrapper":""},a.isEmbeddedInSheet&&I.a.createElement(Ye,{token:this.token,bitableStore:a,storageManager:c,store:i,tableId:t,activeTableId:t,mountOption:d,height:this.uiManager.getHeight(),onMount:function(e){return r(e)},onRecover:d.operator.onRecover,onLoaded:function(){return e(n,a)},onTableChangedInUndo:this.onTableChangedInUndo,onChanged:function(e){return o.onDataChanged(e)},shell:this.createSheetShell()}),a.isEmbeddedInDoc&&I.a.createElement(mt,{token:this.token,width:l,maxWidth:s[t]?s[t].width:Lt,offsetX:s[t]?s[t].offsetX:Tt,docWidth:u,initViewIdIndex:n&&n.option&&n.option.viewIndex||0,bitableStore:a,storageManager:c,tableId:t,mountOption:d,onMount:function(e){return r(e)},onLoaded:function(){return e(n,a)},onTableChangedInUndo:this.onTableChangedInUndo,internalSizeChanged:this.internalSizeChanged,editbarPinChanged:function(e){o.editbarPinChanged(t,e)},onChanged:function(e){return o.onDataChanged(e)},shell:this.createDocShell(t),store:i}))))}},{key:"createEmbeddedComponent",value:function(t,r,e,n){var o=this,i=this.contentManager.dataSource.getSource(),a=this.contentManager.dataSource.getStorageManager(),c=this.contentPersenters.get(t),s=i.base,l=s.getTrashTableById(t);if(l){s.recoverTable(t,{index:-1,name:l.name});var u=r;r=function(){u.apply(void 0,arguments),o.reduxStore.dispatch(Object(B.updateTables)(s)),o.reduxStore.dispatch(Object(B.setBitableStage)(B.BitableStage.READY))}}if(c){var d=null==c?void 0:c.getSmartableMentionManager(t);null==d||d.fetchUpdate(t)}var h=this.uiManager.getContainerSize(),f=this.uiManager.getWidth(),p=this.uiManager.getDocWidth(),v=this.uiManager.getActionTypeMap().get(t)||0,b=this.mountOptions[t];if(b.isHistoryMode)return i.Options.isHistoryMode=!0,this.createHistoryEmbeddedComponent(t,r,e,n);var y=Object(lt.a)();return I.a.createElement(L.Provider,{store:this.reduxStore},I.a.createElement(dt.Router,{history:y},I.a.createElement(Bt,{bitableStore:i,tableId:t},I.a.createElement("div",{className:i.isEmbeddedInSheet?"bitable-in-sheet__component-wrapper":""},i.isEmbeddedInSheet?I.a.createElement(M.DynamicModuleLoader,{modules:[It]},I.a.createElement(ze,{history:y,token:this.token,bitableStore:i,storageManager:a,tableId:t,activeTableId:t,mountOption:b,height:this.uiManager.getHeight(),onMount:function(e){return r(e)},onRecover:b.operator.onRecover,onLoaded:function(){return e(n,i)},onTableChangedInUndo:this.onTableChangedInUndo,onChanged:function(e){return o.onDataChanged(e)},shell:this.createSheetShell(),store:this.reduxStore})):null,i.isEmbeddedInDoc?I.a.createElement(M.DynamicModuleLoader,{modules:[Ot]},I.a.createElement(st,{isManagerDestroyed:this.isManagerDestroyed,history:Object(lt.a)(),token:this.token,width:f,commentActionType:v,maxWidth:h[t]?h[t].width:Lt,offsetX:h[t]?h[t].offsetX:Tt,docWidth:p,initViewIdIndex:n&&n.option&&n.option.viewIndex||0,bitableStore:i,storageManager:a,tableId:t,mountOption:b,onMount:function(e){return r(e)},onLoaded:function(){return e(n,i)},onTableChangedInUndo:this.onTableChangedInUndo,internalSizeChanged:this.internalSizeChanged,editbarPinChanged:function(e){o.editbarPinChanged(t,e)},onChanged:function(e){return o.onDataChanged(e)},shell:this.createDocShell(t),store:this.reduxStore,zoom:this.uiManager.getZoom()})):null))))}}],[{key:"pasteBitableWithoutBridge",value:function(e,t,r,n){return Me.paste(e,t,r,n)}},{key:"getInitCSWithoutBridge",value:function(e){return Me.addTable(e)}},{key:"getInitKanbanCSWithoutBridge",value:function(e){return Me.addKanban(e)}},{key:"getInitGanttCSWithoutBridge",value:function(e){return Me.addGantt(e)}},{key:"getInitGalleryCSWithoutBridge",value:function(e){return Me.addGallery(e)}},{key:"getBitablePasteDataWithoutBridge",value:function(e){var t=e.dataset.byteBitable;if(!t)return"";if(xt(t))return t;try{return t=ut.Base64.decode(t),B.BitableDep.collectBitableEvent("bitable_doc_paste_base64_data",{scm_version:JSON.stringify(window.scm||{}),scm_bitable:JSON.stringify(window.scmbitable||{}),source:"paste_bitable_cells"}),t}catch(e){var r=e.stack||e.toString();return B.BitableDep.collectBitableEvent("bitable_doc_paste_error",{name:e.name,stack:r||"",info:e.message}),""}}}]),a}(ne);kt([Object($e.Bind)(),B.VCFollowReplayDecorator],_t.prototype,"replayVCFollowState",null)},vb296:function(e,t,r){var n=r("vb361");function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&n(e,t)}e.exports=o},vb328:function(t,e){function r(e){return t.exports=r=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},r(e)}t.exports=r},vb340:function(e,t,r){"use strict";r.d(t,"a",function(){return w}),r.d(t,"b",function(){return a});var n=r("vb105"),o=r.n(n),v=r("vb145"),b=r("vb102"),y=r("vb284");function i(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),r.push.apply(r,n)}return r}function g(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?i(Object(r),!0).forEach(function(e){o()(t,e,r[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):i(Object(r)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))})}return t}var m=Object(b.getAllUrlParams)().localhost,w={eventMap:null},a=function(e){var t,r=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},n=2<arguments.length&&void 0!==arguments[2]&&arguments[2];if((Object(v.a)(window,"local.localhost")||m)&&console.log("collectBitableEvent",e,r),w.eventMap&&0<Object.keys(w.eventMap).length&&(t=w.eventMap[e]),Object(b.collectSuiteEvent)(e,g({is_bitable:!0},r,{},t)),n&&r.bitable_view_type){var o=y.BitableTea.getCommonOptions()||{},i=o.is_premium_permission,a=o.premium_permission_user_permission,c=r.smartable_token,s=r.row,l=r.col,u=r.table_id,d=r.bitable_view_type,h=r.bitable_field_type,f=r.view_id,p={is_bitable:!0,bitable_view_type:d,is_premium_permission:i,premium_permission_user_permission:a};void 0!==c&&(p.smartable_token=c,p.bitable_id=c),void 0!==s&&(p.row=s),void 0!==l&&(p.col=l),void 0!==u&&(p.table_id=u),void 0!==h&&(p.bitable_field_type=h),void 0!==f&&(p.view_id=f),Object(b.collectSuiteEvent)(y.LogEvent.ClientFielBitableEdit,p)}}},vb360:function(e,t){function r(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}e.exports=r},vb361:function(r,e){function n(e,t){return r.exports=n=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},n(e,t)}r.exports=n},vb362:function(e,t,r){var n=r("vb363").getAppNameFromConfig,a=null,c={product_name_lower:"bitable",product_name_upper:"Bitable",product_name_lower_plural:"bitables"};function o(){var e;if(a)return a;var t=((null===(e=window.BitableDep)||void 0===e?void 0:e.CommonUtil.getABParameters())||{}).global_rename_bitable;if(!t)return c;var r=t||{},n=r.upper,o=r.lower,i=r.plural;return a={product_name_lower:o,product_name_upper:n,product_name_lower_plural:i}}var i=/\{product_name_lower\}|\{product_name_upper\}|\{product_name_lower_plural\}/g;function s(e){if(i.test(e)){var t=o();e=e.replace(i,function(e){return"".concat(t[e.substring(1,e.length-1)])})}return e}e.exports=function(e){var t=n();return s(e).replace(/\{\{APP_DISPLAY_NAME\}\}/g,t)}},vb363:function(e,v,b){"use strict";b.r(v),function(e){b.d(v,"getAppNameFromConfig",function(){return d});var t,r,n,o,i,a=b("vb146"),c=b("vb145"),s=null,l="undefined"==typeof window?e:window,u=(t={zh:"zh-CN",en:"en-US",ja:"ja-JP",fr:"fr-FR",hi:"hi-IN",id:"id-ID",it:"it-IT",ko:"ko-KR",pt:"pt-BR",ru:"ru-RU",th:"th-TH",vi:"vi-VN",de:"de-DE",es:"es-ES","zh-TW":"zh-TW","zh-HK":"zh-HK"},r=Object(c.a)(l,"User.language"),n=Object(c.a)(l,"navigator.language"),i=(o=r||n||"").split("-")[0],t[o]||t[i]||"en-US");function d(){if(null!==s)return s;var e="Lark";try{var t=l.globalConfig?l.globalConfig.common:l.backupDomain.ext,r="common."+Object(c.a)(t,"brand.app_name","").toLowerCase(),n=l.TTI18N[r];n&&(e=n)}catch(e){}return s=h()||f()||p()||e}function h(){var e=l.globalKaConfig;if(e){var t=Object(c.a)(e,"i18n.IDS_LARK_PRODUCT_NAME");return Object(a.a)(t)?t:""}}function f(){var e=l.globalKaConfig;if(e){var t=Object(c.a)(e,"i18n.app_name.$base","");return Object(c.a)(e,"i18n.app_name[".concat(u,"]"),t)}}function p(){if(l.materialConfig)return l.materialConfig.brand_app_name}}.call(this,b("vb301"))},vb378:function(n,e,t){var i=t("vb502");function o(e,t,r){return"undefined"!=typeof Reflect&&Reflect.get?n.exports=o=Reflect.get:n.exports=o=function(e,t,r){var n=i(e,t);if(n){var o=Object.getOwnPropertyDescriptor(n,t);return o.get?o.get.call(r):o.value}},o(e,t,r||e)}n.exports=o},vb436:function(e,t,r){"use strict";var n=function(){};e.exports=n},vb502:function(e,t,r){var n=r("vb328");function o(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=n(e)););return e}e.exports=o},vb507:function(e,t){},vb512:function(e,t){},vb517:function(e,t,r){"use strict";var n,o,i,a;r.d(t,"a",function(){return n}),r.d(t,"b",function(){return i}),(o=n||(n={})).Default="Default",o.EmbeddedInSheet="EmbeddedInSheet",o.EmbeddedInDoc="EmbeddedInDoc",(a=i||(i={})).Default="Default",a.Table="Table"},vb518:function(e,t,r){"use strict";r.r(t),r.d(t,"NEW_VIEW_RECORD_COUNT_IN_DOC",function(){return b}),r.d(t,"NEW_VIEW_FIELD_MAP_IN_DOC",function(){return y}),r.d(t,"addIndexToTableViewMap",function(){return g}),r.d(t,"generateAddTableCs",function(){return m}),r.d(t,"DefaultActions",function(){return d});var n=r("vb285"),o=r.n(n),i=r("vb286"),a=r.n(i),c=r("vb105"),s=r.n(c),B=r("vb284"),v=r("vb517"),_=r("vb164");function l(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),r.push.apply(r,n)}return r}function u(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?l(Object(r),!0).forEach(function(e){s()(t,e,r[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):l(Object(r)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))})}return t}var b=3,y=[B.FieldType.Text,B.FieldType.Text,B.FieldType.SingleSelect];function g(e){var r=e.viewMap,t=e.views,n={};return t&&t.forEach(function(e,t){n[e]=u({},r[e],{owner:"",index:t})}),u({},e,{viewMap:t?n:r})}function p(n,t){var e=Object.keys(t).filter(function(e){return t[e].type===B.FieldType.Attachment}),r={};if(e.length<=0)return r;var o={};return e.forEach(function(r){Object.keys(n).forEach(function(e){var t=n[e];t[r]&&t[r].value&&(o[r]=o[r]||{},o[r][e]=t[r].value)})}),r[B.ResourceType.Attachments]={data:o},r}function m(e){for(var t,r=e.tableId,n=e.viewMap,o=e.recordMap,i=e.fieldMap,a=e.memberId,c=e.sourceTableId,s=e.commentMap,l=void 0===s?{}:s,u=e.resourceMap,d=void 0===u?{}:u,h=e.userMap,f=void 0===h?{}:h,p=e.recordMeta,v=void 0===p?{}:p,b=e.milestoneMap,y=void 0===b?{}:b,g=e.reminderMap,m=void 0===g?{}:g,w=e.renewRecord,S=void 0===w||w,E=e.contentCreation,C=void 0!==E&&E,k=0,O=Object.keys(m);k<O.length;k++){var I=m[O[k]];if(I)for(var L=0,T=Object.keys(I);L<T.length;L++){var x=T[L];I[x]||delete I[x]}}var M={action:(null===B.BitableDep||void 0===B.BitableDep?void 0:null===(t=B.BitableDep.MinaConfig)||void 0===t?void 0:t.getMinaBooleanConfig("ccm.bitable.client_vars_api_rank"))?B.BaseActionNames.AddTableV2:B.BaseActionNames.AddTable,type:B.ActionTypes.Base,tableId:r,isRecover:!1,contentCreation:C,renewRecord:S,sourceTableId:c,data:{index:0,name:r,snapshot:{recordMap:o,fieldMap:i,reminderMap:m,viewMap:n,recordMeta:S?{}:v,userMap:f,commentMap:l,resourceMap:d,milestoneMap:y}}};return n&&0!==Object.keys(n).length||B.BitableDep.collectBitableEvent("client_bitable_view_map_state_dev",{table_id:r,stack:(new Error).stack}),{localRev:0,operations:[{actions:[M],command:B.CollaCommands.AddTable,type:B.ActionTypes.Base}],member_id:a,signature:"".concat(a,"-").concat(Object(_.v4)()),type:"USER_CHANGES"}}var d=function(){function i(){o()(this,i)}return a()(i,null,[{key:"addTableUsingTableInstance",value:function(e,t){var r=e.id,n=!0,o=g(e.toJSON()),i=o.viewMap,a=o.recordMap,c=o.recordMeta,s=o.fieldMap,l=o.userMap,u=o.resourceMap,d=o.commentMap,h=o.reminderMap,f=o.milestoneMap,p=m({tableId:r,viewMap:i,recordMap:a,fieldMap:s,userMap:l,memberId:t,contentCreation:n,recordMeta:c,commentMap:d,resourceMap:u,reminderMap:h,milestoneMap:void 0===f?{}:f});return this.stashedActions[r]=p}},{key:"addTableUsingBlockData",value:function(e){var t=e.operations[0].actions[0].tableId;return this.stashedActions[t]=JSON.parse(JSON.stringify(e)),e}},{key:"addTable",value:function(e){var t,r=1<arguments.length&&void 0!==arguments[1]?arguments[1]:v.a.Default,n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:B.ViewType.Grid,o=3<arguments.length?arguments[3]:void 0,i=Object(B.getNewId)(B.IDPrefix.table,[]);if(n===B.ViewType.Kanban)t=B.TableUtil.createDefaultKanbanByTableId(i,i).toJSON();else if(n===B.ViewType.Gantt)t=B.TableUtil.createDefaultGanttByTableId(i,i,o).toJSON();else if(n===B.ViewType.Gallery)t=B.TableUtil.createDefaultGalleryByTableId(i,i).toJSON();else if(n===B.ViewType.Form)t=B.TableUtil.createDefaultFormByTableId(i,i).toJSON();else{var a=r===v.a.EmbeddedInDoc,c=a?y:B.NEW_VIEW_FIELDS,s=a?b:B.NEW_VIEW_RECORD_COUNT;t=B.TableUtil.createDefaultByTableId(i,i,c,s).toJSON()}var l=g(t),u=l.viewMap,d=l.recordMap,h=l.recordMeta,f=m({tableId:i,viewMap:u,recordMap:d,fieldMap:l.fieldMap,userMap:l.userMap,memberId:e,recordMeta:h});this.stashedActions[i]=f;var p=i+"_"+B.BitableBlockLoadedStage.BlockLoaded+"_"+B.BitableBlockLoadedStage.Done;return B.TrackerInstance.start(B.BitableBlockLoadedStage.BlockLoaded,{},{eventKey:p}),p=i+"_"+B.BitableBlockLoadedStage.BlockLoaded+"_"+B.BitableBlockLoadedStage.GetToken,B.TrackerInstance.start(B.BitableBlockLoadedStage.BlockLoaded,{},{eventKey:p}),f}},{key:"addTableFromSnapshot",value:function(e,t){2<arguments.length&&void 0!==arguments[2]?arguments[2]:v.a.Default;var r=Object(B.getNewId)(B.IDPrefix.table,[]),n=t.id?JSON.parse(JSON.stringify(t)):t;n.id=r;var o=n.viewMap,i=n.recordMap,a=n.recordMeta,c=n.fieldMap,s=n.userMap,l=n.resourceMap,u=n.milestoneMap,d=void 0===u?{}:u,h=m({tableId:r,viewMap:o,recordMap:i,fieldMap:c,userMap:s,memberId:e,recordMeta:a,resourceMap:l||p(i,c),milestoneMap:d});this.stashedActions[r]=h;var f=r+"_"+B.BitableBlockLoadedStage.BlockLoaded+"_"+B.BitableBlockLoadedStage.Done;return B.TrackerInstance.start(B.BitableBlockLoadedStage.BlockLoaded,{},{eventKey:f}),f=r+"_"+B.BitableBlockLoadedStage.BlockLoaded+"_"+B.BitableBlockLoadedStage.GetToken,B.TrackerInstance.start(B.BitableBlockLoadedStage.BlockLoaded,{},{eventKey:f}),h}},{key:"addTables",value:function(r,e){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:v.a.Default,o={},t=e.map(function(e){var t=i.addTableFromSnapshot(r,e,n);return o[e.id]=t.operations[0].actions[0].tableId,t});return i.replaceLinkField(t,o),t}},{key:"replaceLinkField",value:function(e,o){e.forEach(function(e){var t=e.operations[0].actions[0].data.snapshot.fieldMap;for(var r in t){var n=t[r];n.type!==B.FieldType.SingleLink&&n.type!==B.FieldType.DuplexLink||(n.property.tableId=o[n.property.tableId])}})}},{key:"delTable",value:function(e,t){return{operations:{actions:[{action:B.BaseActionNames.DeleteTable,type:B.ActionTypes.Base,tableId:e,data:{index:t}}],command:B.CollaCommands.DeleteTable,type:B.ActionTypes.Base},type:"USER_CHANGES"}}},{key:"clearStashedActions",value:function(){var t=this;Object.keys(this.stashedActions).forEach(function(e){return delete t.stashedActions[e]})}},{key:"jsonToCS",value:function(e){var t=B.Serializer.json.parseCore(e),r=h(t),n=r.fieldMap,o=r.fieldIds,i=f(t);return{recordMap:i,fieldMap:n,viewMap:w(i,o),userMap:t&&t.userData||{}}}},{key:"csToJSON",value:function(e,t,r,n){if(!e)return null;var o=new B.Table(e.id,e.name);o.setBase(r),o.fromJSON(e),o.checkUserMap(),o.status=B.TableLoadStatus.TableLoaded;var i=o.getViewById(t);if(!i)return null;var a,c=new B.Range(0,0,i.getAllRecords().length,i.getColumnCount()),s=i.getAllRecords(),l=i.getAllFields();return n&&(a=o.commentMap),i.getStdValueTableFromRange([c],s,l,!1,a)}}]),i}();function h(e){var r={},n=[];return e.header.forEach(function(e,t){0!==t||B.FieldCenter.instance.isSupportPrimary(e.type)||(e.type=B.FieldType.Text,delete e.property),r[e.id]=e,n.push(e.id)}),{fieldMap:r,fieldIds:n}}function f(c){var s={};return c.body.forEach(function(e,i){var a=Object(B.getNewId)(B.IDPrefix.record,[]);s[a]={},c.header.forEach(function(e,t){var r=c.body[i][t];if(r.sourceType!==e.type){var n=[];r.data.forEach(function(e){n.push(e.text)}),n.length&&(r.data=[{type:B.FieldCenter.instance.getStringType(B.FieldType.Text),text:n.join(",")}]),s[a][e.id]={value:r.data}}else{var o=c.bodyCell[i][t];s[a][e.id]=o}})}),s}function w(r){var n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:[],e=Object(B.getNewId)(B.IDPrefix.view,[]),t=B.TableUtil.createDefaultByTableId(e,e,B.NEW_VIEW_FIELDS,B.NEW_VIEW_RECORD_COUNT).toJSON(),o=t.viewMap,i=t.views,a={};return i.forEach(function(e,t){a[e]=u({},o[e],{owner:"",index:t}),a[e].property.fields=n,a[e].property.records=Object.keys(r)}),a}d.stashedActions={}},vb519:function(e,n,o){"use strict";(function(e){o.d(n,"a",function(){return r});var t="data:image/jpeg;base64,/9j/4AAQSkZJRgABAQAAAQABAAD/2wBDAAgGBgcGBQgHBwcJCQgKDBQNDAsLDBkSEw8UHRofHh0aHBwgJC4nICIsIxwcKDcpLDAxNDQ0Hyc5PTgyPC4zNDL/2wBDAQkJCQwLDBgNDRgyIRwhMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjL/wAARCABIAEgDASIAAhEBAxEB/8QAHwAAAQUBAQEBAQEAAAAAAAAAAAECAwQFBgcICQoL/8QAtRAAAgEDAwIEAwUFBAQAAAF9AQIDAAQRBRIhMUEGE1FhByJxFDKBkaEII0KxwRVS0fAkM2JyggkKFhcYGRolJicoKSo0NTY3ODk6Q0RFRkdISUpTVFVWV1hZWmNkZWZnaGlqc3R1dnd4eXqDhIWGh4iJipKTlJWWl5iZmqKjpKWmp6ipqrKztLW2t7i5usLDxMXGx8jJytLT1NXW19jZ2uHi4+Tl5ufo6erx8vP09fb3+Pn6/8QAHwEAAwEBAQEBAQEBAQAAAAAAAAECAwQFBgcICQoL/8QAtREAAgECBAQDBAcFBAQAAQJ3AAECAxEEBSExBhJBUQdhcRMiMoEIFEKRobHBCSMzUvAVYnLRChYkNOEl8RcYGRomJygpKjU2Nzg5OkNERUZHSElKU1RVVldYWVpjZGVmZ2hpanN0dXZ3eHl6goOEhYaHiImKkpOUlZaXmJmaoqOkpaanqKmqsrO0tba3uLm6wsPExcbHyMnK0tPU1dbX2Nna4uPk5ebn6Onq8vP09fb3+Pn6/9oADAMBAAIRAxEAPwCtmjNMzRmv0Q+bH5ozTM0ZoAfmjNM5xnHFGaAH5ozTM0ZoAfmimZooAZmlzTM0ZpgPzW9pNnElus8ih5H5G4Z2iuezXR2UhFlCCMEIOK58S3y2RpStc0/MGMcYrJ1azha3a4jQJInJ2jAYVb833qC9ctZTAckoeK5KacZJo2lZo57NJmm5ozXpnKOzRTc0UAMzRmm5ozTAdmtexvBJEIz99Bj6isbNPhcpOhHXNRUgpIcXZnQeZVW+vBHEY1++4x9BTfMrLmcvM5PXNYU6ab1NJS0EzRmm5ozXUZDs0U3NFADM0o5OKZmlDYOaYFhY0A+bk1KpRPugCqnm0eZUOLY7lzzaRijfeANVPNo82lyBcmaND93g1CeDijzaaWyc1STExc0U3NFUAzNGaKKYgzRmiigAzRmiigAzRmiigAzRRRQB/9k=",r={name:e("Bitable_Form_GuestUser"),enName:e("Bitable_Form_GuestUser"),avatarUrl:t}}).call(this,o("vb163"))},vb520:function(e,i,a){"use strict";(function(e){a.d(i,"a",function(){return o});var t=a("vb103"),r=a.n(t),n=a("vb873");a("vb874");function o(){return r.a.createElement("div",{className:"bitable-card-comment"},r.a.createElement("div",{className:"bitable-card-comment__title"},e("bitable.record_comments")),r.a.createElement("div",{className:"b-comment-loading-container"},r.a.createElement("div",{className:"b-comment-loading-content"},r.a.createElement(n.a,{className:"b-comment-loading-icon"}))))}}).call(this,a("vb163"))},vb561:function(e,t,r){"use strict";var n=r("vb436"),P=r.n(n),o=r("vb469"),D=r.n(o);function f(e){return"/"===e.charAt(0)}function p(e,t){for(var r=t,n=r+1,o=e.length;n<o;r+=1,n+=1)e[r]=e[n];e.pop()}function i(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"",r=e&&e.split("/")||[],n=t&&t.split("/")||[],o=e&&f(e),i=t&&f(t),a=o||i;if(e&&f(e)?n=r:r.length&&(n.pop(),n=n.concat(r)),!n.length)return"/";var c=void 0;if(n.length){var s=n[n.length-1];c="."===s||".."===s||""===s}else c=!1;for(var l=0,u=n.length;0<=u;u--){var d=n[u];"."===d?p(n,u):".."===d?(p(n,u),l++):l&&(p(n,u),l--)}if(!a)for(;l--;l)n.unshift("..");!a||""===n[0]||n[0]&&f(n[0])||n.unshift("");var h=n.join("/");return c&&"/"!==h.substr(-1)&&(h+="/"),h}var a=i;"function"==typeof Symbol&&Symbol.iterator;var R=function(e){return"/"===e.charAt(0)?e:"/"+e},F=function(e,t){return new RegExp("^"+t+"(\\/|\\?|#|$)","i").test(e)},N=function(e,t){return F(e,t)?e.substr(t.length):e},U=function(e){return"/"===e.charAt(e.length-1)?e.slice(0,-1):e},c=function(e){var t=e||"/",r="",n="",o=t.indexOf("#");-1!==o&&(n=t.substr(o),t=t.substr(0,o));var i=t.indexOf("?");return-1!==i&&(r=t.substr(i),t=t.substr(0,i)),{pathname:t,search:"?"===r?"":r,hash:"#"===n?"":n}},V=function(e){var t=e.pathname,r=e.search,n=e.hash,o=t||"/";return r&&"?"!==r&&(o+="?"===r.charAt(0)?r:"?"+r),n&&"#"!==n&&(o+="#"===n.charAt(0)?n:"#"+n),o},s=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},H=function(e,t,r,n){var o=void 0;"string"==typeof e?(o=c(e)).state=t:(void 0===(o=s({},e)).pathname&&(o.pathname=""),o.search?"?"!==o.search.charAt(0)&&(o.search="?"+o.search):o.search="",o.hash?"#"!==o.hash.charAt(0)&&(o.hash="#"+o.hash):o.hash="",void 0!==t&&void 0===o.state&&(o.state=t));try{o.pathname=decodeURI(o.pathname)}catch(e){throw e instanceof URIError?new URIError('Pathname "'+o.pathname+'" could not be decoded. This is likely caused by an invalid percent-encoding.'):e}return r&&(o.key=r),n?o.pathname?"/"!==o.pathname.charAt(0)&&(o.pathname=a(o.pathname,n.pathname)):o.pathname=n.pathname:o.pathname||(o.pathname="/"),o},W=function(){var i=null,n=[];return{setPrompt:function(e){return P()(null==i,"A history supports only one prompt at a time"),i=e,function(){i===e&&(i=null)}},confirmTransitionTo:function(e,t,r,n){if(null!=i){var o="function"==typeof i?i(e,t):i;"string"==typeof o?"function"==typeof r?r(o,n):(P()(!1,"A history needs a getUserConfirmation function in order to use a prompt message"),n(!0)):n(!1!==o)}else n(!0)},appendListener:function(e){var t=!0,r=function(){t&&e.apply(void 0,arguments)};return n.push(r),function(){t=!1,n=n.filter(function(e){return e!==r})}},notifyListeners:function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];n.forEach(function(e){return e.apply(void 0,t)})}}},z=!("undefined"==typeof window||!window.document||!window.document.createElement),K=function(e,t,r){return e.addEventListener?e.addEventListener(t,r,!1):e.attachEvent("on"+t,r)},Y=function(e,t,r){return e.removeEventListener?e.removeEventListener(t,r,!1):e.detachEvent("on"+t,r)},Q=function(e,t){return t(window.confirm(e))},X=function(){var e=window.navigator.userAgent;return(-1===e.indexOf("Android 2.")&&-1===e.indexOf("Android 4.0")||-1===e.indexOf("Mobile Safari")||-1!==e.indexOf("Chrome")||-1!==e.indexOf("Windows Phone"))&&(window.history&&"pushState"in window.history)},J=function(){return-1===window.navigator.userAgent.indexOf("Trident")},q=function(e){return void 0===e.state&&-1===navigator.userAgent.indexOf("CriOS")},Z="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},$=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},ee="popstate",te="hashchange",re=function(){try{return window.history.state||{}}catch(e){return{}}},l=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};D()(z,"Browser history needs a DOM");var s=window.history,l=X(),t=!J(),r=e.forceRefresh,u=void 0!==r&&r,n=e.getUserConfirmation,o=void 0===n?Q:n,i=e.keyLength,a=void 0===i?6:i,c=e.basename?U(R(e.basename)):"",d=function(e){var t=e||{},r=t.key,n=t.state,o=window.location,i=o.pathname+o.search+o.hash;return P()(!c||F(i,c),'You are attempting to use a basename on a page whose URL path does not begin with the basename. Expected path "'+i+'" to begin with "'+c+'".'),c&&(i=N(i,c)),H(i,n,r)},h=function(){return Math.random().toString(36).substr(2,a)},f=W(),p=function(e){$(j,e),j.length=s.length,f.notifyListeners(j.location,j.action)},v=function(e){q(e)||g(d(e.state))},b=function(){g(d(re()))},y=!1,g=function(t){if(y)y=!1,p();else{var r="POP";f.confirmTransitionTo(t,r,o,function(e){e?p({action:r,location:t}):m(t)})}},m=function(e){var t=j.location,r=S.indexOf(t.key);-1===r&&(r=0);var n=S.indexOf(e.key);-1===n&&(n=0);var o=r-n;o&&(y=!0,O(o))},w=d(re()),S=[w.key],E=function(e){return c+V(e)},C=function(e,t){P()(!("object"===(void 0===e?"undefined":Z(e))&&void 0!==e.state&&void 0!==t),"You should avoid providing a 2nd state argument to push when the 1st argument is a location-like object that already has state; it is ignored");var a="PUSH",c=H(e,t,h(),j.location);f.confirmTransitionTo(c,a,o,function(e){if(e){var t=E(c),r=c.key,n=c.state;if(l)if(s.pushState({key:r,state:n},null,t),u)window.location.href=t;else{var o=S.indexOf(j.location.key),i=S.slice(0,-1===o?0:o+1);i.push(c.key),S=i,p({action:a,location:c})}else P()(void 0===n,"Browser history cannot push state in browsers that do not support HTML5 history"),window.location.href=t}})},k=function(e,t){P()(!("object"===(void 0===e?"undefined":Z(e))&&void 0!==e.state&&void 0!==t),"You should avoid providing a 2nd state argument to replace when the 1st argument is a location-like object that already has state; it is ignored");var i="REPLACE",a=H(e,t,h(),j.location);f.confirmTransitionTo(a,i,o,function(e){if(e){var t=E(a),r=a.key,n=a.state;if(l)if(s.replaceState({key:r,state:n},null,t),u)window.location.replace(t);else{var o=S.indexOf(j.location.key);-1!==o&&(S[o]=a.key),p({action:i,location:a})}else P()(void 0===n,"Browser history cannot replace state in browsers that do not support HTML5 history"),window.location.replace(t)}})},O=function(e){s.go(e)},I=function(){return O(-1)},L=function(){return O(1)},T=0,x=function(e){1===(T+=e)?(K(window,ee,v),t&&K(window,te,b)):0===T&&(Y(window,ee,v),t&&Y(window,te,b))},M=!1,B=function(){var e=0<arguments.length&&void 0!==arguments[0]&&arguments[0],t=f.setPrompt(e);return M||(x(1),M=!0),function(){return M&&(M=!1,x(-1)),t()}},_=function(e){var t=f.appendListener(e);return x(1),function(){x(-1),t()}},j={length:s.length,action:"POP",location:w,createHref:E,push:C,replace:k,go:O,goBack:I,goForward:L,block:B,listen:_};return j};Object.assign,"function"==typeof Symbol&&Symbol.iterator,Object.assign;r.d(t,"a",function(){return l})},vb601:function(e,t,r){"use strict";r.r(t);var n=r("vb106"),T=r.n(n),o=r("vb339"),a=r.n(o),i=r("vb107"),c=r.n(i),s=r("vb105"),l=r.n(s),u=r("vb285"),d=r.n(u),h=r("vb286"),f=r.n(h),p=r("vb195"),v=r("vb180"),b=r("vb284"),y=r("vb102"),g=r("vb519");function x(){x=function(){return a};var a={},e=Object.prototype,u=e.hasOwnProperty,d=Object.defineProperty||function(e,t,r){e[t]=r.value},t="function"==typeof Symbol?Symbol:{},o=t.iterator||"@@iterator",r=t.asyncIterator||"@@asyncIterator",n=t.toStringTag||"@@toStringTag";function i(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{i({},"")}catch(e){i=function(e,t,r){return e[t]=r}}function c(e,t,r,n){var o=t&&t.prototype instanceof s?t:s,i=Object.create(o.prototype),a=new O(n||[]);return d(i,"_invoke",{value:S(e,r,a)}),i}function h(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}a.wrap=c;var l={};function s(){}function f(){}function p(){}var v={};i(v,o,function(){return this});var b=Object.getPrototypeOf,y=b&&b(b(I([])));y&&y!==e&&u.call(y,o)&&(v=y);var g=p.prototype=s.prototype=Object.create(v);function m(e){["next","throw","return"].forEach(function(t){i(e,t,function(e){return this._invoke(t,e)})})}function w(c,s){function l(e,t,r,n){var o=h(c[e],c,t);if("throw"!==o.type){var i=o.arg,a=i.value;return a&&"object"==T()(a)&&u.call(a,"__await")?s.resolve(a.__await).then(function(e){l("next",e,r,n)},function(e){l("throw",e,r,n)}):s.resolve(a).then(function(e){i.value=e,r(i)},function(e){return l("throw",e,r,n)})}n(o.arg)}var t;d(this,"_invoke",{value:function(r,n){function e(){return new s(function(e,t){l(r,n,e,t)})}return t=t?t.then(e,e):e()}})}function S(i,a,c){var s="suspendedStart";return function(e,t){if("executing"===s)throw new Error("Generator is already running");if("completed"===s){if("throw"===e)throw t;return L()}for(c.method=e,c.arg=t;;){var r=c.delegate;if(r){var n=E(r,c);if(n){if(n===l)continue;return n}}if("next"===c.method)c.sent=c._sent=c.arg;else if("throw"===c.method){if("suspendedStart"===s)throw s="completed",c.arg;c.dispatchException(c.arg)}else"return"===c.method&&c.abrupt("return",c.arg);s="executing";var o=h(i,a,c);if("normal"===o.type){if(s=c.done?"completed":"suspendedYield",o.arg===l)continue;return{value:o.arg,done:c.done}}"throw"===o.type&&(s="completed",c.method="throw",c.arg=o.arg)}}}function E(e,t){var r=t.method,n=e.iterator[r];if(void 0===n)return t.delegate=null,"throw"===r&&e.iterator.return&&(t.method="return",t.arg=void 0,E(e,t),"throw"===t.method)||"return"!==r&&(t.method="throw",t.arg=new TypeError("The iterator does not provide a '"+r+"' method")),l;var o=h(n,e.iterator,t.arg);if("throw"===o.type)return t.method="throw",t.arg=o.arg,t.delegate=null,l;var i=o.arg;return i?i.done?(t[e.resultName]=i.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,l):i:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,l)}function C(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function k(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function O(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(C,this),this.reset(!0)}function I(t){if(t){var e=t[o];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var r=-1,n=function e(){for(;++r<t.length;)if(u.call(t,r))return e.value=t[r],e.done=!1,e;return e.value=void 0,e.done=!0,e};return n.next=n}}return{next:L}}function L(){return{value:void 0,done:!0}}return f.prototype=p,d(g,"constructor",{value:p,configurable:!0}),d(p,"constructor",{value:f,configurable:!0}),f.displayName=i(p,n,"GeneratorFunction"),a.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===f||"GeneratorFunction"===(t.displayName||t.name))},a.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,p):(e.__proto__=p,i(e,n,"GeneratorFunction")),e.prototype=Object.create(g),e},a.awrap=function(e){return{__await:e}},m(w.prototype),i(w.prototype,r,function(){return this}),a.AsyncIterator=w,a.async=function(e,t,r,n,o){void 0===o&&(o=Promise);var i=new w(c(e,t,r,n),o);return a.isGeneratorFunction(t)?i:i.next().then(function(e){return e.done?e.value:i.next()})},m(g),i(g,n,"Generator"),i(g,o,function(){return this}),i(g,"toString",function(){return"[object Generator]"}),a.keys=function(e){var r=Object(e),n=[];for(var t in r)n.push(t);return n.reverse(),function e(){for(;n.length;){var t=n.pop();if(t in r)return e.value=t,e.done=!1,e}return e.done=!0,e}},a.values=I,O.prototype={constructor:O,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(k),!e)for(var t in this)"t"===t.charAt(0)&&u.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(r){if(this.done)throw r;var n=this;function e(e,t){return i.type="throw",i.arg=r,n.next=e,t&&(n.method="next",n.arg=void 0),!!t}for(var t=this.tryEntries.length-1;0<=t;--t){var o=this.tryEntries[t],i=o.completion;if("root"===o.tryLoc)return e("end");if(o.tryLoc<=this.prev){var a=u.call(o,"catchLoc"),c=u.call(o,"finallyLoc");if(a&&c){if(this.prev<o.catchLoc)return e(o.catchLoc,!0);if(this.prev<o.finallyLoc)return e(o.finallyLoc)}else if(a){if(this.prev<o.catchLoc)return e(o.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return e(o.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;0<=r;--r){var n=this.tryEntries[r];if(n.tryLoc<=this.prev&&u.call(n,"finallyLoc")&&this.prev<n.finallyLoc){var o=n;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var i=o?o.completion:{};return i.type=e,i.arg=t,o?(this.method="next",this.next=o.finallyLoc,l):this.complete(i)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),l},finish:function(e){for(var t=this.tryEntries.length-1;0<=t;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),k(r),l}},catch:function(e){for(var t=this.tryEntries.length-1;0<=t;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var o=n.arg;k(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,r){return this.delegate={iterator:I(e),resultName:t,nextLoc:r},"next"===this.method&&(this.arg=void 0),l}},a}function m(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),r.push.apply(r,n)}return r}function w(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?m(Object(r),!0).forEach(function(e){l()(t,e,r[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):m(Object(r)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))})}return t}var S={},E={},C=50,k=8e3,O=2e3,I=8e3;function L(e){return S[e]}function M(e){S[e]=(S[e]||0)+1}function B(e,t){E[e]=t}function _(e){return!!E[e]}function j(e){return Object(b.isUserFieldType)(e)||e===b.FieldType.Text||e===b.FieldType.DateTime}var P="MentionPermissionManager",D="PERMISSION_CHANGE_KEY",R="CHECK_USER_AVATAR_KEY",F=function(){function n(e,t){var r=this;d()(this,n),this.needLoadUserIds=new Set,this.batchFetchUsersArr=[],this.batchFetchOnlyLoadAvatarUsersArr=[],this.isFetchingAvatar=!1,this.initializedTables=new Set,this.batchUpdateFaster=Object(v.a)(function(){r.renderer.updateFaster()},O,{maxWait:I,trailing:!0}),this.batchFetchUsersPemission=function(e){r.needLoadUserIds.add(e),r.fetchUserPermission()},this.fetchUserPermission=Object(v.a)(function(){r.userPermissionManager.addUsers(Array.from(r.needLoadUserIds)),r.needLoadUserIds.clear()},500),this.renderer=e,this.bitableStore=t,this.userPermissionManager=new y.UserPermissionManager({onPermissionChange:function(e){var t=r.renderer.getActiveTable();t&&Object.keys(t.records).forEach(function(e){t.updateRecordVersionMap(e)}),r.batchUpdateFaster(),y.EventEmitter.emit(D,e)},onError:function(e){console.error(e)}})}return f()(n,[{key:"getFieldWhichHasUsers",value:function(e){var t=[];for(var r in e.fields){var n=e.fields[r];j(n.type)&&t.push(n)}return t}},{key:"checkUserToken",value:function(e){return e.type===b.SegmentType.Mention&&e.mentionType===b.MentionType.User&&!Number.isNaN(Number(e.token))}},{key:"initUsers",value:function(){var i=this,a=this.renderer.getActiveTable();if(a&&!this.initializedTables.has(a.id)){this.initializedTables.add(a.id);var e=this.getFieldWhichHasUsers(a),c=new Set,n=new Set,s=function(e,t){var r=a.getUserItemById(e);i.bitableStore.addUserWatch(e,a.id,t),(!r||r.avatarUrl&&b.filterUserUrls.some(function(e){return r.avatarUrl.includes(e)}))&&(_(e)||n.add(e))},t=function(o){a.records[o]&&e.forEach(function(r){switch(r.type){case b.FieldType.Text:var e=a.getCellValue(o,r.id);Array.isArray(e)&&e.forEach(function(e){i.checkUserToken(e)&&(c.add(e.token),s(e.token,r.id))});break;case b.FieldType.User:var t=a.getCellValue(o,r.id);t&&Array.isArray(t.users)&&t.users.forEach(function(e){c.add(e.userId),s(e.userId,r.id)});break;case b.FieldType.CreatedUser:case b.FieldType.ModifiedUser:r.getUserIds(a,o,r.id).forEach(function(e){c.add(e),s(e,r.id)});break;case b.FieldType.DateTime:var n=a.getReminder(o,r.id);n&&n.notifyEntities.users&&n.notifyEntities.users.forEach(function(e){var t=e.userId;c.add(t),s(t,r.id)})}})};for(var r in a.records)t(r);this.fetchUsers(a,Array.from(n)),this.addUsers(Array.from(c))}}},{key:"getAnonymousUserInfo",value:function(e,t){return e.userMap[t]||e.base.userMap[t]||w({userId:t},g.a)}},{key:"fetchUsers",value:function(s,e){var l=this,t=2<arguments.length&&void 0!==arguments[2]&&arguments[2];if(e.length){var o=[],i=function(a){var c=1<arguments.length&&void 0!==arguments[1]&&arguments[1];return l.userPermissionManager.fetchUsers(a).then(function(e){var t=e.payload||{},r=t.entities,o=void 0===r?{}:r,n=t.result_list,i=[];return((void 0===n?[]:n)||[]).forEach(function(e){var t=o[e],r=s.getUserItemById(e),n={userId:e,name:t.cn_name,enName:t.en_name,avatarUrl:t.avatar_url};if(!c&&t.avatar_url)return s.setUserItem(n,!0,c),void l.bitableStore.triggerTableRerenderWhenUserLoad(e);t.avatar_url?r&&r.avatarUrl!==t.avatar_url&&i.push(e):Object(p.a)(n.avatarUrl)&&Object(p.a)(n.name)&&Object(p.a)(n.enName)&&!Object(p.a)(n.userId)&&(n=l.getAnonymousUserInfo(s,n.userId)),s.setUserItem(n,!0,c)}),l.addUsers(a),i}).finally(function(){a.forEach(function(e){B(e,!1)})})};e.forEach(function(e){B(e,!0),t?l.batchFetchOnlyLoadAvatarUsersArr.push(e):l.batchFetchUsersArr.push(e)}),Promise.resolve().then(function(){for(;l.batchFetchUsersArr.length;){var e=l.batchFetchUsersArr.splice(0,C);i(e)}}),this.isFetchingAvatar||(this.isFetchingAvatar=!0,setTimeout(c()(x().mark(function e(){var t,r,n;return x().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:o=a()(l.batchFetchOnlyLoadAvatarUsersArr),l.batchFetchOnlyLoadAvatarUsersArr=[],t=[];case 3:if(!o.length){e.next=18;break}return r=o.splice(0,C),e.prev=5,e.next=8,i(r,!0);case 8:(n=e.sent)&&n.length&&t.push.apply(t,a()(n)),e.next=16;break;case 12:throw e.prev=12,e.t0=e.catch(5),l.isFetchingAvatar=!1,Error(e.t0);case 16:e.next=3;break;case 18:l.isFetchingAvatar=!1,t.forEach(function(e){l.bitableStore.triggerTableRerenderWhenUserLoad(e)});case 20:case"end":return e.stop()}},e,null,[[5,12]])})),k))}}},{key:"addUsers",value:function(e){this.userPermissionManager.addUsers(e),this.bindCellRenderMiddleWare()}},{key:"addUserByAction",value:function(e){var t=this;if(e.action===b.DataActionNames.SetRecord){var r=e.data,n=new Set;for(var o in r){var i=r[o],a=i.type,c=i.value;if(c)if(a===b.FieldType.Text&&Array.isArray(c))c.forEach(function(e){t.checkUserToken(e)&&n.add(e.token)});else if(a===b.FieldType.User&&Array.isArray(c.users))c.users.forEach(function(e){n.add(e.userId)});else if(a===b.FieldType.DateTime){var s=i.reminders&&i.reminders.reminder;null!=s&&s.notifyEntities.users&&s.notifyEntities.users.forEach(function(e){n.add(e.userId)})}}this.userPermissionManager.addUsers(Array.from(n))}}},{key:"setUserItemWithPermission",value:function(e,t,r,n,o){var i=!(5<arguments.length&&void 0!==arguments[5])||arguments[5];e.getUserItemById(t)||(o?e.setUserItem(o):_(t)||L(t)&&!(L(t)<3)||(i&&e.markDirtyForField(r,n),this.fetchUsers(e,[t]),this.addUsers([t]),M(t)));var a=this.userPermissionManager.getPermissionByUser(t);a?e.setUserPermission(t,a):this.batchFetchUsersPemission(t)}},{key:"checkUserPermission",value:function(e,r,n,t,o){var i=this,a=(r=r.table).fields[n];if(!a)return e;var c=a.type,s=e,l=Object(b.getProxyFieldAndValue)(a,e);return l.proxy&&(a=l.field,s=l.value,c=a.type),c===b.FieldType.Text&&Array.isArray(s)?s.forEach(function(e){var t;e.type===b.SegmentType.Mention&&e.mentionType===b.MentionType.User&&(e.name&&e.en_name&&(t={userId:e.token,name:e.name,enName:e.en_name,avatarUrl:e.link}),i.setUserItemWithPermission(r,e.token,n,o,t))}):Object(b.isUserFieldType)(c)&&s&&Array.isArray(s.users)&&s.users.forEach(function(e){i.setUserItemWithPermission(r,e.userId,n,o)}),e}},{key:"checkUserAvatar",value:function(e,t,r,n,o){var i=this,a=(t=t.table).fields[r];if(!a)return e;var c=a.type,s=e;if(Object(b.isUserFieldType)(c)&&s&&Array.isArray(s.users)){var l=s.users.map(function(e){return e.userId});l.forEach(function(e){i.bitableStore.addUserWatch(e,t.id,r)});var u=l.filter(function(e){return _(e)||t.checkUserInfo(e)?null:e});if(!u.length)return e;this.fetchUsers(t,u,!0)}return e}},{key:"bindCellRenderMiddleWare",value:function(){var e=this.renderer.activeBitableWidget;e&&(e.middleWare.setMiddleware(P,this.checkUserPermission.bind(this)),e.middleWare.setMiddleware(R,this.checkUserAvatar.bind(this)))}},{key:"reset",value:function(){this.userPermissionManager.destroy(),this.initializedTables.clear();var e=this.renderer.activeBitableWidget;e&&(e.middleWare.removeMiddleware(P),e.middleWare.removeMiddleware(R))}},{key:"addPermissionChangeListener",value:function(e){y.EventEmitter.on(D,e)}},{key:"removePermissionChangeListener",value:function(e){y.EventEmitter.off(D,e)}}]),n}(),N=function(){function e(){d()(this,e),this.userValidMap={}}return f()(e,[{key:"setUserItemValid",value:function(e){this.userValidMap[e]={isValid:!0}}},{key:"checkUserInfo",value:function(e){var t=!1;return e&&this.userValidMap[e]&&(t=this.userValidMap[e].isValid),t}},{key:"init",value:function(){this.userValidMap={}}}]),e}(),U=r("vb340"),V=r("vb500"),H=r("vb101");function W(e){H.a.BITABLE_PC_FIRST_INJECT_DEP=Date.now(),Object(y.injectBitableDep)(e),b.BitableGlobalConfig.setGlobalConfig({UserManagerHelper:{MentionPermissionManager:F,UserValidationManager:new N},config:{cardSyncMode:b.CardSyncMode.RealTime},collectBitableEvent:U.b,GzipWorker:new V.a})}r.d(t,"default",function(){return W})},vb745:function(e,t,r){"use strict";r.d(t,"a",function(){return u});var n=r("vb339"),o=r.n(n),i=r("vb746"),a=r("vb193");function c(e){return JSON.parse(i.a.ungzip(a.Buffer.from(e,"base64"),{to:"string"}))}function s(e){return a.Buffer.from(i.a.gzip(JSON.stringify(e),{level:9})).toString("base64")}var l={ungzip:c,gzip:s},u=function(e){var t=l[e.method];if(t)return t.apply(void 0,o()(e.args))}},vb747:function(e,t,r){"use strict";r.d(t,"a",function(){return o}),r.d(t,"b",function(){return i});var n=r("vb284");function o(e){var t=Object(n.selectCurrentSuitePermissionInfo)(e);return null!=t&&null!=t.get("permissions")&&Object(n.getIsEditable)(t.get("permissions"))}var i=Object(n.createPermissionsFieldSelector)("isContainerOrPageFA")},vb748:function(e,t,r){"use strict";r.d(t,"a",function(){return f}),r.d(t,"b",function(){return b}),r.d(t,"c",function(){return m}),r.d(t,"d",function(){return w});var n=r("vb106"),T=r.n(n),o=r("vb107"),i=r.n(o),a=r("vb101"),c=r("vb103"),s=r.n(c),l=r("vb104"),u=r.n(l),d=r("vb520"),h=r("vb284");function x(){x=function(){return a};var a={},e=Object.prototype,u=e.hasOwnProperty,d=Object.defineProperty||function(e,t,r){e[t]=r.value},t="function"==typeof Symbol?Symbol:{},o=t.iterator||"@@iterator",r=t.asyncIterator||"@@asyncIterator",n=t.toStringTag||"@@toStringTag";function i(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{i({},"")}catch(e){i=function(e,t,r){return e[t]=r}}function c(e,t,r,n){var o=t&&t.prototype instanceof s?t:s,i=Object.create(o.prototype),a=new O(n||[]);return d(i,"_invoke",{value:S(e,r,a)}),i}function h(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}a.wrap=c;var l={};function s(){}function f(){}function p(){}var v={};i(v,o,function(){return this});var b=Object.getPrototypeOf,y=b&&b(b(I([])));y&&y!==e&&u.call(y,o)&&(v=y);var g=p.prototype=s.prototype=Object.create(v);function m(e){["next","throw","return"].forEach(function(t){i(e,t,function(e){return this._invoke(t,e)})})}function w(c,s){function l(e,t,r,n){var o=h(c[e],c,t);if("throw"!==o.type){var i=o.arg,a=i.value;return a&&"object"==T()(a)&&u.call(a,"__await")?s.resolve(a.__await).then(function(e){l("next",e,r,n)},function(e){l("throw",e,r,n)}):s.resolve(a).then(function(e){i.value=e,r(i)},function(e){return l("throw",e,r,n)})}n(o.arg)}var t;d(this,"_invoke",{value:function(r,n){function e(){return new s(function(e,t){l(r,n,e,t)})}return t=t?t.then(e,e):e()}})}function S(i,a,c){var s="suspendedStart";return function(e,t){if("executing"===s)throw new Error("Generator is already running");if("completed"===s){if("throw"===e)throw t;return L()}for(c.method=e,c.arg=t;;){var r=c.delegate;if(r){var n=E(r,c);if(n){if(n===l)continue;return n}}if("next"===c.method)c.sent=c._sent=c.arg;else if("throw"===c.method){if("suspendedStart"===s)throw s="completed",c.arg;c.dispatchException(c.arg)}else"return"===c.method&&c.abrupt("return",c.arg);s="executing";var o=h(i,a,c);if("normal"===o.type){if(s=c.done?"completed":"suspendedYield",o.arg===l)continue;return{value:o.arg,done:c.done}}"throw"===o.type&&(s="completed",c.method="throw",c.arg=o.arg)}}}function E(e,t){var r=t.method,n=e.iterator[r];if(void 0===n)return t.delegate=null,"throw"===r&&e.iterator.return&&(t.method="return",t.arg=void 0,E(e,t),"throw"===t.method)||"return"!==r&&(t.method="throw",t.arg=new TypeError("The iterator does not provide a '"+r+"' method")),l;var o=h(n,e.iterator,t.arg);if("throw"===o.type)return t.method="throw",t.arg=o.arg,t.delegate=null,l;var i=o.arg;return i?i.done?(t[e.resultName]=i.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,l):i:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,l)}function C(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function k(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function O(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(C,this),this.reset(!0)}function I(t){if(t){var e=t[o];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var r=-1,n=function e(){for(;++r<t.length;)if(u.call(t,r))return e.value=t[r],e.done=!1,e;return e.value=void 0,e.done=!0,e};return n.next=n}}return{next:L}}function L(){return{value:void 0,done:!0}}return f.prototype=p,d(g,"constructor",{value:p,configurable:!0}),d(p,"constructor",{value:f,configurable:!0}),f.displayName=i(p,n,"GeneratorFunction"),a.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===f||"GeneratorFunction"===(t.displayName||t.name))},a.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,p):(e.__proto__=p,i(e,n,"GeneratorFunction")),e.prototype=Object.create(g),e},a.awrap=function(e){return{__await:e}},m(w.prototype),i(w.prototype,r,function(){return this}),a.AsyncIterator=w,a.async=function(e,t,r,n,o){void 0===o&&(o=Promise);var i=new w(c(e,t,r,n),o);return a.isGeneratorFunction(t)?i:i.next().then(function(e){return e.done?e.value:i.next()})},m(g),i(g,n,"Generator"),i(g,o,function(){return this}),i(g,"toString",function(){return"[object Generator]"}),a.keys=function(e){var r=Object(e),n=[];for(var t in r)n.push(t);return n.reverse(),function e(){for(;n.length;){var t=n.pop();if(t in r)return e.value=t,e.done=!1,e}return e.done=!0,e}},a.values=I,O.prototype={constructor:O,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(k),!e)for(var t in this)"t"===t.charAt(0)&&u.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(r){if(this.done)throw r;var n=this;function e(e,t){return i.type="throw",i.arg=r,n.next=e,t&&(n.method="next",n.arg=void 0),!!t}for(var t=this.tryEntries.length-1;0<=t;--t){var o=this.tryEntries[t],i=o.completion;if("root"===o.tryLoc)return e("end");if(o.tryLoc<=this.prev){var a=u.call(o,"catchLoc"),c=u.call(o,"finallyLoc");if(a&&c){if(this.prev<o.catchLoc)return e(o.catchLoc,!0);if(this.prev<o.finallyLoc)return e(o.finallyLoc)}else if(a){if(this.prev<o.catchLoc)return e(o.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return e(o.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;0<=r;--r){var n=this.tryEntries[r];if(n.tryLoc<=this.prev&&u.call(n,"finallyLoc")&&this.prev<n.finallyLoc){var o=n;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var i=o?o.completion:{};return i.type=e,i.arg=t,o?(this.method="next",this.next=o.finallyLoc,l):this.complete(i)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),l},finish:function(e){for(var t=this.tryEntries.length-1;0<=t;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),k(r),l}},catch:function(e){for(var t=this.tryEntries.length-1;0<=t;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var o=n.arg;k(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,r){return this.delegate={iterator:I(e),resultName:t,nextLoc:r},"next"===this.method&&(this.arg=void 0),l}},a}var f=u()({loader:function(){var e=i()(x().mark(function e(){var t;return x().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a.a.BITABLE_COMMENT_BAR_LOAD_START=Date.now(),e.next=3,Promise.all([r.e("23ec269fa7e1"),r.e("7bb53f704439"),r.e("1e1ebf3e2b21")]).then(r.bind(null,"vb1307"));case 3:return t=e.sent.BitableCommentBar,a.a.BITABLE_COMMENT_BAR_LOAD_END=Date.now(),e.abrupt("return",t);case 6:case"end":return e.stop()}},e)}));function t(){return e.apply(this,arguments)}return t}(),loading:function(){return null}}),p=u()({loader:function(){var e=i()(x().mark(function e(){return x().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.all([r.e("23ec269fa7e1"),r.e("7bb53f704439"),r.e("1e1ebf3e2b21")]).then(r.bind(null,"vb1311"));case 2:return e.abrupt("return",e.sent.BitableCommentCard);case 3:case"end":return e.stop()}},e)}));function t(){return e.apply(this,arguments)}return t}(),loading:function(){return s.a.createElement(d.a,null)}}),v=u()({loader:function(){var e=i()(x().mark(function e(){return x().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.all([r.e("23ec269fa7e1"),r.e("7bb53f704439"),r.e("1e1ebf3e2b21")]).then(r.bind(null,"vb1314"));case 2:return e.abrupt("return",e.sent.BitableCommentCard);case 3:case"end":return e.stop()}},e)}));function t(){return e.apply(this,arguments)}return t}(),loading:function(){return s.a.createElement(d.a,null)}}),b=u()({loader:function(){var e=i()(x().mark(function e(){return x().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.all([r.e("23ec269fa7e1"),r.e("7bb53f704439"),r.e("3e7bc8266763")]).then(r.bind(null,"vb1316"));case 2:return e.abrupt("return",e.sent.DocCommentBar);case 3:case"end":return e.stop()}},e)}));function t(){return e.apply(this,arguments)}return t}(),loading:function(){return null}}),y=u()({loader:function(){var e=i()(x().mark(function e(){return x().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.all([r.e("23ec269fa7e1"),r.e("7bb53f704439"),r.e("3e7bc8266763")]).then(r.bind(null,"vb1317"));case 2:return e.abrupt("return",e.sent.DocCommentCard);case 3:case"end":return e.stop()}},e)}));function t(){return e.apply(this,arguments)}return t}(),loading:function(){return s.a.createElement(d.a,null)}}),g=u()({loader:function(){var e=i()(x().mark(function e(){return x().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.all([r.e("23ec269fa7e1"),r.e("7bb53f704439"),r.e("3e7bc8266763")]).then(r.bind(null,"vb1318"));case 2:return e.abrupt("return",e.sent.DocCommentCard);case 3:case"end":return e.stop()}},e)}));function t(){return e.apply(this,arguments)}return t}(),loading:function(){return s.a.createElement(d.a,null)}});function m(){return null!==h.isCardModalV2Enable&&void 0!==h.isCardModalV2Enable&&Object(h.isCardModalV2Enable)()?v:p}function w(){return null!==h.isCardModalV2Enable&&void 0!==h.isCardModalV2Enable&&Object(h.isCardModalV2Enable)()?g:y}},vb749:function(e,t,r){"use strict";r.d(t,"a",function(){return s}),r.d(t,"b",function(){return l});var n=r("vb106"),T=r.n(n),o=r("vb107"),i=r.n(o),a=r("vb104"),c=r.n(a);function x(){x=function(){return a};var a={},e=Object.prototype,u=e.hasOwnProperty,d=Object.defineProperty||function(e,t,r){e[t]=r.value},t="function"==typeof Symbol?Symbol:{},o=t.iterator||"@@iterator",r=t.asyncIterator||"@@asyncIterator",n=t.toStringTag||"@@toStringTag";function i(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{i({},"")}catch(e){i=function(e,t,r){return e[t]=r}}function c(e,t,r,n){var o=t&&t.prototype instanceof s?t:s,i=Object.create(o.prototype),a=new O(n||[]);return d(i,"_invoke",{value:S(e,r,a)}),i}function h(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}a.wrap=c;var l={};function s(){}function f(){}function p(){}var v={};i(v,o,function(){return this});var b=Object.getPrototypeOf,y=b&&b(b(I([])));y&&y!==e&&u.call(y,o)&&(v=y);var g=p.prototype=s.prototype=Object.create(v);function m(e){["next","throw","return"].forEach(function(t){i(e,t,function(e){return this._invoke(t,e)})})}function w(c,s){function l(e,t,r,n){var o=h(c[e],c,t);if("throw"!==o.type){var i=o.arg,a=i.value;return a&&"object"==T()(a)&&u.call(a,"__await")?s.resolve(a.__await).then(function(e){l("next",e,r,n)},function(e){l("throw",e,r,n)}):s.resolve(a).then(function(e){i.value=e,r(i)},function(e){return l("throw",e,r,n)})}n(o.arg)}var t;d(this,"_invoke",{value:function(r,n){function e(){return new s(function(e,t){l(r,n,e,t)})}return t=t?t.then(e,e):e()}})}function S(i,a,c){var s="suspendedStart";return function(e,t){if("executing"===s)throw new Error("Generator is already running");if("completed"===s){if("throw"===e)throw t;return L()}for(c.method=e,c.arg=t;;){var r=c.delegate;if(r){var n=E(r,c);if(n){if(n===l)continue;return n}}if("next"===c.method)c.sent=c._sent=c.arg;else if("throw"===c.method){if("suspendedStart"===s)throw s="completed",c.arg;c.dispatchException(c.arg)}else"return"===c.method&&c.abrupt("return",c.arg);s="executing";var o=h(i,a,c);if("normal"===o.type){if(s=c.done?"completed":"suspendedYield",o.arg===l)continue;return{value:o.arg,done:c.done}}"throw"===o.type&&(s="completed",c.method="throw",c.arg=o.arg)}}}function E(e,t){var r=t.method,n=e.iterator[r];if(void 0===n)return t.delegate=null,"throw"===r&&e.iterator.return&&(t.method="return",t.arg=void 0,E(e,t),"throw"===t.method)||"return"!==r&&(t.method="throw",t.arg=new TypeError("The iterator does not provide a '"+r+"' method")),l;var o=h(n,e.iterator,t.arg);if("throw"===o.type)return t.method="throw",t.arg=o.arg,t.delegate=null,l;var i=o.arg;return i?i.done?(t[e.resultName]=i.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,l):i:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,l)}function C(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function k(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function O(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(C,this),this.reset(!0)}function I(t){if(t){var e=t[o];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var r=-1,n=function e(){for(;++r<t.length;)if(u.call(t,r))return e.value=t[r],e.done=!1,e;return e.value=void 0,e.done=!0,e};return n.next=n}}return{next:L}}function L(){return{value:void 0,done:!0}}return f.prototype=p,d(g,"constructor",{value:p,configurable:!0}),d(p,"constructor",{value:f,configurable:!0}),f.displayName=i(p,n,"GeneratorFunction"),a.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===f||"GeneratorFunction"===(t.displayName||t.name))},a.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,p):(e.__proto__=p,i(e,n,"GeneratorFunction")),e.prototype=Object.create(g),e},a.awrap=function(e){return{__await:e}},m(w.prototype),i(w.prototype,r,function(){return this}),a.AsyncIterator=w,a.async=function(e,t,r,n,o){void 0===o&&(o=Promise);var i=new w(c(e,t,r,n),o);return a.isGeneratorFunction(t)?i:i.next().then(function(e){return e.done?e.value:i.next()})},m(g),i(g,n,"Generator"),i(g,o,function(){return this}),i(g,"toString",function(){return"[object Generator]"}),a.keys=function(e){var r=Object(e),n=[];for(var t in r)n.push(t);return n.reverse(),function e(){for(;n.length;){var t=n.pop();if(t in r)return e.value=t,e.done=!1,e}return e.done=!0,e}},a.values=I,O.prototype={constructor:O,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(k),!e)for(var t in this)"t"===t.charAt(0)&&u.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(r){if(this.done)throw r;var n=this;function e(e,t){return i.type="throw",i.arg=r,n.next=e,t&&(n.method="next",n.arg=void 0),!!t}for(var t=this.tryEntries.length-1;0<=t;--t){var o=this.tryEntries[t],i=o.completion;if("root"===o.tryLoc)return e("end");if(o.tryLoc<=this.prev){var a=u.call(o,"catchLoc"),c=u.call(o,"finallyLoc");if(a&&c){if(this.prev<o.catchLoc)return e(o.catchLoc,!0);if(this.prev<o.finallyLoc)return e(o.finallyLoc)}else if(a){if(this.prev<o.catchLoc)return e(o.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return e(o.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;0<=r;--r){var n=this.tryEntries[r];if(n.tryLoc<=this.prev&&u.call(n,"finallyLoc")&&this.prev<n.finallyLoc){var o=n;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var i=o?o.completion:{};return i.type=e,i.arg=t,o?(this.method="next",this.next=o.finallyLoc,l):this.complete(i)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),l},finish:function(e){for(var t=this.tryEntries.length-1;0<=t;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),k(r),l}},catch:function(e){for(var t=this.tryEntries.length-1;0<=t;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var o=n.arg;k(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,r){return this.delegate={iterator:I(e),resultName:t,nextLoc:r},"next"===this.method&&(this.arg=void 0),l}},a}var s=c()({loader:function(){var e=i()(x().mark(function e(){return x().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r.e("4b5680a9ad99").then(r.bind(null,"vb1319"));case 2:return e.abrupt("return",e.sent.BitableMentionBar);case 3:case"end":return e.stop()}},e)}));function t(){return e.apply(this,arguments)}return t}(),loading:function(){return null}}),l=c()({loader:function(){var e=i()(x().mark(function e(){return x().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r.e("91b6e97cc520").then(r.bind(null,"vb1320"));case 2:return e.abrupt("return",e.sent.DocMentionBar);case 3:case"end":return e.stop()}},e)}));function t(){return e.apply(this,arguments)}return t}(),loading:function(){return null}})},vb750:function(e,o,i){"use strict";(function(t){i.d(o,"a",function(){return e});var r=i("vb102"),n=i("vb284");function e(e){e===n.DriveUploadErrorType.NumberOfAttachmentsExceeded?r.Toast.show({type:"error",content:t("Bitable_Attachment_UnsupportedAttachmentFormat_Toast")}):r.Toast.show({type:"error",content:t("common.server_busy")})}}).call(this,i("vb163"))},vb872:function(e,t,r){"use strict";var i=r("vb470"),a=r("vb620"),c=r("vb313");function n(e,n){var o={};return n=Object(c.a)(n,3),Object(a.a)(e,function(e,t,r){Object(i.a)(o,t,n(e,t,r))}),o}t.a=n},vb873:function(e,t,r){"use strict";var n=r("vb608"),o=r.n(n),i=r("vb103"),a=r.n(i);function c(e,t){var r={};for(var n in e)0<=t.indexOf(n)||Object.prototype.hasOwnProperty.call(e,n)&&(r[n]=e[n]);return r}t.a=function(e){e.styles;var t=c(e,["styles"]);return a.a.createElement("svg",o()({width:"18",height:"18",viewBox:"0 0 18 18",xmlns:"http://www.w3.org/2000/svg"},t),a.a.createElement("g",{fill:"#07F",fillRule:"nonzero"},a.a.createElement("circle",{opacity:".4",cx:"3.61",cy:"3.5",r:"3.5"}),a.a.createElement("path",{d:"M14.5 7a3.5 3.5 0 1 0 0-7 3.5 3.5 0 0 0 0 7z"}),a.a.createElement("circle",{opacity:".7",cx:"14.5",cy:"14.5",r:"3.5"}),a.a.createElement("circle",{opacity:".2",cx:"3.5",cy:"14.5",r:"3.5"})))}},vb874:function(e,t,r){},vb875:function(e,t,r){"use strict";r.d(t,"e",function(){return l}),r.d(t,"a",function(){return h}),r.d(t,"b",function(){return f}),r.d(t,"c",function(){return p}),r.d(t,"d",function(){return v});var n,o,i=r("vb102"),a=r("vb214"),c=r.n(a);(o=n||(n={}))[o.UNDEFINED=0]="UNDEFINED",o[o.FEED=1]="FEED",o[o.ANNOUNCE=2]="ANNOUNCE",o[o.MINUTE=3]="MINUTE";var s="report";function l(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"";return c.a.parseUrl(e).query}function u(e){if(!i.browser.isFeed)return 0;var t=+e.lark||1;switch(e.open_type){case"announce":t=n.ANNOUNCE;break;case"meeting_notes":t=n.MINUTE}return t}function d(e){return u(l(e))}function h(){return d(location.href)===n.ANNOUNCE}function f(){return i.browser.isOpendoc}function p(){var e=l(location.href);return!!e&&e.open_type===s}function v(){return"true"===l(window.location.search).hideCommentBtn}},vb876:function(e,t,r){}}]);
//# sourceMappingURL=//slardar.bytedance.net/api_v2/browser/jserr/get_sourcemap?bid=docs_pc&js_filename=vb_EmbeddedBitable_DocManager.3c9633c1b3.chunk.js