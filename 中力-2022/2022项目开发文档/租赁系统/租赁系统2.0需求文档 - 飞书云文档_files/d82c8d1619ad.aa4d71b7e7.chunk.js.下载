(window.webpackJsonp=window.webpackJsonp||[]).push([["d82c8d1619ad"],{vb1274:function(e,i,r){"use strict";r.r(i),function(g){r.d(i,"SingleSelectorEditor",function(){return n});var C=r("vb143"),e=r("vb152"),I=r.n(e),o=r("vb161"),t=r("vb103"),m=r.n(t),p=(r("vb147"),r("vb148"),r("vb112"),r("vb164"),r("vb167"),r("vb113"),r("vb155"),r("vb116"),r("vb118"),r("vb120"),r("vb174"),r("vb119"),r("vb121"),r("vb117"),r("vb115"),r("vb111")),x=r("vb344"),n=(r("vb129"),r("vb223"),r("vb214"),r("vb232"),r("vb187"),r("vb225"),r("vb224"),r("vb128"),r("vb122"),r("vb233"),r("vb234"),r("vb235"),r("vb123"),r("vb236"),r("vb193"),r("vb237"),r("vb238"),r("vb124"),r("vb239"),r("vb104"),r("vb159"),r("vb240"),r("vb134"),r("vb131"),r("vb226"),r("vb241"),r("vb114"),r("vb110"),r("vb125"),r("vb242"),r("vb127"),r("vb132"),r("vb227"),r("vb135"),r("vb228"),r("vb229"),r("vb133"),r("vb126"),r("vb243"),r("vb262"),r("vb244"),r("vb245"),r("vb246"),r("vb247"),r("vb194"),r("vb248"),r("vb249"),r("vb201"),r("vb260"),r("vb267"),r("vb250"),r("vb136"),r("vb251"),r("vb130"),r("vb252"),function(a){function d(){var m,t,i,n;Object(C.ov)(this,d);for(var e=arguments.length,r=new Array(e),o=0;o<e;o++)r[o]=arguments[o];return(m=a.call.apply(a,[this].concat(r))||this).editorRef=null,m.preventOpen=!1,m.focusAfterSetRef=!1,m.state={value:null,options:[],loading:!1},m.getField=function(){var e=m.props,t=e.tableId,n=e.fieldId;return e.bitableStore.base.getTableById(t).fields[n]},m.getDynamicOptions=function(){var e=m.props.getFormValue;m.setState({loading:!0});var t=m.props.recordId;return t&&!Object(C.XI)(t)||!e||(t=Object(C.YI)(m.getField(),e())),console.log("getFormValue",m.getField(),t,m.props,e),Object(C.ZI)(m.getField(),t).then(function(e){return e}).catch(function(e){return Promise.reject(e)}).finally(function(){m.setState({loading:!1})})},m.setEditorRef=function(e){m.editorRef=e,m.editorRef&&(m.focusAfterSetRef&&m.editorRef.focus(),m.focusAfterSetRef=!1)},m.onCreateOption=(n=Object(C.uY)(I.a.mark(function e(t){var n,i,r,o,a,d,s,c,l,u,b;return I.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!(n=m.onAddOption(t))){e.next=17;break}if(!Object(C.fJ)(n)){e.next=4;break}return e.abrupt("return");case 4:return e.prev=4,i=m.props,r=i.tableId,o=i.viewId,a=i.fieldId,d=i.executeAction,e.next=8,d(function(){return{cmd:C.Fy.SetFieldAttr,tableId:r,viewId:o,fieldId:a,data:n.toJSON()}});case 8:(s=n.findOptionByName(t))&&m.onChange(s.id),e.next=17;break;case 12:e.prev=12,e.t0=e.catch(4),p.toast.error(g("common.create_failed")),console.error("error create",e.t0),C.hy.ravenCatch(e.t0,{key:C.iy.ErrorEvent});case 17:c=m.props,l=c.tableId,u=c.viewId,b=c.view,Object(C.eJ)(l,u,b);case 19:case"end":return e.stop()}},e,null,[[4,12]])})),function(e){return n.apply(this,arguments)}),m.onUpdateOption=(i=Object(C.uY)(I.a.mark(function e(t,n,i){var r,o,a,d,s,c,l,u,b,p,v,f,h,O,y,S,g;return I.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=m.props,o=r.tableId,a=r.viewId,d=r.fieldId,s=r.executeAction,c=r.bitableStore,l=r.view,u=c.base.getTableById(o).fields[d],c&&o&&n&&(b=c.base.getTableById(o),p=a?b.getViewById(a):void 0,C.ob.collectBitableEvent(C.On.BitableColorSet,{action:"choose_color",from_color:i,to_color:t.color,source:C.gJ.SelectPanel,table_id:o,view_id:a,bitable_view_type:p&&p.type?C.Cz[p.type]:void 0})),!u){e.next=12;break}if(v=u.id,f=u.name,h=u.type,O=u.property,y=u.fieldUIType,S=O.options.map(function(e){return e.id===t.id?t:e}),g={id:v,name:f,type:h,property:{options:S}},!Object(C.fJ)(u)){e.next=9;break}return e.abrupt("return");case 9:return e.next=11,s(function(){return{cmd:C.Fy.SetFieldAttr,tableId:o,viewId:a,fieldId:d,data:g}});case 11:l&&C.ob.collectBitableEvent(C.On.BitableSelectUpdateOption,{table_id:o,view_id:a,bitable_view_type:C.Cz[l.type],data_source:c.Options.module,bitable_field_type:C.lC[y],source:C.gJ.SelectPanel},!0);case 12:case"end":return e.stop()}},e)})),function(e,t,n){return i.apply(this,arguments)}),m.onChange=(t=Object(C.uY)(I.a.mark(function e(t){var n,i,r,o,a,d,s,c,l,u,b,p,v,f;return I.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=m.props,i=n.tableId,r=n.viewId,o=n.view,a=n.recordId,d=n.fieldId,s=n.isCardEdit,c=n.cardSyncMode,l=n.executeAction,u=n.bitableStore,b=n.endEdit,p=n.renderer,n.editable){e.next=3;break}return e.abrupt("return");case 3:return v=p.activeBitableWidget.isFloatLayerOpen,f=m.isSearched,c!==C.tx.OnDemand&&c!==C.tx.Custom||m.setState({value:t}),e.next=8,l(function(){return{cmd:C.Fy.SetRecord,tableId:i,viewId:r,recordId:a,data:Object(C.Ww)({},d,{value:""===t?null:t,type:C.og.SingleSelect})}});case 8:o&&C.ob.collectBitableEvent(C.On.BitableRecordEdit,Object.assign({smartable_token:u.md5Token,row:o.getVisibleRecordIndexById(a),col:o.getFieldIndexById(d),table_id:i,view_id:r,bitable_editor_type:s?"card":"cell",bitable_view_type:C.Cz[o.type],bitable_field_type:C.lC[C.ex.SingleSelect],bitable_edit_search:f,data_source:u.Options.module,is_record_floating:v},p.getRecordEditLogParams()),!0),b&&b(!0);case 10:case"end":return e.stop()}},e)})),function(e){return t.apply(this,arguments)}),m.onOpenSelectList=function(){m.props.renderer.setGlobalContext(C.aJ.CellSelectOpened,!0)},m.onEndedEdit=function(){m.props.renderer.setGlobalContext(C.aJ.CellSelectOpened,!1)},m.onOptionClick=function(e,t){var n=m.props,i=n.tableId,r=n.viewId,o=n.view;!t&&Object(C.bJ)(i,r,o)},m.onSearch=function(e){var t=m.props,n=t.tableId,i=t.viewId,r=t.view;Object(C.cJ)(n,i,r)},m}return Object(C.bu)(d,a),Object(C.Pw)(d,[{key:"componentDidMount",value:function(){this.gridContext=this.props.renderer.activeBitableWidget.getGridWidget(),this.unbindContextEvent=this.bindContextEvent(),this.bindDataSource(this.props)}},{key:"componentDidUpdate",value:function(e){e.tableId===this.props.tableId&&e.fieldId===this.props.fieldId&&e.recordId===this.props.recordId||this.bindDataSource(this.props)}},{key:"componentWillUnmount",value:function(){this.unbindContextEvent&&this.unbindContextEvent(),this.dataSource&&this.dataSource.destroyed()}},{key:"onStartEdit",value:function(){this.editorRef&&this.editorRef.onStartEdit(),C.cz.collectClickEvent(C.Bc.CcmBitableSearchClick,{click:"search_option"})}},{key:"onEndEdit",value:function(e){Object(C.yH)(this.props.relativeClass,C.ex.SingleSelect,this.state.value),this.editorRef&&this.editorRef.onEndEdit()}},{key:"focus",value:function(){this.editorRef?this.editorRef.focus():this.focusAfterSetRef=!0}},{key:"setDefaultValue",value:function(){this.setEditorValue(this.props.value||"")}},{key:"setEditorValue",value:function(e){this.setState({value:e})}},{key:"bindDataSource",value:function(e){var t=this;this.dataSource&&this.dataSource.destroyed();var n,i=e.tableId,r=e.fieldId,o=e.recordId,a=e.bitableStore;this.props.cardSyncMode===C.tx.OnDemand&&(n=e.value),this.dataSource=new C.dJ(i,r,o,a,n);var d=this.dataSource.getSource();this.updateList(d),this.props.cardSyncMode!==C.tx.OnDemand&&this.dataSource.bindUpdate(function(e){t.updateList(e)})}},{key:"bindContextEvent",value:function(){var e=this,t=this.getContextListeners();return this.gridContext&&this.gridContext.addGridEventsBindListener(t),function(){e.gridContext&&e.gridContext.removeGridEventsBindListener(t)}}},{key:"updateList",value:function(e,t){if(null!=e){var n=this.getField().isDynamic,i=e.options.map(function(e){return{id:e.id,name:e.name,color:e.color}}),r=Object.assign({},this.state);this.props.cardSyncMode!==C.tx.Custom&&n?r={value:""===e.value?null:e.value,options:[]}:this.props.cardSyncMode!==C.tx.Custom||n?this.props.cardSyncMode===C.tx.Custom||n||(r={value:""===e.value?null:e.value,options:i||[]}):r={options:i||[]},this.setState(r,function(){t&&t()})}}},{key:"getContextListeners",value:function(){var e,t=this;return Object(C.Ww)(e={},C.pC.CoverMouseDown,function(e){t.editorRef&&t.editorRef.isOpened()?t.preventOpen=!0:t.preventOpen=!1}),Object(C.Ww)(e,C.pC.DeleteSingleSelectCell,function(e){Object(C.yH)(t.props.relativeClass,C.ex.MultiSelect,e),t.onChange(e)}),Object(C.Ww)(e,C.pC.CoverClick,function(e){t.preventOpen||(t.editorRef&&!t.editorRef.isOpened()?t.props.startEdit&&t.props.startEdit(!1):t.props.endEdit&&t.props.endEdit(!0))}),e}},{key:"onAddOption",value:function(t){var e=this.state.options,n=this.props.bitableStore.base.getTableById(this.props.tableId);if(n&&!e.find(function(e){return e.name===t})){var i=Object(o.a)(n.fields[this.props.fieldId]);e.forEach(function(e){e.id&&!i.findOptionById(e.id)&&i.addOption(e.name,null,e.id)});var r=i.addOption(t);return this.props.cardSyncMode===C.tx.OnDemand&&(this.setState({options:[].concat(Object(C.hI)(e),[{id:r,name:t,color:e.length}])}),this.setState({value:r})),i}return null}},{key:"isSearched",get:function(){return!(!this.editorRef||!this.editorRef.isSearched)}},{key:"getSelectorCellPosition",value:function(){if(this.props.staticPosition)return{};var e=this.props,t=e.anchorRef,n=e.width,i={left:0,top:1,width:n};return t&&Object(C.bE)(t,i,{width:n}),i}},{key:"render",value:function(){var e=this,t=this.props,n=t.bitableStore,i=t.tableId,r=t.editable,o=t.getPinyin,a=t.maxListHeight,d=t.relativeClass,s=t.rect,c=t.isCardEdit,l=t.fieldEditable,u=this.state,b=u.value,p=u.options,v=u.loading,f=this.getField().isDynamic,h={isDynamic:f};f&&(h.getDynamicOptions=this.getDynamicOptions,h.getTargetFieldOptions=function(){return e.getField().getOptions()},h.emptyListPlaceholder=g("Bitable_SingleOption_NoAvailableOption_Web"));var O=null==n?void 0:n.base.isPro(),y=Object(C.wH)(n,i),S=Object(C.xH)({isFieldEditablePermission:y,placeholder:g("Bitable_Form_PleaseSelect"),isPro:O});return m.a.createElement(x.b,Object(C.Kx)({},h,{className:"selector-cell single-selector-cell",ref:this.setEditorRef,options:p,placeholder:S,style:this.getSelectorCellPosition(),onOpenSelectList:this.onOpenSelectList,onEndedEdit:this.onEndedEdit,value:b,editable:r,maxListHeight:a,relativeClass:d,anchorHeight:s?s.height:0,offY:c?1:0,onChange:this.onChange,onSearch:this.onSearch,onUpdateOption:this.onUpdateOption,onCreateOption:this.onCreateOption,onOptionClick:this.onOptionClick,getPinyin:o,disableCreateOption:!l,disableEditOption:!l,disableAutoFocus:C.rx.isIPad,loading:v}))}}]),d}(m.a.PureComponent))}.call(this,r("vb163"))},vb344:function(e,t,n){"use strict";n.d(t,"a",function(){return d}),n.d(t,"b",function(){return a}),n.d(t,"c",function(){return s});var i=n("vb152"),r=n.n(i),o=n("vb143"),a=Object(o.Uy)(Object(o.uY)(r.a.mark(function e(){return r.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.e("d645920e395f").then(n.bind(null,"vb485"));case 2:return e.abrupt("return",e.sent.SingleSelectorEditor);case 3:case"end":return e.stop()}},e)}))),d=Object(o.Uy)(Object(o.uY)(r.a.mark(function e(){return r.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.e("d67d8ab4f4c1").then(n.bind(null,"vb486"));case 2:return e.abrupt("return",e.sent.MultiSelectorEditor);case 3:case"end":return e.stop()}},e)}))),s=Object(o.Uy)(Object(o.uY)(r.a.mark(function e(){return r.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.e("3416a75f4cea").then(n.bind(null,"vb487"));case 2:return e.abrupt("return",e.sent.UserSelectorEditor);case 3:case"end":return e.stop()}},e)})))}}]);
//# sourceMappingURL=//slardar.bytedance.net/api_v2/browser/jserr/get_sourcemap?bid=docs_pc&js_filename=d82c8d1619ad.aa4d71b7e7.chunk.js